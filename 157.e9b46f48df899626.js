"use strict";(self.webpackChunkbarcode_reader=self.webpackChunkbarcode_reader||[]).push([[157],{157:(tl,Ws,Ni)=>{Ni.r(Ws),Ni.d(Ws,{ContentManagmentModule:()=>$a});var Ti,Vt,De,p,qn=Ni(814),Wr=Ni(385),ce=Ni(946);function Ys(p,t,r,f,C,T,S){try{var O=p[T](S),x=O.value}catch(L){return void r(L)}O.done?t(x):Promise.resolve(x).then(f,C)}function te(p){return function(){var t=this,r=arguments;return new Promise(function(f,C){var T=p.apply(t,r);function S(x){Ys(T,f,C,S,O,"next",x)}function O(x){Ys(T,f,C,S,O,"throw",x)}S(void 0)})}}function Ge(p,t,r,f){if("a"===r&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?p!==t||!f:!t.has(p))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?f:"a"===r?f.call(p):f?f.value:t.get(p)}function wi(p,t,r,f,C){if("m"===f)throw new TypeError("Private method is not writable");if("a"===f&&!C)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?p!==t||!C:!t.has(p))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===f?C.call(p,r):C?C.value=r:t.set(p,r),r}"function"==typeof SuppressedError&&SuppressedError,(p=Ti||(Ti={}))[p.BOPM_BLOCK=0]="BOPM_BLOCK",p[p.BOPM_UPDATE=1]="BOPM_UPDATE",function(p){p[p.CCUT_AUTO=0]="CCUT_AUTO",p[p.CCUT_FULL_CHANNEL=1]="CCUT_FULL_CHANNEL",p[p.CCUT_Y_CHANNEL_ONLY=2]="CCUT_Y_CHANNEL_ONLY",p[p.CCUT_RGB_R_CHANNEL_ONLY=3]="CCUT_RGB_R_CHANNEL_ONLY",p[p.CCUT_RGB_G_CHANNEL_ONLY=4]="CCUT_RGB_G_CHANNEL_ONLY",p[p.CCUT_RGB_B_CHANNEL_ONLY=5]="CCUT_RGB_B_CHANNEL_ONLY"}(Vt||(Vt={})),function(p){p[p.IPF_BINARY=0]="IPF_BINARY",p[p.IPF_BINARYINVERTED=1]="IPF_BINARYINVERTED",p[p.IPF_GRAYSCALED=2]="IPF_GRAYSCALED",p[p.IPF_NV21=3]="IPF_NV21",p[p.IPF_RGB_565=4]="IPF_RGB_565",p[p.IPF_RGB_555=5]="IPF_RGB_555",p[p.IPF_RGB_888=6]="IPF_RGB_888",p[p.IPF_ARGB_8888=7]="IPF_ARGB_8888",p[p.IPF_RGB_161616=8]="IPF_RGB_161616",p[p.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",p[p.IPF_ABGR_8888=10]="IPF_ABGR_8888",p[p.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",p[p.IPF_BGR_888=12]="IPF_BGR_888",p[p.IPF_BINARY_8=13]="IPF_BINARY_8",p[p.IPF_NV12=14]="IPF_NV12",p[p.IPF_BINARY_8_INVERTED=15]="IPF_BINARY_8_INVERTED"}(De||(De={}));const Hs=p=>Object.prototype.toString.call(p),Yr=p=>Array.isArray?Array.isArray(p):"[object Array]"===Hs(p),Hr=p=>"[object Boolean]"===Hs(p),ot=p=>"number"==typeof p&&!Number.isNaN(p),Nt=p=>null!==p&&"object"==typeof p&&!Array.isArray(p),Xs=p=>!(!Nt(p)||!(p.bytes instanceof Uint8Array)||!ot(p.width)||p.width<=0||!ot(p.height)||p.height<=0||!ot(p.stride)||p.stride<=0||!("format"in p)||"tag"in p&&!oa(p.tag)),oa=p=>!!Nt(p)&&!!ot(p.imageId)&&"type"in p,Bi=p=>!!Nt(p)&&!!ot(p.x)&&!!ot(p.y);function zs(p,t){return Xr.apply(this,arguments)}function Xr(){return Xr=te(function*(p,t){return yield new Promise((r,f)=>{let C=new XMLHttpRequest;C.open("GET",p,!0),C.responseType=t,C.send(),C.onloadend=te(function*(){r(C.response)}),C.onerror=()=>{f(new Error("Network Error: "+C.statusText))}})}),Xr.apply(this,arguments)}const gn=(p,t)=>{let r=p.split("."),f=t.split(".");for(let C=0;C<r.length&&C<f.length;++C){let T=r[C],S=f[C];if(T===S)continue;let O=parseInt(r[C]),x=parseInt(f[C]);return O===x||Number.isNaN(O)&&Number.isNaN(x)?T<S?-1:1:O<x||Number.isNaN(O)&&Number.isInteger(x)?-1:1}return r.length===f.length?0:r.length<f.length?-1:1},ca="function"==typeof BigInt;var Kn,ct,bi,mn,pn,Rt,Si,zr;class Dt{get _isFetchingStarted(){return Ge(this,pn,"f")}constructor(){Kn.add(this),ct.set(this,[]),bi.set(this,1),mn.set(this,Ti.BOPM_BLOCK),pn.set(this,!1),Rt.set(this,void 0),Si.set(this,Vt.CCUT_AUTO)}setErrorListener(t){}addImageToBuffer(t){var r;if(!Xs(t))throw new TypeError("Invalid 'image'.");if(null!==(r=t.tag)&&void 0!==r&&r.hasOwnProperty("imageId")&&"number"==typeof t.tag.imageId&&this.hasImage(t.tag.imageId))throw new Error("Existed imageId.");if(Ge(this,ct,"f").length>=Ge(this,bi,"f"))switch(Ge(this,mn,"f")){case Ti.BOPM_BLOCK:break;case Ti.BOPM_UPDATE:if(Ge(this,ct,"f").push(t),Nt(Ge(this,Rt,"f"))&&ot(Ge(this,Rt,"f").imageId)&&1==Ge(this,Rt,"f").keepInBuffer)for(;Ge(this,ct,"f").length>Ge(this,bi,"f");){const f=Ge(this,ct,"f").findIndex(C=>{var T;return(null===(T=C.tag)||void 0===T?void 0:T.imageId)!==Ge(this,Rt,"f").imageId});Ge(this,ct,"f").splice(f,1)}else Ge(this,ct,"f").splice(0,Ge(this,ct,"f").length-Ge(this,bi,"f"))}else Ge(this,ct,"f").push(t)}getImage(){if(0===Ge(this,ct,"f").length)return null;let t;if(Ge(this,Rt,"f")&&ot(Ge(this,Rt,"f").imageId)){const r=Ge(this,Kn,"m",zr).call(this,Ge(this,Rt,"f").imageId);if(r<0)throw new Error(`Image with id ${Ge(this,Rt,"f").imageId} doesn't exist.`);t=Ge(this,ct,"f").slice(r,r+1)[0]}else t=Ge(this,ct,"f").pop();if([De.IPF_RGB_565,De.IPF_RGB_555,De.IPF_RGB_888,De.IPF_ARGB_8888,De.IPF_RGB_161616,De.IPF_ARGB_16161616,De.IPF_ABGR_8888,De.IPF_ABGR_16161616,De.IPF_BGR_888].includes(t.format)){if(Ge(this,Si,"f")===Vt.CCUT_RGB_R_CHANNEL_ONLY){Dt._onLog&&Dt._onLog("only get R channel data.");const r=new Uint8Array(t.width*t.height);for(let f=0;f<r.length;f++)switch(t.format){case De.IPF_RGB_565:case De.IPF_RGB_555:case De.IPF_RGB_888:case De.IPF_RGB_161616:r[f]=t.bytes[3*f+2];break;case De.IPF_ARGB_8888:case De.IPF_ARGB_16161616:r[f]=t.bytes[4*f+2];break;case De.IPF_BGR_888:r[f]=t.bytes[3*f];break;case De.IPF_ABGR_8888:case De.IPF_ABGR_16161616:r[f]=t.bytes[4*f]}t.bytes=r,t.stride=t.width,t.format=De.IPF_GRAYSCALED}else if(Ge(this,Si,"f")===Vt.CCUT_RGB_G_CHANNEL_ONLY){Dt._onLog&&Dt._onLog("only get G channel data.");const r=new Uint8Array(t.width*t.height);for(let f=0;f<r.length;f++)switch(t.format){case De.IPF_RGB_565:case De.IPF_RGB_555:case De.IPF_RGB_888:case De.IPF_RGB_161616:case De.IPF_BGR_888:r[f]=t.bytes[3*f+1];break;case De.IPF_ARGB_8888:case De.IPF_ARGB_16161616:case De.IPF_ABGR_8888:case De.IPF_ABGR_16161616:r[f]=t.bytes[4*f+1]}t.bytes=r,t.stride=t.width,t.format=De.IPF_GRAYSCALED}else if(Ge(this,Si,"f")===Vt.CCUT_RGB_B_CHANNEL_ONLY){Dt._onLog&&Dt._onLog("only get B channel data.");const r=new Uint8Array(t.width*t.height);for(let f=0;f<r.length;f++)switch(t.format){case De.IPF_RGB_565:case De.IPF_RGB_555:case De.IPF_RGB_888:case De.IPF_RGB_161616:r[f]=t.bytes[3*f];break;case De.IPF_ARGB_8888:case De.IPF_ARGB_16161616:r[f]=t.bytes[4*f];break;case De.IPF_BGR_888:r[f]=t.bytes[3*f+2];break;case De.IPF_ABGR_8888:case De.IPF_ABGR_16161616:r[f]=t.bytes[4*f+2]}t.bytes=r,t.stride=t.width,t.format=De.IPF_GRAYSCALED}}else[De.IPF_NV21,De.IPF_NV12].includes(t.format)&&Dt._onLog&&Dt._onLog("NV21 or NV12 is not supported.");return t}setNextImageToReturn(t,r){if(!((...f)=>0!==f.length&&f.every(C=>ot(C)))(t))throw new TypeError("Invalid 'imageId'.");if(void 0!==r&&!Hr(r))throw new TypeError("Invalid 'keepInBuffer'.");wi(this,Rt,{imageId:t,keepInBuffer:r},"f")}_resetNextReturnedImage(){wi(this,Rt,null,"f")}hasImage(t){return Ge(this,Kn,"m",zr).call(this,t)>=0}startFetching(){wi(this,pn,!0,"f")}stopFetching(){wi(this,pn,!1,"f")}setMaxImageCount(t){if("number"!=typeof t)throw new TypeError("Invalid 'count'.");if(t<1||Math.round(t)!==t)throw new Error("Invalid 'count'.");for(wi(this,bi,t,"f");Ge(this,ct,"f")&&Ge(this,ct,"f").length>t;)Ge(this,ct,"f").shift()}getMaxImageCount(){return Ge(this,bi,"f")}getImageCount(){return Ge(this,ct,"f").length}clearBuffer(){Ge(this,ct,"f").length=0}isBufferEmpty(){return 0===Ge(this,ct,"f").length}setBufferOverflowProtectionMode(t){wi(this,mn,t,"f")}getBufferOverflowProtectionMode(){return Ge(this,mn,"f")}setColourChannelUsageType(t){wi(this,Si,t,"f")}getColourChannelUsageType(){return Ge(this,Si,"f")}}ct=new WeakMap,bi=new WeakMap,mn=new WeakMap,pn=new WeakMap,Rt=new WeakMap,Si=new WeakMap,Kn=new WeakSet,zr=function(p){if("number"!=typeof p)throw new TypeError("Invalid 'imageId'.");return Ge(this,ct,"f").findIndex(t=>{var r;return(null===(r=t.tag)||void 0===r?void 0:r.imageId)===p})};const Jn=typeof self>"u",Zs=(()=>{if(!Jn&&document.currentScript){let p=document.currentScript.src,t=p.indexOf("?");if(-1!=t)p=p.substring(0,t);else{let r=p.indexOf("#");-1!=r&&(p=p.substring(0,r))}return p.substring(0,p.lastIndexOf("/")+1)}return"./"})(),qs=p=>{if(null==p&&(p="./"),!Jn){let t=document.createElement("a");t.href=p,p=t.href}return p.endsWith("/")||(p+="/"),p};let _n,zt,Qn,$n,yt;typeof navigator<"u"&&(_n=navigator,zt=_n.userAgent,Qn=_n.platform,$n=_n.mediaDevices),function(){if(!Jn){const p={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:_n.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},t={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:Qn,search:"Win"},Mac:{str:Qn},Linux:{str:Qn}};let r="unknownBrowser",f=0,C="unknownOS";for(let T in p){const S=p[T]||{};let L=S.verStr||zt,P=S.verSearch||T;if(P instanceof Array||(P=[P]),-1!=(S.str||zt).indexOf(S.search||T)){r=T;for(let N of P){let k=L.indexOf(N);if(-1!=k){f=parseFloat(L.substring(k+N.length+1));break}}break}}for(let T in t){const S=t[T]||{};if(-1!=(S.str||zt).indexOf(S.search||T)){C=T;break}}"Linux"==C&&-1!=zt.indexOf("Windows NT")&&(C="HarmonyOS"),yt={browser:r,version:f,OS:C}}Jn&&(yt={browser:"ssr",version:0,OS:"ssr"})}();const ua=typeof WebAssembly<"u"&&zt&&!(/Safari/.test(zt)&&!/Chrome/.test(zt)&&/\(.+\s11_2_([2-6]).*\)/.test(zt)),da=!(typeof Worker>"u"),Ks=!(!$n||!$n.getUserMedia),fa=function(){var p=te(function*(){let t=!1;if(Ks)try{(yield $n.getUserMedia({video:!0})).getTracks().forEach(r=>{r.stop()}),t=!0}catch{}return t});return function(){return p.apply(this,arguments)}}(),Js=p=>p&&"object"==typeof p&&"function"==typeof p.then;class er extends Promise{constructor(t){let r,f;super((C,T)=>{r=C,f=T}),this._s="pending",this.resolve=C=>{this.isPending&&(Js(C)?this.task=C:(this._s="fulfilled",r(C)))},this.reject=C=>{this.isPending&&(this._s="rejected",f(C))},this.task=t}get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(t){var r=this;let f;this._task=t,Js(t)?f=t:"function"==typeof t&&(f=new Promise(t)),f&&te(function*(){try{const C=yield f;t===r._task&&r.resolve(C)}catch(C){t===r._task&&r.reject(C)}})()}get isEmpty(){return null==this._task}}const Lt={},Qs=function(){var p=te(function*(t){let r="string"==typeof t?[t]:t,f=[];for(let C of r)f.push(Lt[C]=Lt[C]||new er);yield Promise.all(f)});return function(r){return p.apply(this,arguments)}}(),tr=function(){var p=te(function*(t,r){let f,C="string"==typeof t?[t]:t,T=[];for(let S of C){let O;T.push(O=Lt[S]=Lt[S]||new er(f=f||r())),O.isEmpty&&(O.task=f=f||r())}yield Promise.all(T)});return function(r,f){return p.apply(this,arguments)}}();let Xe,$s=0;const it=()=>$s++,Ze={};let ui,Zr=!1;const Ii={},pt={},qe={std:{version:"1.2.0",path:qs(Zs+"../../dynamsoft-capture-vision-std@1.2.0/dist/")},core:{version:"3.2.10",path:Zs}},vn=new Proxy(qe,{get(p,t,r){let f=Reflect.get(p,t,r);return f&&f.path&&(f=f.path),f}}),xi={dip:{wasm:!0}},Wt=function(){var p=te(function*(t){let r;t instanceof Array||(t=t?[t]:[]);{let T=Lt.core;r=!T||T.isEmpty}let f=new Map;for(let T of t){if(T=T.toLowerCase(),"std"==T||"core"==T)continue;if(!xi[T])throw Error("Module '"+T+"' not existed.");let S=xi[T].deps;if(S?.length)for(let x of S){let L=Lt[x];f.has(x)||f.set(x,!L||L.isEmpty)}let O=Lt[T];f.has(T)||f.set(T,!O||O.isEmpty)}let C=[];r&&C.push("core"),C.push(...f.keys()),yield tr(C,te(function*(){const T=[...f.entries()].filter(N=>N[1]).map(N=>N[0]),S={};for(let N in vn){if("rootDirectory"==N)continue;let k=vn[N];vn.rootDirectory&&(k.startsWith("http://")||k.startsWith("https://")||(k=vn.rootDirectory+"/"+k)),S[N]=qs(k)}const O={};for(let N of T)O[N]=xi[N];const x={engineResourcePaths:S,autoResources:O,names:T};let L=new er;if(r){x.needLoadCore=!0;let N=S.core+at._workerName;S.rootDirectory&&(N=S.rootDirectory+N),N.startsWith(location.origin)||(N=yield fetch(N).then(k=>k.blob()).then(k=>URL.createObjectURL(k))),Xe=new Worker(N),Xe.onerror=k=>{let W=new Error(k.message);L.reject(W)},Xe.addEventListener("message",k=>{let W=k.data?k.data:k,Z=W.id,X=W.body;switch(W.type){case"log":ui&&ui(W.message);break;case"task":try{Ze[Z](X),delete Ze[Z]}catch(q){throw delete Ze[Z],q}break;case"event":try{Ze[Z](X)}catch(q){throw q}break;default:console.log(k)}}),x.bLog=!!ui,x.bd=Zr,x.dm=location.origin.startsWith("http")?location.origin:"https://localhost"}else yield Qs("worker");let P=$s++;Ze[P]=N=>{if(N.success)Object.assign(Ii,N.versions),"{}"!==JSON.stringify(N.versions)&&(at._versions=N.versions),L.resolve(void 0);else{const k=Error(N.message);N.stack&&(k.stack=N.stack),L.reject(k)}},Xe.postMessage({type:"loadWasm",body:x,id:P}),r&&tr("worker",()=>Promise.resolve()),yield L}))});return function(r){return p.apply(this,arguments)}}();class at{static get engineResourcePaths(){return vn}static set engineResourcePaths(t){Object.assign(qe,t)}static get bSupportDce4Module(){return this._bSupportDce4Module}static get bSupportIRTModule(){return this._bSupportIRTModule}static get versions(){return this._versions}static get _onLog(){return ui}static set _onLog(t){(p=>{ui=p,Xe&&Xe.postMessage({type:"setBLog",body:{value:!!p}})})(t)}static get _bDebug(){return Zr}static set _bDebug(t){(p=>{Zr=p,Xe&&Xe.postMessage({type:"setBDebug",body:{value:!!p}})})(t)}static isModuleLoaded(t){return t=(t=t||"core").toLowerCase(),!!Lt[t]&&Lt[t].isFulfilled}static loadWasm(t){return te(function*(){return yield Wt(t)})()}static detectEnvironment(){return te(function*(){return yield te(function*(){return{wasm:ua,worker:da,getUserMedia:Ks,camera:yield fa(),browser:yt.browser,version:yt.version,OS:yt.OS}})()})()}static getModuleVersion(){return te(function*(){return yield new Promise((t,r)=>{let f=it();Ze[f]=function(){var C=te(function*(T){if(T.success)return t(T.versions);{let S=new Error(T.message);return S.stack=T.stack+"\n"+S.stack,r(S)}});return function(T){return C.apply(this,arguments)}}(),Xe.postMessage({type:"getModuleVersion",id:f})})})()}static getVersion(){return`3.2.10(Worker: ${Ii.core&&Ii.core.worker||"Not Loaded"}, Wasm: ${Ii.core&&Ii.core.wasm||"Not Loaded"})`}static enableLogging(){Dt._onLog=console.log,at._onLog=console.log}static disableLogging(){Dt._onLog=null,at._onLog=null}static cfd(t){return te(function*(){return yield new Promise((r,f)=>{let C=it();Ze[C]=function(){var T=te(function*(S){if(S.success)return r();{let O=new Error(S.message);return O.stack=S.stack+"\n"+O.stack,f(O)}});return function(S){return T.apply(this,arguments)}}(),Xe.postMessage({type:"cfd",id:C,body:{count:t}})})})()}}var Le,eo,qr,to,io,ir,no,ro,Ui,so,oo;at._bSupportDce4Module=-1,at._bSupportIRTModule=-1,at._versions=null,at._workerName="core.worker.js",at.browserInfo=yt,function(p){p[p.CRIT_ORIGINAL_IMAGE=1]="CRIT_ORIGINAL_IMAGE",p[p.CRIT_BARCODE=2]="CRIT_BARCODE",p[p.CRIT_TEXT_LINE=4]="CRIT_TEXT_LINE",p[p.CRIT_DETECTED_QUAD=8]="CRIT_DETECTED_QUAD",p[p.CRIT_NORMALIZED_IMAGE=16]="CRIT_NORMALIZED_IMAGE",p[p.CRIT_PARSED_RESULT=32]="CRIT_PARSED_RESULT"}(Le||(Le={})),function(p){p[p.CT_NORMAL_INTERSECTED=0]="CT_NORMAL_INTERSECTED",p[p.CT_T_INTERSECTED=1]="CT_T_INTERSECTED",p[p.CT_CROSS_INTERSECTED=2]="CT_CROSS_INTERSECTED",p[p.CT_NOT_INTERSECTED=3]="CT_NOT_INTERSECTED"}(eo||(eo={})),function(p){p[p.EC_OK=0]="EC_OK",p[p.EC_UNKNOWN=-1e4]="EC_UNKNOWN",p[p.EC_NO_MEMORY=-10001]="EC_NO_MEMORY",p[p.EC_NULL_POINTER=-10002]="EC_NULL_POINTER",p[p.EC_LICENSE_INVALID=-10003]="EC_LICENSE_INVALID",p[p.EC_LICENSE_EXPIRED=-10004]="EC_LICENSE_EXPIRED",p[p.EC_FILE_NOT_FOUND=-10005]="EC_FILE_NOT_FOUND",p[p.EC_FILE_TYPE_NOT_SUPPORTED=-10006]="EC_FILE_TYPE_NOT_SUPPORTED",p[p.EC_BPP_NOT_SUPPORTED=-10007]="EC_BPP_NOT_SUPPORTED",p[p.EC_INDEX_INVALID=-10008]="EC_INDEX_INVALID",p[p.EC_CUSTOM_REGION_INVALID=-10010]="EC_CUSTOM_REGION_INVALID",p[p.EC_IMAGE_READ_FAILED=-10012]="EC_IMAGE_READ_FAILED",p[p.EC_TIFF_READ_FAILED=-10013]="EC_TIFF_READ_FAILED",p[p.EC_DIB_BUFFER_INVALID=-10018]="EC_DIB_BUFFER_INVALID",p[p.EC_PDF_READ_FAILED=-10021]="EC_PDF_READ_FAILED",p[p.EC_PDF_DLL_MISSING=-10022]="EC_PDF_DLL_MISSING",p[p.EC_PAGE_NUMBER_INVALID=-10023]="EC_PAGE_NUMBER_INVALID",p[p.EC_CUSTOM_SIZE_INVALID=-10024]="EC_CUSTOM_SIZE_INVALID",p[p.EC_TIMEOUT=-10026]="EC_TIMEOUT",p[p.EC_JSON_PARSE_FAILED=-10030]="EC_JSON_PARSE_FAILED",p[p.EC_JSON_TYPE_INVALID=-10031]="EC_JSON_TYPE_INVALID",p[p.EC_JSON_KEY_INVALID=-10032]="EC_JSON_KEY_INVALID",p[p.EC_JSON_VALUE_INVALID=-10033]="EC_JSON_VALUE_INVALID",p[p.EC_JSON_NAME_KEY_MISSING=-10034]="EC_JSON_NAME_KEY_MISSING",p[p.EC_JSON_NAME_VALUE_DUPLICATED=-10035]="EC_JSON_NAME_VALUE_DUPLICATED",p[p.EC_TEMPLATE_NAME_INVALID=-10036]="EC_TEMPLATE_NAME_INVALID",p[p.EC_JSON_NAME_REFERENCE_INVALID=-10037]="EC_JSON_NAME_REFERENCE_INVALID",p[p.EC_PARAMETER_VALUE_INVALID=-10038]="EC_PARAMETER_VALUE_INVALID",p[p.EC_DOMAIN_NOT_MATCH=-10039]="EC_DOMAIN_NOT_MATCH",p[p.EC_RESERVED_INFO_NOT_MATCH=-10040]="EC_RESERVED_INFO_NOT_MATCH",p[p.EC_LICENSE_KEY_NOT_MATCH=-10043]="EC_LICENSE_KEY_NOT_MATCH",p[p.EC_REQUEST_FAILED=-10044]="EC_REQUEST_FAILED",p[p.EC_LICENSE_INIT_FAILED=-10045]="EC_LICENSE_INIT_FAILED",p[p.EC_SET_MODE_ARGUMENT_ERROR=-10051]="EC_SET_MODE_ARGUMENT_ERROR",p[p.EC_LICENSE_CONTENT_INVALID=-10052]="EC_LICENSE_CONTENT_INVALID",p[p.EC_LICENSE_KEY_INVALID=-10053]="EC_LICENSE_KEY_INVALID",p[p.EC_LICENSE_DEVICE_RUNS_OUT=-10054]="EC_LICENSE_DEVICE_RUNS_OUT",p[p.EC_GET_MODE_ARGUMENT_ERROR=-10055]="EC_GET_MODE_ARGUMENT_ERROR",p[p.EC_IRT_LICENSE_INVALID=-10056]="EC_IRT_LICENSE_INVALID",p[p.EC_FILE_SAVE_FAILED=-10058]="EC_FILE_SAVE_FAILED",p[p.EC_STAGE_TYPE_INVALID=-10059]="EC_STAGE_TYPE_INVALID",p[p.EC_IMAGE_ORIENTATION_INVALID=-10060]="EC_IMAGE_ORIENTATION_INVALID",p[p.EC_CONVERT_COMPLEX_TEMPLATE_ERROR=-10061]="EC_CONVERT_COMPLEX_TEMPLATE_ERROR",p[p.EC_CALL_REJECTED_WHEN_CAPTURING=-10062]="EC_CALL_REJECTED_WHEN_CAPTURING",p[p.EC_NO_IMAGE_SOURCE=-10063]="EC_NO_IMAGE_SOURCE",p[p.EC_READ_DIRECTORY_FAILED=-10064]="EC_READ_DIRECTORY_FAILED",p[p.EC_MODULE_NOT_FOUND=-10065]="EC_MODULE_NOT_FOUND",p[p.EC_MULTI_PAGES_NOT_SUPPORTED=-10066]="EC_MULTI_PAGES_NOT_SUPPORTED",p[p.EC_FILE_ALREADY_EXISTS=-10067]="EC_FILE_ALREADY_EXISTS",p[p.EC_CREATE_FILE_FAILED=-10068]="EC_CREATE_FILE_FAILED",p[p.EC_IMGAE_DATA_INVALID=-10069]="EC_IMGAE_DATA_INVALID",p[p.EC_IMAGE_SIZE_NOT_MATCH=-10070]="EC_IMAGE_SIZE_NOT_MATCH",p[p.EC_IMAGE_PIXEL_FORMAT_NOT_MATCH=-10071]="EC_IMAGE_PIXEL_FORMAT_NOT_MATCH",p[p.EC_SECTION_LEVEL_RESULT_IRREPLACEABLE=-10072]="EC_SECTION_LEVEL_RESULT_IRREPLACEABLE",p[p.EC_AXIS_DEFINITION_INCORRECT=-10073]="EC_AXIS_DEFINITION_INCORRECT",p[p.EC_RESULT_TYPE_MISMATCH_IRREPLACEABLE=-10074]="EC_RESULT_TYPE_MISMATCH_IRREPLACEABLE",p[p.EC_NO_LICENSE=-2e4]="EC_NO_LICENSE",p[p.EC_HANDSHAKE_CODE_INVALID=-20001]="EC_HANDSHAKE_CODE_INVALID",p[p.EC_LICENSE_BUFFER_FAILED=-20002]="EC_LICENSE_BUFFER_FAILED",p[p.EC_LICENSE_SYNC_FAILED=-20003]="EC_LICENSE_SYNC_FAILED",p[p.EC_DEVICE_NOT_MATCH=-20004]="EC_DEVICE_NOT_MATCH",p[p.EC_BIND_DEVICE_FAILED=-20005]="EC_BIND_DEVICE_FAILED",p[p.EC_INSTANCE_COUNT_OVER_LIMIT=-20008]="EC_INSTANCE_COUNT_OVER_LIMIT",p[p.EC_LICENSE_INIT_SEQUENCE_FAILED=-20009]="EC_LICENSE_INIT_SEQUENCE_FAILED",p[p.EC_TRIAL_LICENSE=-20010]="EC_TRIAL_LICENSE",p[p.EC_FAILED_TO_REACH_DLS=-20200]="EC_FAILED_TO_REACH_DLS",p[p.EC_LICENSE_CACHE_USED=-20012]="EC_LICENSE_CACHE_USED",p[p.EC_BARCODE_FORMAT_INVALID=-30009]="EC_BARCODE_FORMAT_INVALID",p[p.EC_QR_LICENSE_INVALID=-30016]="EC_QR_LICENSE_INVALID",p[p.EC_1D_LICENSE_INVALID=-30017]="EC_1D_LICENSE_INVALID",p[p.EC_PDF417_LICENSE_INVALID=-30019]="EC_PDF417_LICENSE_INVALID",p[p.EC_DATAMATRIX_LICENSE_INVALID=-30020]="EC_DATAMATRIX_LICENSE_INVALID",p[p.EC_CUSTOM_MODULESIZE_INVALID=-30025]="EC_CUSTOM_MODULESIZE_INVALID",p[p.EC_AZTEC_LICENSE_INVALID=-30041]="EC_AZTEC_LICENSE_INVALID",p[p.EC_PATCHCODE_LICENSE_INVALID=-30046]="EC_PATCHCODE_LICENSE_INVALID",p[p.EC_POSTALCODE_LICENSE_INVALID=-30047]="EC_POSTALCODE_LICENSE_INVALID",p[p.EC_DPM_LICENSE_INVALID=-30048]="EC_DPM_LICENSE_INVALID",p[p.EC_FRAME_DECODING_THREAD_EXISTS=-30049]="EC_FRAME_DECODING_THREAD_EXISTS",p[p.EC_STOP_DECODING_THREAD_FAILED=-30050]="EC_STOP_DECODING_THREAD_FAILED",p[p.EC_MAXICODE_LICENSE_INVALID=-30057]="EC_MAXICODE_LICENSE_INVALID",p[p.EC_GS1_DATABAR_LICENSE_INVALID=-30058]="EC_GS1_DATABAR_LICENSE_INVALID",p[p.EC_GS1_COMPOSITE_LICENSE_INVALID=-30059]="EC_GS1_COMPOSITE_LICENSE_INVALID",p[p.EC_DOTCODE_LICENSE_INVALID=-30061]="EC_DOTCODE_LICENSE_INVALID",p[p.EC_PHARMACODE_LICENSE_INVALID=-30062]="EC_PHARMACODE_LICENSE_INVALID",p[p.EC_CHARACTER_MODEL_FILE_NOT_FOUND=-40100]="EC_CHARACTER_MODEL_FILE_NOT_FOUND",p[p.EC_TEXT_LINE_GROUP_LAYOUT_CONFLICT=-40101]="EC_TEXT_LINE_GROUP_LAYOUT_CONFLICT",p[p.EC_TEXT_LINE_GROUP_REGEX_CONFLICT=-40102]="EC_TEXT_LINE_GROUP_REGEX_CONFLICT",p[p.EC_QUADRILATERAL_INVALID=-50057]="EC_QUADRILATERAL_INVALID",p[p.EC_PANORAMA_LICENSE_INVALID=-70060]="EC_PANORAMA_LICENSE_INVALID",p[p.EC_RESOURCE_PATH_NOT_EXIST=-90001]="EC_RESOURCE_PATH_NOT_EXIST",p[p.EC_RESOURCE_LOAD_FAILED=-90002]="EC_RESOURCE_LOAD_FAILED",p[p.EC_CODE_SPECIFICATION_NOT_FOUND=-90003]="EC_CODE_SPECIFICATION_NOT_FOUND",p[p.EC_FULL_CODE_EMPTY=-90004]="EC_FULL_CODE_EMPTY",p[p.EC_FULL_CODE_PREPROCESS_FAILED=-90005]="EC_FULL_CODE_PREPROCESS_FAILED",p[p.EC_ZA_DL_LICENSE_INVALID=-90006]="EC_ZA_DL_LICENSE_INVALID",p[p.EC_AAMVA_DL_ID_LICENSE_INVALID=-90007]="EC_AAMVA_DL_ID_LICENSE_INVALID",p[p.EC_AADHAAR_LICENSE_INVALID=-90008]="EC_AADHAAR_LICENSE_INVALID",p[p.EC_MRTD_LICENSE_INVALID=-90009]="EC_MRTD_LICENSE_INVALID",p[p.EC_VIN_LICENSE_INVALID=-90010]="EC_VIN_LICENSE_INVALID",p[p.EC_CUSTOMIZED_CODE_TYPE_LICENSE_INVALID=-90011]="EC_CUSTOMIZED_CODE_TYPE_LICENSE_INVALID"}(qr||(qr={})),function(p){p[p.GEM_SKIP=0]="GEM_SKIP",p[p.GEM_AUTO=1]="GEM_AUTO",p[p.GEM_GENERAL=2]="GEM_GENERAL",p[p.GEM_GRAY_EQUALIZE=4]="GEM_GRAY_EQUALIZE",p[p.GEM_GRAY_SMOOTH=8]="GEM_GRAY_SMOOTH",p[p.GEM_SHARPEN_SMOOTH=16]="GEM_SHARPEN_SMOOTH",p[p.GEM_REV=-2147483648]="GEM_REV"}(to||(to={})),function(p){p[p.GTM_SKIP=0]="GTM_SKIP",p[p.GTM_INVERTED=1]="GTM_INVERTED",p[p.GTM_ORIGINAL=2]="GTM_ORIGINAL",p[p.GTM_AUTO=4]="GTM_AUTO",p[p.GTM_REV=-2147483648]="GTM_REV"}(io||(io={})),function(p){p[p.ITT_FILE_IMAGE=0]="ITT_FILE_IMAGE",p[p.ITT_VIDEO_FRAME=1]="ITT_VIDEO_FRAME"}(ir||(ir={})),function(p){p[p.PDFRM_VECTOR=1]="PDFRM_VECTOR",p[p.PDFRM_RASTER=2]="PDFRM_RASTER",p[p.PDFRM_REV=-2147483648]="PDFRM_REV"}(no||(no={})),function(p){p[p.RDS_RASTERIZED_PAGES=0]="RDS_RASTERIZED_PAGES",p[p.RDS_EXTRACTED_IMAGES=1]="RDS_EXTRACTED_IMAGES"}(ro||(ro={})),function(p){p[p.IRUT_NULL=0]="IRUT_NULL",p[p.IRUT_COLOUR_IMAGE=1]="IRUT_COLOUR_IMAGE",p[p.IRUT_SCALED_DOWN_COLOUR_IMAGE=2]="IRUT_SCALED_DOWN_COLOUR_IMAGE",p[p.IRUT_GRAYSCALE_IMAGE=4]="IRUT_GRAYSCALE_IMAGE",p[p.IRUT_TRANSOFORMED_GRAYSCALE_IMAGE=8]="IRUT_TRANSOFORMED_GRAYSCALE_IMAGE",p[p.IRUT_ENHANCED_GRAYSCALE_IMAGE=16]="IRUT_ENHANCED_GRAYSCALE_IMAGE",p[p.IRUT_PREDETECTED_REGIONS=32]="IRUT_PREDETECTED_REGIONS",p[p.IRUT_BINARY_IMAGE=64]="IRUT_BINARY_IMAGE",p[p.IRUT_TEXTURE_DETECTION_RESULT=128]="IRUT_TEXTURE_DETECTION_RESULT",p[p.IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE=256]="IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE",p[p.IRUT_TEXTURE_REMOVED_BINARY_IMAGE=512]="IRUT_TEXTURE_REMOVED_BINARY_IMAGE",p[p.IRUT_CONTOURS=1024]="IRUT_CONTOURS",p[p.IRUT_LINE_SEGMENTS=2048]="IRUT_LINE_SEGMENTS",p[p.IRUT_TEXT_ZONES=4096]="IRUT_TEXT_ZONES",p[p.IRUT_TEXT_REMOVED_BINARY_IMAGE=8192]="IRUT_TEXT_REMOVED_BINARY_IMAGE",p[p.IRUT_CANDIDATE_BARCODE_ZONES=16384]="IRUT_CANDIDATE_BARCODE_ZONES",p[p.IRUT_LOCALIZED_BARCODES=32768]="IRUT_LOCALIZED_BARCODES",p[p.IRUT_SCALED_UP_BARCODE_IMAGE=65536]="IRUT_SCALED_UP_BARCODE_IMAGE",p[p.IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE=131072]="IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE",p[p.IRUT_COMPLEMENTED_BARCODE_IMAGE=262144]="IRUT_COMPLEMENTED_BARCODE_IMAGE",p[p.IRUT_DECODED_BARCODES=524288]="IRUT_DECODED_BARCODES",p[p.IRUT_LONG_LINES=1048576]="IRUT_LONG_LINES",p[p.IRUT_CORNERS=2097152]="IRUT_CORNERS",p[p.IRUT_CANDIDATE_QUAD_EDGES=4194304]="IRUT_CANDIDATE_QUAD_EDGES",p[p.IRUT_DETECTED_QUADS=8388608]="IRUT_DETECTED_QUADS",p[p.IRUT_LOCALIZED_TEXT_LINES=16777216]="IRUT_LOCALIZED_TEXT_LINES",p[p.IRUT_RECOGNIZED_TEXT_LINES=33554432]="IRUT_RECOGNIZED_TEXT_LINES",p[p.IRUT_NORMALIZED_IMAGES=67108864]="IRUT_NORMALIZED_IMAGES",p[p.IRUT_SHORT_LINES=134217728]="IRUT_SHORT_LINES",p[p.IRUT_ALL=268435455]="IRUT_ALL"}(Ui||(Ui={})),function(p){p[p.ROET_PREDETECTED_REGION=0]="ROET_PREDETECTED_REGION",p[p.ROET_LOCALIZED_BARCODE=1]="ROET_LOCALIZED_BARCODE",p[p.ROET_DECODED_BARCODE=2]="ROET_DECODED_BARCODE",p[p.ROET_LOCALIZED_TEXT_LINE=3]="ROET_LOCALIZED_TEXT_LINE",p[p.ROET_RECOGNIZED_TEXT_LINE=4]="ROET_RECOGNIZED_TEXT_LINE",p[p.ROET_DETECTED_QUAD=5]="ROET_DETECTED_QUAD",p[p.ROET_NORMALIZED_IMAGE=6]="ROET_NORMALIZED_IMAGE",p[p.ROET_SOURCE_IMAGE=7]="ROET_SOURCE_IMAGE",p[p.ROET_TARGET_ROI=8]="ROET_TARGET_ROI"}(so||(so={})),function(p){p[p.ST_NULL=0]="ST_NULL",p[p.ST_REGION_PREDETECTION=1]="ST_REGION_PREDETECTION",p[p.ST_BARCODE_LOCALIZATION=2]="ST_BARCODE_LOCALIZATION",p[p.ST_BARCODE_DECODING=3]="ST_BARCODE_DECODING",p[p.ST_TEXT_LINE_LOCALIZATION=4]="ST_TEXT_LINE_LOCALIZATION",p[p.ST_TEXT_LINE_RECOGNITION=5]="ST_TEXT_LINE_RECOGNITION",p[p.ST_DOCUMENT_DETECTION=6]="ST_DOCUMENT_DETECTION",p[p.ST_DOCUMENT_NORMALIZATION=7]="ST_DOCUMENT_NORMALIZATION"}(oo||(oo={}));const ao=p=>p&&"object"==typeof p&&"function"==typeof p.then;class ji extends Promise{constructor(t){let r,f;super((C,T)=>{r=C,f=T}),this._s="pending",this.resolve=C=>{this.isPending&&(ao(C)?this.task=C:(this._s="fulfilled",r(C)))},this.reject=C=>{this.isPending&&(this._s="rejected",f(C))},this.task=t}get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(t){var r=this;let f;this._task=t,ao(t)?f=t:"function"==typeof t&&(f=new Promise(t)),f&&te(function*(){try{const C=yield f;t===r._task&&r.resolve(C)}catch(C){t===r._task&&r.reject(C)}})()}get isEmpty(){return null==this._task}}class pa{constructor(){this.addResultReceiver=null,this.removeResultReceiver=null,this.getOriginalImage=null}}var _a={onTaskResultsReceived:!1,onTaskResultsReceivedForDce:!1,onPredetectedRegionsReceived:!1,onLocalizedBarcodesReceived:!1,onDecodedBarcodesReceived:!1,onLocalizedTextLinesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onNormalizedImagesReceived:!1,onColourImageUnitReceived:!1,onScaledDownColourImageUnitReceived:!1,onGrayscaleImageUnitReceived:!1,onTransformedGrayscaleImageUnitReceived:!1,onEnhancedGrayscaleImageUnitReceived:!1,onBinaryImageUnitReceived:!1,onTextureDetectionResultUnitReceived:!1,onTextureRemovedGrayscaleImageUnitReceived:!1,onTextureRemovedBinaryImageUnitReceived:!1,onContoursUnitReceived:!1,onLineSegmentsUnitReceived:!1,onTextZonesUnitReceived:!1,onTextRemovedBinaryImageUnitReceived:!1,onLongLinesUnitReceived:!1,onCornersUnitReceived:!1,onCandidateQuadEdgesUnitReceived:!1,onCandidateBarcodeZonesUnitReceived:!1,onScaledUpBarcodeImageUnitReceived:!1,onDeformationResistedBarcodeImageUnitReceived:!1,onComplementedBarcodeImageUnitReceived:!1,onShortLinesUnitReceived:!1};const lo=typeof self>"u",Kr=(()=>{if(!lo&&document.currentScript){let p=document.currentScript.src,t=p.indexOf("?");if(-1!=t)p=p.substring(0,t);else{let r=p.indexOf("#");-1!=r&&(p=p.substring(0,r))}return p.substring(0,p.lastIndexOf("/")+1)}return"./"})(),ho=p=>{if(null==p&&(p="./"),!lo){let t=document.createElement("a");t.href=p,p=t.href}return p.endsWith("/")||(p+="/"),p};var Jr;null==qe.cvr&&(qe.cvr=Kr),xi.cvr={js:!0,wasm:!0,deps:["license","dip"]},pt.cvr={};const Qr="1.2.0";"string"!=typeof qe.std&&gn(qe.std.version,Qr)<0&&(qe.std={version:Qr,path:ho(Kr+`../../dynamsoft-capture-vision-std@${Qr}/dist/`)});const $r="2.2.10";(!qe.dip||"string"!=typeof qe.dip&&gn(qe.dip.version,$r)<0)&&(qe.dip={version:$r,path:ho(Kr+`../../dynamsoft-image-processing@${$r}/dist/`)});class co{static getVersion(){return this._version}}var nr,uo;function fo(p,t){if(p&&p.location){const r=p.location.points;for(let f of r)f.x=f.x/t,f.y=f.y/t;fo(p.referencedItem,t)}}co._version=`2.2.10(Worker: ${null===(Jr=Ii.cvr)||void 0===Jr?void 0:Jr.worker}, Wasm: loading...`,function(p){p[p.ISS_BUFFER_EMPTY=0]="ISS_BUFFER_EMPTY",p[p.ISS_EXHAUSTED=1]="ISS_EXHAUSTED"}(nr||(nr={})),function(p){p[p.IRUT_NULL=0]="IRUT_NULL",p[p.IRUT_COLOUR_IMAGE=1]="IRUT_COLOUR_IMAGE",p[p.IRUT_SCALED_DOWN_COLOUR_IMAGE=2]="IRUT_SCALED_DOWN_COLOUR_IMAGE",p[p.IRUT_GRAYSCALE_IMAGE=4]="IRUT_GRAYSCALE_IMAGE",p[p.IRUT_TRANSOFORMED_GRAYSCALE_IMAGE=8]="IRUT_TRANSOFORMED_GRAYSCALE_IMAGE",p[p.IRUT_ENHANCED_GRAYSCALE_IMAGE=16]="IRUT_ENHANCED_GRAYSCALE_IMAGE",p[p.IRUT_PREDETECTED_REGIONS=32]="IRUT_PREDETECTED_REGIONS",p[p.IRUT_BINARY_IMAGE=64]="IRUT_BINARY_IMAGE",p[p.IRUT_TEXTURE_DETECTION_RESULT=128]="IRUT_TEXTURE_DETECTION_RESULT",p[p.IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE=256]="IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE",p[p.IRUT_TEXTURE_REMOVED_BINARY_IMAGE=512]="IRUT_TEXTURE_REMOVED_BINARY_IMAGE",p[p.IRUT_CONTOURS=1024]="IRUT_CONTOURS",p[p.IRUT_LINE_SEGMENTS=2048]="IRUT_LINE_SEGMENTS",p[p.IRUT_TEXT_ZONES=4096]="IRUT_TEXT_ZONES",p[p.IRUT_TEXT_REMOVED_BINARY_IMAGE=8192]="IRUT_TEXT_REMOVED_BINARY_IMAGE",p[p.IRUT_CANDIDATE_BARCODE_ZONES=16384]="IRUT_CANDIDATE_BARCODE_ZONES",p[p.IRUT_LOCALIZED_BARCODES=32768]="IRUT_LOCALIZED_BARCODES",p[p.IRUT_SCALED_UP_BARCODE_IMAGE=65536]="IRUT_SCALED_UP_BARCODE_IMAGE",p[p.IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE=131072]="IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE",p[p.IRUT_COMPLEMENTED_BARCODE_IMAGE=262144]="IRUT_COMPLEMENTED_BARCODE_IMAGE",p[p.IRUT_DECODED_BARCODES=524288]="IRUT_DECODED_BARCODES",p[p.IRUT_LONG_LINES=1048576]="IRUT_LONG_LINES",p[p.IRUT_CORNERS=2097152]="IRUT_CORNERS",p[p.IRUT_CANDIDATE_QUAD_EDGES=4194304]="IRUT_CANDIDATE_QUAD_EDGES",p[p.IRUT_DETECTED_QUADS=8388608]="IRUT_DETECTED_QUADS",p[p.IRUT_LOCALIZED_TEXT_LINES=16777216]="IRUT_LOCALIZED_TEXT_LINES",p[p.IRUT_RECOGNIZED_TEXT_LINES=33554432]="IRUT_RECOGNIZED_TEXT_LINES",p[p.IRUT_NORMALIZED_IMAGES=67108864]="IRUT_NORMALIZED_IMAGES",p[p.IRUT_SHORT_LINES=134217728]="IRUT_SHORT_LINES",p[p.IRUT_ALL=134217727]="IRUT_ALL"}(uo||(uo={}));class ze{constructor(){this.maxCvsSideLength=["iPhone","Android","HarmonyOS"].includes(at.browserInfo.OS)?2048:4096,this._isa=null,this._dsImage=null,this._instanceID=void 0,this._bPauseScan=!0,this._bNeedOutputOriginalImage=!1,this._canvas=null,this._irrRegistryState=_a,this._resultReceiverSet=new Set,this._isaStateListenerSet=new Set,this._resultFilterSet=new Set,this._intermediateResultReceiverSet=new Set,this._intermediateResultManager=null,this._templateName="Default",this._bOpenDetectVerify=!1,this._bOpenNormalizeVerify=!1,this._bOpenBarcodeVerify=!1,this._bOpenLabelVerify=!1,this._minImageCaptureInterval=0,this._averageProcessintTimeArray=[],this._averageFetchImageTimeArray=[],this._currentSettings=null,this._averageTime=999,this._compressRate=0,this._dynamsoft=!1,this.captureInParallel=!0,this.bDestroyed=!1,this._singleFrameModeCallbackBind=this._singleFrameModeCallback.bind(this),this._promiseStartScan=null}get disposed(){return this.bDestroyed}static createInstance(){return te(function*(){if(!pt.license)throw Error("Module `license` is not existed.");yield pt.license.dynamsoft(),yield Wt(["cvr"]);const t=new ze,r=new ji;let f=it();return Ze[f]=function(){var C=te(function*(T){var S;if(T.success)t._instanceID=T.instanceID,t._currentSettings=JSON.parse(T.outputSettings),co._version=`2.2.10(Worker: ${null===(S=Ii.cvr)||void 0===S?void 0:S.worker}, Wasm: ${T.version})`,0===at.bSupportDce4Module&&(t._intermediateResultManager=t.getIntermediateResultManager(!0)),r.resolve(t);else{const O=Error(T.message);T.stack&&(O.stack=T.stack),r.reject(O)}});return function(T){return C.apply(this,arguments)}}(),Xe.postMessage({type:"cvr_createInstance",id:f}),r})()}_singleFrameModeCallback(t){var r=this;return te(function*(){r._isa.getCameraView().setScanLaserVisible(!0);for(let S of r._resultReceiverSet)r._bNeedOutputOriginalImage&&S.onOriginalImageResultReceived&&S.onOriginalImageResultReceived({imageData:t});const f={bytes:new Uint8Array(t.bytes),width:t.width,height:t.height,stride:t.stride,format:t.format,tag:t.tag},C=yield r.capture(f,r._templateName);C.originalImageTag=t.tag;for(let S of r._resultReceiverSet)S.isDce&&S.onCapturedResultReceived(C,{isDetectVerifyOpen:!1,isNormalizeVerifyOpen:!1,isBarcodeVerifyOpen:!1,isLabelVerifyOpen:!1});const T={originalImageHashId:C.originalImageHashId,originalImageTag:C.originalImageTag,errorCode:C.errorCode,errorString:C.errorString};for(let S of r._resultReceiverSet)if(S.onDecodedBarcodesReceived&&C.barcodeResultItems&&S.onDecodedBarcodesReceived(Object.assign(Object.assign({},T),{barcodeResultItems:C.barcodeResultItems})),S.onRecognizedTextLinesReceived&&C.textLineResultItems&&S.onRecognizedTextLinesReceived(Object.assign(Object.assign({},T),{textLineResultItems:C.textLineResultItems})),S.onDetectedQuadsReceived&&C.detectedQuadResultItems&&S.onDetectedQuadsReceived(Object.assign(Object.assign({},T),{detectedQuadResultItems:C.detectedQuadResultItems})),S.onNormalizedImagesReceived&&C.normalizedImageResultItems&&S.onNormalizedImagesReceived(Object.assign(Object.assign({},T),{normalizedImageResultItems:C.normalizedImageResultItems})),S.onParsedResultsReceived&&C.parsedResultItems&&S.onParsedResultsReceived(Object.assign(Object.assign({},T),{parsedResultItems:C.parsedResultItems})),S.onCapturedResultReceived&&!S.isDce){if(r._bNeedOutputOriginalImage){const O=C.items.findIndex(x=>1===x.type);-1!==O&&(C.items[O].imageData=t)}S.onCapturedResultReceived(C)}})()}setInput(t){if(this._checkIsDisposed(),t){if(this._isa=t,t.isCameraEnhancer){this._intermediateResultManager&&(this._isa._intermediateResultReceiver.isDce=!0,this._intermediateResultManager.addResultReceiver(this._isa._intermediateResultReceiver));const r=this._isa.getCameraView();if(r){const f=r._capturedResultReceiver;f.isDce=!0,this._resultReceiverSet.add(f)}}}else this._isa=null}getInput(){return this._isa}addImageSourceStateListener(t){if(this._checkIsDisposed(),"object"!=typeof t)return console.warn("Invalid ISA state listener.");t&&Object.keys(t)&&this._isaStateListenerSet.add(t)}removeImageSourceStateListener(t){return this._checkIsDisposed(),this._isaStateListenerSet.delete(t)}addResultReceiver(t){if(this._checkIsDisposed(),"object"!=typeof t)throw new Error("Invalid receiver.");t&&Object.keys(t).length&&(this._resultReceiverSet.add(t),this._setCrrRegistry())}removeResultReceiver(t){this._checkIsDisposed(),this._resultReceiverSet.delete(t),this._setCrrRegistry()}_setCrrRegistry(){var t=this;return te(function*(){const r={onCapturedResultReceived:!1,onDecodedBarcodesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onNormalizedImagesReceived:!1,onParsedResultsReceived:!1};for(let T of t._resultReceiverSet)T.isDce||(r.onCapturedResultReceived=!!T.onCapturedResultReceived,r.onDecodedBarcodesReceived=!!T.onDecodedBarcodesReceived,r.onRecognizedTextLinesReceived=!!T.onRecognizedTextLinesReceived,r.onDetectedQuadsReceived=!!T.onDetectedQuadsReceived,r.onNormalizedImagesReceived=!!T.onNormalizedImagesReceived,r.onParsedResultsReceived=!!T.onParsedResultsReceived);const f=new ji;let C=it();return Ze[C]=function(){var T=te(function*(S){if(S.success)f.resolve();else{let O=new Error(S.message);O.stack=S.stack+"\n"+O.stack,f.reject()}});return function(S){return T.apply(this,arguments)}}(),Xe.postMessage({type:"cvr_setCrrRegistry",id:C,instanceID:t._instanceID,body:{receiver:JSON.stringify(r)}}),f})()}addResultFilter(t){var r=this;return te(function*(){if(r._checkIsDisposed(),"object"!=typeof t)return console.warn("Invalid filter.");if(t&&Object.keys(t)){r._resultFilterSet.add(t),r._handleFilterSwitch();for(let f of r._resultFilterSet)yield r._enableResultCrossVerification(f.verificationEnabled),yield r._enableResultDeduplication(f.duplicateFilterEnabled),yield r._setDuplicateForgetTime(f.duplicateForgetTime)}})()}removeResultFilter(t){var r=this;return te(function*(){r._checkIsDisposed(),r._resultFilterSet.delete(t),r._handleFilterSwitch();for(let f of r._resultFilterSet)yield r._enableResultCrossVerification(f.verificationEnabled),yield r._enableResultDeduplication(f.duplicateFilterEnabled),yield r._setDuplicateForgetTime(f.duplicateForgetTime)})()}_handleFilterSwitch(){this._bOpenBarcodeVerify=!1,this._bOpenLabelVerify=!1,this._bOpenDetectVerify=!1,this._bOpenNormalizeVerify=!1;for(let t of this._resultFilterSet)t.isResultCrossVerificationEnabled(Le.CRIT_BARCODE)&&(this._bOpenBarcodeVerify=!0),t.isResultCrossVerificationEnabled(Le.CRIT_TEXT_LINE)&&(this._bOpenLabelVerify=!0),t.isResultCrossVerificationEnabled(Le.CRIT_DETECTED_QUAD)&&(this._bOpenDetectVerify=!0),t.isResultCrossVerificationEnabled(Le.CRIT_NORMALIZED_IMAGE)&&(this._bOpenNormalizeVerify=!0)}startCapturing(t="Default"){var r=this;return te(function*(){if(r._checkIsDisposed(),!r._bPauseScan)return;if(!r._isa)throw new Error("'ImageSourceAdapter' is not set. call 'setInput' before 'startCapturing'");const f=yield r.containsTask(t);return yield Wt(f),r._isa.isCameraEnhancer&&(f.includes("ddn")?r._isa.setPixelFormat(De.IPF_ABGR_8888):r._isa.setPixelFormat(De.IPF_GRAYSCALED)),void 0!==r._isa.singleFrameMode&&"disabled"!==r._isa.singleFrameMode?(r._templateName=t,void r._isa.on("singleFrameAcquired",r._singleFrameModeCallbackBind)):(r._isa.getColourChannelUsageType()===Vt.CCUT_AUTO&&r._isa.setColourChannelUsageType(f.includes("ddn")?Vt.CCUT_FULL_CHANNEL:Vt.CCUT_Y_CHANNEL_ONLY),r._promiseStartScan&&r._promiseStartScan.isPending?r._promiseStartScan:(r._promiseStartScan=new ji((C,T)=>{if(r.disposed)return;let S=it();Ze[S]=function(){var O=te(function*(x){if(r._promiseStartScan&&!r._promiseStartScan.isFulfilled){if(!x.success){let L=new Error(x.message);return L.stack=x.stack+"\n"+L.stack,T(L)}for(let L of r._resultFilterSet)yield r.addResultFilter(L);r._bPauseScan=!1,r._bNeedOutputOriginalImage=x.bNeedOutputOriginalImage,r._loopReadVideoTimeoutId&&clearTimeout(r._loopReadVideoTimeoutId),r._loopReadVideoTimeoutId=setTimeout(te(function*(){-1!==r._minImageCaptureInterval&&r._isa.startFetching(),r._loopReadVideo(t),C()}),0),r._isa.isCameraEnhancer&&r._isa.getCameraView().setScanLaserVisible(!0)}});return function(x){return O.apply(this,arguments)}}(),Xe.postMessage({type:"cvr_startCapturing",id:S,instanceID:r._instanceID,body:{templateName:t}})}),yield r._promiseStartScan))})()}stopCapturing(){this._checkIsDisposed(),this._isa&&(this._isa.isCameraEnhancer&&(this._isa.getCameraView().setScanLaserVisible(!1),void 0!==this._isa.singleFrameMode&&"disabled"!==this._isa.singleFrameMode)?this._isa.off("singleFrameAcquired",this._singleFrameModeCallbackBind):(this._isa.stopFetching(),this._clearVerifyList(),this._averageProcessintTimeArray=[],this._averageTime=999,this._bPauseScan=!0,this._promiseStartScan=null,this._isa.setColourChannelUsageType(Vt.CCUT_AUTO)))}_clearVerifyList(){var t=this;return te(function*(){let r=it();const f=new ji;return Ze[r]=function(){var C=te(function*(T){if(T.success)return f.resolve();{let S=new Error(T.message);return S.stack=T.stack+"\n"+S.stack,f.reject(S)}});return function(T){return C.apply(this,arguments)}}(),Xe.postMessage({type:"cvr_clearVerifyList",id:r,instanceID:t._instanceID}),f})()}_getIntermediateResult(){var t=this;return te(function*(){t._checkIsDisposed();let r=it();const f=new ji;return Ze[r]=function(){var C=te(function*(T){if(T.success)f.resolve(T.result);else{let S=new Error(T.message);S.stack=T.stack+"\n"+S.stack,f.reject(S)}});return function(T){return C.apply(this,arguments)}}(),Xe.postMessage({type:"cvr_getIntermediateResult",id:r,instanceID:t._instanceID}),f})()}containsTask(t){var r=this;return te(function*(){return r._checkIsDisposed(),yield new Promise((f,C)=>{let T=it();Ze[T]=function(){var S=te(function*(O){if(O.success)return f(JSON.parse(O.tasks));{let x=new Error(O.message);return x.stack=O.stack+"\n"+x.stack,C(x)}});return function(O){return S.apply(this,arguments)}}(),Xe.postMessage({type:"cvr_containsTask",id:T,instanceID:r._instanceID,body:{templateName:t}})})})()}_loopReadVideo(t){var r=this;return te(function*(){if(r._dynamsoft=!0,r.disposed||r._bPauseScan)return;if(r._isa.isBufferEmpty())if(r._isa.hasNextImageToFetch())for(let C of r._isaStateListenerSet)C.onImageSourceStateReceived&&C.onImageSourceStateReceived(nr.ISS_BUFFER_EMPTY);else if(!r._isa.hasNextImageToFetch())for(let C of r._isaStateListenerSet)C.onImageSourceStateReceived&&C.onImageSourceStateReceived(nr.ISS_EXHAUSTED);if(-1===r._minImageCaptureInterval||r._isa.isBufferEmpty())try{r._isa.isBufferEmpty()&&ze._onLog&&ze._onLog("buffer is empty so fetch image"),ze._onLog&&ze._onLog(`DCE: start fetching a frame: ${Date.now()}`),r._dsImage=r._isa.fetchImage(),ze._onLog&&ze._onLog(`DCE: finish fetching a frame: ${Date.now()}`),r._isa.setImageFetchInterval(r._averageTime)}catch{return void r._reRunCurrnetFunc(t)}else if(r._isa.setImageFetchInterval(r._averageTime-(r._dsImage&&r._dsImage.tag?r._dsImage.tag.timeSpent:0)),r._dsImage=r._isa.getImage(),r._dsImage.tag&&Date.now()-r._dsImage.tag.timeStamp>200)return void r._reRunCurrnetFunc(t);if(!r._dsImage)return void r._reRunCurrnetFunc(t);for(let C of r._resultReceiverSet)r._bNeedOutputOriginalImage&&C.onOriginalImageResultReceived&&C.onOriginalImageResultReceived({imageData:r._dsImage});const f=Date.now();r._captureDsimage(r._dsImage,t).then(function(){var C=te(function*(T){if(ze._onLog&&ze._onLog("no js handle time: "+(Date.now()-f)),r._bPauseScan)return void r._reRunCurrnetFunc(t);T.originalImageTag=r._dsImage.tag?r._dsImage.tag:null;for(let x of r._resultReceiverSet)if(x.isDce){const L=Date.now();if(x.onCapturedResultReceived(T,{isDetectVerifyOpen:r._bOpenDetectVerify,isNormalizeVerifyOpen:r._bOpenNormalizeVerify,isBarcodeVerifyOpen:r._bOpenBarcodeVerify,isLabelVerifyOpen:r._bOpenLabelVerify}),ze._onLog){const P=Date.now()-L;P>10&&ze._onLog(`draw result time: ${P}`)}}const S={originalImageHashId:T.originalImageHashId,originalImageTag:T.originalImageTag,errorCode:T.errorCode,errorString:T.errorString};for(let x of r._resultReceiverSet)x.onDecodedBarcodesReceived&&T.barcodeResultItems&&x.onDecodedBarcodesReceived(Object.assign(Object.assign({},S),{barcodeResultItems:T.barcodeResultItems.filter(L=>!L.isFilter)})),x.onRecognizedTextLinesReceived&&T.textLineResultItems&&x.onRecognizedTextLinesReceived(Object.assign(Object.assign({},S),{textLineResultItems:T.textLineResultItems.filter(L=>!L.isFilter)})),x.onDetectedQuadsReceived&&T.detectedQuadResultItems&&x.onDetectedQuadsReceived(Object.assign(Object.assign({},S),{detectedQuadResultItems:T.detectedQuadResultItems.filter(L=>!L.isFilter)})),x.onNormalizedImagesReceived&&T.normalizedImageResultItems&&x.onNormalizedImagesReceived(Object.assign(Object.assign({},S),{normalizedImageResultItems:T.normalizedImageResultItems.filter(L=>!L.isFilter)})),x.onParsedResultsReceived&&T.parsedResultItems&&x.onParsedResultsReceived(Object.assign(Object.assign({},S),{parsedResultItems:T.parsedResultItems.filter(L=>!L.isFilter)})),x.onCapturedResultReceived&&!x.isDce&&(T.items=T.items.filter(L=>!L.isFilter),T.barcodeResultItems&&(T.barcodeResultItems=T.barcodeResultItems.filter(L=>!L.isFilter)),T.textLineResultItems&&(T.textLineResultItems=T.textLineResultItems.filter(L=>!L.isFilter)),T.detectedQuadResultItems&&(T.detectedQuadResultItems=T.detectedQuadResultItems.filter(L=>!L.isFilter)),T.normalizedImageResultItems&&(T.normalizedImageResultItems=T.normalizedImageResultItems.filter(L=>!L.isFilter)),T.parsedResultItems&&(T.parsedResultItems=T.parsedResultItems.filter(L=>!L.isFilter)),x.onCapturedResultReceived(T));const O=Date.now();if(r._minImageCaptureInterval>-1&&(5===r._averageProcessintTimeArray.length&&r._averageProcessintTimeArray.shift(),5===r._averageFetchImageTimeArray.length&&r._averageFetchImageTimeArray.shift(),r._averageProcessintTimeArray.push(Date.now()-f),r._averageFetchImageTimeArray.push(r._dsImage&&r._dsImage.tag?r._dsImage.tag.timeSpent:0),r._averageTime=Math.min(...r._averageProcessintTimeArray)-Math.max(...r._averageFetchImageTimeArray),r._averageTime=r._averageTime>0?r._averageTime:0,ze._onLog&&(ze._onLog(`minImageCaptureInterval: ${r._minImageCaptureInterval}`),ze._onLog(`averageProcessintTimeArray: ${r._averageProcessintTimeArray}`),ze._onLog(`averageFetchImageTimeArray: ${r._averageFetchImageTimeArray}`),ze._onLog(`averageTime: ${r._averageTime}`))),ze._onLog){const x=Date.now()-O;x>10&&ze._onLog(`fetch image calculate time: ${x}`)}ze._onLog&&ze._onLog(`time finish decode: ${Date.now()}`),ze._onLog&&ze._onLog("main time: "+(Date.now()-f)),ze._onLog&&ze._onLog("===================================================="),r._loopReadVideoTimeoutId&&clearTimeout(r._loopReadVideoTimeoutId),r._loopReadVideoTimeoutId=r._minImageCaptureInterval>0&&r._minImageCaptureInterval>=r._averageTime?setTimeout(()=>{r._loopReadVideo(t)},r._minImageCaptureInterval-r._averageTime):setTimeout(()=>{r._loopReadVideo(t)},Math.max(r._minImageCaptureInterval,0))});return function(T){return C.apply(this,arguments)}}()).catch(C=>{r._isa.stopFetching(),r._loopReadVideoTimeoutId&&clearTimeout(r._loopReadVideoTimeoutId),r._loopReadVideoTimeoutId=setTimeout(()=>{r._isa.startFetching(),r._loopReadVideo(t)},Math.max(r._minImageCaptureInterval,1e3)),"platform error"!==C.message&&setTimeout(()=>{throw C},0)})})()}_reRunCurrnetFunc(t){this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(t)},0)}capture(t,r="Default"){var f=this;return te(function*(){f._checkIsDisposed();const C=yield f.containsTask(r);let T;if(yield Wt(C),f._dynamsoft=!1,Xs(t))T=yield f._captureDsimage(t,r);else if("string"==typeof t)T="data:image/"==t.substring(0,11)?yield f._captureBase64(t,r):yield f._captureUrl(t,r);else if(t instanceof Blob)T=yield f._captureBlob(t,r);else if(t instanceof HTMLImageElement)T=yield f._captureImage(t,r);else if(t instanceof HTMLCanvasElement)T=yield f._captureCanvas(t,r);else{if(!(t instanceof HTMLVideoElement))throw new TypeError("'capture(imageOrFile, templateName)': Type of 'imageOrFile' should be 'DSImageData', 'Url', 'Base64', 'Blob', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement'.");T=yield f._captureVideo(t,r)}return T})()}_captureDsimage(t,r){var f=this;return te(function*(){return yield f._captureInWorker(t,r)})()}_captureUrl(t,r){var f=this;return te(function*(){let C=yield zs(t,"blob");return yield f._captureBlob(C,r)})()}_captureBase64(t,r){var f=this;return te(function*(){t=t.substring(t.indexOf(",")+1);let C=atob(t),T=C.length,S=new Uint8Array(T);for(;T--;)S[T]=C.charCodeAt(T);return yield f._captureBlob(new Blob([S]),r)})()}_captureBlob(t,r){var f=this;return te(function*(){let C=null,T=null;if(typeof createImageBitmap<"u")try{C=yield createImageBitmap(t)}catch{}var O;C||(T=yield(O=te(function*(x){return yield new Promise((L,P)=>{let N=URL.createObjectURL(x),k=new Image;k.src=N,k.onload=()=>{URL.revokeObjectURL(k.dbrObjUrl),L(k)},k.onerror=W=>{P(new Error("Can't convert blob to image : "+(W instanceof Event?W.type:W)))}})}),function(x){return O.apply(this,arguments)})(t));let S=yield f._captureImage(C||T,r);return C&&C.close(),S})()}_captureImage(t,r){var f=this;return te(function*(){let C,T,S=t instanceof HTMLImageElement?t.naturalWidth:t.width,O=t instanceof HTMLImageElement?t.naturalHeight:t.height,x=Math.max(S,O);x>f.maxCvsSideLength?(f._compressRate=f.maxCvsSideLength/x,C=Math.round(S*f._compressRate),T=Math.round(O*f._compressRate)):(C=S,T=O),f._canvas||(f._canvas=document.createElement("canvas"));const L=f._canvas;return L.width===C&&L.height===T||(L.width=C,L.height=T),L.ctx2d||(L.ctx2d=L.getContext("2d",{willReadFrequently:!0})),L.ctx2d.drawImage(t,0,0,S,O,0,0,C,T),t.dbrObjUrl&&URL.revokeObjectURL(t.dbrObjUrl),yield f._captureCanvas(L,r)})()}_captureCanvas(t,r){var f=this;return te(function*(){if(t.crossOrigin&&"anonymous"!=t.crossOrigin)throw"cors";if([t.width,t.height].includes(0))throw Error("The width or height of the 'canvas' is 0.");const C=t.ctx2d||t.getContext("2d",{willReadFrequently:!0}),T={bytes:Uint8Array.from(C.getImageData(0,0,t.width,t.height).data),width:t.width,height:t.height,stride:4*t.width,format:10};return yield f._captureInWorker(T,r)})()}_captureVideo(t,r){var f=this;return te(function*(){if(t.crossOrigin&&"anonymous"!=t.crossOrigin)throw"cors";let C,T,S=t.videoWidth,O=t.videoHeight,x=Math.max(S,O);x>f.maxCvsSideLength?(f._compressRate=f.maxCvsSideLength/x,C=Math.round(S*f._compressRate),T=Math.round(O*f._compressRate)):(C=S,T=O),f._canvas||(f._canvas=document.createElement("canvas"));const L=f._canvas;return L.width===C&&L.height===T||(L.width=C,L.height=T),L.ctx2d||(L.ctx2d=L.getContext("2d",{willReadFrequently:!0})),L.ctx2d.drawImage(t,0,0,S,O,0,0,C,T),yield f._captureCanvas(L,r)})()}_captureInWorker(t,r){var f=this;return te(function*(){const{bytes:C,width:T,height:S,stride:O,format:x}=t;let L=it();const P=new ji;return Ze[L]=function(){var N=te(function*(k){var W,H;if(!k.success){let Z=new Error(k.message);return Z.stack=k.stack+"\n"+Z.stack,P.reject(Z)}{const Z=Date.now();ze._onLog&&(ze._onLog(`get result time from worker: ${Z}`),ze._onLog("worker to main time consume: "+(Z-k.workerReturnMsgTime)));try{const X=k.captureResult;t.bytes=k.bytes;for(let J of X.items)0!==f._compressRate&&fo(J,f._compressRate),J.type===Le.CRIT_ORIGINAL_IMAGE?J.imageData=t:J.type===Le.CRIT_NORMALIZED_IMAGE?null===(W=pt.ddn)||void 0===W||W.handleNormalizedImageResultItem(J):J.type===Le.CRIT_PARSED_RESULT&&(null===(H=pt.dcp)||void 0===H||H.handleParsedResultItem(J));if(f._dynamsoft)for(let J of f._resultFilterSet)J.onDecodedBarcodesReceived(X.items),J.onRecognizedTextLinesReceived(X.items),J.onDetectedQuadsReceived(X.items),J.onNormalizedImagesReceived(X.items);const q=function(J){const Ee={barcodeResultItems:[],textLineResultItems:[],detectedQuadResultItems:[],normalizedImageResultItems:[],parsedResultItems:[]};return J.items.forEach(_e=>{_e.type===Le.CRIT_BARCODE?Ee.barcodeResultItems.push(_e):_e.type===Le.CRIT_TEXT_LINE?Ee.textLineResultItems.push(_e):_e.type===Le.CRIT_DETECTED_QUAD?Ee.detectedQuadResultItems.push(_e):_e.type===Le.CRIT_NORMALIZED_IMAGE?Ee.normalizedImageResultItems.push(_e):_e.type===Le.CRIT_PARSED_RESULT&&Ee.parsedResultItems.push(_e)}),Ee}(X);q.barcodeResultItems.length&&(X.barcodeResultItems=q.barcodeResultItems),q.textLineResultItems.length&&(X.textLineResultItems=q.textLineResultItems),q.detectedQuadResultItems.length&&(X.detectedQuadResultItems=q.detectedQuadResultItems),q.normalizedImageResultItems.length&&(X.normalizedImageResultItems=q.normalizedImageResultItems),q.parsedResultItems.length&&(X.parsedResultItems=q.parsedResultItems);const ie=X.intermediateResult;if(ie){let J=0;for(let Ee of f._intermediateResultReceiverSet){J++;for(let _e of ie){if("onTaskResultsReceived"===_e.info.callbackName){for(let xe of _e.intermediateResultUnits)xe.originalImageTag=t.tag?t.tag:null;Ee[_e.info.callbackName]&&Ee[_e.info.callbackName]({intermediateResultUnits:_e.intermediateResultUnits},_e.info)}else Ee[_e.info.callbackName]&&Ee[_e.info.callbackName](_e.result,_e.info);J===f._intermediateResultReceiverSet.size&&delete _e.info.callbackName}}}return X&&X.intermediateResult&&delete X.intermediateResult,f._compressRate=0,P.resolve(X)}catch(X){return P.reject(X)}}});return function(k){return N.apply(this,arguments)}}(),ze._onLog&&ze._onLog(`send buffer to worker: ${Date.now()}`),Xe.postMessage({type:"cvr_capture",id:L,instanceID:f._instanceID,body:{bytes:C,width:T,height:S,stride:O,format:x,templateName:r||"",dynamsoft:f._dynamsoft}},[C.buffer]),P})()}initSettings(t){var r=this;return te(function*(){return r._checkIsDisposed(),t&&["string","object"].includes(typeof t)?("string"==typeof t?t.startsWith("{")?r._currentSettings=JSON.parse(t):t=yield zs(t,"text"):"object"==typeof t&&(r._currentSettings=t,t=JSON.stringify(t)),yield new Promise((f,C)=>{let T=it();Ze[T]=function(){var S=te(function*(O){if(O.success){const x=JSON.parse(O.response);if(0!==x.exception){let N=new Error(x.description?x.description:"Init Settings Failed.");return N.errorCode=x.exception,C(N)}let L=[],P=JSON.parse(t).CaptureVisionTemplates;for(let N=0;N<P.length;N++){let k=yield r.containsTask(P[N].Name);L=L.concat(k)}return yield Wt([...new Set(L)]),r._bNeedOutputOriginalImage=1===r._currentSettings.CaptureVisionTemplates[0].OutputOriginalImage,f(x)}{let x=new Error(O.message);return x.stack=O.stack+"\n"+x.stack,C(x)}});return function(O){return S.apply(this,arguments)}}(),Xe.postMessage({type:"cvr_initSettings",id:T,instanceID:r._instanceID,body:{settings:t}})})):console.error("Invalid template.")})()}outputSettings(t){var r=this;return te(function*(){return r._checkIsDisposed(),yield new Promise((f,C)=>{let T=it();Ze[T]=function(){var S=te(function*(O){if(O.success){const x=JSON.parse(O.settings);if(0!==x.errorCode){let L=new Error(x.errorString);return L.errorCode=x.errorCode,C(L)}return delete x.errorCode,delete x.errorString,f(x)}{let x=new Error(O.message);return x.stack=O.stack+"\n"+x.stack,C(x)}});return function(O){return S.apply(this,arguments)}}(),Xe.postMessage({type:"cvr_outputSettings",id:T,instanceID:r._instanceID,body:{templateName:t||"Default"}})})})()}outputSettingsToFile(t,r,f){var C=this;return te(function*(){const T=yield C.outputSettings(t),S=new Blob([JSON.stringify(T,null,2,function(O,x){return x instanceof Array?JSON.stringify(x):x},2)],{type:"application/json"});if(f){const O=document.createElement("a");O.href=URL.createObjectURL(S),r.endsWith(".json")&&(r=r.replace(".json","")),O.download=`${r}.json`,O.onclick=()=>{setTimeout(()=>{URL.revokeObjectURL(O.href)},500)},O.click()}return S})()}getSimplifiedSettings(t="Default"){var r=this;return te(function*(){r._checkIsDisposed();const f=yield r.containsTask(t);return yield Wt(f),yield new Promise((C,T)=>{let S=it();Ze[S]=function(){var O=te(function*(x){if(x.success){const L=JSON.parse(x.settings,(P,N)=>ca&&"barcodeFormatIds"===P?BigInt(N):N);if(L.minImageCaptureInterval=r._minImageCaptureInterval,0!==L.code){let P=new Error(L.codeString);return P.errorCode=L.errorCode,T(P)}return delete L.code,delete L.codeString,C(L)}{let L=new Error(x.message);return L.stack=x.stack+"\n"+L.stack,T(L)}});return function(x){return O.apply(this,arguments)}}(),Xe.postMessage({type:"cvr_getSimplifiedSettings",id:S,instanceID:r._instanceID,body:{templateName:t}})})})()}updateSettings(t,r){var f=this;return te(function*(){f._checkIsDisposed();const C=yield f.containsTask(t);return yield Wt(C),yield new Promise((T,S)=>{let O=it();Ze[O]=function(){var x=te(function*(L){if(L.success){const P=JSON.parse(L.response);if(r.minImageCaptureInterval&&r.minImageCaptureInterval>=-1&&(f._minImageCaptureInterval=r.minImageCaptureInterval),f._bNeedOutputOriginalImage=L.bNeedOutputOriginalImage,0!==P.exception){let N=new Error(P.description?P.description:"Update Settings Failed.");return N.errorCode=P.exception,S(N)}return f._currentSettings=yield f.outputSettings("*"),T(P)}{let P=new Error(L.message);return P.stack=L.stack+"\n"+P.stack,S(P)}});return function(L){return x.apply(this,arguments)}}(),Xe.postMessage({type:"cvr_updateSettings",id:O,instanceID:f._instanceID,body:{settings:r,templateName:t}})})})()}resetSettings(){var t=this;return te(function*(){return t._checkIsDisposed(),yield new Promise((r,f)=>{let C=it();Ze[C]=function(){var T=te(function*(S){if(S.success){const O=JSON.parse(S.response);if(0!==O.exception){let x=new Error(O.description?O.description:"Reset Settings Failed.");return x.errorCode=O.exception,f(x)}return t._currentSettings=yield t.outputSettings("*"),r(O)}{let O=new Error(S.message);return O.stack=S.stack+"\n"+O.stack,f(O)}});return function(S){return T.apply(this,arguments)}}(),Xe.postMessage({type:"cvr_resetSettings",id:C,instanceID:t._instanceID})})})()}getIntermediateResultManager(t){var r=this;if(this._checkIsDisposed(),!t&&0!==at.bSupportIRTModule)throw new Error("The current license does not support the use of intermediate results.");return this._intermediateResultManager||(this._intermediateResultManager=new pa,this._intermediateResultManager.addResultReceiver=function(){var f=te(function*(C){if("object"!=typeof C)throw new Error("Invalid receiver.");r._intermediateResultReceiverSet.add(C),r._handleIntermediateResultReceiver();let T=-1,S={};if(!C.isDce){if(!C._observedResultUnitTypes||!C._observedTaskMap)throw new Error("Invalid Intermediate Result Receiver.");T=C._observedResultUnitTypes,C._observedTaskMap.forEach((O,x)=>{S[x]=O}),C._observedTaskMap.clear()}return yield te(function*(){return yield new Promise((O,x)=>{let L=it();Ze[L]=function(){var P=te(function*(N){if(N.success)return O();{let k=new Error(N.message);return k.stack=N.stack+"\n"+k.stack,x(k)}});return function(N){return P.apply(this,arguments)}}(),Xe.postMessage({type:"cvr_setIrrRegistry",id:L,instanceID:r._instanceID,body:{receiverObj:r._irrRegistryState,observedResultUnitTypes:String(T),observedTaskMap:S}})})})()});return function(C){return f.apply(this,arguments)}}(),this._intermediateResultManager.removeResultReceiver=function(){var f=te(function*(C){return r._intermediateResultReceiverSet.delete(C),r._handleIntermediateResultReceiver(),yield new Promise((T,S)=>{let O=it();Ze[O]=function(){var x=te(function*(L){if(L.success)return T();{let P=new Error(L.message);return P.stack=L.stack+"\n"+P.stack,S(P)}});return function(L){return x.apply(this,arguments)}}(),Xe.postMessage({type:"cvr_setIrrRegistry",id:O,instanceID:r._instanceID,body:{receiverObj:r._irrRegistryState}})})});return function(C){return f.apply(this,arguments)}}(),this._intermediateResultManager.getOriginalImage=()=>this._dsImage),this._intermediateResultManager}_handleIntermediateResultReceiver(){for(let t in this._irrRegistryState)this._irrRegistryState[t]=!1;for(let t of this._intermediateResultReceiverSet)if(t.isDce)this._irrRegistryState.onTaskResultsReceivedForDce=!0;else for(let r in t)this._irrRegistryState[r]||(this._irrRegistryState[r]=!!t[r])}contains(t,r){return function(f,C){let T=C.x,S=C.y,O=f[0].x,x=f[0].y,L=f[1].x,P=f[1].y,N=f[2].x,k=f[2].y,W=f[3].x,H=f[3].y,Z=J(T,S,O,x,L,P),X=J(T,S,L,P,N,k),q=J(T,S,N,k,W,H),ie=J(T,S,W,H,O,x);function J(Ee,_e,xe,Ie,b,me){return(Ee-xe)*(me-Ie)-(_e-Ie)*(b-xe)}return Z>=0&&X>=0&&q>=0&&ie>=0||Z<=0&&X<=0&&q<=0&&ie<=0}(t,r)}parseRequiredResources(t){var r=this;return te(function*(){return r._checkIsDisposed(),yield new Promise((f,C)=>{let T=it();Ze[T]=function(){var S=te(function*(O){if(O.success)return f(JSON.parse(O.resources));{let x=new Error(O.message);return x.stack=O.stack+"\n"+x.stack,C(x)}});return function(O){return S.apply(this,arguments)}}(),Xe.postMessage({type:"cvr_parseRequiredResources",id:T,instanceID:r._instanceID,body:{templateName:t}})})})()}dispose(){var t=this;return te(function*(){t._checkIsDisposed(),t._promiseStartScan&&t.stopCapturing(),t._isa=null,t._resultReceiverSet.clear(),t._isaStateListenerSet.clear(),t._resultFilterSet.clear(),t.bDestroyed=!0;let r=it();Ze[r]=f=>{if(!f.success){let C=new Error(f.message);throw C.stack=f.stack+"\n"+C.stack,C}},Xe.postMessage({type:"cvr_dispose",id:r,instanceID:t._instanceID})})()}_enableResultCrossVerification(t){var r=this;return te(function*(){return r._checkIsDisposed(),yield new Promise((f,C)=>{let T=it();Ze[T]=function(){var S=te(function*(O){if(O.success)return f(O.result);{let x=new Error(O.message);return x.stack=O.stack+"\n"+x.stack,C(x)}});return function(O){return S.apply(this,arguments)}}(),Xe.postMessage({type:"cvr_enableResultCrossVerification",id:T,instanceID:r._instanceID,body:{verificationEnabled:t}})})})()}_enableResultDeduplication(t){var r=this;return te(function*(){return r._checkIsDisposed(),yield new Promise((f,C)=>{let T=it();Ze[T]=function(){var S=te(function*(O){if(O.success)return f(O.result);{let x=new Error(O.message);return x.stack=O.stack+"\n"+x.stack,C(x)}});return function(O){return S.apply(this,arguments)}}(),Xe.postMessage({type:"cvr_enableResultDeduplication",id:T,instanceID:r._instanceID,body:{duplicateFilterEnabled:t}})})})()}_setDuplicateForgetTime(t){var r=this;return te(function*(){return r._checkIsDisposed(),yield new Promise((f,C)=>{let T=it();Ze[T]=function(){var S=te(function*(O){if(O.success)return f(O.result);{let x=new Error(O.message);return x.stack=O.stack+"\n"+x.stack,C(x)}});return function(O){return S.apply(this,arguments)}}(),Xe.postMessage({type:"cvr_setDuplicateForgetTime",id:T,instanceID:r._instanceID,body:{duplicateForgetTime:t}})})})()}_getDuplicateForgetTime(t){var r=this;return te(function*(){return r._checkIsDisposed(),yield new Promise((f,C)=>{let T=it();Ze[T]=function(){var S=te(function*(O){if(O.success)return f(O.time);{let x=new Error(O.message);return x.stack=O.stack+"\n"+x.stack,C(x)}});return function(O){return S.apply(this,arguments)}}(),Xe.postMessage({type:"cvr_getDuplicateForgetTime",id:T,instanceID:r._instanceID,body:{type:t}})})})()}_setThresholdValue(t,r,f){var C=this;return te(function*(){return yield Wt("ddn"),yield new Promise((T,S)=>{let O=it();Ze[O]=function(){var x=te(function*(L){if(L.success)return T();{let P=new Error(L.message);return P.stack=L.stack+"\n"+P.stack,S(P)}});return function(L){return x.apply(this,arguments)}}(),Xe.postMessage({type:"ddn_setThresholdValue",id:O,instanceID:C._instanceID,body:{threshold:t,leftLimit:r,rightLimit:f}})})})()}_checkIsDisposed(){if(this.disposed)throw new Error('"CaptureVisionRouter" instance has been disposed')}}class va{constructor(){this.onCapturedResultReceived=null,this.onOriginalImageResultReceived=null}}const di=typeof self>"u",go=di?{}:self,mo=(()=>{if(!di&&document.currentScript){let p=document.currentScript.src,t=p.indexOf("?");if(-1!=t)p=p.substring(0,t);else{let r=p.indexOf("#");-1!=r&&(p=p.substring(0,r))}return p.substring(0,p.lastIndexOf("/")+1)}return"./"})(),po=p=>{if(null==p&&(p="./"),!di){let t=document.createElement("a");t.href=p,p=t.href}return p.endsWith("/")||(p+="/"),p},_o=p=>p&&"object"==typeof p&&"function"==typeof p.then;class es extends Promise{constructor(t){let r,f;super((C,T)=>{r=C,f=T}),this._s="pending",this.resolve=C=>{this.isPending&&(_o(C)?this.task=C:(this._s="fulfilled",r(C)))},this.reject=C=>{this.isPending&&(this._s="rejected",f(C))},this.task=t}get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(t){var r=this;let f;this._task=t,_o(t)?f=t:"function"==typeof t&&(f=new Promise(t)),f&&te(function*(){try{const C=yield f;t===r._task&&r.resolve(C)}catch(C){t===r._task&&r.reject(C)}})()}get isEmpty(){return null==this._task}}const rr=" is not allowed to change after `createInstance` or `loadWasm` is called.",ya=!di&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID"))||"",vo=(p,t)=>{const r=p;if(!r._pLoad.isEmpty)throw new Error("`license`"+rr);r._license=t};!di&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword");const yo=p=>{if(null==p)p=[];else{p=p instanceof Array?[...p]:[p];for(let t=0;t<p.length;++t){if(!di){let r=document.createElement("a");r.href=p[t],p[t]=r.href}p[t].endsWith("/")||(p[t]+="/")}}return p},Co=(p,t)=>{const r=p;if(!r._pLoad.isEmpty)throw new Error("`licenseServer`"+rr);r._licenseServer=yo(t)},Eo=(p,t)=>{const r=p;if(!r._pLoad.isEmpty)throw new Error("`deviceFriendlyName`"+rr);r._deviceFriendlyName=t||""};let yn,Zt,sr,ts,Bt;typeof navigator<"u"&&(yn=navigator,Zt=yn.userAgent,sr=yn.platform,ts=yn.mediaDevices),function(){if(!di){const p={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:yn.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},t={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:sr,search:"Win"},Mac:{str:sr},Linux:{str:sr}};let r="unknownBrowser",f=0,C="unknownOS";for(let T in p){const S=p[T]||{};let L=S.verStr||Zt,P=S.verSearch||T;if(P instanceof Array||(P=[P]),-1!=(S.str||Zt).indexOf(S.search||T)){r=T;for(let N of P){let k=L.indexOf(N);if(-1!=k){f=parseFloat(L.substring(k+N.length+1));break}}break}}for(let T in t){const S=t[T]||{};if(-1!=(S.str||Zt).indexOf(S.search||T)){C=T;break}}"Linux"==C&&-1!=Zt.indexOf("Windows NT")&&(C="HarmonyOS"),Bt={browser:r,version:f,OS:C}}di&&(Bt={browser:"ssr",version:0,OS:"ssr"})}(),typeof WebAssembly<"u"&&Zt&&(!/Safari/.test(Zt)||/Chrome/.test(Zt)||/\(.+\s11_2_([2-6]).*\)/.test(Zt));const wo=function(){var p=te(function*(){return Wt("license"),tr("dynamsoft_inited",te(function*(){let{lt:t,l:r,ls:f,sp:C,rmk:T,cv:S}=((L,P=!1)=>{const N=L;if(N._pLoad.isEmpty){let k,W,H,Z=N._license||"",X=JSON.parse(JSON.stringify(N._licenseServer)),q=N._sessionPassword,ie=0;if(Z.startsWith("t")||Z.startsWith("f"))ie=0;else if(0===Z.length||Z.startsWith("P")||Z.startsWith("L")||Z.startsWith("Y")||Z.startsWith("A"))ie=1;else{ie=2;const J=Z.indexOf(":");-1!=J&&(Z=Z.substring(J+1));const Ee=Z.indexOf("?");if(-1!=Ee&&(W=Z.substring(Ee+1),Z=Z.substring(0,Ee)),Z.startsWith("DLC2"))ie=0;else{if(Z.startsWith("DLS2")){let _e;try{let xe=Z.substring(4);xe=atob(xe),_e=JSON.parse(xe)}catch{throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}if(Z=_e.handshakeCode?_e.handshakeCode:_e.organizationID?_e.organizationID:"","number"==typeof Z&&(Z=JSON.stringify(Z)),0===X.length){let xe=[];_e.mainServerURL&&(xe[0]=_e.mainServerURL),_e.standbyServerURL&&(xe[1]=_e.standbyServerURL),X=yo(xe)}!q&&_e.sessionPassword&&(q=_e.sessionPassword),k=_e.remark}Z&&"200001"!==Z&&!Z.startsWith("200001-")||(ie=1)}}if(ie&&(P||(go.crypto||(H="Please upgrade your browser to support online key."),go.crypto.subtle||(H="Require https to use online key in this browser."))),H){if(1!==ie)throw new Error(H);ie=0,console.warn(H),N._lastErrorCode=-1,N._lastErrorString=H}return 1===ie&&(Z="",console.warn("Applying for a public trial license ...")),{lt:ie,l:Z,ls:X,sp:q,rmk:k,cv:W}}throw new Error("Can't preprocess license again"+rr)})(tt),O=new es;tt._pLoad.task=O,te(function*(){try{yield tt._pLoad}catch{}})();let x=it();Ze[x]=L=>{if(L.message&&tt._onAuthMessage){let k=tt._onAuthMessage(L.message);null!=k&&(L.message=k)}let P,N=!1;if(1===t&&(N=!0),L.success?(ui&&ui("init license success"),L.message&&console.warn(L.message),at._bSupportIRTModule=L.bSupportIRTModule,at._bSupportDce4Module=L.bSupportDce4Module,tt.bPassValidation=!0):(P=Error(L.message),L.stack&&(P.stack=L.stack),L.ltsErrorCode&&(P.ltsErrorCode=L.ltsErrorCode),N||111==L.ltsErrorCode&&-1!=L.message.toLowerCase().indexOf("trial license")&&(N=!0)),N){let k=qe.license;qe.rootDirectory&&(k=qe.rootDirectory+"/"+k),k=po(k),(W=te(function*(H,Z,X){if(!H._bNeverShowDialog)try{let q=yield fetch(H.engineResourcePath+"dls.license.dialog.html");if(!q.ok)throw Error("Get license dialog fail. Network Error: "+q.statusText);let ie=yield q.text();if(!ie.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let J=document.createElement("div");J.innerHTML=ie;let Ee=[];for(let a=0;a<J.childElementCount;++a){let l=J.children[a];l instanceof HTMLStyleElement&&(Ee.push(l),document.head.append(l))}let _e=1==J.childElementCount?J.children[0]:J;_e.remove();let xe,Ie,b,me,Re,je=[_e],u=_e.children;for(let a of u)je.push(a);for(let a=0;a<je.length;++a)for(let l of je[a].children)je.push(l);for(let a of je)if(!xe&&a.classList.contains("dls-license-mask"))xe=a,a.addEventListener("click",l=>{if(a==l.target){_e.remove();for(let m of Ee)m.remove()}});else if(!Ie&&a.classList.contains("dls-license-icon-close"))Ie=a,a.addEventListener("click",()=>{_e.remove();for(let l of Ee)l.remove()});else if(!b&&a.classList.contains("dls-license-icon-error"))b=a,"error"!=Z&&a.remove();else if(!me&&a.classList.contains("dls-license-icon-warn"))me=a,"warn"!=Z&&a.remove();else if(!Re&&a.classList.contains("dls-license-msg-content")){Re=a;let l=X;for(;l;){let m=l.indexOf("["),i=l.indexOf("]",m),o=l.indexOf("(",i),d=l.indexOf(")",o);if(-1==m||-1==i||-1==o||-1==d){a.appendChild(new Text(l));break}m>0&&a.appendChild(new Text(l.substring(0,m)));let y=document.createElement("a"),_=l.substring(m+1,i);y.innerText=_;let v=l.substring(o+1,d);y.setAttribute("href",v),y.setAttribute("target","_blank"),a.appendChild(y),l=l.substring(d+1)}}document.body.appendChild(_e)}catch(q){H._onLog&&H._onLog(q.message||q)}}),function(H,Z,X){return W.apply(this,arguments)})({_bNeverShowDialog:tt._bNeverShowDialog,engineResourcePath:k,_onLog:ui},L.success?"warn":"error",L.message)}var W;L.success?O.resolve(void 0):O.reject(P)},yield Qs("worker"),Xe.postMessage({type:"dynamsoft",body:{v:"3.2.10",brtk:!!t,bptk:1===t,l:r,os:Bt,fn:tt.deviceFriendlyName,ls:f,sp:C,rmk:T,cv:S},id:x}),tt.bCallInitLicense=!0,yield O}))});return function(){return p.apply(this,arguments)}}();let To;pt.license={},pt.license.dynamsoft=wo,pt.license.getAR=te(function*(){{let p=Lt.dynamsoft_inited;p&&p.isRejected&&(yield p)}return Xe?new Promise((p,t)=>{let r=it();Ze[r]=function(){var f=te(function*(C){if(C.success){delete C.success;{let T=tt.license;T&&(T.startsWith("t")||T.startsWith("f"))&&(C.pk=T)}if(Object.keys(C).length){if(C.lem){let T=Error(C.lem);T.ltsErrorCode=C.lec,delete C.lem,delete C.lec,C.ae=T}p(C)}else p(null)}else{let T=Error(C.message);C.stack&&(T.stack=C.stack),t(T)}});return function(C){return f.apply(this,arguments)}}(),Xe.postMessage({type:"getAR",id:r})}):null});class tt{static setLicenseServer(t){Co(tt,t)}static get license(){return this._license}static set license(t){vo(tt,t)}static get licenseServer(){return this._licenseServer}static set licenseServer(t){Co(tt,t)}static get deviceFriendlyName(){return this._deviceFriendlyName}static set deviceFriendlyName(t){Eo(tt,t)}static initLicense(t,r){if(vo(tt,t),tt.bCallInitLicense=!0,r)return wo()}static setDeviceFriendlyName(t){Eo(tt,t)}static getDeviceFriendlyName(){return tt._deviceFriendlyName}static getDeviceUUID(){return te(function*(){return yield tr("dynamsoft_uuid",te(function*(){yield Wt();let t=new es,r=it();Ze[r]=f=>{if(f.success)t.resolve(f.uuid);else{const C=Error(f.message);f.stack&&(C.stack=f.stack),t.reject(C)}},Xe.postMessage({type:"getDeviceUUID",id:r}),To=yield t})),To})()}}tt._pLoad=new es,tt.bPassValidation=!1,tt.bCallInitLicense=!1,tt._license=ya,tt._licenseServer=[],tt._deviceFriendlyName="",null==qe.license&&(qe.license=mo),xi.license={wasm:!0},pt.license.LicenseManager=tt;const is="1.2.0";"string"!=typeof qe.std&&gn(qe.std.version,is)<0&&(qe.std={version:is,path:po(mo+`../../dynamsoft-capture-vision-std@${is}/dist/`)});const bo=typeof self>"u",ns=(()=>{if(!bo&&document.currentScript){let p=document.currentScript.src,t=p.indexOf("?");if(-1!=t)p=p.substring(0,t);else{let r=p.indexOf("#");-1!=r&&(p=p.substring(0,r))}return p.substring(0,p.lastIndexOf("/")+1)}return"./"})(),So=p=>{if(null==p&&(p="./"),!bo){let t=document.createElement("a");t.href=p,p=t.href}return p.endsWith("/")||(p+="/"),p};null==qe.dbr&&(qe.dbr=ns),xi.dbr={js:!1,wasm:!0,deps:["license","dip"]},pt.dbr={};const rs="1.2.0";"string"!=typeof qe.std&&gn(qe.std.version,rs)<0&&(qe.std={version:rs,path:So(ns+`../../dynamsoft-capture-vision-std@${rs}/dist/`)});const ss="2.2.10";var Io,xo,Ao,Oo;function Ca(p,t){if(1&p&&(ce.TgZ(0,"div",8),ce._UZ(1,"img",9,10),ce.qZA()),2&p){const r=ce.oxw();ce.xp6(1),ce.Q6J("src",r.fileSelected,ce.LSH)("alt",r.fileSelected)}}function Ea(p,t){if(1&p&&(ce.TgZ(0,"section",11)(1,"div",12)(2,"div",13)(3,"small"),ce._uU(4),ce.qZA()()(),ce.TgZ(5,"div",14)(6,"strong"),ce._uU(7),ce.qZA()()()),2&p){const r=ce.oxw();ce.xp6(4),ce.hij("Response: ",r.responseData.format,""),ce.xp6(3),ce.Oqu(r.responseData.text)}}function wa(p,t){if(1&p&&(ce.TgZ(0,"div")(1,"p"),ce._uU(2),ce.qZA()()),2&p){const r=ce.oxw();ce.xp6(2),ce.Oqu(r.messsage)}}(!qe.dip||"string"!=typeof qe.dip&&gn(qe.dip.version,ss)<0)&&(qe.dip={version:ss,path:So(ns+`../../dynamsoft-image-processing@${ss}/dist/`)}),"function"==typeof BigInt&&(BigInt(0),BigInt(0x10000000000000000),BigInt(4265345023),BigInt(3147775),BigInt(260096),BigInt(1),BigInt(2),BigInt(4),BigInt(8),BigInt(16),BigInt(32),BigInt(64),BigInt(128),BigInt(256),BigInt(512),BigInt(1024),BigInt(2048),BigInt(4096),BigInt(8192),BigInt(16384),BigInt(32768),BigInt(65536),BigInt(131072),BigInt(262144),BigInt(16777216),BigInt(33554432),BigInt(67108864),BigInt(134217728),BigInt(268435456),BigInt(536870912),BigInt(1073741824),BigInt(524288),BigInt(2147483648),BigInt(1048576),BigInt(2097152),BigInt(4194304),BigInt(8388608),BigInt(68719476736),BigInt(0x3f0000000000000),BigInt(4294967296),BigInt(4503599627370496),BigInt(9007199254740992),BigInt(0x40000000000000),BigInt(0x80000000000000),BigInt(72057594037927940),BigInt(0x200000000000000),BigInt(8589934592),BigInt(17179869184),BigInt(34359738368),BigInt(51539607552)),function(p){p[p.EBRT_STANDARD_RESULT=0]="EBRT_STANDARD_RESULT",p[p.EBRT_CANDIDATE_RESULT=1]="EBRT_CANDIDATE_RESULT",p[p.EBRT_PARTIAL_RESULT=2]="EBRT_PARTIAL_RESULT"}(Io||(Io={})),function(p){p[p.QRECL_ERROR_CORRECTION_H=0]="QRECL_ERROR_CORRECTION_H",p[p.QRECL_ERROR_CORRECTION_L=1]="QRECL_ERROR_CORRECTION_L",p[p.QRECL_ERROR_CORRECTION_M=2]="QRECL_ERROR_CORRECTION_M",p[p.QRECL_ERROR_CORRECTION_Q=3]="QRECL_ERROR_CORRECTION_Q"}(xo||(xo={})),function(p){p[p.LM_AUTO=1]="LM_AUTO",p[p.LM_CONNECTED_BLOCKS=2]="LM_CONNECTED_BLOCKS",p[p.LM_STATISTICS=4]="LM_STATISTICS",p[p.LM_LINES=8]="LM_LINES",p[p.LM_SCAN_DIRECTLY=16]="LM_SCAN_DIRECTLY",p[p.LM_STATISTICS_MARKS=32]="LM_STATISTICS_MARKS",p[p.LM_STATISTICS_POSTAL_CODE=64]="LM_STATISTICS_POSTAL_CODE",p[p.LM_CENTRE=128]="LM_CENTRE",p[p.LM_ONED_FAST_SCAN=256]="LM_ONED_FAST_SCAN",p[p.LM_REV=-2147483648]="LM_REV",p[p.LM_SKIP=0]="LM_SKIP"}(Ao||(Ao={})),function(p){p[p.DM_DIRECT_BINARIZATION=1]="DM_DIRECT_BINARIZATION",p[p.DM_THRESHOLD_BINARIZATION=2]="DM_THRESHOLD_BINARIZATION",p[p.DM_GRAY_EQUALIZATION=4]="DM_GRAY_EQUALIZATION",p[p.DM_SMOOTHING=8]="DM_SMOOTHING",p[p.DM_MORPHING=16]="DM_MORPHING",p[p.DM_DEEP_ANALYSIS=32]="DM_DEEP_ANALYSIS",p[p.DM_SHARPENING=64]="DM_SHARPENING",p[p.DM_BASED_ON_LOC_BIN=128]="DM_BASED_ON_LOC_BIN",p[p.DM_SHARPENING_SMOOTHING=256]="DM_SHARPENING_SMOOTHING",p[p.DM_REV=-2147483648]="DM_REV",p[p.DM_SKIP=0]="DM_SKIP"}(Oo||(Oo={})),tt.initLicense("DLS2eyJvcmdhbml6YXRpb25JRCI6IjIwMDAwMSJ9"),at.engineResourcePaths={std:"https://cdn.jsdelivr.net/npm/dynamsoft-capture-vision-std@1.2.0/dist/",dip:"https://cdn.jsdelivr.net/npm/dynamsoft-image-processing@2.2.10/dist/",core:"https://cdn.jsdelivr.net/npm/dynamsoft-core@3.2.10/dist/",license:"https://cdn.jsdelivr.net/npm/dynamsoft-license@3.2.10/dist/",cvr:"https://cdn.jsdelivr.net/npm/dynamsoft-capture-vision-router@2.2.10/dist/",dbr:"https://cdn.jsdelivr.net/npm/dynamsoft-barcode-reader@10.2.10/dist/",dce:"https://cdn.jsdelivr.net/npm/dynamsoft-camera-enhancer@4.0.2/dist/"},at.loadWasm(["DBR"]);let Ta=(()=>{class p{constructor(){var r=this;this.pInit=null,this.format="",this.fileSelected="",this.imageLoad=!1,this.messsage="",this.decodeImage=function(){var f=te(function*(C){try{const T=C.target.files[0];if(T){r.readImage(T),r.setResponseDefault();const O=yield(yield r.pInit).capture(C.target.files[0],"ReadBarcodes_SpeedFirst");for(let x of O.items)r.responseData={format:x.formatString,text:x.text};O.items.length||alert("No barcode found")}}catch(T){let S=T.message||T;console.error(S),alert(S)}C.target.value=""});return function(C){return f.apply(this,arguments)}}(),this.setResponseDefault=()=>{this.responseData={format:"",text:""}}}ngOnInit(){var r=this;return te(function*(){r.pInit=ze.createInstance(),r.setResponseDefault()})()}readImage(r){const f=new FileReader;f.onload=C=>{this.fileSelected=f.result,this.imageLoad=!0},f.onerror=C=>{console.warn(C),this.messsage="Error loading image"},f.readAsDataURL(r)}ngOnDestroy(){var r=this;return te(function*(){r.pInit&&(yield r.pInit).dispose(),console.log("ImageCapture Component Unmount")})()}static#e=this.\u0275fac=function(f){return new(f||p)};static#t=this.\u0275cmp=ce.Xpm({type:p,selectors:[["image-capture"]],decls:9,vars:3,consts:[[1,"div-image-capture"],["type","file","accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp",3,"change","click"],["class","content-preview",4,"ngIf"],[1,"div-results-container"],["resultsContainer",""],[1,"content-results"],["class","results",4,"ngIf"],[4,"ngIf"],[1,"content-preview"],[3,"src","alt"],["inputImage",""],[1,"results"],[1,"content-header"],[1,"response"],[1,"content-response"]],template:function(f,C){1&f&&(ce.TgZ(0,"div",0)(1,"input",1),ce.NdJ("change",function(S){return C.decodeImage(S)})("click",function(){return C.setResponseDefault()}),ce.qZA()(),ce._UZ(2,"br"),ce.YNc(3,Ca,3,2,"div",2),ce.TgZ(4,"div",3,4)(6,"div",5),ce.YNc(7,Ea,8,2,"section",6),ce.qZA()(),ce.YNc(8,wa,3,1,"div",7)),2&f&&(ce.xp6(3),ce.Q6J("ngIf",C.imageLoad),ce.xp6(4),ce.Q6J("ngIf",C.responseData.text),ce.xp6(1),ce.Q6J("ngIf",C.messsage))},dependencies:[qn.O5],styles:[".div-image-capture[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%}.div-image-capture[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:inline-block;border:1px solid #43555e;border-radius:5px;padding:8px 12px;outline:none;white-space:nowrap;cursor:pointer;text-shadow:1px 1px #fff;font-weight:700;font-size:10pt}section.results[_ngcontent-%COMP%]{border-radius:12px;margin:16px 0;border:1px solid #c4c6d0}.content-response[_ngcontent-%COMP%]{padding:16px 24px;word-wrap:break-word}.content-header[_ngcontent-%COMP%]{align-content:center;align-items:center;display:flex;justify-content:center;padding:16px 16px 0 24px}.content-header[_ngcontent-%COMP%]   .response[_ngcontent-%COMP%]{flex:1 1 auto;color:#44474e}.content-header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{cursor:pointer;border:none;background:transparent;margin:auto 10px}.content-preview[_ngcontent-%COMP%]{box-shadow:#0bdc12 0 0 0 1px,transparent 0 0 0 0;border-radius:5px;max-width:380px;margin:20px auto auto}.content-preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:auto;width:100%;border-radius:5px}"]})}return p})();const os=typeof self>"u",ba=(()=>{if(!os&&document.currentScript){let p=document.currentScript.src,t=p.indexOf("?");if(-1!=t)p=p.substring(0,t);else{let r=p.indexOf("#");-1!=r&&(p=p.substring(0,r))}return p.substring(0,p.lastIndexOf("/")+1)}return"./"})();function R(p,t,r,f){if("a"===r&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?p!==t||!f:!t.has(p))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?f:"a"===r?f.call(p):f?f.value:t.get(p)}function Te(p,t,r,f,C){if("m"===f)throw new TypeError("Private method is not writable");if("a"===f&&!C)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?p!==t||!C:!t.has(p))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===f?C.call(p,r):C?C.value=r:t.set(p,r),r}let Cn,qt,or,ar,gt;null==qe.dce&&(qe.dce=ba),xi.dce={wasm:!1,js:!1},pt.dce={},"function"==typeof SuppressedError&&SuppressedError,typeof navigator<"u"&&(Cn=navigator,qt=Cn.userAgent,or=Cn.platform,ar=Cn.mediaDevices),function(){if(!os){const p={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Cn.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},t={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:or,search:"Win"},Mac:{str:or},Linux:{str:or}};let r="unknownBrowser",f=0,C="unknownOS";for(let T in p){const S=p[T]||{};let L=S.verStr||qt,P=S.verSearch||T;if(P instanceof Array||(P=[P]),-1!=(S.str||qt).indexOf(S.search||T)){r=T;for(let N of P){let k=L.indexOf(N);if(-1!=k){f=parseFloat(L.substring(k+N.length+1));break}}break}}for(let T in t){const S=t[T]||{};if(-1!=(S.str||qt).indexOf(S.search||T)){C=T;break}}"Linux"==C&&-1!=qt.indexOf("Windows NT")&&(C="HarmonyOS"),gt={browser:r,version:f,OS:C}}os&&(gt={browser:"ssr",version:0,OS:"ssr"})}();const Sa=typeof WebAssembly<"u"&&qt&&!(/Safari/.test(qt)&&!/Chrome/.test(qt)&&/\(.+\s11_2_([2-6]).*\)/.test(qt)),Ia=!(typeof Worker>"u"),Ro=!(!ar||!ar.getUserMedia),xa=function(){var p=te(function*(){let t=!1;if(Ro)try{(yield ar.getUserMedia({video:!0})).getTracks().forEach(r=>{r.stop()}),t=!0}catch{}return t});return function(){return p.apply(this,arguments)}}();var Aa={653:(p,t,r)=>{var f,C,T,S,O,x,L,P,N,k,H,Z,X,q,ie,J,Ee,_e,xe,Ie,u,a,l,m,b=b||{version:"5.2.1"};if(t.fabric=b,typeof document<"u"&&typeof window<"u")b.document=document instanceof(typeof HTMLDocument<"u"?HTMLDocument:Document)?document:document.implementation.createHTMLDocument(""),b.window=window;else{var me=new(r(192).JSDOM)(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;b.document=me.document,b.jsdomImplForWrapper=r(898).implForWrapper,b.nodeCanvas=r(245).Canvas,b.window=me,DOMParser=b.window.DOMParser}function Re(u,a){var l=u.canvas,m=a.targetCanvas,i=m.getContext("2d");i.translate(0,m.height),i.scale(1,-1),i.drawImage(l,0,l.height-m.height,m.width,m.height,0,0,m.width,m.height)}function je(u,a){var l=a.targetCanvas.getContext("2d"),m=a.destinationWidth,i=a.destinationHeight,o=m*i*4,d=new Uint8Array(this.imageBuffer,0,o),y=new Uint8ClampedArray(this.imageBuffer,0,o);u.readPixels(0,0,m,i,u.RGBA,u.UNSIGNED_BYTE,d);var _=new ImageData(y,m,i);l.putImageData(_,0,0)}b.isTouchSupported="ontouchstart"in b.window||"ontouchstart"in b.document||b.window&&b.window.navigator&&b.window.navigator.maxTouchPoints>0,b.isLikelyNode=typeof Buffer<"u"&&typeof window>"u",b.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],b.DPI=96,b.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",b.commaWsp="(?:\\s+,?\\s*|,\\s*)",b.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/gi,b.reNonWord=/[ \n\.,;!\?\-]/,b.fontPaths={},b.iMatrix=[1,0,0,1,0,0],b.svgNS="http://www.w3.org/2000/svg",b.perfLimitSizeTotal=2097152,b.maxCacheSideLimit=4096,b.minCacheSideLimit=256,b.charWidthsCache={},b.textureSize=2048,b.disableStyleCopyPaste=!1,b.enableGLFiltering=!0,b.devicePixelRatio=b.window.devicePixelRatio||b.window.webkitDevicePixelRatio||b.window.mozDevicePixelRatio||1,b.browserShadowBlurConstant=1,b.arcToSegmentsCache={},b.boundsOfCurveCache={},b.cachesBoundsOfCurve=!0,b.forceGLPutImageData=!1,b.initFilterBackend=function(){return b.enableGLFiltering&&b.isWebglSupported&&b.isWebglSupported(b.textureSize)?(console.log("max texture size: "+b.maxTextureSize),new b.WebglFilterBackend({tileSize:b.textureSize})):b.Canvas2dFilterBackend?new b.Canvas2dFilterBackend:void 0},typeof document<"u"&&typeof window<"u"&&(window.fabric=b),function(){function u(l,m){if(this.__eventListeners[l]){var i=this.__eventListeners[l];m?i[i.indexOf(m)]=!1:b.util.array.fill(i,!1)}}function a(l,m){var i=function(){m.apply(this,arguments),this.off(l,i)}.bind(this);this.on(l,i)}b.Observable={fire:function(l,m){if(!this.__eventListeners)return this;var i=this.__eventListeners[l];if(!i)return this;for(var o=0,d=i.length;o<d;o++)i[o]&&i[o].call(this,m||{});return this.__eventListeners[l]=i.filter(function(y){return!1!==y}),this},on:function(l,m){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var i in l)this.on(i,l[i]);else this.__eventListeners[l]||(this.__eventListeners[l]=[]),this.__eventListeners[l].push(m);return this},once:function(l,m){if(1===arguments.length)for(var i in l)a.call(this,i,l[i]);else a.call(this,l,m);return this},off:function(l,m){if(!this.__eventListeners)return this;if(0===arguments.length)for(l in this.__eventListeners)u.call(this,l);else if(1===arguments.length&&"object"==typeof arguments[0])for(var i in l)u.call(this,i,l[i]);else u.call(this,l,m);return this}}}(),b.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var u=0,a=arguments.length;u<a;u++)this._onObjectAdded(arguments[u]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(u,a,l){var m=this._objects;return l?m[a]=u:m.splice(a,0,u),this._onObjectAdded&&this._onObjectAdded(u),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var u,a=this._objects,l=!1,m=0,i=arguments.length;m<i;m++)-1!==(u=a.indexOf(arguments[m]))&&(l=!0,a.splice(u,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[m]));return this.renderOnAddRemove&&l&&this.requestRenderAll(),this},forEachObject:function(u,a){for(var l=this.getObjects(),m=0,i=l.length;m<i;m++)u.call(a,l[m],m,l);return this},getObjects:function(u){return void 0===u?this._objects.concat():this._objects.filter(function(a){return a.type===u})},item:function(u){return this._objects[u]},isEmpty:function(){return 0===this._objects.length},size:function(){return this._objects.length},contains:function(u,a){return this._objects.indexOf(u)>-1||!!a&&this._objects.some(function(l){return"function"==typeof l.contains&&l.contains(u,!0)})},complexity:function(){return this._objects.reduce(function(u,a){return u+(a.complexity?a.complexity():0)},0)}},b.CommonMethods={_setOptions:function(u){for(var a in u)this.set(a,u[a])},_initGradient:function(u,a){!u||!u.colorStops||u instanceof b.Gradient||this.set(a,new b.Gradient(u))},_initPattern:function(u,a,l){!u||!u.source||u instanceof b.Pattern?l&&l():this.set(a,new b.Pattern(u,l))},_setObject:function(u){for(var a in u)this._set(a,u[a])},set:function(u,a){return"object"==typeof u?this._setObject(u):this._set(u,a),this},_set:function(u,a){this[u]=a},toggle:function(u){var a=this.get(u);return"boolean"==typeof a&&this.set(u,!a),this},get:function(u){return this[u]}},f=t,C=Math.sqrt,T=Math.atan2,S=Math.pow,O=Math.PI/180,x=Math.PI/2,b.util={cos:function(u){if(0===u)return 1;switch(u<0&&(u=-u),u/x){case 1:case 3:return 0;case 2:return-1}return Math.cos(u)},sin:function(u){if(0===u)return 0;var a=1;switch(u<0&&(a=-1),u/x){case 1:return a;case 2:return 0;case 3:return-a}return Math.sin(u)},removeFromArray:function(u,a){var l=u.indexOf(a);return-1!==l&&u.splice(l,1),u},getRandomInt:function(u,a){return Math.floor(Math.random()*(a-u+1))+u},degreesToRadians:function(u){return u*O},radiansToDegrees:function(u){return u/O},rotatePoint:function(u,a,l){var m=new b.Point(u.x-a.x,u.y-a.y),i=b.util.rotateVector(m,l);return new b.Point(i.x,i.y).addEquals(a)},rotateVector:function(u,a){var l=b.util.sin(a),m=b.util.cos(a);return{x:u.x*m-u.y*l,y:u.x*l+u.y*m}},createVector:function(u,a){return new b.Point(a.x-u.x,a.y-u.y)},calcAngleBetweenVectors:function(u,a){return Math.acos((u.x*a.x+u.y*a.y)/(Math.hypot(u.x,u.y)*Math.hypot(a.x,a.y)))},getHatVector:function(u){return new b.Point(u.x,u.y).multiply(1/Math.hypot(u.x,u.y))},getBisector:function(u,a,l){var m=b.util.createVector(u,a),i=b.util.createVector(u,l),o=b.util.calcAngleBetweenVectors(m,i),d=o*(0===b.util.calcAngleBetweenVectors(b.util.rotateVector(m,o),i)?1:-1)/2;return{vector:b.util.getHatVector(b.util.rotateVector(m,d)),angle:o}},projectStrokeOnPoints:function(u,a,l){var m=[],i=a.strokeWidth/2,o=a.strokeUniform?new b.Point(1/a.scaleX,1/a.scaleY):new b.Point(1,1),d=function(y){var _=i/Math.hypot(y.x,y.y);return new b.Point(y.x*_*o.x,y.y*_*o.y)};return u.length<=1||u.forEach(function(y,_){var v,w,I=new b.Point(y.x,y.y);0===_?(w=u[_+1],v=l?d(b.util.createVector(w,I)).addEquals(I):u[u.length-1]):_===u.length-1?(v=u[_-1],w=l?d(b.util.createVector(v,I)).addEquals(I):u[0]):(v=u[_-1],w=u[_+1]);var A,M,D=b.util.getBisector(I,v,w),F=D.vector;if("miter"===a.strokeLineJoin&&(A=-i/Math.sin(D.angle/2),M=new b.Point(F.x*A*o.x,F.y*A*o.y),Math.hypot(M.x,M.y)/i<=a.strokeMiterLimit))return m.push(I.add(M)),void m.push(I.subtract(M));A=-i*Math.SQRT2,M=new b.Point(F.x*A*o.x,F.y*A*o.y),m.push(I.add(M)),m.push(I.subtract(M))}),m},transformPoint:function(u,a,l){return l?new b.Point(a[0]*u.x+a[2]*u.y,a[1]*u.x+a[3]*u.y):new b.Point(a[0]*u.x+a[2]*u.y+a[4],a[1]*u.x+a[3]*u.y+a[5])},makeBoundingBoxFromPoints:function(u,a){if(a)for(var l=0;l<u.length;l++)u[l]=b.util.transformPoint(u[l],a);var m=[u[0].x,u[1].x,u[2].x,u[3].x],i=b.util.array.min(m),o=b.util.array.max(m)-i,d=[u[0].y,u[1].y,u[2].y,u[3].y],y=b.util.array.min(d);return{left:i,top:y,width:o,height:b.util.array.max(d)-y}},invertTransform:function(u){var a=1/(u[0]*u[3]-u[1]*u[2]),l=[a*u[3],-a*u[1],-a*u[2],a*u[0]],m=b.util.transformPoint({x:u[4],y:u[5]},l,!0);return l[4]=-m.x,l[5]=-m.y,l},toFixed:function(u,a){return parseFloat(Number(u).toFixed(a))},parseUnit:function(u,a){var l=/\D{0,2}$/.exec(u),m=parseFloat(u);switch(a||(a=b.Text.DEFAULT_SVG_FONT_SIZE),l[0]){case"mm":return m*b.DPI/25.4;case"cm":return m*b.DPI/2.54;case"in":return m*b.DPI;case"pt":return m*b.DPI/72;case"pc":return m*b.DPI/72*12;case"em":return m*a;default:return m}},falseFunction:function(){return!1},getKlass:function(u,a){return u=b.util.string.camelize(u.charAt(0).toUpperCase()+u.slice(1)),b.util.resolveNamespace(a)[u]},getSvgAttributes:function(u){var a=["instantiated_by_use","style","id","class"];switch(u){case"linearGradient":a=a.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":a=a.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":a=a.concat(["offset","stop-color","stop-opacity"])}return a},resolveNamespace:function(u){if(!u)return b;var a,l=u.split("."),m=l.length,i=f||b.window;for(a=0;a<m;++a)i=i[l[a]];return i},loadImage:function(u,a,l,m){if(u){var i=b.util.createImage(),o=function(){a&&a.call(l,i,!1),i=i.onload=i.onerror=null};i.onload=o,i.onerror=function(){b.log("Error loading "+i.src),a&&a.call(l,null,!0),i=i.onload=i.onerror=null},0!==u.indexOf("data")&&null!=m&&(i.crossOrigin=m),"data:image/svg"===u.substring(0,14)&&(i.onload=null,b.util.loadImageInDom(i,o)),i.src=u}else a&&a.call(l,u)},loadImageInDom:function(u,a){var l=b.document.createElement("div");l.style.width=l.style.height="1px",l.style.left=l.style.top="-100%",l.style.position="absolute",l.appendChild(u),b.document.querySelector("body").appendChild(l),u.onload=function(){a(),l.parentNode.removeChild(l),l=null}},enlivenObjects:function(u,a,l,m){var i=[],o=0,d=(u=u||[]).length;function y(){++o===d&&a&&a(i.filter(function(_){return _}))}d?u.forEach(function(_,v){_&&_.type?b.util.getKlass(_.type,l).fromObject(_,function(w,I){I||(i[v]=w),m&&m(_,w,I),y()}):y()}):a&&a(i)},enlivenObjectEnlivables:function(u,a,l){var m=b.Object.ENLIVEN_PROPS.filter(function(i){return!!u[i]});b.util.enlivenObjects(m.map(function(i){return u[i]}),function(i){var o={};m.forEach(function(d,y){o[d]=i[y],a&&(a[d]=i[y])}),l&&l(o)})},enlivenPatterns:function(u,a){function l(){++i===o&&a&&a(m)}var m=[],i=0,o=(u=u||[]).length;o?u.forEach(function(d,y){d&&d.source?new b.Pattern(d,function(_){m[y]=_,l()}):(m[y]=d,l())}):a&&a(m)},groupSVGElements:function(u,a,l){var m;return u&&1===u.length?u[0]:(a&&(a.width&&a.height?a.centerPoint={x:a.width/2,y:a.height/2}:(delete a.width,delete a.height)),m=new b.Group(u,a),void 0!==l&&(m.sourcePath=l),m)},populateWithProperties:function(u,a,l){if(l&&Array.isArray(l))for(var m=0,i=l.length;m<i;m++)l[m]in u&&(a[l[m]]=u[l[m]])},createCanvasElement:function(){return b.document.createElement("canvas")},copyCanvasElement:function(u){var a=b.util.createCanvasElement();return a.width=u.width,a.height=u.height,a.getContext("2d").drawImage(u,0,0),a},toDataURL:function(u,a,l){return u.toDataURL("image/"+a,l)},createImage:function(){return b.document.createElement("img")},multiplyTransformMatrices:function(u,a,l){return[u[0]*a[0]+u[2]*a[1],u[1]*a[0]+u[3]*a[1],u[0]*a[2]+u[2]*a[3],u[1]*a[2]+u[3]*a[3],l?0:u[0]*a[4]+u[2]*a[5]+u[4],l?0:u[1]*a[4]+u[3]*a[5]+u[5]]},qrDecompose:function(u){var a=T(u[1],u[0]),l=S(u[0],2)+S(u[1],2),m=C(l),i=(u[0]*u[3]-u[2]*u[1])/m,o=T(u[0]*u[2]+u[1]*u[3],l);return{angle:a/O,scaleX:m,scaleY:i,skewX:o/O,skewY:0,translateX:u[4],translateY:u[5]}},calcRotateMatrix:function(u){if(!u.angle)return b.iMatrix.concat();var a=b.util.degreesToRadians(u.angle),l=b.util.cos(a),m=b.util.sin(a);return[l,m,-m,l,0,0]},calcDimensionsMatrix:function(u){var a=void 0===u.scaleX?1:u.scaleX,l=void 0===u.scaleY?1:u.scaleY,m=[u.flipX?-a:a,0,0,u.flipY?-l:l,0,0],i=b.util.multiplyTransformMatrices,o=b.util.degreesToRadians;return u.skewX&&(m=i(m,[1,0,Math.tan(o(u.skewX)),1],!0)),u.skewY&&(m=i(m,[1,Math.tan(o(u.skewY)),0,1],!0)),m},composeMatrix:function(u){var a=[1,0,0,1,u.translateX||0,u.translateY||0],l=b.util.multiplyTransformMatrices;return u.angle&&(a=l(a,b.util.calcRotateMatrix(u))),(1!==u.scaleX||1!==u.scaleY||u.skewX||u.skewY||u.flipX||u.flipY)&&(a=l(a,b.util.calcDimensionsMatrix(u))),a},resetObjectTransform:function(u){u.scaleX=1,u.scaleY=1,u.skewX=0,u.skewY=0,u.flipX=!1,u.flipY=!1,u.rotate(0)},saveObjectTransform:function(u){return{scaleX:u.scaleX,scaleY:u.scaleY,skewX:u.skewX,skewY:u.skewY,angle:u.angle,left:u.left,flipX:u.flipX,flipY:u.flipY,top:u.top}},isTransparent:function(u,a,l,m){m>0&&(a>m?a-=m:a=0,l>m?l-=m:l=0);var i,o=!0,d=u.getImageData(a,l,2*m||1,2*m||1),y=d.data.length;for(i=3;i<y&&0!=(o=d.data[i]<=0);i+=4);return d=null,o},parsePreserveAspectRatioAttribute:function(u){var a,l="meet",m=u.split(" ");return m&&m.length&&("meet"!==(l=m.pop())&&"slice"!==l?(a=l,l="meet"):m.length&&(a=m.pop())),{meetOrSlice:l,alignX:"none"!==a?a.slice(1,4):"none",alignY:"none"!==a?a.slice(5,8):"none"}},clearFabricFontCache:function(u){(u=(u||"").toLowerCase())?b.charWidthsCache[u]&&delete b.charWidthsCache[u]:b.charWidthsCache={}},limitDimsByArea:function(u,a){var l=Math.sqrt(a*u),m=Math.floor(a/l);return{x:Math.floor(l),y:m}},capValue:function(u,a,l){return Math.max(u,Math.min(a,l))},findScaleToFit:function(u,a){return Math.min(a.width/u.width,a.height/u.height)},findScaleToCover:function(u,a){return Math.max(a.width/u.width,a.height/u.height)},matrixToSVG:function(u){return"matrix("+u.map(function(a){return b.util.toFixed(a,b.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(u,a){var l=b.util.invertTransform(a),m=b.util.multiplyTransformMatrices(l,u.calcOwnMatrix());b.util.applyTransformToObject(u,m)},addTransformToObject:function(u,a){b.util.applyTransformToObject(u,b.util.multiplyTransformMatrices(a,u.calcOwnMatrix()))},applyTransformToObject:function(u,a){var l=b.util.qrDecompose(a),m=new b.Point(l.translateX,l.translateY);u.flipX=!1,u.flipY=!1,u.set("scaleX",l.scaleX),u.set("scaleY",l.scaleY),u.skewX=l.skewX,u.skewY=l.skewY,u.angle=l.angle,u.setPositionByOrigin(m,"center","center")},sizeAfterTransform:function(u,a,l){var m=u/2,i=a/2,o=[{x:-m,y:-i},{x:m,y:-i},{x:-m,y:i},{x:m,y:i}],d=b.util.calcDimensionsMatrix(l),y=b.util.makeBoundingBoxFromPoints(o,d);return{x:y.width,y:y.height}},mergeClipPaths:function(u,a){var l=u,m=a;l.inverted&&!m.inverted&&(l=a,m=u),b.util.applyTransformToObject(m,b.util.multiplyTransformMatrices(b.util.invertTransform(l.calcTransformMatrix()),m.calcTransformMatrix()));var i=l.inverted&&m.inverted;return i&&(l.inverted=m.inverted=!1),new b.Group([l],{clipPath:m,inverted:i})}},function(){var u=Array.prototype.join,a={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},l={m:"l",M:"L"};function m(M,D,F,B,z,K,oe,ne,ee,G,j){var Q=b.util.cos(M),se=b.util.sin(M),ae=b.util.cos(D),Y=b.util.sin(D),V=F*z*ae-B*K*Y+oe,$=B*z*ae+F*K*Y+ne;return["C",G+ee*(-F*z*se-B*K*Q),j+ee*(-B*z*se+F*K*Q),V+ee*(F*z*Y+B*K*ae),$+ee*(B*z*Y-F*K*ae),V,$]}function i(M,D,F,B){var z=Math.atan2(D,M),K=Math.atan2(B,F);return K>=z?K-z:2*Math.PI-(z-K)}function o(M,D,F){for(var ee=function(Q,se,ae,Y,V,$,le){var re=Math.PI,he=le*re/180,ve=b.util.sin(he),fe=b.util.cos(he),ue=0,pe=0,ge=-fe*Q*.5-ve*se*.5,Ce=-fe*se*.5+ve*Q*.5,Oe=(ae=Math.abs(ae))*ae,we=(Y=Math.abs(Y))*Y,Be=Ce*Ce,Ke=ge*ge,Pt=Oe*we-Oe*Be-we*Ke,ci=0;if(Pt<0){var un=Math.sqrt(1-Pt/(Oe*we));ae*=un,Y*=un}else ci=(V===$?-1:1)*Math.sqrt(Pt/(Oe*Be+we*Ke));var st=ci*ae*Ce/Y,kt=-ci*Y*ge/ae,Xn=fe*st-ve*kt+.5*Q,dn=ve*st+fe*kt+.5*se,ki=i(1,0,(ge-st)/ae,(Ce-kt)/Y),fn=i((ge-st)/ae,(Ce-kt)/Y,(-ge-st)/ae,(-Ce-kt)/Y);0===$&&fn>0?fn-=2*re:1===$&&fn<0&&(fn+=2*re);for(var ra=Math.ceil(Math.abs(fn/re*2)),Vr=[],zn=fn/ra,el=8/3*Math.sin(zn/4)*Math.sin(zn/4)/Math.sin(zn/2),Vs=ki+zn,Zn=0;Zn<ra;Zn++)Vr[Zn]=m(ki,Vs,fe,ve,ae,Y,Xn,dn,el,ue,pe),ue=Vr[Zn][5],pe=Vr[Zn][6],ki=Vs,Vs+=zn;return Vr}(F[6]-M,F[7]-D,F[1],F[2],F[4],F[5],F[3]),G=0,j=ee.length;G<j;G++)ee[G][1]+=M,ee[G][2]+=D,ee[G][3]+=M,ee[G][4]+=D,ee[G][5]+=M,ee[G][6]+=D;return ee}function d(M,D,F,B){return Math.sqrt((F-M)*(F-M)+(B-D)*(B-D))}function y(M,D,F,B,z,K,oe,ne){return function(ee){var G,Y,j=(G=ee)*G*G,Q=3*(Y=ee)*Y*(1-Y),se=function(Y){return 3*Y*(1-Y)*(1-Y)}(ee),ae=function(Y){return(1-Y)*(1-Y)*(1-Y)}(ee);return{x:oe*j+z*Q+F*se+M*ae,y:ne*j+K*Q+B*se+D*ae}}}function _(M,D,F,B,z,K,oe,ne){return function(ee){var G=1-ee;return Math.atan2(3*G*G*(B-D)+6*G*ee*(K-B)+3*ee*ee*(ne-K),3*G*G*(F-M)+6*G*ee*(z-F)+3*ee*ee*(oe-z))}}function v(M,D,F,B,z,K){return function(oe){var ne,Q,ee=(ne=oe)*ne,G=2*(Q=oe)*(1-Q),j=function(Q){return(1-Q)*(1-Q)}(oe);return{x:z*ee+F*G+M*j,y:K*ee+B*G+D*j}}}function w(M,D,F,B,z,K){return function(oe){var ne=1-oe;return Math.atan2(2*ne*(B-D)+2*oe*(K-B),2*ne*(F-M)+2*oe*(z-F))}}function I(M,D,F){var B,z,K={x:D,y:F},oe=0;for(z=1;z<=100;z+=1)B=M(z/100),oe+=d(K.x,K.y,B.x,B.y),K=B;return oe}function A(M){for(var D,F,B,z,K=0,oe=M.length,ne=0,ee=0,G=0,j=0,Q=[],se=0;se<oe;se++){switch(B={x:ne,y:ee,command:(D=M[se])[0]},D[0]){case"M":B.length=0,G=ne=D[1],j=ee=D[2];break;case"L":B.length=d(ne,ee,D[1],D[2]),ne=D[1],ee=D[2];break;case"C":F=y(ne,ee,D[1],D[2],D[3],D[4],D[5],D[6]),z=_(ne,ee,D[1],D[2],D[3],D[4],D[5],D[6]),B.iterator=F,B.angleFinder=z,B.length=I(F,ne,ee),ne=D[5],ee=D[6];break;case"Q":F=v(ne,ee,D[1],D[2],D[3],D[4]),z=w(ne,ee,D[1],D[2],D[3],D[4]),B.iterator=F,B.angleFinder=z,B.length=I(F,ne,ee),ne=D[3],ee=D[4];break;case"Z":case"z":B.destX=G,B.destY=j,B.length=d(ne,ee,G,j),ne=G,ee=j}K+=B.length,Q.push(B)}return Q.push({length:K,x:ne,y:ee}),Q}b.util.joinPath=function(M){return M.map(function(D){return D.join(" ")}).join(" ")},b.util.parsePath=function(M){var D,F,B,z,K,oe=[],ne=[],ee=b.rePathCommand,G="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",j="("+G+")"+b.commaWsp,Q="([01])"+b.commaWsp+"?",se=new RegExp(j+"?"+j+"?"+j+Q+Q+j+"?("+G+")","g");if(!M||!M.match)return oe;for(var ae,Y=0,V=(K=M.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi)).length;Y<V;Y++){z=(D=K[Y]).slice(1).trim(),ne.length=0;var $=D.charAt(0);if(ae=[$],"a"===$.toLowerCase())for(var le;le=se.exec(z);)for(var re=1;re<le.length;re++)ne.push(le[re]);else for(;B=ee.exec(z);)ne.push(B[0]);re=0;for(var he=ne.length;re<he;re++)F=parseFloat(ne[re]),isNaN(F)||ae.push(F);var ve=a[$.toLowerCase()],fe=l[$]||$;if(ae.length-1>ve)for(var ue=1,pe=ae.length;ue<pe;ue+=ve)oe.push([$].concat(ae.slice(ue,ue+ve))),$=fe;else oe.push(ae)}return oe},b.util.makePathSimpler=function(M){var D,F,B,z,K,oe,ne=0,ee=0,G=M.length,j=0,Q=0,se=[];for(F=0;F<G;++F){switch(B=!1,(D=M[F].slice(0))[0]){case"l":D[0]="L",D[1]+=ne,D[2]+=ee;case"L":ne=D[1],ee=D[2];break;case"h":D[1]+=ne;case"H":D[0]="L",D[2]=ee,ne=D[1];break;case"v":D[1]+=ee;case"V":D[0]="L",ee=D[1],D[1]=ne,D[2]=ee;break;case"m":D[0]="M",D[1]+=ne,D[2]+=ee;case"M":ne=D[1],ee=D[2],j=D[1],Q=D[2];break;case"c":D[0]="C",D[1]+=ne,D[2]+=ee,D[3]+=ne,D[4]+=ee,D[5]+=ne,D[6]+=ee;case"C":K=D[3],oe=D[4],ne=D[5],ee=D[6];break;case"s":D[0]="S",D[1]+=ne,D[2]+=ee,D[3]+=ne,D[4]+=ee;case"S":"C"===z?(K=2*ne-K,oe=2*ee-oe):(K=ne,oe=ee),ne=D[3],ee=D[4],D[0]="C",D[5]=D[3],D[6]=D[4],D[3]=D[1],D[4]=D[2],D[1]=K,D[2]=oe,K=D[3],oe=D[4];break;case"q":D[0]="Q",D[1]+=ne,D[2]+=ee,D[3]+=ne,D[4]+=ee;case"Q":K=D[1],oe=D[2],ne=D[3],ee=D[4];break;case"t":D[0]="T",D[1]+=ne,D[2]+=ee;case"T":"Q"===z?(K=2*ne-K,oe=2*ee-oe):(K=ne,oe=ee),D[0]="Q",ne=D[1],ee=D[2],D[1]=K,D[2]=oe,D[3]=ne,D[4]=ee;break;case"a":D[0]="A",D[6]+=ne,D[7]+=ee;case"A":B=!0,se=se.concat(o(ne,ee,D)),ne=D[6],ee=D[7];break;case"z":case"Z":ne=j,ee=Q}B||se.push(D),z=D[0]}return se},b.util.getSmoothPathFromPoints=function(M,D){var F,B=[],z=new b.Point(M[0].x,M[0].y),K=new b.Point(M[1].x,M[1].y),oe=M.length,ne=1,ee=0,G=oe>2;for(G&&(ne=M[2].x<K.x?-1:M[2].x===K.x?0:1,ee=M[2].y<K.y?-1:M[2].y===K.y?0:1),B.push(["M",z.x-ne*(D=D||0),z.y-ee*D]),F=1;F<oe;F++){if(!z.eq(K)){var j=z.midPointFrom(K);B.push(["Q",z.x,z.y,j.x,j.y])}z=M[F],F+1<M.length&&(K=M[F+1])}return G&&(ne=z.x>M[F-2].x?1:z.x===M[F-2].x?0:-1,ee=z.y>M[F-2].y?1:z.y===M[F-2].y?0:-1),B.push(["L",z.x+ne*D,z.y+ee*D]),B},b.util.getPathSegmentsInfo=A,b.util.getBoundsOfCurve=function(M,D,F,B,z,K,oe,ne){var ee;if(b.cachesBoundsOfCurve&&(ee=u.call(arguments),b.boundsOfCurveCache[ee]))return b.boundsOfCurveCache[ee];var G,j,Q,se,ae,Y,V,$,le=Math.sqrt,re=Math.min,he=Math.max,ve=Math.abs,fe=[],ue=[[],[]];j=6*M-12*F+6*z,G=-3*M+9*F-9*z+3*oe,Q=3*F-3*M;for(var pe=0;pe<2;++pe)if(pe>0&&(j=6*D-12*B+6*K,G=-3*D+9*B-9*K+3*ne,Q=3*B-3*D),ve(G)<1e-12){if(ve(j)<1e-12)continue;0<(se=-Q/j)&&se<1&&fe.push(se)}else(V=j*j-4*Q*G)<0||(0<(ae=(-j+($=le(V)))/(2*G))&&ae<1&&fe.push(ae),0<(Y=(-j-$)/(2*G))&&Y<1&&fe.push(Y));for(var ge,Oe,we=fe.length,Be=we;we--;)ge=(Oe=1-(se=fe[we]))*Oe*Oe*M+3*Oe*Oe*se*F+3*Oe*se*se*z+se*se*se*oe,ue[0][we]=ge,ue[1][we]=Oe*Oe*Oe*D+3*Oe*Oe*se*B+3*Oe*se*se*K+se*se*se*ne;ue[0][Be]=M,ue[1][Be]=D,ue[0][Be+1]=oe,ue[1][Be+1]=ne;var Ke=[{x:re.apply(null,ue[0]),y:re.apply(null,ue[1])},{x:he.apply(null,ue[0]),y:he.apply(null,ue[1])}];return b.cachesBoundsOfCurve&&(b.boundsOfCurveCache[ee]=Ke),Ke},b.util.getPointOnPath=function(M,D,F){F||(F=A(M));for(var B=0;D-F[B].length>0&&B<F.length-2;)D-=F[B].length,B++;var z,K=F[B],oe=D/K.length,ee=M[B];switch(K.command){case"M":return{x:K.x,y:K.y,angle:0};case"Z":case"z":return(z=new b.Point(K.x,K.y).lerp(new b.Point(K.destX,K.destY),oe)).angle=Math.atan2(K.destY-K.y,K.destX-K.x),z;case"L":return(z=new b.Point(K.x,K.y).lerp(new b.Point(ee[1],ee[2]),oe)).angle=Math.atan2(ee[2]-K.y,ee[1]-K.x),z;case"C":case"Q":return function(G,j){for(var Q,se,ae,Y=0,V=0,$=G.iterator,le={x:G.x,y:G.y},re=.01,he=G.angleFinder;V<j&&re>1e-4;)Q=$(Y),ae=Y,(se=d(le.x,le.y,Q.x,Q.y))+V>j?(Y-=re,re/=2):(le=Q,Y+=re,V+=se);return Q.angle=he(ae),Q}(K,D)}},b.util.transformPath=function(M,D,F){return F&&(D=b.util.multiplyTransformMatrices(D,[1,0,0,1,-F.x,-F.y])),M.map(function(B){for(var z=B.slice(0),K={},oe=1;oe<B.length-1;oe+=2)K.x=B[oe],K.y=B[oe+1],K=b.util.transformPoint(K,D),z[oe]=K.x,z[oe+1]=K.y;return z})}}(),function(){var u=Array.prototype.slice;function a(l,m,i){if(l&&0!==l.length){var o=l.length-1,d=m?l[o][m]:l[o];if(m)for(;o--;)i(l[o][m],d)&&(d=l[o][m]);else for(;o--;)i(l[o],d)&&(d=l[o]);return d}}b.util.array={fill:function(l,m){for(var i=l.length;i--;)l[i]=m;return l},invoke:function(l,m){for(var i=u.call(arguments,2),o=[],d=0,y=l.length;d<y;d++)o[d]=i.length?l[d][m].apply(l[d],i):l[d][m].call(l[d]);return o},min:function(l,m){return a(l,m,function(i,o){return i<o})},max:function(l,m){return a(l,m,function(i,o){return i>=o})}}}(),function(){function u(a,l,m){if(m)if(!b.isLikelyNode&&l instanceof Element)a=l;else if(l instanceof Array){a=[];for(var i=0,o=l.length;i<o;i++)a[i]=u({},l[i],m)}else if(l&&"object"==typeof l)for(var d in l)"canvas"===d||"group"===d?a[d]=null:l.hasOwnProperty(d)&&(a[d]=u({},l[d],m));else a=l;else for(var d in l)a[d]=l[d];return a}b.util.object={extend:u,clone:function(a,l){return u({},a,l)}},b.util.object.extend(b.util,b.Observable)}(),function(){function u(a,l){var m=a.charCodeAt(l);if(isNaN(m))return"";if(m<55296||m>57343)return a.charAt(l);if(55296<=m&&m<=56319){if(a.length<=l+1)throw"High surrogate without following low surrogate";var i=a.charCodeAt(l+1);if(56320>i||i>57343)throw"High surrogate without following low surrogate";return a.charAt(l)+a.charAt(l+1)}if(0===l)throw"Low surrogate without preceding high surrogate";var o=a.charCodeAt(l-1);if(55296>o||o>56319)throw"Low surrogate without preceding high surrogate";return!1}b.util.string={camelize:function(a){return a.replace(/-+(.)?/g,function(l,m){return m?m.toUpperCase():""})},capitalize:function(a,l){return a.charAt(0).toUpperCase()+(l?a.slice(1):a.slice(1).toLowerCase())},escapeXml:function(a){return a.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},graphemeSplit:function(a){var l,m=0,i=[];for(m=0;m<a.length;m++)!1!==(l=u(a,m))&&i.push(l);return i}}}(),function(){var u=Array.prototype.slice,a=function(){},l=function(){for(var d in{toString:1})if("toString"===d)return!1;return!0}(),m=function(d,y,_){for(var v in y)d.prototype[v]=v in d.prototype&&"function"==typeof d.prototype[v]&&(y[v]+"").indexOf("callSuper")>-1?function(w){return function(){var I=this.constructor.superclass;this.constructor.superclass=_;var A=y[w].apply(this,arguments);if(this.constructor.superclass=I,"initialize"!==w)return A}}(v):y[v],l&&(y.toString!==Object.prototype.toString&&(d.prototype.toString=y.toString),y.valueOf!==Object.prototype.valueOf&&(d.prototype.valueOf=y.valueOf))};function i(){}function o(d){for(var y=null,_=this;_.constructor.superclass;){var v=_.constructor.superclass.prototype[d];if(_[d]!==v){y=v;break}_=_.constructor.superclass.prototype}return y?arguments.length>1?y.apply(this,u.call(arguments,1)):y.call(this):console.log("tried to callSuper "+d+", method not found in prototype chain",this)}b.util.createClass=function(){var d=null,y=u.call(arguments,0);function _(){this.initialize.apply(this,arguments)}"function"==typeof y[0]&&(d=y.shift()),_.superclass=d,_.subclasses=[],d&&(i.prototype=d.prototype,_.prototype=new i,d.subclasses.push(_));for(var v=0,w=y.length;v<w;v++)m(_,y[v],d);return _.prototype.initialize||(_.prototype.initialize=a),_.prototype.constructor=_,_.prototype.callSuper=o,_}}(),L=!!b.document.createElement("div").attachEvent,P=["touchstart","touchmove","touchend"],b.util.addListener=function(u,a,l,m){u&&u.addEventListener(a,l,!L&&m)},b.util.removeListener=function(u,a,l,m){u&&u.removeEventListener(a,l,!L&&m)},b.util.getPointer=function(u){var i,o,l=b.util.getScrollLeftTop(u.target),m=(o=(i=u).changedTouches)&&o[0]?o[0]:i;return{x:m.clientX+l.left,y:m.clientY+l.top}},b.util.isTouchEvent=function(u){return P.indexOf(u.type)>-1||"touch"===u.pointerType},k="string"==typeof(N=b.document.createElement("div")).style.opacity,H=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,Z=function(u){return u},k?Z=function(u,a){return u.style.opacity=a,u}:"string"==typeof N.style.filter&&(Z=function(u,a){var l=u.style;return u.currentStyle&&!u.currentStyle.hasLayout&&(l.zoom=1),H.test(l.filter)?l.filter=l.filter.replace(H,a=a>=.9999?"":"alpha(opacity="+100*a+")"):l.filter+=" alpha(opacity="+100*a+")",u}),b.util.setStyle=function(u,a){var l=u.style;if(!l)return u;if("string"==typeof a)return u.style.cssText+=";"+a,a.indexOf("opacity")>-1?Z(u,a.match(/opacity:\s*(\d?\.?\d*)/)[1]):u;for(var m in a)"opacity"===m?Z(u,a[m]):l["float"===m||"cssFloat"===m?void 0===l.styleFloat?"cssFloat":"styleFloat":m]=a[m];return u},function(){var u,a,l,m,i=Array.prototype.slice,o=function(_){return i.call(_,0)};try{u=o(b.document.childNodes)instanceof Array}catch{}function d(_,v){var w=b.document.createElement(_);for(var I in v)"class"===I?w.className=v[I]:"for"===I?w.htmlFor=v[I]:w.setAttribute(I,v[I]);return w}function y(_){for(var v=0,w=0,I=b.document.documentElement,A=b.document.body||{scrollLeft:0,scrollTop:0};_&&(_.parentNode||_.host)&&((_=_.parentNode||_.host)===b.document?(v=A.scrollLeft||I.scrollLeft||0,w=A.scrollTop||I.scrollTop||0):(v+=_.scrollLeft||0,w+=_.scrollTop||0),1!==_.nodeType||"fixed"!==_.style.position););return{left:v,top:w}}u||(o=function(_){for(var v=new Array(_.length),w=_.length;w--;)v[w]=_[w];return v}),a=b.document.defaultView&&b.document.defaultView.getComputedStyle?function(_,v){var w=b.document.defaultView.getComputedStyle(_,null);return w?w[v]:void 0}:function(_,v){var w=_.style[v];return!w&&_.currentStyle&&(w=_.currentStyle[v]),w},m="userSelect"in(l=b.document.documentElement.style)?"userSelect":"MozUserSelect"in l?"MozUserSelect":"WebkitUserSelect"in l?"WebkitUserSelect":"KhtmlUserSelect"in l?"KhtmlUserSelect":"",b.util.makeElementUnselectable=function(_){return void 0!==_.onselectstart&&(_.onselectstart=b.util.falseFunction),m?_.style[m]="none":"string"==typeof _.unselectable&&(_.unselectable="on"),_},b.util.makeElementSelectable=function(_){return void 0!==_.onselectstart&&(_.onselectstart=null),m?_.style[m]="":"string"==typeof _.unselectable&&(_.unselectable=""),_},b.util.setImageSmoothing=function(_,v){_.imageSmoothingEnabled=_.imageSmoothingEnabled||_.webkitImageSmoothingEnabled||_.mozImageSmoothingEnabled||_.msImageSmoothingEnabled||_.oImageSmoothingEnabled,_.imageSmoothingEnabled=v},b.util.getById=function(_){return"string"==typeof _?b.document.getElementById(_):_},b.util.toArray=o,b.util.addClass=function(_,v){_&&-1===(" "+_.className+" ").indexOf(" "+v+" ")&&(_.className+=(_.className?" ":"")+v)},b.util.makeElement=d,b.util.wrapElement=function(_,v,w){return"string"==typeof v&&(v=d(v,w)),_.parentNode&&_.parentNode.replaceChild(v,_),v.appendChild(_),v},b.util.getScrollLeftTop=y,b.util.getElementOffset=function(_){var v,w,I=_&&_.ownerDocument,A={left:0,top:0},M={left:0,top:0},D={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!I)return M;for(var F in D)M[D[F]]+=parseInt(a(_,F),10)||0;return v=I.documentElement,void 0!==_.getBoundingClientRect&&(A=_.getBoundingClientRect()),w=y(_),{left:A.left+w.left-(v.clientLeft||0)+M.left,top:A.top+w.top-(v.clientTop||0)+M.top}},b.util.getNodeCanvas=function(_){var v=b.jsdomImplForWrapper(_);return v._canvas||v._image},b.util.cleanUpJsdomNode=function(_){if(b.isLikelyNode){var v=b.jsdomImplForWrapper(_);v&&(v._image=null,v._canvas=null,v._currentSrc=null,v._attributes=null,v._classList=null)}}}(),function(){function u(){}b.util.request=function(a,l){l||(l={});var y,_,m=l.method?l.method.toUpperCase():"GET",i=l.onComplete||function(){},o=new b.window.XMLHttpRequest,d=l.body||l.parameters;return o.onreadystatechange=function(){4===o.readyState&&(i(o),o.onreadystatechange=u)},"GET"===m&&(d=null,"string"==typeof l.parameters&&(_=l.parameters,a=(y=a)+(/\?/.test(y)?"&":"?")+_)),o.open(m,a,!0),"POST"!==m&&"PUT"!==m||o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send(d),o}}(),b.log=console.log,b.warn=console.warn,function(){var u=b.util.object.extend,a=b.util.object.clone,l=[];function m(){return!1}function i(_,v,w,I){return-w*Math.cos(_/I*(Math.PI/2))+w+v}b.util.object.extend(l,{cancelAll:function(){var _=this.splice(0);return _.forEach(function(v){v.cancel()}),_},cancelByCanvas:function(_){if(!_)return[];var v=this.filter(function(w){return"object"==typeof w.target&&w.target.canvas===_});return v.forEach(function(w){w.cancel()}),v},cancelByTarget:function(_){var v=this.findAnimationsByTarget(_);return v.forEach(function(w){w.cancel()}),v},findAnimationIndex:function(_){return this.indexOf(this.findAnimation(_))},findAnimation:function(_){return this.find(function(v){return v.cancel===_})},findAnimationsByTarget:function(_){return _?this.filter(function(v){return v.target===_}):[]}});var o=b.window.requestAnimationFrame||b.window.webkitRequestAnimationFrame||b.window.mozRequestAnimationFrame||b.window.oRequestAnimationFrame||b.window.msRequestAnimationFrame||function(_){return b.window.setTimeout(_,1e3/60)},d=b.window.cancelAnimationFrame||b.window.clearTimeout;function y(){return o.apply(b.window,arguments)}b.util.animate=function(_){_||(_={});var v,w=!1,I=function(){var A=b.runningAnimations.indexOf(v);return A>-1&&b.runningAnimations.splice(A,1)[0]};return v=u(a(_),{cancel:function(){return w=!0,I()},currentValue:"startValue"in _?_.startValue:0,completionRate:0,durationRate:0}),b.runningAnimations.push(v),y(function(A){var M,D=A||+new Date,F=_.duration||500,B=D+F,z=_.onChange||m,K=_.abort||m,oe=_.onComplete||m,ne=_.easing||i,ee="startValue"in _&&_.startValue.length>0,G="startValue"in _?_.startValue:0,j="endValue"in _?_.endValue:100,Q=_.byValue||(ee?G.map(function(se,ae){return j[ae]-G[ae]}):j-G);_.onStart&&_.onStart(),function se(ae){var Y=(M=ae||+new Date)>B?F:M-D,V=Y/F,$=ee?G.map(function(re,he){return ne(Y,G[he],Q[he],F)}):ne(Y,G,Q,F),le=Math.abs(ee?($[0]-G[0])/Q[0]:($-G)/Q);if(v.currentValue=ee?$.slice():$,v.completionRate=le,v.durationRate=V,!w){if(!K($,le,V))return M>B?(v.currentValue=ee?j.slice():j,v.completionRate=1,v.durationRate=1,z(ee?j.slice():j,1,1),oe(j,1,1),void I()):(z($,le,V),void y(se));I()}}(D)}),v.cancel},b.util.requestAnimFrame=y,b.util.cancelAnimFrame=function(){return d.apply(b.window,arguments)},b.runningAnimations=l}(),function(){function u(a,l,m){var i="rgba("+parseInt(a[0]+m*(l[0]-a[0]),10)+","+parseInt(a[1]+m*(l[1]-a[1]),10)+","+parseInt(a[2]+m*(l[2]-a[2]),10);return(i+=","+(a&&l?parseFloat(a[3]+m*(l[3]-a[3])):1))+")"}b.util.animateColor=function(a,l,m,i){var o=new b.Color(a).getSource(),d=new b.Color(l).getSource(),y=i.onComplete,_=i.onChange;return b.util.animate(b.util.object.extend(i=i||{},{duration:m||500,startValue:o,endValue:d,byValue:d,easing:function(v,w,I,A){return u(w,I,i.colorEasing?i.colorEasing(v,A):1-Math.cos(v/A*(Math.PI/2)))},onComplete:function(v,w,I){if(y)return y(u(d,d,0),w,I)},onChange:function(v,w,I){if(_){if(Array.isArray(v))return _(u(v,v,0),w,I);_(v,w,I)}}}))}}(),function(){function u(i,o,d,y){return i<Math.abs(o)?(i=o,y=d/4):y=0===o&&0===i?d/(2*Math.PI)*Math.asin(1):d/(2*Math.PI)*Math.asin(o/i),{a:i,c:o,p:d,s:y}}function a(i,o,d){return i.a*Math.pow(2,10*(o-=1))*Math.sin((o*d-i.s)*(2*Math.PI)/i.p)}function l(i,o,d,y){return d-m(y-i,0,d,y)+o}function m(i,o,d,y){return(i/=y)<1/2.75?d*(7.5625*i*i)+o:i<2/2.75?d*(7.5625*(i-=1.5/2.75)*i+.75)+o:i<2.5/2.75?d*(7.5625*(i-=2.25/2.75)*i+.9375)+o:d*(7.5625*(i-=2.625/2.75)*i+.984375)+o}b.util.ease={easeInQuad:function(i,o,d,y){return d*(i/=y)*i+o},easeOutQuad:function(i,o,d,y){return-d*(i/=y)*(i-2)+o},easeInOutQuad:function(i,o,d,y){return(i/=y/2)<1?d/2*i*i+o:-d/2*(--i*(i-2)-1)+o},easeInCubic:function(i,o,d,y){return d*(i/=y)*i*i+o},easeOutCubic:function(i,o,d,y){return d*((i=i/y-1)*i*i+1)+o},easeInOutCubic:function(i,o,d,y){return(i/=y/2)<1?d/2*i*i*i+o:d/2*((i-=2)*i*i+2)+o},easeInQuart:function(i,o,d,y){return d*(i/=y)*i*i*i+o},easeOutQuart:function(i,o,d,y){return-d*((i=i/y-1)*i*i*i-1)+o},easeInOutQuart:function(i,o,d,y){return(i/=y/2)<1?d/2*i*i*i*i+o:-d/2*((i-=2)*i*i*i-2)+o},easeInQuint:function(i,o,d,y){return d*(i/=y)*i*i*i*i+o},easeOutQuint:function(i,o,d,y){return d*((i=i/y-1)*i*i*i*i+1)+o},easeInOutQuint:function(i,o,d,y){return(i/=y/2)<1?d/2*i*i*i*i*i+o:d/2*((i-=2)*i*i*i*i+2)+o},easeInSine:function(i,o,d,y){return-d*Math.cos(i/y*(Math.PI/2))+d+o},easeOutSine:function(i,o,d,y){return d*Math.sin(i/y*(Math.PI/2))+o},easeInOutSine:function(i,o,d,y){return-d/2*(Math.cos(Math.PI*i/y)-1)+o},easeInExpo:function(i,o,d,y){return 0===i?o:d*Math.pow(2,10*(i/y-1))+o},easeOutExpo:function(i,o,d,y){return i===y?o+d:d*(1-Math.pow(2,-10*i/y))+o},easeInOutExpo:function(i,o,d,y){return 0===i?o:i===y?o+d:(i/=y/2)<1?d/2*Math.pow(2,10*(i-1))+o:d/2*(2-Math.pow(2,-10*--i))+o},easeInCirc:function(i,o,d,y){return-d*(Math.sqrt(1-(i/=y)*i)-1)+o},easeOutCirc:function(i,o,d,y){return d*Math.sqrt(1-(i=i/y-1)*i)+o},easeInOutCirc:function(i,o,d,y){return(i/=y/2)<1?-d/2*(Math.sqrt(1-i*i)-1)+o:d/2*(Math.sqrt(1-(i-=2)*i)+1)+o},easeInElastic:function(i,o,d,y){var _=0;return 0===i?o:1==(i/=y)?o+d:(_||(_=.3*y),-a(u(d,d,_,1.70158),i,y)+o)},easeOutElastic:function(i,o,d,y){var _=0;if(0===i)return o;if(1==(i/=y))return o+d;_||(_=.3*y);var v=u(d,d,_,1.70158);return v.a*Math.pow(2,-10*i)*Math.sin((i*y-v.s)*(2*Math.PI)/v.p)+v.c+o},easeInOutElastic:function(i,o,d,y){var _=0;if(0===i)return o;if(2==(i/=y/2))return o+d;_||(_=y*(.3*1.5));var v=u(d,d,_,1.70158);return i<1?-.5*a(v,i,y)+o:v.a*Math.pow(2,-10*(i-=1))*Math.sin((i*y-v.s)*(2*Math.PI)/v.p)*.5+v.c+o},easeInBack:function(i,o,d,y,_){return void 0===_&&(_=1.70158),d*(i/=y)*i*((_+1)*i-_)+o},easeOutBack:function(i,o,d,y,_){return void 0===_&&(_=1.70158),d*((i=i/y-1)*i*((_+1)*i+_)+1)+o},easeInOutBack:function(i,o,d,y,_){return void 0===_&&(_=1.70158),(i/=y/2)<1?d/2*(i*i*((1+(_*=1.525))*i-_))+o:d/2*((i-=2)*i*((1+(_*=1.525))*i+_)+2)+o},easeInBounce:l,easeOutBounce:m,easeInOutBounce:function(i,o,d,y){return i<y/2?.5*l(2*i,0,d,y)+o:.5*m(2*i-y,0,d,y)+.5*d+o}}}(),function(u){var a=u.fabric||(u.fabric={}),l=a.util.object.extend,m=a.util.object.clone,i=a.util.toFixed,o=a.util.parseUnit,d=a.util.multiplyTransformMatrices,y={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},_={stroke:"strokeOpacity",fill:"fillOpacity"},v="font-size",w="clip-path";function I(G){return G in y?y[G]:G}function A(G,j,Q,se){var ae,Y=Array.isArray(j);if("fill"!==G&&"stroke"!==G||"none"!==j){if("strokeUniform"===G)return"non-scaling-stroke"===j;if("strokeDashArray"===G)j="none"===j?null:j.replace(/,/g," ").split(/\s+/).map(parseFloat);else if("transformMatrix"===G)j=Q&&Q.transformMatrix?d(Q.transformMatrix,a.parseTransformAttribute(j)):a.parseTransformAttribute(j);else if("visible"===G)j="none"!==j&&"hidden"!==j,Q&&!1===Q.visible&&(j=!1);else if("opacity"===G)j=parseFloat(j),Q&&void 0!==Q.opacity&&(j*=Q.opacity);else if("textAnchor"===G)j="start"===j?"left":"end"===j?"right":"center";else if("charSpacing"===G)ae=o(j,se)/se*1e3;else if("paintFirst"===G){var V=j.indexOf("fill"),$=j.indexOf("stroke");j="fill",(V>-1&&$>-1&&$<V||-1===V&&$>-1)&&(j="stroke")}else{if("href"===G||"xlink:href"===G||"font"===G)return j;if("imageSmoothing"===G)return"optimizeQuality"===j;ae=Y?j.map(o):o(j,se)}}else j="";return!Y&&isNaN(ae)?j:ae}function M(G){return new RegExp("^("+G.join("|")+")\\b","i")}function D(G,j){var se,ae,Y,V=[];for(ae=0,Y=j.length;ae<Y;ae++)se=G.getElementsByTagName(j[ae]),V=V.concat(Array.prototype.slice.call(se));return V}function F(G,j){var Q,se=!0;return(Q=B(G,j.pop()))&&j.length&&(se=function(ae,Y){for(var V,$=!0;ae.parentNode&&1===ae.parentNode.nodeType&&Y.length;)$&&(V=Y.pop()),$=B(ae=ae.parentNode,V);return 0===Y.length}(G,j)),Q&&se&&0===j.length}function B(G,j){var Q,se,ae=G.nodeName,Y=G.getAttribute("class"),V=G.getAttribute("id");if(Q=new RegExp("^"+ae,"i"),j=j.replace(Q,""),V&&j.length&&(Q=new RegExp("#"+V+"(?![a-zA-Z\\-]+)","i"),j=j.replace(Q,"")),Y&&j.length)for(se=(Y=Y.split(" ")).length;se--;)Q=new RegExp("\\."+Y[se]+"(?![a-zA-Z\\-]+)","i"),j=j.replace(Q,"");return 0===j.length}function z(G,j){var Q;if(G.getElementById&&(Q=G.getElementById(j)),Q)return Q;var se,ae,Y,V=G.getElementsByTagName("*");for(ae=0,Y=V.length;ae<Y;ae++)if(j===(se=V[ae]).getAttribute("id"))return se}a.svgValidTagNamesRegEx=M(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),a.svgViewBoxElementsRegEx=M(["symbol","image","marker","pattern","view","svg"]),a.svgInvalidAncestorsRegEx=M(["pattern","defs","symbol","metadata","clipPath","mask","desc"]),a.svgValidParentsRegEx=M(["symbol","g","a","svg","clipPath","defs"]),a.cssRules={},a.gradientDefs={},a.clipPaths={},a.parseTransformAttribute=function(){function G($,le,re){$[re]=Math.tan(a.util.degreesToRadians(le[0]))}var j=a.iMatrix,Q=a.reNum,se=a.commaWsp,ae="(?:(?:(matrix)\\s*\\(\\s*("+Q+")"+se+"("+Q+")"+se+"("+Q+")"+se+"("+Q+")"+se+"("+Q+")"+se+"("+Q+")\\s*\\))|(?:(translate)\\s*\\(\\s*("+Q+")(?:"+se+"("+Q+"))?\\s*\\))|(?:(scale)\\s*\\(\\s*("+Q+")(?:"+se+"("+Q+"))?\\s*\\))|(?:(rotate)\\s*\\(\\s*("+Q+")(?:"+se+"("+Q+")"+se+"("+Q+"))?\\s*\\))|(?:(skewX)\\s*\\(\\s*("+Q+")\\s*\\))|(?:(skewY)\\s*\\(\\s*("+Q+")\\s*\\)))",Y=new RegExp("^\\s*(?:(?:"+ae+"(?:"+se+"*"+ae+")*)?)\\s*$"),V=new RegExp(ae,"g");return function($){var le=j.concat(),re=[];if(!$||$&&!Y.test($))return le;$.replace(V,function(ve){var ge,Ce,fe=new RegExp(ae).exec(ve).filter(function(ge){return!!ge}),ue=fe[1],pe=fe.slice(2).map(parseFloat);switch(ue){case"translate":(ge=le)[4]=(Ce=pe)[0],2===Ce.length&&(ge[5]=Ce[1]);break;case"rotate":pe[0]=a.util.degreesToRadians(pe[0]),function(ge,Ce){var Oe=a.util.cos(Ce[0]),we=a.util.sin(Ce[0]),Be=0,Ke=0;3===Ce.length&&(Be=Ce[1],Ke=Ce[2]),ge[0]=Oe,ge[1]=we,ge[2]=-we,ge[3]=Oe,ge[4]=Be-(Oe*Be-we*Ke),ge[5]=Ke-(we*Be+Oe*Ke)}(le,pe);break;case"scale":!function(ge,Ce){var we=2===Ce.length?Ce[1]:Ce[0];ge[0]=Ce[0],ge[3]=we}(le,pe);break;case"skewX":G(le,pe,2);break;case"skewY":G(le,pe,1);break;case"matrix":le=pe}re.push(le.concat()),le=j.concat()});for(var he=re[0];re.length>1;)re.shift(),he=a.util.multiplyTransformMatrices(he,re[0]);return he}}();var K=new RegExp("^\\s*("+a.reNum+"+)\\s*,?\\s*("+a.reNum+"+)\\s*,?\\s*("+a.reNum+"+)\\s*,?\\s*("+a.reNum+"+)\\s*$");function oe(G){if(!a.svgViewBoxElementsRegEx.test(G.nodeName))return{};var j,Q,se,ae,Y,V,$=G.getAttribute("viewBox"),le=1,re=1,he=G.getAttribute("width"),ve=G.getAttribute("height"),fe=G.getAttribute("x")||0,ue=G.getAttribute("y")||0,pe=G.getAttribute("preserveAspectRatio")||"",ge=!$||!($=$.match(K)),Ce=!he||!ve||"100%"===he||"100%"===ve,Oe=ge&&Ce,we={},Be="",Ke=0,Pt=0;if(we.width=0,we.height=0,we.toBeParsed=Oe,ge&&(fe||ue)&&G.parentNode&&"#document"!==G.parentNode.nodeName&&(Be=" translate("+o(fe)+" "+o(ue)+") ",Y=(G.getAttribute("transform")||"")+Be,G.setAttribute("transform",Y),G.removeAttribute("x"),G.removeAttribute("y")),Oe)return we;if(ge)return we.width=o(he),we.height=o(ve),we;if(j=-parseFloat($[1]),Q=-parseFloat($[2]),se=parseFloat($[3]),ae=parseFloat($[4]),we.minX=j,we.minY=Q,we.viewBoxWidth=se,we.viewBoxHeight=ae,Ce?(we.width=se,we.height=ae):(we.width=o(he),we.height=o(ve),le=we.width/se,re=we.height/ae),"none"!==(pe=a.util.parsePreserveAspectRatioAttribute(pe)).alignX&&("meet"===pe.meetOrSlice&&(re=le=le>re?re:le),"slice"===pe.meetOrSlice&&(re=le=le>re?le:re),Ke=we.width-se*le,Pt=we.height-ae*le,"Mid"===pe.alignX&&(Ke/=2),"Mid"===pe.alignY&&(Pt/=2),"Min"===pe.alignX&&(Ke=0),"Min"===pe.alignY&&(Pt=0)),1===le&&1===re&&0===j&&0===Q&&0===fe&&0===ue)return we;if((fe||ue)&&"#document"!==G.parentNode.nodeName&&(Be=" translate("+o(fe)+" "+o(ue)+") "),Y=Be+" matrix("+le+" 0 0 "+re+" "+(j*le+Ke)+" "+(Q*re+Pt)+") ","svg"===G.nodeName){for(V=G.ownerDocument.createElementNS(a.svgNS,"g");G.firstChild;)V.appendChild(G.firstChild);G.appendChild(V)}else(V=G).removeAttribute("x"),V.removeAttribute("y"),Y=V.getAttribute("transform")+Y;return V.setAttribute("transform",Y),we}function ne(G,j){var Q="xlink:href",se=z(G,j.getAttribute(Q).slice(1));if(se&&se.getAttribute(Q)&&ne(G,se),["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"].forEach(function(Y){se&&!j.hasAttribute(Y)&&se.hasAttribute(Y)&&j.setAttribute(Y,se.getAttribute(Y))}),!j.children.length)for(var ae=se.cloneNode(!0);ae.firstChild;)j.appendChild(ae.firstChild);j.removeAttribute(Q)}a.parseSVGDocument=function(G,j,Q,se){if(G){!function(fe){for(var ue=D(fe,["use","svg:use"]),pe=0;ue.length&&pe<ue.length;){var ge=ue[pe],Ce=ge.getAttribute("xlink:href")||ge.getAttribute("href");if(null===Ce)return;var Oe,we,Be,Ke,Pt=Ce.slice(1),ci=ge.getAttribute("x")||0,un=ge.getAttribute("y")||0,st=z(fe,Pt).cloneNode(!0),kt=(st.getAttribute("transform")||"")+" translate("+ci+", "+un+")",Xn=ue.length,dn=a.svgNS;if(oe(st),/^svg$/i.test(st.nodeName)){var ki=st.ownerDocument.createElementNS(dn,"g");for(we=0,Ke=(Be=st.attributes).length;we<Ke;we++)Oe=Be.item(we),ki.setAttributeNS(dn,Oe.nodeName,Oe.nodeValue);for(;st.firstChild;)ki.appendChild(st.firstChild);st=ki}for(we=0,Ke=(Be=ge.attributes).length;we<Ke;we++)"x"!==(Oe=Be.item(we)).nodeName&&"y"!==Oe.nodeName&&"xlink:href"!==Oe.nodeName&&"href"!==Oe.nodeName&&("transform"===Oe.nodeName?kt=Oe.nodeValue+" "+kt:st.setAttribute(Oe.nodeName,Oe.nodeValue));st.setAttribute("transform",kt),st.setAttribute("instantiated_by_use","1"),st.removeAttribute("id"),ge.parentNode.replaceChild(st,ge),ue.length===Xn&&pe++}}(G);var ae,Y,V=a.Object.__uid++,$=oe(G),le=a.util.toArray(G.getElementsByTagName("*"));if($.crossOrigin=se&&se.crossOrigin,$.svgUid=V,0===le.length&&a.isLikelyNode){var re=[];for(ae=0,Y=(le=G.selectNodes('//*[name(.)!="svg"]')).length;ae<Y;ae++)re[ae]=le[ae];le=re}var he=le.filter(function(fe){return oe(fe),a.svgValidTagNamesRegEx.test(fe.nodeName.replace("svg:",""))&&!function(ue,pe){for(;ue&&(ue=ue.parentNode);)if(ue.nodeName&&pe.test(ue.nodeName.replace("svg:",""))&&!ue.getAttribute("instantiated_by_use"))return!0;return!1}(fe,a.svgInvalidAncestorsRegEx)});if(!he||he&&!he.length)j&&j([],{});else{var ve={};le.filter(function(fe){return"clipPath"===fe.nodeName.replace("svg:","")}).forEach(function(fe){var ue=fe.getAttribute("id");ve[ue]=a.util.toArray(fe.getElementsByTagName("*")).filter(function(pe){return a.svgValidTagNamesRegEx.test(pe.nodeName.replace("svg:",""))})}),a.gradientDefs[V]=a.getGradientDefs(G),a.cssRules[V]=a.getCSSRules(G),a.clipPaths[V]=ve,a.parseElements(he,function(fe,ue){j&&(j(fe,$,ue,le),delete a.gradientDefs[V],delete a.cssRules[V],delete a.clipPaths[V])},m($),Q,se)}}};var ee=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+a.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+a.reNum+"))?\\s+(.*)");l(a,{parseFontDeclaration:function(G,j){var Q=G.match(ee);if(Q){var se=Q[1],ae=Q[3],Y=Q[4],V=Q[5],$=Q[6];se&&(j.fontStyle=se),ae&&(j.fontWeight=isNaN(parseFloat(ae))?ae:parseFloat(ae)),Y&&(j.fontSize=o(Y)),$&&(j.fontFamily=$),V&&(j.lineHeight="normal"===V?1:V)}},getGradientDefs:function(G){var j,Q=D(G,["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"]),se=0,ae={};for(se=Q.length;se--;)(j=Q[se]).getAttribute("xlink:href")&&ne(G,j),ae[j.getAttribute("id")]=j;return ae},parseAttributes:function(G,j,Q){if(G){var se,ae,Y,V={};void 0===Q&&(Q=G.getAttribute("svgUid")),G.parentNode&&a.svgValidParentsRegEx.test(G.parentNode.nodeName)&&(V=a.parseAttributes(G.parentNode,j,Q));var $=j.reduce(function(pe,ge){return(se=G.getAttribute(ge))&&(pe[ge]=se),pe},{}),le=l(function(pe,ge){var Ce={};for(var Oe in a.cssRules[ge])if(F(pe,Oe.split(" ")))for(var we in a.cssRules[ge][Oe])Ce[we]=a.cssRules[ge][Oe][we];return Ce}(G,Q),a.parseStyleAttribute(G));$=l($,le),le[w]&&G.setAttribute(w,le[w]),ae=Y=V.fontSize||a.Text.DEFAULT_SVG_FONT_SIZE,$[v]&&($[v]=ae=o($[v],Y));var re,he,ve={};for(var fe in $)he=A(re=I(fe),$[fe],V,ae),ve[re]=he;ve&&ve.font&&a.parseFontDeclaration(ve.font,ve);var ue=l(V,ve);return a.svgValidParentsRegEx.test(G.nodeName)?ue:function(pe){for(var ge in _)if(void 0!==pe[_[ge]]&&""!==pe[ge]){if(void 0===pe[ge]){if(!a.Object.prototype[ge])continue;pe[ge]=a.Object.prototype[ge]}if(0!==pe[ge].indexOf("url(")){var Ce=new a.Color(pe[ge]);pe[ge]=Ce.setAlpha(i(Ce.getAlpha()*pe[_[ge]],2)).toRgba()}}return pe}(ue)}},parseElements:function(G,j,Q,se,ae){new a.ElementsParser(G,j,Q,se,ae).parse()},parseStyleAttribute:function(G){var ae,Y,V,j={},Q=G.getAttribute("style");return Q&&("string"==typeof Q?(ae=j,Q.replace(/;\s*$/,"").split(";").forEach(function($){var le=$.split(":");Y=le[0].trim().toLowerCase(),V=le[1].trim(),ae[Y]=V})):function(se,ae){for(var $ in se)void 0!==se[$]&&(ae[$.toLowerCase()]=se[$])}(Q,j)),j},parsePointsAttribute:function(G){if(!G)return null;var j,Q,se=[];for(j=0,Q=(G=(G=G.replace(/,/g," ").trim()).split(/\s+/)).length;j<Q;j+=2)se.push({x:parseFloat(G[j]),y:parseFloat(G[j+1])});return se},getCSSRules:function(G){var j,Q,se=G.getElementsByTagName("style"),ae={};for(j=0,Q=se.length;j<Q;j++){var Y=se[j].textContent;""!==(Y=Y.replace(/\/\*[\s\S]*?\*\//g,"")).trim()&&Y.split("}").filter(function(V){return V.trim()}).forEach(function(V){var $=V.split("{"),le={},re=$[1].trim().split(";").filter(function(ue){return ue.trim()});for(j=0,Q=re.length;j<Q;j++){var he=re[j].split(":"),ve=he[0].trim(),fe=he[1].trim();le[ve]=fe}(V=$[0].trim()).split(",").forEach(function(ue){""!==(ue=ue.replace(/^svg/i,"").trim())&&(ae[ue]?a.util.object.extend(ae[ue],le):ae[ue]=a.util.object.clone(le))})})}return ae},loadSVGFromURL:function(G,j,Q,se){G=G.replace(/^\n\s*/,"").trim(),new a.util.request(G,{method:"get",onComplete:function(ae){var Y=ae.responseXML;if(!Y||!Y.documentElement)return j&&j(null),!1;a.parseSVGDocument(Y.documentElement,function(V,$,le,re){j&&j(V,$,le,re)},Q,se)}})},loadSVGFromString:function(G,j,Q,se){var ae=(new a.window.DOMParser).parseFromString(G.trim(),"text/xml");a.parseSVGDocument(ae.documentElement,function(Y,V,$,le){j(Y,V,$,le)},Q,se)}})}(t),b.ElementsParser=function(u,a,l,m,i,o){this.elements=u,this.callback=a,this.options=l,this.reviver=m,this.svgUid=l&&l.svgUid||0,this.parsingOptions=i,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=o},(X=b.ElementsParser.prototype).parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},X.createObjects=function(){var u=this;this.elements.forEach(function(a,l){a.setAttribute("svgUid",u.svgUid),u.createObject(a,l)})},X.findTag=function(u){return b[b.util.string.capitalize(u.tagName.replace("svg:",""))]},X.createObject=function(u,a){var l=this.findTag(u);if(l&&l.fromElement)try{l.fromElement(u,this.createCallback(a,u),this.options)}catch(m){b.log(m)}else this.checkIfDone()},X.createCallback=function(u,a){var l=this;return function(m){var i;l.resolveGradient(m,a,"fill"),l.resolveGradient(m,a,"stroke"),m instanceof b.Image&&m._originalElement&&(i=m.parsePreserveAspectRatioAttribute(a)),m._removeTransformMatrix(i),l.resolveClipPath(m,a),l.reviver&&l.reviver(a,m),l.instances[u]=m,l.checkIfDone()}},X.extractPropertyDefinition=function(u,a,l){var m=u[a],i=this.regexUrl;if(i.test(m)){i.lastIndex=0;var o=i.exec(m)[1];return i.lastIndex=0,b[l][this.svgUid][o]}},X.resolveGradient=function(u,a,l){var m=this.extractPropertyDefinition(u,l,"gradientDefs");if(m){var i=a.getAttribute(l+"-opacity"),o=b.Gradient.fromElement(m,u,i,this.options);u.set(l,o)}},X.createClipPathCallback=function(u,a){return function(l){l._removeTransformMatrix(),l.fillRule=l.clipRule,a.push(l)}},X.resolveClipPath=function(u,a){var l,m,i,o,d=this.extractPropertyDefinition(u,"clipPath","clipPaths");if(d){i=[],m=b.util.invertTransform(u.calcTransformMatrix());for(var y=d[0].parentNode,_=a;_.parentNode&&_.getAttribute("clip-path")!==u.clipPath;)_=_.parentNode;_.parentNode.appendChild(y);for(var v=0;v<d.length;v++)this.findTag(l=d[v]).fromElement(l,this.createClipPathCallback(u,i),this.options);d=1===i.length?i[0]:new b.Group(i),o=b.util.multiplyTransformMatrices(m,d.calcTransformMatrix()),d.clipPath&&this.resolveClipPath(d,_);var w=b.util.qrDecompose(o);d.flipX=!1,d.flipY=!1,d.set("scaleX",w.scaleX),d.set("scaleY",w.scaleY),d.angle=w.angle,d.skewX=w.skewX,d.skewY=0,d.setPositionByOrigin({x:w.translateX,y:w.translateY},"center","center"),u.clipPath=d}else delete u.clipPath},X.checkIfDone=function(){0==--this.numElements&&(this.instances=this.instances.filter(function(u){return null!=u}),this.callback(this.instances,this.elements))},function(u){var a=u.fabric||(u.fabric={});function l(m,i){this.x=m,this.y=i}a.Point?a.warn("fabric.Point is already defined"):(a.Point=l,l.prototype={type:"point",constructor:l,add:function(m){return new l(this.x+m.x,this.y+m.y)},addEquals:function(m){return this.x+=m.x,this.y+=m.y,this},scalarAdd:function(m){return new l(this.x+m,this.y+m)},scalarAddEquals:function(m){return this.x+=m,this.y+=m,this},subtract:function(m){return new l(this.x-m.x,this.y-m.y)},subtractEquals:function(m){return this.x-=m.x,this.y-=m.y,this},scalarSubtract:function(m){return new l(this.x-m,this.y-m)},scalarSubtractEquals:function(m){return this.x-=m,this.y-=m,this},multiply:function(m){return new l(this.x*m,this.y*m)},multiplyEquals:function(m){return this.x*=m,this.y*=m,this},divide:function(m){return new l(this.x/m,this.y/m)},divideEquals:function(m){return this.x/=m,this.y/=m,this},eq:function(m){return this.x===m.x&&this.y===m.y},lt:function(m){return this.x<m.x&&this.y<m.y},lte:function(m){return this.x<=m.x&&this.y<=m.y},gt:function(m){return this.x>m.x&&this.y>m.y},gte:function(m){return this.x>=m.x&&this.y>=m.y},lerp:function(m,i){return void 0===i&&(i=.5),i=Math.max(Math.min(1,i),0),new l(this.x+(m.x-this.x)*i,this.y+(m.y-this.y)*i)},distanceFrom:function(m){var i=this.x-m.x,o=this.y-m.y;return Math.sqrt(i*i+o*o)},midPointFrom:function(m){return this.lerp(m)},min:function(m){return new l(Math.min(this.x,m.x),Math.min(this.y,m.y))},max:function(m){return new l(Math.max(this.x,m.x),Math.max(this.y,m.y))},toString:function(){return this.x+","+this.y},setXY:function(m,i){return this.x=m,this.y=i,this},setX:function(m){return this.x=m,this},setY:function(m){return this.y=m,this},setFromPoint:function(m){return this.x=m.x,this.y=m.y,this},swap:function(m){var i=this.x,o=this.y;this.x=m.x,this.y=m.y,m.x=i,m.y=o},clone:function(){return new l(this.x,this.y)}})}(t),function(u){var a=u.fabric||(u.fabric={});function l(m){this.status=m,this.points=[]}a.Intersection?a.warn("fabric.Intersection is already defined"):(a.Intersection=l,a.Intersection.prototype={constructor:l,appendPoint:function(m){return this.points.push(m),this},appendPoints:function(m){return this.points=this.points.concat(m),this}},a.Intersection.intersectLineLine=function(m,i,o,d){var y,_=(d.x-o.x)*(m.y-o.y)-(d.y-o.y)*(m.x-o.x),v=(i.x-m.x)*(m.y-o.y)-(i.y-m.y)*(m.x-o.x),w=(d.y-o.y)*(i.x-m.x)-(d.x-o.x)*(i.y-m.y);if(0!==w){var I=_/w,A=v/w;0<=I&&I<=1&&0<=A&&A<=1?(y=new l("Intersection")).appendPoint(new a.Point(m.x+I*(i.x-m.x),m.y+I*(i.y-m.y))):y=new l}else y=new l(0===_||0===v?"Coincident":"Parallel");return y},a.Intersection.intersectLinePolygon=function(m,i,o){var _,v,w=new l,I=o.length;for(v=0;v<I;v++)_=l.intersectLineLine(m,i,o[v],o[(v+1)%I]),w.appendPoints(_.points);return w.points.length>0&&(w.status="Intersection"),w},a.Intersection.intersectPolygonPolygon=function(m,i){var o,d=new l,y=m.length;for(o=0;o<y;o++){var w=l.intersectLinePolygon(m[o],m[(o+1)%y],i);d.appendPoints(w.points)}return d.points.length>0&&(d.status="Intersection"),d},a.Intersection.intersectPolygonRectangle=function(m,i,o){var d=i.min(o),y=i.max(o),_=new a.Point(y.x,d.y),v=new a.Point(d.x,y.y),w=l.intersectLinePolygon(d,_,m),I=l.intersectLinePolygon(_,y,m),A=l.intersectLinePolygon(y,v,m),M=l.intersectLinePolygon(v,d,m),D=new l;return D.appendPoints(w.points),D.appendPoints(I.points),D.appendPoints(A.points),D.appendPoints(M.points),D.points.length>0&&(D.status="Intersection"),D})}(t),function(u){var a=u.fabric||(u.fabric={});function l(i){i?this._tryParsingColor(i):this.setSource([0,0,0,1])}function m(i,o,d){return d<0&&(d+=1),d>1&&(d-=1),d<1/6?i+6*(o-i)*d:d<.5?o:d<2/3?i+(o-i)*(2/3-d)*6:i}a.Color?a.warn("fabric.Color is already defined."):(a.Color=l,a.Color.prototype={_tryParsingColor:function(i){var o;i in l.colorNameMap&&(i=l.colorNameMap[i]),"transparent"===i&&(o=[255,255,255,0]),o||(o=l.sourceFromHex(i)),o||(o=l.sourceFromRgb(i)),o||(o=l.sourceFromHsl(i)),o||(o=[0,0,0,1]),o&&this.setSource(o)},_rgbToHsl:function(i,o,d){var y,_,v,w=a.util.array.max([i/=255,o/=255,d/=255]),I=a.util.array.min([i,o,d]);if(v=(w+I)/2,w===I)y=_=0;else{var A=w-I;switch(_=v>.5?A/(2-w-I):A/(w+I),w){case i:y=(o-d)/A+(o<d?6:0);break;case o:y=(d-i)/A+2;break;case d:y=(i-o)/A+4}y/=6}return[Math.round(360*y),Math.round(100*_),Math.round(100*v)]},getSource:function(){return this._source},setSource:function(i){this._source=i},toRgb:function(){var i=this.getSource();return"rgb("+i[0]+","+i[1]+","+i[2]+")"},toRgba:function(){var i=this.getSource();return"rgba("+i[0]+","+i[1]+","+i[2]+","+i[3]+")"},toHsl:function(){var i=this.getSource(),o=this._rgbToHsl(i[0],i[1],i[2]);return"hsl("+o[0]+","+o[1]+"%,"+o[2]+"%)"},toHsla:function(){var i=this.getSource(),o=this._rgbToHsl(i[0],i[1],i[2]);return"hsla("+o[0]+","+o[1]+"%,"+o[2]+"%,"+i[3]+")"},toHex:function(){var i,o,d,y=this.getSource();return i=1===(i=y[0].toString(16)).length?"0"+i:i,o=1===(o=y[1].toString(16)).length?"0"+o:o,d=1===(d=y[2].toString(16)).length?"0"+d:d,i.toUpperCase()+o.toUpperCase()+d.toUpperCase()},toHexa:function(){var i,o=this.getSource();return i=1===(i=(i=Math.round(255*o[3])).toString(16)).length?"0"+i:i,this.toHex()+i.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(i){var o=this.getSource();return o[3]=i,this.setSource(o),this},toGrayscale:function(){var i=this.getSource(),o=parseInt((.3*i[0]+.59*i[1]+.11*i[2]).toFixed(0),10);return this.setSource([o,o,o,i[3]]),this},toBlackWhite:function(i){var o=this.getSource(),d=(.3*o[0]+.59*o[1]+.11*o[2]).toFixed(0),y=o[3];return i=i||127,d=Number(d)<Number(i)?0:255,this.setSource([d,d,d,y]),this},overlayWith:function(i){i instanceof l||(i=new l(i));var o,d=[],y=this.getAlpha(),_=this.getSource(),v=i.getSource();for(o=0;o<3;o++)d.push(Math.round(.5*_[o]+.5*v[o]));return d[3]=y,this.setSource(d),this}},a.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,a.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,a.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,a.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},a.Color.fromRgb=function(i){return l.fromSource(l.sourceFromRgb(i))},a.Color.sourceFromRgb=function(i){var o=i.match(l.reRGBa);if(o){var d=parseInt(o[1],10)/(/%$/.test(o[1])?100:1)*(/%$/.test(o[1])?255:1),y=parseInt(o[2],10)/(/%$/.test(o[2])?100:1)*(/%$/.test(o[2])?255:1),_=parseInt(o[3],10)/(/%$/.test(o[3])?100:1)*(/%$/.test(o[3])?255:1);return[parseInt(d,10),parseInt(y,10),parseInt(_,10),o[4]?parseFloat(o[4]):1]}},a.Color.fromRgba=l.fromRgb,a.Color.fromHsl=function(i){return l.fromSource(l.sourceFromHsl(i))},a.Color.sourceFromHsl=function(i){var o=i.match(l.reHSLa);if(o){var d,y,_,v=(parseFloat(o[1])%360+360)%360/360,w=parseFloat(o[2])/(/%$/.test(o[2])?100:1),I=parseFloat(o[3])/(/%$/.test(o[3])?100:1);if(0===w)d=y=_=I;else{var A=I<=.5?I*(w+1):I+w-I*w,M=2*I-A;d=m(M,A,v+1/3),y=m(M,A,v),_=m(M,A,v-1/3)}return[Math.round(255*d),Math.round(255*y),Math.round(255*_),o[4]?parseFloat(o[4]):1]}},a.Color.fromHsla=l.fromHsl,a.Color.fromHex=function(i){return l.fromSource(l.sourceFromHex(i))},a.Color.sourceFromHex=function(i){if(i.match(l.reHex)){var o=i.slice(i.indexOf("#")+1),d=3===o.length||4===o.length,y=8===o.length||4===o.length,_=d?o.charAt(0)+o.charAt(0):o.substring(0,2),v=d?o.charAt(1)+o.charAt(1):o.substring(2,4),w=d?o.charAt(2)+o.charAt(2):o.substring(4,6),I=y?d?o.charAt(3)+o.charAt(3):o.substring(6,8):"FF";return[parseInt(_,16),parseInt(v,16),parseInt(w,16),parseFloat((parseInt(I,16)/255).toFixed(2))]}},a.Color.fromSource=function(i){var o=new l;return o.setSource(i),o})}(t),function(u){var a=u.fabric||(u.fabric={}),l=["e","se","s","sw","w","nw","n","ne","e"],m=["ns","nesw","ew","nwse"],i={},o="left",d="top",y="right",_="bottom",v="center",w={top:_,bottom:d,left:y,right:o,center:v},I=a.util.radiansToDegrees,A=Math.sign||function(Y){return(Y>0)-(Y<0)||+Y};function M(Y,V){var $=Y.angle+I(Math.atan2(V.y,V.x))+360;return Math.round($%360/45)}function D(Y,V){var $=V.transform.target,le=$.canvas,re=a.util.object.clone(V);re.target=$,le&&le.fire("object:"+Y,re),$.fire(Y,V)}function F(Y,V){var $=V.canvas,le=Y[$.uniScaleKey];return $.uniformScaling&&!le||!$.uniformScaling&&le}function B(Y){return Y.originX===v&&Y.originY===v}function z(Y,V,$){var le=Y.lockScalingX,re=Y.lockScalingY;return!((!le||!re)&&(V||!le&&!re||!$)&&(!le||"x"!==V)&&(!re||"y"!==V))}function K(Y,V,$,le){return{e:Y,transform:V,pointer:{x:$,y:le}}}function oe(Y){return function(V,$,le,re){var he=$.target,ve=he.getCenterPoint(),fe=he.translateToOriginPoint(ve,$.originX,$.originY),ue=Y(V,$,le,re);return he.setPositionByOrigin(fe,$.originX,$.originY),ue}}function ne(Y,V){return function($,le,re,he){var ve=V($,le,re,he);return ve&&D(Y,K($,le,re,he)),ve}}function ee(Y,V,$,le,re){var he=Y.target,ve=he.controls[Y.corner],fe=he.canvas.getZoom(),ue=he.padding/fe,pe=he.toLocalPoint(new a.Point(le,re),V,$);return pe.x>=ue&&(pe.x-=ue),pe.x<=-ue&&(pe.x+=ue),pe.y>=ue&&(pe.y-=ue),pe.y<=ue&&(pe.y+=ue),pe.x-=ve.offsetX,pe.y-=ve.offsetY,pe}function G(Y){return Y.flipX!==Y.flipY}function j(Y,V,$,le,re){if(0!==Y[V]){var he=re/Y._getTransformedDimensions()[le]*Y[$];Y.set($,he)}}function Q(Y,V,$,le){var re,he=V.target,ve=he._getTransformedDimensions(0,he.skewY),fe=ee(V,V.originX,V.originY,$,le),ue=Math.abs(2*fe.x)-ve.x,pe=he.skewX;ue<2?re=0:(re=I(Math.atan2(ue/he.scaleX,ve.y/he.scaleY)),V.originX===o&&V.originY===_&&(re=-re),V.originX===y&&V.originY===d&&(re=-re),G(he)&&(re=-re));var ge=pe!==re;if(ge){var Ce=he._getTransformedDimensions().y;he.set("skewX",re),j(he,"skewY","scaleY","y",Ce)}return ge}function se(Y,V,$,le){var re,he=V.target,ve=he._getTransformedDimensions(he.skewX,0),fe=ee(V,V.originX,V.originY,$,le),ue=Math.abs(2*fe.y)-ve.y,pe=he.skewY;ue<2?re=0:(re=I(Math.atan2(ue/he.scaleY,ve.x/he.scaleX)),V.originX===o&&V.originY===_&&(re=-re),V.originX===y&&V.originY===d&&(re=-re),G(he)&&(re=-re));var ge=pe!==re;if(ge){var Ce=he._getTransformedDimensions().x;he.set("skewY",re),j(he,"skewX","scaleX","x",Ce)}return ge}function ae(Y,V,$,le,re){var he,ve,fe,ue,pe,ge,Ce=V.target,Oe=Ce.lockScalingX,we=Ce.lockScalingY,Be=(re=re||{}).by,Ke=F(Y,Ce),Pt=z(Ce,Be,Ke),ci=V.gestureScale;if(Pt)return!1;if(ci)ve=V.scaleX*ci,fe=V.scaleY*ci;else{if(he=ee(V,V.originX,V.originY,$,le),pe="y"!==Be?A(he.x):1,ge="x"!==Be?A(he.y):1,V.signX||(V.signX=pe),V.signY||(V.signY=ge),Ce.lockScalingFlip&&(V.signX!==pe||V.signY!==ge))return!1;if(ue=Ce._getTransformedDimensions(),Ke&&!Be){var un=Math.abs(he.x)+Math.abs(he.y),st=V.original,kt=un/(Math.abs(ue.x*st.scaleX/Ce.scaleX)+Math.abs(ue.y*st.scaleY/Ce.scaleY));ve=st.scaleX*kt,fe=st.scaleY*kt}else ve=Math.abs(he.x*Ce.scaleX/ue.x),fe=Math.abs(he.y*Ce.scaleY/ue.y);B(V)&&(ve*=2,fe*=2),V.signX!==pe&&"y"!==Be&&(V.originX=w[V.originX],ve*=-1,V.signX=pe),V.signY!==ge&&"x"!==Be&&(V.originY=w[V.originY],fe*=-1,V.signY=ge)}var Xn=Ce.scaleX,dn=Ce.scaleY;return Be?("x"===Be&&Ce.set("scaleX",ve),"y"===Be&&Ce.set("scaleY",fe)):(!Oe&&Ce.set("scaleX",ve),!we&&Ce.set("scaleY",fe)),Xn!==Ce.scaleX||dn!==Ce.scaleY}i.scaleCursorStyleHandler=function(Y,V,$){var le=F(Y,$),re="";if(0!==V.x&&0===V.y?re="x":0===V.x&&0!==V.y&&(re="y"),z($,re,le))return"not-allowed";var he=M($,V);return l[he]+"-resize"},i.skewCursorStyleHandler=function(Y,V,$){if(0!==V.x&&$.lockSkewingY||0!==V.y&&$.lockSkewingX)return"not-allowed";var re=M($,V)%4;return m[re]+"-resize"},i.scaleSkewCursorStyleHandler=function(Y,V,$){return Y[$.canvas.altActionKey]?i.skewCursorStyleHandler(Y,V,$):i.scaleCursorStyleHandler(Y,V,$)},i.rotationWithSnapping=ne("rotating",oe(function(Y,V,$,le){var re=V,he=re.target,ve=he.translateToOriginPoint(he.getCenterPoint(),re.originX,re.originY);if(he.lockRotation)return!1;var fe,ue=Math.atan2(re.ey-ve.y,re.ex-ve.x),pe=Math.atan2(le-ve.y,$-ve.x),ge=I(pe-ue+re.theta);if(he.snapAngle>0){var Ce=he.snapAngle,Oe=he.snapThreshold||Ce,we=Math.ceil(ge/Ce)*Ce,Be=Math.floor(ge/Ce)*Ce;Math.abs(ge-Be)<Oe?ge=Be:Math.abs(ge-we)<Oe&&(ge=we)}return ge<0&&(ge=360+ge),fe=he.angle!==(ge%=360),he.angle=ge,fe})),i.scalingEqually=ne("scaling",oe(function(Y,V,$,le){return ae(Y,V,$,le)})),i.scalingX=ne("scaling",oe(function(Y,V,$,le){return ae(Y,V,$,le,{by:"x"})})),i.scalingY=ne("scaling",oe(function(Y,V,$,le){return ae(Y,V,$,le,{by:"y"})})),i.scalingYOrSkewingX=function(Y,V,$,le){return Y[V.target.canvas.altActionKey]?i.skewHandlerX(Y,V,$,le):i.scalingY(Y,V,$,le)},i.scalingXOrSkewingY=function(Y,V,$,le){return Y[V.target.canvas.altActionKey]?i.skewHandlerY(Y,V,$,le):i.scalingX(Y,V,$,le)},i.changeWidth=ne("resizing",oe(function(Y,V,$,le){var re=V.target,he=ee(V,V.originX,V.originY,$,le),ve=re.strokeWidth/(re.strokeUniform?re.scaleX:1),fe=B(V)?2:1,ue=re.width,pe=Math.abs(he.x*fe/re.scaleX)-ve;return re.set("width",Math.max(pe,0)),ue!==pe})),i.skewHandlerX=function(Y,V,$,le){var re,he=V.target,ve=he.skewX,fe=V.originY;return!he.lockSkewingX&&(0===ve?re=ee(V,v,v,$,le).x>0?o:y:(ve>0&&(re=fe===d?o:y),ve<0&&(re=fe===d?y:o),G(he)&&(re=re===o?y:o)),V.originX=re,ne("skewing",oe(Q))(Y,V,$,le))},i.skewHandlerY=function(Y,V,$,le){var re,he=V.target,ve=he.skewY,fe=V.originX;return!he.lockSkewingY&&(0===ve?re=ee(V,v,v,$,le).y>0?d:_:(ve>0&&(re=fe===o?d:_),ve<0&&(re=fe===o?_:d),G(he)&&(re=re===d?_:d)),V.originY=re,ne("skewing",oe(se))(Y,V,$,le))},i.dragHandler=function(Y,V,$,le){var re=V.target,he=$-V.offsetX,ve=le-V.offsetY,fe=!re.get("lockMovementX")&&re.left!==he,ue=!re.get("lockMovementY")&&re.top!==ve;return fe&&re.set("left",he),ue&&re.set("top",ve),(fe||ue)&&D("moving",K(Y,V,$,le)),fe||ue},i.scaleOrSkewActionName=function(Y,V,$){var le=Y[$.canvas.altActionKey];return 0===V.x?le?"skewX":"scaleY":0===V.y?le?"skewY":"scaleX":void 0},i.rotationStyleHandler=function(Y,V,$){return $.lockRotation?"not-allowed":V.cursorStyle},i.fireEvent=D,i.wrapWithFixedAnchor=oe,i.wrapWithFireEvent=ne,i.getLocalPoint=ee,a.controlsUtils=i}(t),a=(u=t).fabric||(u.fabric={}),l=a.util.degreesToRadians,(m=a.controlsUtils).renderCircleControl=function(i,o,d,y,_){y=y||{};var v,w=this.sizeX||y.cornerSize||_.cornerSize,I=this.sizeY||y.cornerSize||_.cornerSize,A=void 0!==y.transparentCorners?y.transparentCorners:_.transparentCorners,M=A?"stroke":"fill",D=!A&&(y.cornerStrokeColor||_.cornerStrokeColor),F=o,B=d;i.save(),i.fillStyle=y.cornerColor||_.cornerColor,i.strokeStyle=y.cornerStrokeColor||_.cornerStrokeColor,w>I?(v=w,i.scale(1,I/w),B=d*w/I):I>w?(v=I,i.scale(w/I,1),F=o*I/w):v=w,i.lineWidth=1,i.beginPath(),i.arc(F,B,v/2,0,2*Math.PI,!1),i[M](),D&&i.stroke(),i.restore()},m.renderSquareControl=function(i,o,d,y,_){y=y||{};var v=this.sizeX||y.cornerSize||_.cornerSize,w=this.sizeY||y.cornerSize||_.cornerSize,I=void 0!==y.transparentCorners?y.transparentCorners:_.transparentCorners,A=I?"stroke":"fill",M=!I&&(y.cornerStrokeColor||_.cornerStrokeColor),D=v/2,F=w/2;i.save(),i.fillStyle=y.cornerColor||_.cornerColor,i.strokeStyle=y.cornerStrokeColor||_.cornerStrokeColor,i.lineWidth=1,i.translate(o,d),i.rotate(l(_.angle)),i[A+"Rect"](-D,-F,v,w),M&&i.strokeRect(-D,-F,v,w),i.restore()},function(u){var a=u.fabric||(u.fabric={});a.Control=function(l){for(var m in l)this[m]=l[m]},a.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(l,m){return m.cursorStyle},getActionName:function(l,m){return m.actionName},getVisibility:function(l,m){var i=l._controlsVisibility;return i&&void 0!==i[m]?i[m]:this.visible},setVisibility:function(l){this.visible=l},positionHandler:function(l,m){return a.util.transformPoint({x:this.x*l.x+this.offsetX,y:this.y*l.y+this.offsetY},m)},calcCornerCoords:function(l,m,i,o,d){var y,_,v,w,I=d?this.touchSizeX:this.sizeX,A=d?this.touchSizeY:this.sizeY;if(I&&A&&I!==A){var M=Math.atan2(A,I),D=Math.sqrt(I*I+A*A)/2,F=M-a.util.degreesToRadians(l),B=Math.PI/2-M-a.util.degreesToRadians(l);y=D*a.util.cos(F),_=D*a.util.sin(F),v=D*a.util.cos(B),w=D*a.util.sin(B)}else D=.7071067812*(I&&A?I:m),F=a.util.degreesToRadians(45-l),y=v=D*a.util.cos(F),_=w=D*a.util.sin(F);return{tl:{x:i-w,y:o-v},tr:{x:i+y,y:o-_},bl:{x:i-y,y:o+_},br:{x:i+w,y:o+v}}},render:function(l,m,i,o,d){"circle"===((o=o||{}).cornerStyle||d.cornerStyle)?a.controlsUtils.renderCircleControl.call(this,l,m,i,o,d):a.controlsUtils.renderSquareControl.call(this,l,m,i,o,d)}}}(t),function(){function u(l,m){var i,o,d,y,_=l.getAttribute("style"),v=l.getAttribute("offset")||0;if(v=(v=parseFloat(v)/(/%$/.test(v)?100:1))<0?0:v>1?1:v,_){var w=_.split(/\s*;\s*/);for(""===w[w.length-1]&&w.pop(),y=w.length;y--;){var I=w[y].split(/\s*:\s*/),A=I[0].trim(),M=I[1].trim();"stop-color"===A?i=M:"stop-opacity"===A&&(d=M)}}return i||(i=l.getAttribute("stop-color")||"rgb(0,0,0)"),d||(d=l.getAttribute("stop-opacity")),o=(i=new b.Color(i)).getAlpha(),d=isNaN(parseFloat(d))?1:parseFloat(d),d*=o*m,{offset:v,color:i.toRgb(),opacity:d}}var a=b.util.object.clone;b.Gradient=b.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(l){l||(l={}),l.coords||(l.coords={});var m,i=this;Object.keys(l).forEach(function(o){i[o]=l[o]}),this.id?this.id+="_"+b.Object.__uid++:this.id=b.Object.__uid++,m={x1:l.coords.x1||0,y1:l.coords.y1||0,x2:l.coords.x2||0,y2:l.coords.y2||0},"radial"===this.type&&(m.r1=l.coords.r1||0,m.r2=l.coords.r2||0),this.coords=m,this.colorStops=l.colorStops.slice()},addColorStop:function(l){for(var m in l){var i=new b.Color(l[m]);this.colorStops.push({offset:parseFloat(m),color:i.toRgb(),opacity:i.getAlpha()})}return this},toObject:function(l){var m={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return b.util.populateWithProperties(this,m,l),m},toSVG:function(l,m){var i,o,d,y,_=a(this.coords,!0),v=(m=m||{},a(this.colorStops,!0)),w=_.r1>_.r2,I=this.gradientTransform?this.gradientTransform.concat():b.iMatrix.concat(),A=-this.offsetX,M=-this.offsetY,D=!!m.additionalTransform,F="pixels"===this.gradientUnits?"userSpaceOnUse":"objectBoundingBox";if(v.sort(function(oe,ne){return oe.offset-ne.offset}),"objectBoundingBox"===F?(A/=l.width,M/=l.height):(A+=l.width/2,M+=l.height/2),"path"===l.type&&"percentage"!==this.gradientUnits&&(A-=l.pathOffset.x,M-=l.pathOffset.y),I[4]-=A,I[5]-=M,y='id="SVGID_'+this.id+'" gradientUnits="'+F+'"',y+=' gradientTransform="'+(D?m.additionalTransform+" ":"")+b.util.matrixToSVG(I)+'" ',"linear"===this.type?d=["<linearGradient ",y,' x1="',_.x1,'" y1="',_.y1,'" x2="',_.x2,'" y2="',_.y2,'">\n']:"radial"===this.type&&(d=["<radialGradient ",y,' cx="',w?_.x1:_.x2,'" cy="',w?_.y1:_.y2,'" r="',w?_.r1:_.r2,'" fx="',w?_.x2:_.x1,'" fy="',w?_.y2:_.y1,'">\n']),"radial"===this.type){if(w)for((v=v.concat()).reverse(),i=0,o=v.length;i<o;i++)v[i].offset=1-v[i].offset;var B=Math.min(_.r1,_.r2);if(B>0){var z=B/Math.max(_.r1,_.r2);for(i=0,o=v.length;i<o;i++)v[i].offset+=z*(1-v[i].offset)}}for(i=0,o=v.length;i<o;i++){var K=v[i];d.push("<stop ",'offset="',100*K.offset+"%",'" style="stop-color:',K.color,void 0!==K.opacity?";stop-opacity: "+K.opacity:";",'"/>\n')}return d.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n"),d.join("")},toLive:function(l){var m,i,o,d=b.util.object.clone(this.coords);if(this.type){for("linear"===this.type?m=l.createLinearGradient(d.x1,d.y1,d.x2,d.y2):"radial"===this.type&&(m=l.createRadialGradient(d.x1,d.y1,d.r1,d.x2,d.y2,d.r2)),i=0,o=this.colorStops.length;i<o;i++){var y=this.colorStops[i].color,_=this.colorStops[i].opacity,v=this.colorStops[i].offset;void 0!==_&&(y=new b.Color(y).setAlpha(_).toRgba()),m.addColorStop(v,y)}return m}}}),b.util.object.extend(b.Gradient,{fromElement:function(l,m,i,o){var d=parseFloat(i)/(/%$/.test(i)?100:1);d=d<0?0:d>1?1:d,isNaN(d)&&(d=1);var y,_,v,w,z,K,oe,ne,ee,G,I=l.getElementsByTagName("stop"),A="userSpaceOnUse"===l.getAttribute("gradientUnits")?"pixels":"percentage",M=l.getAttribute("gradientTransform")||"",D=[],F=0,B=0;for("linearGradient"===l.nodeName||"LINEARGRADIENT"===l.nodeName?(y="linear",_={x1:(z=l).getAttribute("x1")||0,y1:z.getAttribute("y1")||0,x2:z.getAttribute("x2")||"100%",y2:z.getAttribute("y2")||0}):(y="radial",_=function(z){return{x1:z.getAttribute("fx")||z.getAttribute("cx")||"50%",y1:z.getAttribute("fy")||z.getAttribute("cy")||"50%",r1:0,x2:z.getAttribute("cx")||"50%",y2:z.getAttribute("cy")||"50%",r2:z.getAttribute("r")||"50%"}}(l)),v=I.length;v--;)D.push(u(I[v],d));return w=b.parseTransformAttribute(M),K=_,oe=o,ne=A,Object.keys(K).forEach(function(j){"Infinity"===(ee=K[j])?G=1:"-Infinity"===ee?G=0:(G=parseFloat(K[j],10),"string"==typeof ee&&/^(\d+\.\d+)%|(\d+)%$/.test(ee)&&(G*=.01,"pixels"===ne&&("x1"!==j&&"x2"!==j&&"r2"!==j||(G*=oe.viewBoxWidth||oe.width),"y1"!==j&&"y2"!==j||(G*=oe.viewBoxHeight||oe.height)))),K[j]=G}),"pixels"===A&&(F=-m.left,B=-m.top),new b.Gradient({id:l.getAttribute("id"),type:y,coords:_,colorStops:D,gradientUnits:A,gradientTransform:w,offsetX:F,offsetY:B})}})}(),q=b.util.toFixed,b.Pattern=b.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(u,a){if(u||(u={}),this.id=b.Object.__uid++,this.setOptions(u),!u.source||u.source&&"string"!=typeof u.source)a&&a(this);else{var l=this;this.source=b.util.createImage(),b.util.loadImage(u.source,function(m,i){l.source=m,a&&a(l,i)},null,this.crossOrigin)}},toObject:function(u){var a,l,m=b.Object.NUM_FRACTION_DIGITS;return"string"==typeof this.source.src?a=this.source.src:"object"==typeof this.source&&this.source.toDataURL&&(a=this.source.toDataURL()),l={type:"pattern",source:a,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:q(this.offsetX,m),offsetY:q(this.offsetY,m),patternTransform:this.patternTransform?this.patternTransform.concat():null},b.util.populateWithProperties(this,l,u),l},toSVG:function(u){var a="function"==typeof this.source?this.source():this.source,l=a.width/u.width,m=a.height/u.height,i=this.offsetX/u.width,o=this.offsetY/u.height,d="";return"repeat-x"!==this.repeat&&"no-repeat"!==this.repeat||(m=1,o&&(m+=Math.abs(o))),"repeat-y"!==this.repeat&&"no-repeat"!==this.repeat||(l=1,i&&(l+=Math.abs(i))),a.src?d=a.src:a.toDataURL&&(d=a.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+i+'" y="'+o+'" width="'+l+'" height="'+m+'">\n<image x="0" y="0" width="'+a.width+'" height="'+a.height+'" xlink:href="'+d+'"></image>\n</pattern>\n'},setOptions:function(u){for(var a in u)this[a]=u[a]},toLive:function(u){var a=this.source;return a&&(void 0===a.src||a.complete&&0!==a.naturalWidth&&0!==a.naturalHeight)?u.createPattern(a,this.repeat):""}}),function(u){var a=u.fabric||(u.fabric={}),l=a.util.toFixed;a.Shadow?a.warn("fabric.Shadow is already defined."):(a.Shadow=a.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(m){for(var i in"string"==typeof m&&(m=this._parseShadow(m)),m)this[i]=m[i];this.id=a.Object.__uid++},_parseShadow:function(m){var i=m.trim(),o=a.Shadow.reOffsetsAndBlur.exec(i)||[];return{color:(i.replace(a.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseFloat(o[1],10)||0,offsetY:parseFloat(o[2],10)||0,blur:parseFloat(o[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(m){var i=40,o=40,d=a.Object.NUM_FRACTION_DIGITS,y=a.util.rotateVector({x:this.offsetX,y:this.offsetY},a.util.degreesToRadians(-m.angle)),_=new a.Color(this.color);return m.width&&m.height&&(i=100*l((Math.abs(y.x)+this.blur)/m.width,d)+20,o=100*l((Math.abs(y.y)+this.blur)/m.height,d)+20),m.flipX&&(y.x*=-1),m.flipY&&(y.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+o+'%" height="'+(100+2*o)+'%" x="-'+i+'%" width="'+(100+2*i)+'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="'+l(this.blur?this.blur/2:0,d)+'"></feGaussianBlur>\n\t<feOffset dx="'+l(y.x,d)+'" dy="'+l(y.y,d)+'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="'+_.toRgb()+'" flood-opacity="'+_.getAlpha()+'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var m={},i=a.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(o){this[o]!==i[o]&&(m[o]=this[o])},this),m}}),a.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/)}(t),function(){if(b.StaticCanvas)b.warn("fabric.StaticCanvas is already defined.");else{var u=b.util.object.extend,a=b.util.getElementOffset,l=b.util.removeFromArray,m=b.util.toFixed,i=b.util.transformPoint,o=b.util.invertTransform,d=b.util.getNodeCanvas,y=b.util.createCanvasElement,_=new Error("Could not initialize `canvas` element");b.StaticCanvas=b.util.createClass(b.CommonMethods,{initialize:function(v,w){w||(w={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(v,w)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:b.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(v,w){var I=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(v),this._initOptions(w),this.interactive||this._initRetinaScaling(),w.overlayImage&&this.setOverlayImage(w.overlayImage,I),w.backgroundImage&&this.setBackgroundImage(w.backgroundImage,I),w.backgroundColor&&this.setBackgroundColor(w.backgroundColor,I),w.overlayColor&&this.setOverlayColor(w.overlayColor,I),this.calcOffset()},_isRetinaScaling:function(){return b.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,b.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var v=b.devicePixelRatio;this.__initRetinaScaling(v,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(v,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(v,w,I){w.setAttribute("width",this.width*v),w.setAttribute("height",this.height*v),I.scale(v,v)},calcOffset:function(){return this._offset=a(this.lowerCanvasEl),this},setOverlayImage:function(v,w,I){return this.__setBgOverlayImage("overlayImage",v,w,I)},setBackgroundImage:function(v,w,I){return this.__setBgOverlayImage("backgroundImage",v,w,I)},setOverlayColor:function(v,w){return this.__setBgOverlayColor("overlayColor",v,w)},setBackgroundColor:function(v,w){return this.__setBgOverlayColor("backgroundColor",v,w)},__setBgOverlayImage:function(v,w,I,A){return"string"==typeof w?b.util.loadImage(w,function(M,D){if(M){var F=new b.Image(M,A);this[v]=F,F.canvas=this}I&&I(M,D)},this,A&&A.crossOrigin):(A&&w.setOptions(A),this[v]=w,w&&(w.canvas=this),I&&I(w,!1)),this},__setBgOverlayColor:function(v,w,I){return this[v]=w,this._initGradient(w,v),this._initPattern(w,v,I),this},_createCanvasElement:function(){var v=y();if(!v||(v.style||(v.style={}),void 0===v.getContext))throw _;return v},_initOptions:function(v){var w=this.lowerCanvasEl;this._setOptions(v),this.width=this.width||parseInt(w.width,10)||0,this.height=this.height||parseInt(w.height,10)||0,this.lowerCanvasEl.style&&(w.width=this.width,w.height=this.height,w.style.width=this.width+"px",w.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(v){this.lowerCanvasEl=v&&v.getContext?v:b.util.getById(v)||this._createCanvasElement(),b.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(v,w){return this.setDimensions({width:v},w)},setHeight:function(v,w){return this.setDimensions({height:v},w)},setDimensions:function(v,w){var I;for(var A in w=w||{},v)I=v[A],w.cssOnly||(this._setBackstoreDimension(A,v[A]),I+="px",this.hasLostContext=!0),w.backstoreOnly||this._setCssDimension(A,I);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),w.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(v,w){return this.lowerCanvasEl[v]=w,this.upperCanvasEl&&(this.upperCanvasEl[v]=w),this.cacheCanvasEl&&(this.cacheCanvasEl[v]=w),this[v]=w,this},_setCssDimension:function(v,w){return this.lowerCanvasEl.style[v]=w,this.upperCanvasEl&&(this.upperCanvasEl.style[v]=w),this.wrapperEl&&(this.wrapperEl.style[v]=w),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(v){var w,I,A,M=this._activeObject,D=this.backgroundImage,F=this.overlayImage;for(this.viewportTransform=v,I=0,A=this._objects.length;I<A;I++)(w=this._objects[I]).group||w.setCoords(!0);return M&&M.setCoords(),D&&D.setCoords(!0),F&&F.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(v,w){var I=v,A=this.viewportTransform.slice(0);v=i(v,o(this.viewportTransform)),A[0]=w,A[3]=w;var M=i(v,A);return A[4]+=I.x-M.x,A[5]+=I.y-M.y,this.setViewportTransform(A)},setZoom:function(v){return this.zoomToPoint(new b.Point(0,0),v),this},absolutePan:function(v){var w=this.viewportTransform.slice(0);return w[4]=-v.x,w[5]=-v.y,this.setViewportTransform(w)},relativePan:function(v){return this.absolutePan(new b.Point(-v.x-this.viewportTransform[4],-v.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(v){this.stateful&&v.setupState(),v._set("canvas",this),v.setCoords(),this.fire("object:added",{target:v}),v.fire("added")},_onObjectRemoved:function(v){this.fire("object:removed",{target:v}),v.fire("removed"),delete v.canvas},clearContext:function(v){return v.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){return this.renderCanvas(this.contextContainer,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=b.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var v={},w=this.width,I=this.height,A=o(this.viewportTransform);return v.tl=i({x:0,y:0},A),v.br=i({x:w,y:I},A),v.tr=new b.Point(v.br.x,v.tl.y),v.bl=new b.Point(v.tl.x,v.br.y),this.vptCoords=v,v},cancelRequestedRender:function(){this.isRendering&&(b.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(v,w){var I=this.viewportTransform,A=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(v),b.util.setImageSmoothing(v,this.imageSmoothingEnabled),this.fire("before:render",{ctx:v}),this._renderBackground(v),v.save(),v.transform(I[0],I[1],I[2],I[3],I[4],I[5]),this._renderObjects(v,w),v.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(v),A&&(A.canvas=this,A.shouldCache(),A._transformDone=!0,A.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(v)),this._renderOverlay(v),this.controlsAboveOverlay&&this.interactive&&this.drawControls(v),this.fire("after:render",{ctx:v})},drawClipPathOnCanvas:function(v){var w=this.viewportTransform,I=this.clipPath;v.save(),v.transform(w[0],w[1],w[2],w[3],w[4],w[5]),v.globalCompositeOperation="destination-in",I.transform(v),v.scale(1/I.zoomX,1/I.zoomY),v.drawImage(I._cacheCanvas,-I.cacheTranslationX,-I.cacheTranslationY),v.restore()},_renderObjects:function(v,w){var I,A;for(I=0,A=w.length;I<A;++I)w[I]&&w[I].render(v)},_renderBackgroundOrOverlay:function(v,w){var I=this[w+"Color"],A=this[w+"Image"],M=this.viewportTransform,D=this[w+"Vpt"];if(I||A){if(I){v.save(),v.beginPath(),v.moveTo(0,0),v.lineTo(this.width,0),v.lineTo(this.width,this.height),v.lineTo(0,this.height),v.closePath(),v.fillStyle=I.toLive?I.toLive(v,this):I,D&&v.transform(M[0],M[1],M[2],M[3],M[4],M[5]),v.transform(1,0,0,1,I.offsetX||0,I.offsetY||0);var F=I.gradientTransform||I.patternTransform;F&&v.transform(F[0],F[1],F[2],F[3],F[4],F[5]),v.fill(),v.restore()}A&&(v.save(),D&&v.transform(M[0],M[1],M[2],M[3],M[4],M[5]),A.render(v),v.restore())}},_renderBackground:function(v){this._renderBackgroundOrOverlay(v,"background")},_renderOverlay:function(v){this._renderBackgroundOrOverlay(v,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new b.Point(this.width/2,this.height/2)},centerObjectH:function(v){return this._centerObject(v,new b.Point(this.getCenterPoint().x,v.getCenterPoint().y))},centerObjectV:function(v){return this._centerObject(v,new b.Point(v.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(v){var w=this.getCenterPoint();return this._centerObject(v,w)},viewportCenterObject:function(v){var w=this.getVpCenter();return this._centerObject(v,w)},viewportCenterObjectH:function(v){var w=this.getVpCenter();return this._centerObject(v,new b.Point(w.x,v.getCenterPoint().y)),this},viewportCenterObjectV:function(v){var w=this.getVpCenter();return this._centerObject(v,new b.Point(v.getCenterPoint().x,w.y))},getVpCenter:function(){var v=this.getCenterPoint(),w=o(this.viewportTransform);return i(v,w)},_centerObject:function(v,w){return v.setPositionByOrigin(w,"center","center"),v.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(v){return this.toDatalessObject(v)},toObject:function(v){return this._toObjectMethod("toObject",v)},toDatalessObject:function(v){return this._toObjectMethod("toDatalessObject",v)},_toObjectMethod:function(v,w){var I=this.clipPath,A={version:b.version,objects:this._toObjects(v,w)};return I&&!I.excludeFromExport&&(A.clipPath=this._toObject(this.clipPath,v,w)),u(A,this.__serializeBgOverlay(v,w)),b.util.populateWithProperties(this,A,w),A},_toObjects:function(v,w){return this._objects.filter(function(I){return!I.excludeFromExport}).map(function(I){return this._toObject(I,v,w)},this)},_toObject:function(v,w,I){var A;this.includeDefaultValues||(A=v.includeDefaultValues,v.includeDefaultValues=!1);var M=v[w](I);return this.includeDefaultValues||(v.includeDefaultValues=A),M},__serializeBgOverlay:function(v,w){var I={},A=this.backgroundImage,M=this.overlayImage,D=this.backgroundColor,F=this.overlayColor;return D&&D.toObject?D.excludeFromExport||(I.background=D.toObject(w)):D&&(I.background=D),F&&F.toObject?F.excludeFromExport||(I.overlay=F.toObject(w)):F&&(I.overlay=F),A&&!A.excludeFromExport&&(I.backgroundImage=this._toObject(A,v,w)),M&&!M.excludeFromExport&&(I.overlayImage=this._toObject(M,v,w)),I},svgViewportTransformation:!0,toSVG:function(v,w){v||(v={}),v.reviver=w;var I=[];return this._setSVGPreamble(I,v),this._setSVGHeader(I,v),this.clipPath&&I.push('<g clip-path="url(#'+this.clipPath.clipPathId+')" >\n'),this._setSVGBgOverlayColor(I,"background"),this._setSVGBgOverlayImage(I,"backgroundImage",w),this._setSVGObjects(I,w),this.clipPath&&I.push("</g>\n"),this._setSVGBgOverlayColor(I,"overlay"),this._setSVGBgOverlayImage(I,"overlayImage",w),I.push("</svg>"),I.join("")},_setSVGPreamble:function(v,w){w.suppressPreamble||v.push('<?xml version="1.0" encoding="',w.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(v,w){var I,A=w.width||this.width,M=w.height||this.height,D='viewBox="0 0 '+this.width+" "+this.height+'" ',F=b.Object.NUM_FRACTION_DIGITS;w.viewBox?D='viewBox="'+w.viewBox.x+" "+w.viewBox.y+" "+w.viewBox.width+" "+w.viewBox.height+'" ':this.svgViewportTransformation&&(D='viewBox="'+m(-(I=this.viewportTransform)[4]/I[0],F)+" "+m(-I[5]/I[3],F)+" "+m(this.width/I[0],F)+" "+m(this.height/I[3],F)+'" '),v.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',A,'" ','height="',M,'" ',D,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",b.version,"</desc>\n","<defs>\n",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(w),"</defs>\n")},createSVGClipPathMarkup:function(v){var w=this.clipPath;return w?(w.clipPathId="CLIPPATH_"+b.Object.__uid++,'<clipPath id="'+w.clipPathId+'" >\n'+this.clipPath.toClipPathSVG(v.reviver)+"</clipPath>\n"):""},createSVGRefElementsMarkup:function(){var v=this;return["background","overlay"].map(function(w){var I=v[w+"Color"];if(I&&I.toLive){var A=v[w+"Vpt"],M=v.viewportTransform;return I.toSVG({width:v.width/(A?M[0]:1),height:v.height/(A?M[3]:1)},{additionalTransform:A?b.util.matrixToSVG(M):""})}}).join("")},createSVGFontFacesMarkup:function(){var v,w,I,A,M,D,F,B,z="",K={},oe=b.fontPaths,ne=[];for(this._objects.forEach(function G(j){ne.push(j),j._objects&&j._objects.forEach(G)}),F=0,B=ne.length;F<B;F++)if(w=(v=ne[F]).fontFamily,-1!==v.type.indexOf("text")&&!K[w]&&oe[w]&&(K[w]=!0,v.styles))for(M in I=v.styles)for(D in A=I[M])!K[w=A[D].fontFamily]&&oe[w]&&(K[w]=!0);for(var ee in K)z+=["\t\t@font-face {\n","\t\t\tfont-family: '",ee,"';\n","\t\t\tsrc: url('",oe[ee],"');\n","\t\t}\n"].join("");return z&&(z=['\t<style type="text/css">',"<![CDATA[\n",z,"]]>","</style>\n"].join("")),z},_setSVGObjects:function(v,w){var I,A,M,D=this._objects;for(A=0,M=D.length;A<M;A++)(I=D[A]).excludeFromExport||this._setSVGObject(v,I,w)},_setSVGObject:function(v,w,I){v.push(w.toSVG(I))},_setSVGBgOverlayImage:function(v,w,I){this[w]&&!this[w].excludeFromExport&&this[w].toSVG&&v.push(this[w].toSVG(I))},_setSVGBgOverlayColor:function(v,w){var I=this[w+"Color"],M=this.width,D=this.height;if(I)if(I.toLive){var F=I.repeat,B=b.util.invertTransform(this.viewportTransform),z=this[w+"Vpt"]?b.util.matrixToSVG(B):"";v.push('<rect transform="'+z+" translate(",M/2,",",D/2,')"',' x="',I.offsetX-M/2,'" y="',I.offsetY-D/2,'" ','width="',"repeat-y"===F||"no-repeat"===F?I.source.width:M,'" height="',"repeat-x"===F||"no-repeat"===F?I.source.height:D,'" fill="url(#SVGID_'+I.id+')"',"></rect>\n")}else v.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',I,'"',"></rect>\n")},sendToBack:function(v){if(!v)return this;var w,I,A,M=this._activeObject;if(v===M&&"activeSelection"===v.type)for(w=(A=M._objects).length;w--;)l(this._objects,I=A[w]),this._objects.unshift(I);else l(this._objects,v),this._objects.unshift(v);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(v){if(!v)return this;var w,I,A,M=this._activeObject;if(v===M&&"activeSelection"===v.type)for(A=M._objects,w=0;w<A.length;w++)l(this._objects,I=A[w]),this._objects.push(I);else l(this._objects,v),this._objects.push(v);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(v,w){if(!v)return this;var I,A,M,D,F,B=this._activeObject,z=0;if(v===B&&"activeSelection"===v.type)for(F=B._objects,I=0;I<F.length;I++)(M=this._objects.indexOf(A=F[I]))>0+z&&(D=M-1,l(this._objects,A),this._objects.splice(D,0,A)),z++;else 0!==(M=this._objects.indexOf(v))&&(D=this._findNewLowerIndex(v,M,w),l(this._objects,v),this._objects.splice(D,0,v));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(v,w,I){var A,M;if(I){for(A=w,M=w-1;M>=0;--M)if(v.intersectsWithObject(this._objects[M])||v.isContainedWithinObject(this._objects[M])||this._objects[M].isContainedWithinObject(v)){A=M;break}}else A=w-1;return A},bringForward:function(v,w){if(!v)return this;var I,A,M,D,F,B=this._activeObject,z=0;if(v===B&&"activeSelection"===v.type)for(I=(F=B._objects).length;I--;)(M=this._objects.indexOf(A=F[I]))<this._objects.length-1-z&&(D=M+1,l(this._objects,A),this._objects.splice(D,0,A)),z++;else(M=this._objects.indexOf(v))!==this._objects.length-1&&(D=this._findNewUpperIndex(v,M,w),l(this._objects,v),this._objects.splice(D,0,v));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(v,w,I){var A,M,D;if(I){for(A=w,M=w+1,D=this._objects.length;M<D;++M)if(v.intersectsWithObject(this._objects[M])||v.isContainedWithinObject(this._objects[M])||this._objects[M].isContainedWithinObject(v)){A=M;break}}else A=w+1;return A},moveTo:function(v,w){return l(this._objects,v),this._objects.splice(w,0,v),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(b.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(v){v.dispose&&v.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),b.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),b.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),u(b.StaticCanvas.prototype,b.Observable),u(b.StaticCanvas.prototype,b.Collection),u(b.StaticCanvas.prototype,b.DataURLExporter),u(b.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(v){var w=y();if(!w||!w.getContext)return null;var I=w.getContext("2d");return I&&"setLineDash"===v?void 0!==I.setLineDash:null}}),b.StaticCanvas.prototype.toJSON=b.StaticCanvas.prototype.toObject,b.isLikelyNode&&(b.StaticCanvas.prototype.createPNGStream=function(){var v=d(this.lowerCanvasEl);return v&&v.createPNGStream()},b.StaticCanvas.prototype.createJPEGStream=function(v){var w=d(this.lowerCanvasEl);return w&&w.createJPEGStream(v)})}}(),b.BaseBrush=b.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(u){u.strokeStyle=this.color,u.lineWidth=this.width,u.lineCap=this.strokeLineCap,u.miterLimit=this.strokeMiterLimit,u.lineJoin=this.strokeLineJoin,u.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(u){var a=this.canvas.viewportTransform;u.save(),u.transform(a[0],a[1],a[2],a[3],a[4],a[5])},_setShadow:function(){if(this.shadow){var u=this.canvas,a=this.shadow,l=u.contextTop,m=u.getZoom();u&&u._isRetinaScaling()&&(m*=b.devicePixelRatio),l.shadowColor=a.color,l.shadowBlur=a.blur*m,l.shadowOffsetX=a.offsetX*m,l.shadowOffsetY=a.offsetY*m}},needsFullRender:function(){return new b.Color(this.color).getAlpha()<1||!!this.shadow},_resetShadow:function(){var u=this.canvas.contextTop;u.shadowColor="",u.shadowBlur=u.shadowOffsetX=u.shadowOffsetY=0},_isOutSideCanvas:function(u){return u.x<0||u.x>this.canvas.getWidth()||u.y<0||u.y>this.canvas.getHeight()}}),b.PencilBrush=b.util.createClass(b.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(u){this.canvas=u,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(u,a,l){var m=a.midPointFrom(l);return u.quadraticCurveTo(a.x,a.y,m.x,m.y),m},onMouseDown:function(u,a){this.canvas._isMainEvent(a.e)&&(this.drawStraightLine=a.e[this.straightLineKey],this._prepareForDrawing(u),this._captureDrawingPath(u),this._render())},onMouseMove:function(u,a){if(this.canvas._isMainEvent(a.e)&&(this.drawStraightLine=a.e[this.straightLineKey],(!0!==this.limitedToCanvasSize||!this._isOutSideCanvas(u))&&this._captureDrawingPath(u)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var l=this._points,m=l.length,i=this.canvas.contextTop;this._saveAndTransform(i),this.oldEnd&&(i.beginPath(),i.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(i,l[m-2],l[m-1],!0),i.stroke(),i.restore()}},onMouseUp:function(u){return!this.canvas._isMainEvent(u.e)||(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1)},_prepareForDrawing:function(u){var a=new b.Point(u.x,u.y);this._reset(),this._addPoint(a),this.canvas.contextTop.moveTo(a.x,a.y)},_addPoint:function(u){return!(this._points.length>1&&u.eq(this._points[this._points.length-1])||(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(u),0))},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(u){var a=new b.Point(u.x,u.y);return this._addPoint(a)},_render:function(u){var a,l,m=this._points[0],i=this._points[1];if(this._saveAndTransform(u=u||this.canvas.contextTop),u.beginPath(),2===this._points.length&&m.x===i.x&&m.y===i.y){var o=this.width/1e3;m=new b.Point(m.x,m.y),i=new b.Point(i.x,i.y),m.x-=o,i.x+=o}for(u.moveTo(m.x,m.y),a=1,l=this._points.length;a<l;a++)this._drawSegment(u,m,i),m=this._points[a],i=this._points[a+1];u.lineTo(m.x,m.y),u.stroke(),u.restore()},convertPointsToSVGPath:function(u){return b.util.getSmoothPathFromPoints(u,this.width/1e3)},_isEmptySVGPath:function(u){return"M 0 0 Q 0 0 0 0 L 0 0"===b.util.joinPath(u)},createPath:function(u){var a=new b.Path(u,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,a.shadow=new b.Shadow(this.shadow)),a},decimatePoints:function(u,a){if(u.length<=2)return u;var l,m=this.canvas.getZoom(),i=Math.pow(a/m,2),o=u.length-1,d=u[0],y=[d];for(l=1;l<o-1;l++)Math.pow(d.x-u[l].x,2)+Math.pow(d.y-u[l].y,2)>=i&&y.push(d=u[l]);return y.push(u[o]),y},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var u=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(u))this.canvas.requestRenderAll();else{var a=this.createPath(u);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:a}),this.canvas.add(a),this.canvas.requestRenderAll(),a.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:a})}}}),b.CircleBrush=b.util.createClass(b.BaseBrush,{width:10,initialize:function(u){this.canvas=u,this.points=[]},drawDot:function(u){var a=this.addPoint(u),l=this.canvas.contextTop;this._saveAndTransform(l),this.dot(l,a),l.restore()},dot:function(u,a){u.fillStyle=a.fill,u.beginPath(),u.arc(a.x,a.y,a.radius,0,2*Math.PI,!1),u.closePath(),u.fill()},onMouseDown:function(u){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(u)},_render:function(){var u,a,l=this.canvas.contextTop,m=this.points;for(this._saveAndTransform(l),u=0,a=m.length;u<a;u++)this.dot(l,m[u]);l.restore()},onMouseMove:function(u){!0===this.limitedToCanvasSize&&this._isOutSideCanvas(u)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(u),this._render()):this.drawDot(u))},onMouseUp:function(){var u,a,l=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var m=[];for(u=0,a=this.points.length;u<a;u++){var i=this.points[u],o=new b.Circle({radius:i.radius,left:i.x,top:i.y,originX:"center",originY:"center",fill:i.fill});this.shadow&&(o.shadow=new b.Shadow(this.shadow)),m.push(o)}var d=new b.Group(m);d.canvas=this.canvas,this.canvas.fire("before:path:created",{path:d}),this.canvas.add(d),this.canvas.fire("path:created",{path:d}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=l,this.canvas.requestRenderAll()},addPoint:function(u){var a=new b.Point(u.x,u.y),l=b.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,m=new b.Color(this.color).setAlpha(b.util.getRandomInt(0,100)/100).toRgba();return a.radius=l,a.fill=m,this.points.push(a),a}}),b.SprayBrush=b.util.createClass(b.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(u){this.canvas=u,this.sprayChunks=[]},onMouseDown:function(u){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(u),this.render(this.sprayChunkPoints)},onMouseMove:function(u){!0===this.limitedToCanvasSize&&this._isOutSideCanvas(u)||(this.addSprayChunk(u),this.render(this.sprayChunkPoints))},onMouseUp:function(){var u=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var a=[],l=0,m=this.sprayChunks.length;l<m;l++)for(var i=this.sprayChunks[l],o=0,d=i.length;o<d;o++){var y=new b.Rect({width:i[o].width,height:i[o].width,left:i[o].x+1,top:i[o].y+1,originX:"center",originY:"center",fill:this.color});a.push(y)}this.optimizeOverlapping&&(a=this._getOptimizedRects(a));var _=new b.Group(a);this.shadow&&_.set("shadow",new b.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:_}),this.canvas.add(_),this.canvas.fire("path:created",{path:_}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=u,this.canvas.requestRenderAll()},_getOptimizedRects:function(u){var a,l,m,i={};for(l=0,m=u.length;l<m;l++)i[a=u[l].left+""+u[l].top]||(i[a]=u[l]);var o=[];for(a in i)o.push(i[a]);return o},render:function(u){var a,l,m=this.canvas.contextTop;for(m.fillStyle=this.color,this._saveAndTransform(m),a=0,l=u.length;a<l;a++){var i=u[a];void 0!==i.opacity&&(m.globalAlpha=i.opacity),m.fillRect(i.x,i.y,i.width,i.width)}m.restore()},_render:function(){var u,a,l=this.canvas.contextTop;for(l.fillStyle=this.color,this._saveAndTransform(l),u=0,a=this.sprayChunks.length;u<a;u++)this.render(this.sprayChunks[u]);l.restore()},addSprayChunk:function(u){this.sprayChunkPoints=[];var a,l,m,i,o=this.width/2;for(i=0;i<this.density;i++){a=b.util.getRandomInt(u.x-o,u.x+o),l=b.util.getRandomInt(u.y-o,u.y+o),m=this.dotWidthVariance?b.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var d=new b.Point(a,l);d.width=m,this.randomOpacity&&(d.opacity=b.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(d)}this.sprayChunks.push(this.sprayChunkPoints)}}),b.PatternBrush=b.util.createClass(b.PencilBrush,{getPatternSrc:function(){var u=b.util.createCanvasElement(),a=u.getContext("2d");return u.width=u.height=25,a.fillStyle=this.color,a.beginPath(),a.arc(10,10,10,0,2*Math.PI,!1),a.closePath(),a.fill(),u},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(u){return u.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(u){this.callSuper("_setBrushStyles",u),u.strokeStyle=this.getPattern(u)},createPath:function(u){var a=this.callSuper("createPath",u),l=a._getLeftTopCoords().scalarAdd(a.strokeWidth/2);return a.stroke=new b.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-l.x,offsetY:-l.y}),a}}),function(){var u=b.util.getPointer,a=b.util.degreesToRadians,l=b.util.isTouchEvent;for(var m in b.Canvas=b.util.createClass(b.StaticCanvas,{initialize:function(i,o){o||(o={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(i,o),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=b.PencilBrush&&new b.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var i,o,d,y=this.getActiveObjects();if(y.length>0&&!this.preserveObjectStacking){o=[],d=[];for(var _=0,v=this._objects.length;_<v;_++)-1===y.indexOf(i=this._objects[_])?o.push(i):d.push(i);y.length>1&&(this._activeObject._objects=d),o.push.apply(o,d)}else o=this._objects;return o},renderAll:function(){return!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1),this.renderCanvas(this.contextContainer,this._chooseObjectsToRender()),this},renderTopLayer:function(i){i.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(i),this.contextTopDirty=!0),i.restore()},renderTop:function(){var i=this.contextTop;return this.clearContext(i),this.renderTopLayer(i),this.fire("after:render"),this},_normalizePointer:function(i,o){var d=i.calcTransformMatrix(),y=b.util.invertTransform(d),_=this.restorePointerVpt(o);return b.util.transformPoint(_,y)},isTargetTransparent:function(i,o,d){if(i.shouldCache()&&i._cacheCanvas&&i!==this._activeObject){var y=this._normalizePointer(i,{x:o,y:d}),_=Math.max(i.cacheTranslationX+y.x*i.zoomX,0),v=Math.max(i.cacheTranslationY+y.y*i.zoomY,0);return b.util.isTransparent(i._cacheContext,Math.round(_),Math.round(v),this.targetFindTolerance)}var w=this.contextCache,I=i.selectionBackgroundColor,A=this.viewportTransform;return i.selectionBackgroundColor="",this.clearContext(w),w.save(),w.transform(A[0],A[1],A[2],A[3],A[4],A[5]),i.render(w),w.restore(),i.selectionBackgroundColor=I,b.util.isTransparent(w,o,d,this.targetFindTolerance)},_isSelectionKeyPressed:function(i){return Array.isArray(this.selectionKey)?!!this.selectionKey.find(function(o){return!0===i[o]}):i[this.selectionKey]},_shouldClearSelection:function(i,o){var d=this.getActiveObjects(),y=this._activeObject;return!o||o&&y&&d.length>1&&-1===d.indexOf(o)&&y!==o&&!this._isSelectionKeyPressed(i)||o&&!o.evented||o&&!o.selectable&&y&&y!==o},_shouldCenterTransform:function(i,o,d){var y;if(i)return"scale"===o||"scaleX"===o||"scaleY"===o||"resizing"===o?y=this.centeredScaling||i.centeredScaling:"rotate"===o&&(y=this.centeredRotation||i.centeredRotation),y?!d:d},_getOriginFromCorner:function(i,o){var d={x:i.originX,y:i.originY};return"ml"===o||"tl"===o||"bl"===o?d.x="right":"mr"!==o&&"tr"!==o&&"br"!==o||(d.x="left"),"tl"===o||"mt"===o||"tr"===o?d.y="bottom":"bl"!==o&&"mb"!==o&&"br"!==o||(d.y="top"),d},_getActionFromCorner:function(i,o,d,y){if(!o||!i)return"drag";var _=y.controls[o];return _.getActionName(d,_,y)},_setupCurrentTransform:function(i,o,d){if(o){var y=this.getPointer(i),_=o.__corner,v=o.controls[_],w=d&&_?v.getActionHandler(i,o,v):b.controlsUtils.dragHandler,I=this._getActionFromCorner(d,_,i,o),A=this._getOriginFromCorner(o,_),M=i[this.centeredKey],D={target:o,action:I,actionHandler:w,corner:_,scaleX:o.scaleX,scaleY:o.scaleY,skewX:o.skewX,skewY:o.skewY,offsetX:y.x-o.left,offsetY:y.y-o.top,originX:A.x,originY:A.y,ex:y.x,ey:y.y,lastX:y.x,lastY:y.y,theta:a(o.angle),width:o.width*o.scaleX,shiftKey:i.shiftKey,altKey:M,original:b.util.saveObjectTransform(o)};this._shouldCenterTransform(o,I,M)&&(D.originX="center",D.originY="center"),D.original.originX=A.x,D.original.originY=A.y,this._currentTransform=D,this._beforeTransform(i)}},setCursor:function(i){this.upperCanvasEl.style.cursor=i},_drawSelection:function(i){var o=this._groupSelector,d=new b.Point(o.ex,o.ey),y=b.util.transformPoint(d,this.viewportTransform),_=new b.Point(o.ex+o.left,o.ey+o.top),v=b.util.transformPoint(_,this.viewportTransform),w=Math.min(y.x,v.x),I=Math.min(y.y,v.y),A=Math.max(y.x,v.x),M=Math.max(y.y,v.y),D=this.selectionLineWidth/2;this.selectionColor&&(i.fillStyle=this.selectionColor,i.fillRect(w,I,A-w,M-I)),this.selectionLineWidth&&this.selectionBorderColor&&(i.lineWidth=this.selectionLineWidth,i.strokeStyle=this.selectionBorderColor,w+=D,I+=D,A-=D,M-=D,b.Object.prototype._setLineDash.call(this,i,this.selectionDashArray),i.strokeRect(w,I,A-w,M-I))},findTarget:function(i,o){if(!this.skipTargetFind){var d,y,_=this.getPointer(i,!0),v=this._activeObject,w=this.getActiveObjects(),I=l(i),A=w.length>1&&!o||1===w.length;if(this.targets=[],A&&v._findTargetCorner(_,I)||w.length>1&&!o&&v===this._searchPossibleTargets([v],_))return v;if(1===w.length&&v===this._searchPossibleTargets([v],_)){if(!this.preserveObjectStacking)return v;d=v,y=this.targets,this.targets=[]}var M=this._searchPossibleTargets(this._objects,_);return i[this.altSelectionKey]&&M&&d&&M!==d&&(M=d,this.targets=y),M}},_checkTarget:function(i,o,d){if(o&&o.visible&&o.evented&&o.containsPoint(i)&&(!this.perPixelTargetFind&&!o.perPixelTargetFind||o.isEditing||!this.isTargetTransparent(o,d.x,d.y)))return!0},_searchPossibleTargets:function(i,o){for(var d,y,_=i.length;_--;){var v=i[_],w=v.group?this._normalizePointer(v.group,o):o;if(this._checkTarget(w,v,o)){(d=i[_]).subTargetCheck&&d instanceof b.Group&&(y=this._searchPossibleTargets(d._objects,o))&&this.targets.push(y);break}}return d},restorePointerVpt:function(i){return b.util.transformPoint(i,b.util.invertTransform(this.viewportTransform))},getPointer:function(i,o){if(this._absolutePointer&&!o)return this._absolutePointer;if(this._pointer&&o)return this._pointer;var d,y=u(i),_=this.upperCanvasEl,v=_.getBoundingClientRect(),w=v.width||0,I=v.height||0;w&&I||("top"in v&&"bottom"in v&&(I=Math.abs(v.top-v.bottom)),"right"in v&&"left"in v&&(w=Math.abs(v.right-v.left))),this.calcOffset(),y.x=y.x-this._offset.left,y.y=y.y-this._offset.top,o||(y=this.restorePointerVpt(y));var A=this.getRetinaScaling();return 1!==A&&(y.x/=A,y.y/=A),{x:y.x*(d=0===w||0===I?{width:1,height:1}:{width:_.width/w,height:_.height/I}).width,y:y.y*d.height}},_createUpperCanvas:function(){var i=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),o=this.lowerCanvasEl,d=this.upperCanvasEl;d?d.className="":(d=this._createCanvasElement(),this.upperCanvasEl=d),b.util.addClass(d,"upper-canvas "+i),this.wrapperEl.appendChild(d),this._copyCanvasStyle(o,d),this._applyCanvasStyle(d),this.contextTop=d.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=b.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),b.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),b.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(i){var o=this.width||i.width,d=this.height||i.height;b.util.setStyle(i,{position:"absolute",width:o+"px",height:d+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),i.width=o,i.height=d,b.util.makeElementUnselectable(i)},_copyCanvasStyle:function(i,o){o.style.cssText=i.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var i=this._activeObject;return i?"activeSelection"===i.type&&i._objects?i._objects.slice(0):[i]:[]},_onObjectRemoved:function(i){i===this._activeObject&&(this.fire("before:selection:cleared",{target:i}),this._discardActiveObject(),this.fire("selection:cleared",{target:i}),i.fire("deselected")),i===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",i)},_fireSelectionEvents:function(i,o){var d=!1,y=this.getActiveObjects(),_=[],v=[];i.forEach(function(w){-1===y.indexOf(w)&&(d=!0,w.fire("deselected",{e:o,target:w}),v.push(w))}),y.forEach(function(w){-1===i.indexOf(w)&&(d=!0,w.fire("selected",{e:o,target:w}),_.push(w))}),i.length>0&&y.length>0?d&&this.fire("selection:updated",{e:o,selected:_,deselected:v}):y.length>0?this.fire("selection:created",{e:o,selected:_}):i.length>0&&this.fire("selection:cleared",{e:o,deselected:v})},setActiveObject:function(i,o){var d=this.getActiveObjects();return this._setActiveObject(i,o),this._fireSelectionEvents(d,o),this},_setActiveObject:function(i,o){return this._activeObject!==i&&!!this._discardActiveObject(o,i)&&!i.onSelect({e:o})&&(this._activeObject=i,!0)},_discardActiveObject:function(i,o){var d=this._activeObject;if(d){if(d.onDeselect({e:i,object:o}))return!1;this._activeObject=null}return!0},discardActiveObject:function(i){var o=this.getActiveObjects(),d=this.getActiveObject();return o.length&&this.fire("before:selection:cleared",{target:d,e:i}),this._discardActiveObject(i),this._fireSelectionEvents(o,i),this},dispose:function(){var i=this.wrapperEl;return this.removeListeners(),i.removeChild(this.upperCanvasEl),i.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(o){b.util.cleanUpJsdomNode(this[o]),this[o]=void 0}.bind(this)),i.parentNode&&i.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,b.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(i){var o=this._activeObject;o&&o._renderControls(i)},_toObject:function(i,o,d){var y=this._realizeGroupTransformOnObject(i),_=this.callSuper("_toObject",i,o,d);return this._unwindGroupTransformOnObject(i,y),_},_realizeGroupTransformOnObject:function(i){if(i.group&&"activeSelection"===i.group.type&&this._activeObject===i.group){var o={};return["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"].forEach(function(d){o[d]=i[d]}),b.util.addTransformToObject(i,this._activeObject.calcOwnMatrix()),o}return null},_unwindGroupTransformOnObject:function(i,o){o&&i.set(o)},_setSVGObject:function(i,o,d){var y=this._realizeGroupTransformOnObject(o);this.callSuper("_setSVGObject",i,o,d),this._unwindGroupTransformOnObject(o,y)},setViewportTransform:function(i){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),b.StaticCanvas.prototype.setViewportTransform.call(this,i)}}),b.StaticCanvas)"prototype"!==m&&(b.Canvas[m]=b.StaticCanvas[m])}(),function(){var u=b.util.addListener,a=b.util.removeListener,l={passive:!1};function m(i,o){return i.button&&i.button===o-1}b.util.object.extend(b.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(u,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(i,o){var d=this.upperCanvasEl,y=this._getEventPrefix();i(b.window,"resize",this._onResize),i(d,y+"down",this._onMouseDown),i(d,y+"move",this._onMouseMove,l),i(d,y+"out",this._onMouseOut),i(d,y+"enter",this._onMouseEnter),i(d,"wheel",this._onMouseWheel),i(d,"contextmenu",this._onContextMenu),i(d,"dblclick",this._onDoubleClick),i(d,"dragover",this._onDragOver),i(d,"dragenter",this._onDragEnter),i(d,"dragleave",this._onDragLeave),i(d,"drop",this._onDrop),this.enablePointerEvents||i(d,"touchstart",this._onTouchStart,l),typeof eventjs<"u"&&o in eventjs&&(eventjs[o](d,"gesture",this._onGesture),eventjs[o](d,"drag",this._onDrag),eventjs[o](d,"orientation",this._onOrientationChange),eventjs[o](d,"shake",this._onShake),eventjs[o](d,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(a,"remove");var i=this._getEventPrefix();a(b.document,i+"up",this._onMouseUp),a(b.document,"touchend",this._onTouchEnd,l),a(b.document,i+"move",this._onMouseMove,l),a(b.document,"touchmove",this._onMouseMove,l)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(i,o){this.__onTransformGesture&&this.__onTransformGesture(i,o)},_onDrag:function(i,o){this.__onDrag&&this.__onDrag(i,o)},_onMouseWheel:function(i){this.__onMouseWheel(i)},_onMouseOut:function(i){var o=this._hoveredTarget;this.fire("mouse:out",{target:o,e:i}),this._hoveredTarget=null,o&&o.fire("mouseout",{e:i});var d=this;this._hoveredTargets.forEach(function(y){d.fire("mouse:out",{target:o,e:i}),y&&o.fire("mouseout",{e:i})}),this._hoveredTargets=[],this._iTextInstances&&this._iTextInstances.forEach(function(y){y.isEditing&&y.hiddenTextarea.focus()})},_onMouseEnter:function(i){this._currentTransform||this.findTarget(i)||(this.fire("mouse:over",{target:null,e:i}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(i,o){this.__onOrientationChange&&this.__onOrientationChange(i,o)},_onShake:function(i,o){this.__onShake&&this.__onShake(i,o)},_onLongPress:function(i,o){this.__onLongPress&&this.__onLongPress(i,o)},_onDragOver:function(i){i.preventDefault();var o=this._simpleEventHandler("dragover",i);this._fireEnterLeaveEvents(o,i)},_onDrop:function(i){return this._simpleEventHandler("drop:before",i),this._simpleEventHandler("drop",i)},_onContextMenu:function(i){return this.stopContextMenu&&(i.stopPropagation(),i.preventDefault()),!1},_onDoubleClick:function(i){this._cacheTransformEventData(i),this._handleEvent(i,"dblclick"),this._resetTransformEventData(i)},getPointerId:function(i){var o=i.changedTouches;return o?o[0]&&o[0].identifier:this.enablePointerEvents?i.pointerId:-1},_isMainEvent:function(i){return!0===i.isPrimary||!1!==i.isPrimary&&("touchend"===i.type&&0===i.touches.length||!i.changedTouches||i.changedTouches[0].identifier===this.mainTouchId)},_onTouchStart:function(i){i.preventDefault(),null===this.mainTouchId&&(this.mainTouchId=this.getPointerId(i)),this.__onMouseDown(i),this._resetTransformEventData();var o=this.upperCanvasEl,d=this._getEventPrefix();u(b.document,"touchend",this._onTouchEnd,l),u(b.document,"touchmove",this._onMouseMove,l),a(o,d+"down",this._onMouseDown)},_onMouseDown:function(i){this.__onMouseDown(i),this._resetTransformEventData();var o=this.upperCanvasEl,d=this._getEventPrefix();a(o,d+"move",this._onMouseMove,l),u(b.document,d+"up",this._onMouseUp),u(b.document,d+"move",this._onMouseMove,l)},_onTouchEnd:function(i){if(!(i.touches.length>0)){this.__onMouseUp(i),this._resetTransformEventData(),this.mainTouchId=null;var o=this._getEventPrefix();a(b.document,"touchend",this._onTouchEnd,l),a(b.document,"touchmove",this._onMouseMove,l);var d=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){u(d.upperCanvasEl,o+"down",d._onMouseDown),d._willAddMouseDown=0},400)}},_onMouseUp:function(i){this.__onMouseUp(i),this._resetTransformEventData();var o=this.upperCanvasEl,d=this._getEventPrefix();this._isMainEvent(i)&&(a(b.document,d+"up",this._onMouseUp),a(b.document,d+"move",this._onMouseMove,l),u(o,d+"move",this._onMouseMove,l))},_onMouseMove:function(i){!this.allowTouchScrolling&&i.preventDefault&&i.preventDefault(),this.__onMouseMove(i)},_onResize:function(){this.calcOffset()},_shouldRender:function(i){var o=this._activeObject;return!!(!!o!=!!i||o&&i&&o!==i)||!1},__onMouseUp:function(i){var o,d=this._currentTransform,y=this._groupSelector,_=!1,v=!y||0===y.left&&0===y.top;if(this._cacheTransformEventData(i),o=this._target,this._handleEvent(i,"up:before"),m(i,3))this.fireRightClick&&this._handleEvent(i,"up",3,v);else{if(m(i,2))return this.fireMiddleClick&&this._handleEvent(i,"up",2,v),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(i);else if(this._isMainEvent(i)){if(d&&(this._finalizeCurrentTransform(i),_=d.actionPerformed),!v){var w=o===this._activeObject;this._maybeGroupObjects(i),_||(_=this._shouldRender(o)||!w&&o===this._activeObject)}var I,A;if(o){if(I=o._findTargetCorner(this.getPointer(i,!0),b.util.isTouchEvent(i)),o.selectable&&o!==this._activeObject&&"up"===o.activeOn)this.setActiveObject(o,i),_=!0;else{var M=o.controls[I],D=M&&M.getMouseUpHandler(i,o,M);D&&D(i,d,(A=this.getPointer(i)).x,A.y)}o.isMoving=!1}if(d&&(d.target!==o||d.corner!==I)){var F=d.target&&d.target.controls[d.corner],B=F&&F.getMouseUpHandler(i,o,M);A=A||this.getPointer(i),B&&B(i,d,A.x,A.y)}this._setCursorFromEvent(i,o),this._handleEvent(i,"up",1,v),this._groupSelector=null,this._currentTransform=null,o&&(o.__corner=0),_?this.requestRenderAll():v||this.renderTop()}}},_simpleEventHandler:function(i,o){var d=this.findTarget(o),y=this.targets,_={e:o,target:d,subTargets:y};if(this.fire(i,_),d&&d.fire(i,_),!y)return d;for(var v=0;v<y.length;v++)y[v].fire(i,_);return d},_handleEvent:function(i,o,d,y){var _=this._target,v=this.targets||[],w={e:i,target:_,subTargets:v,button:d||1,isClick:y||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};"up"===o&&(w.currentTarget=this.findTarget(i),w.currentSubTargets=this.targets),this.fire("mouse:"+o,w),_&&_.fire("mouse"+o,w);for(var I=0;I<v.length;I++)v[I].fire("mouse"+o,w)},_finalizeCurrentTransform:function(i){var o=this._currentTransform,d=o.target,y={e:i,target:d,transform:o,action:o.action};d._scaling&&(d._scaling=!1),d.setCoords(),(o.actionPerformed||this.stateful&&d.hasStateChanged())&&this._fire("modified",y)},_onMouseDownInDrawingMode:function(i){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(i).requestRenderAll();var o=this.getPointer(i);this.freeDrawingBrush.onMouseDown(o,{e:i,pointer:o}),this._handleEvent(i,"down")},_onMouseMoveInDrawingMode:function(i){if(this._isCurrentlyDrawing){var o=this.getPointer(i);this.freeDrawingBrush.onMouseMove(o,{e:i,pointer:o})}this.setCursor(this.freeDrawingCursor),this._handleEvent(i,"move")},_onMouseUpInDrawingMode:function(i){var o=this.getPointer(i);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:i,pointer:o}),this._handleEvent(i,"up")},__onMouseDown:function(i){this._cacheTransformEventData(i),this._handleEvent(i,"down:before");var o=this._target;if(m(i,3))this.fireRightClick&&this._handleEvent(i,"down",3);else if(m(i,2))this.fireMiddleClick&&this._handleEvent(i,"down",2);else if(this.isDrawingMode)this._onMouseDownInDrawingMode(i);else if(this._isMainEvent(i)&&!this._currentTransform){var d=this._pointer;this._previousPointer=d;var y=this._shouldRender(o),_=this._shouldGroup(i,o);if(this._shouldClearSelection(i,o)?this.discardActiveObject(i):_&&(this._handleGrouping(i,o),o=this._activeObject),!this.selection||o&&(o.selectable||o.isEditing||o===this._activeObject)||(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),o){var v=o===this._activeObject;o.selectable&&"down"===o.activeOn&&this.setActiveObject(o,i);var w=o._findTargetCorner(this.getPointer(i,!0),b.util.isTouchEvent(i));if(o.__corner=w,o===this._activeObject&&(w||!_)){this._setupCurrentTransform(i,o,v);var I=o.controls[w],A=(d=this.getPointer(i),I&&I.getMouseDownHandler(i,o,I));A&&A(i,this._currentTransform,d.x,d.y)}}this._handleEvent(i,"down"),(y||_)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(i){this._resetTransformEventData(),this._pointer=this.getPointer(i,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(i)||null},_beforeTransform:function(i){var o=this._currentTransform;this.stateful&&o.target.saveState(),this.fire("before:transform",{e:i,transform:o})},__onMouseMove:function(i){var o,d;if(this._handleEvent(i,"move:before"),this._cacheTransformEventData(i),this.isDrawingMode)this._onMouseMoveInDrawingMode(i);else if(this._isMainEvent(i)){var y=this._groupSelector;y?(y.left=(d=this._absolutePointer).x-y.ex,y.top=d.y-y.ey,this.renderTop()):this._currentTransform?this._transformObject(i):(o=this.findTarget(i)||null,this._setCursorFromEvent(i,o),this._fireOverOutEvents(o,i)),this._handleEvent(i,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(i,o){var d=this._hoveredTarget,y=this._hoveredTargets,_=this.targets,v=Math.max(y.length,_.length);this.fireSyntheticInOutEvents(i,o,{oldTarget:d,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var w=0;w<v;w++)this.fireSyntheticInOutEvents(_[w],o,{oldTarget:y[w],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=i,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(i,o){var d=this._draggedoverTarget,y=this._hoveredTargets,_=this.targets,v=Math.max(y.length,_.length);this.fireSyntheticInOutEvents(i,o,{oldTarget:d,evtOut:"dragleave",evtIn:"dragenter"});for(var w=0;w<v;w++)this.fireSyntheticInOutEvents(_[w],o,{oldTarget:y[w],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=i},fireSyntheticInOutEvents:function(i,o,d){var y,_,v,w=d.oldTarget,I=w!==i,A=d.canvasEvtIn,M=d.canvasEvtOut;I&&(y={e:o,target:i,previousTarget:w},_={e:o,target:w,nextTarget:i}),v=i&&I,w&&I&&(M&&this.fire(M,_),w.fire(d.evtOut,_)),v&&(A&&this.fire(A,y),i.fire(d.evtIn,y))},__onMouseWheel:function(i){this._cacheTransformEventData(i),this._handleEvent(i,"wheel"),this._resetTransformEventData()},_transformObject:function(i){var o=this.getPointer(i),d=this._currentTransform;d.reset=!1,d.shiftKey=i.shiftKey,d.altKey=i[this.centeredKey],this._performTransformAction(i,d,o),d.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(i,o,d){var v=o.action,w=!1,I=o.actionHandler;I&&(w=I(i,o,d.x,d.y)),"drag"===v&&w&&(o.target.isMoving=!0,this.setCursor(o.target.moveCursor||this.moveCursor)),o.actionPerformed=o.actionPerformed||w},_fire:b.controlsUtils.fireEvent,_setCursorFromEvent:function(i,o){if(!o)return this.setCursor(this.defaultCursor),!1;var d=o.hoverCursor||this.hoverCursor,y=this._activeObject&&"activeSelection"===this._activeObject.type?this._activeObject:null,_=(!y||!y.contains(o))&&o._findTargetCorner(this.getPointer(i,!0));_?this.setCursor(this.getCornerCursor(_,o,i)):(o.subTargetCheck&&this.targets.concat().reverse().map(function(v){d=v.hoverCursor||d}),this.setCursor(d))},getCornerCursor:function(i,o,d){var y=o.controls[i];return y.cursorStyleHandler(d,y,o)}})}(),ie=Math.min,J=Math.max,b.util.object.extend(b.Canvas.prototype,{_shouldGroup:function(u,a){var l=this._activeObject;return l&&this._isSelectionKeyPressed(u)&&a&&a.selectable&&this.selection&&(l!==a||"activeSelection"===l.type)&&!a.onSelect({e:u})},_handleGrouping:function(u,a){var l=this._activeObject;l.__corner||(a!==l||(a=this.findTarget(u,!0))&&a.selectable)&&(l&&"activeSelection"===l.type?this._updateActiveSelection(a,u):this._createActiveSelection(a,u))},_updateActiveSelection:function(u,a){var l=this._activeObject,m=l._objects.slice(0);l.contains(u)?(l.removeWithUpdate(u),this._hoveredTarget=u,this._hoveredTargets=this.targets.concat(),1===l.size()&&this._setActiveObject(l.item(0),a)):(l.addWithUpdate(u),this._hoveredTarget=l,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(m,a)},_createActiveSelection:function(u,a){var l=this.getActiveObjects(),m=this._createGroup(u);this._hoveredTarget=m,this._setActiveObject(m,a),this._fireSelectionEvents(l,a)},_createGroup:function(u){var a=this._objects,l=a.indexOf(this._activeObject)<a.indexOf(u)?[this._activeObject,u]:[u,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new b.ActiveSelection(l,{canvas:this})},_groupSelectedObjects:function(u){var a,l=this._collectObjects(u);1===l.length?this.setActiveObject(l[0],u):l.length>1&&(a=new b.ActiveSelection(l.reverse(),{canvas:this}),this.setActiveObject(a,u))},_collectObjects:function(u){for(var a,l=[],m=this._groupSelector.ex,i=this._groupSelector.ey,o=m+this._groupSelector.left,d=i+this._groupSelector.top,y=new b.Point(ie(m,o),ie(i,d)),_=new b.Point(J(m,o),J(i,d)),v=!this.selectionFullyContained,w=m===o&&i===d,I=this._objects.length;I--&&!((a=this._objects[I])&&a.selectable&&a.visible&&(v&&a.intersectsWithRect(y,_,!0)||a.isContainedWithinRect(y,_,!0)||v&&a.containsPoint(y,null,!0)||v&&a.containsPoint(_,null,!0))&&(l.push(a),w)););return l.length>1&&(l=l.filter(function(A){return!A.onSelect({e:u})})),l},_maybeGroupObjects:function(u){this.selection&&this._groupSelector&&this._groupSelectedObjects(u),this.setCursor(this.defaultCursor),this._groupSelector=null}}),b.util.object.extend(b.StaticCanvas.prototype,{toDataURL:function(u){u||(u={});var a=u.format||"png",l=u.quality||1,m=(u.multiplier||1)*(u.enableRetinaScaling?this.getRetinaScaling():1),i=this.toCanvasElement(m,u);return b.util.toDataURL(i,a,l)},toCanvasElement:function(u,a){var l=((a=a||{}).width||this.width)*(u=u||1),m=(a.height||this.height)*u,i=this.getZoom(),o=this.width,d=this.height,y=i*u,_=this.viewportTransform,I=this.interactive,A=[y,0,0,y,(_[4]-(a.left||0))*u,(_[5]-(a.top||0))*u],M=this.enableRetinaScaling,D=b.util.createCanvasElement(),F=this.contextTop;return D.width=l,D.height=m,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=A,this.width=l,this.height=m,this.calcViewportBoundaries(),this.renderCanvas(D.getContext("2d"),this._objects),this.viewportTransform=_,this.width=o,this.height=d,this.calcViewportBoundaries(),this.interactive=I,this.enableRetinaScaling=M,this.contextTop=F,D}}),b.util.object.extend(b.StaticCanvas.prototype,{loadFromJSON:function(u,a,l){if(u){var m="string"==typeof u?JSON.parse(u):b.util.object.clone(u),i=this,o=m.clipPath,d=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete m.clipPath,this._enlivenObjects(m.objects,function(y){i.clear(),i._setBgOverlay(m,function(){o?i._enlivenObjects([o],function(_){i.clipPath=_[0],i.__setupCanvas.call(i,m,y,d,a)}):i.__setupCanvas.call(i,m,y,d,a)})},l),this}},__setupCanvas:function(u,a,l,m){var i=this;a.forEach(function(o,d){i.insertAt(o,d)}),this.renderOnAddRemove=l,delete u.objects,delete u.backgroundImage,delete u.overlayImage,delete u.background,delete u.overlay,this._setOptions(u),this.renderAll(),m&&m()},_setBgOverlay:function(u,a){var l={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(u.backgroundImage||u.overlayImage||u.background||u.overlay){var m=function(){l.backgroundImage&&l.overlayImage&&l.backgroundColor&&l.overlayColor&&a&&a()};this.__setBgOverlay("backgroundImage",u.backgroundImage,l,m),this.__setBgOverlay("overlayImage",u.overlayImage,l,m),this.__setBgOverlay("backgroundColor",u.background,l,m),this.__setBgOverlay("overlayColor",u.overlay,l,m)}else a&&a()},__setBgOverlay:function(u,a,l,m){var i=this;if(!a)return l[u]=!0,void(m&&m());"backgroundImage"===u||"overlayImage"===u?b.util.enlivenObjects([a],function(o){i[u]=o[0],l[u]=!0,m&&m()}):this["set"+b.util.string.capitalize(u,!0)](a,function(){l[u]=!0,m&&m()})},_enlivenObjects:function(u,a,l){u&&0!==u.length?b.util.enlivenObjects(u,function(m){a&&a(m)},null,l):a&&a([])},_toDataURL:function(u,a){this.clone(function(l){a(l.toDataURL(u))})},_toDataURLWithMultiplier:function(u,a,l){this.clone(function(m){l(m.toDataURLWithMultiplier(u,a))})},clone:function(u,a){var l=JSON.stringify(this.toJSON(a));this.cloneWithoutData(function(m){m.loadFromJSON(l,function(){u&&u(m)})})},cloneWithoutData:function(u){var a=b.util.createCanvasElement();a.width=this.width,a.height=this.height;var l=new b.Canvas(a);this.backgroundImage?(l.setBackgroundImage(this.backgroundImage.src,function(){l.renderAll(),u&&u(l)}),l.backgroundImageOpacity=this.backgroundImageOpacity,l.backgroundImageStretch=this.backgroundImageStretch):u&&u(l)}}),function(u){var a=u.fabric||(u.fabric={}),l=a.util.object.extend,m=a.util.object.clone,i=a.util.toFixed,o=a.util.string.capitalize,d=a.util.degreesToRadians;a.Object||(a.Object=a.util.createClass(a.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:!a.isLikelyNode,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(_){_&&this.setOptions(_)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=a.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(_){var v=a.perfLimitSizeTotal,w=_.width,I=_.height,A=a.maxCacheSideLimit,M=a.minCacheSideLimit;if(w<=A&&I<=A&&w*I<=v)return w<M&&(_.width=M),I<M&&(_.height=M),_;var F=a.util.limitDimsByArea(w/I,v),B=a.util.capValue,z=B(M,F.x,A),K=B(M,F.y,A);return w>z&&(_.zoomX/=w/z,_.width=z,_.capped=!0),I>K&&(_.zoomY/=I/K,_.height=K,_.capped=!0),_},_getCacheCanvasDimensions:function(){var _=this.getTotalObjectScaling(),v=this._getTransformedDimensions(0,0),w=v.x*_.scaleX/this.scaleX,I=v.y*_.scaleY/this.scaleY;return{width:w+2,height:I+2,zoomX:_.scaleX,zoomY:_.scaleY,x:w,y:I}},_updateCacheCanvas:function(){var _=this.canvas;if(this.noScaleCache&&_&&_._currentTransform){var w=_._currentTransform.action;if(this===_._currentTransform.target&&w.slice&&"scale"===w.slice(0,5))return!1}var I,A,M=this._cacheCanvas,D=this._limitCacheSize(this._getCacheCanvasDimensions()),F=a.minCacheSideLimit,B=D.width,z=D.height,K=D.zoomX,oe=D.zoomY,ne=B!==this.cacheWidth||z!==this.cacheHeight,G=ne||this.zoomX!==K||this.zoomY!==oe,j=0,Q=0,se=!1;if(ne){var ae=this._cacheCanvas.width,Y=this._cacheCanvas.height,V=B>ae||z>Y;se=V||(B<.9*ae||z<.9*Y)&&ae>F&&Y>F,V&&!D.capped&&(B>F||z>F)&&(j=.1*B,Q=.1*z)}return this instanceof a.Text&&this.path&&(G=!0,se=!0,j+=this.getHeightOfLine(0)*this.zoomX,Q+=this.getHeightOfLine(0)*this.zoomY),!!G&&(se?(M.width=Math.ceil(B+j),M.height=Math.ceil(z+Q)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,M.width,M.height)),I=D.x/2,A=D.y/2,this.cacheTranslationX=Math.round(M.width/2-I)+I,this.cacheTranslationY=Math.round(M.height/2-A)+A,this.cacheWidth=B,this.cacheHeight=z,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(K,oe),this.zoomX=K,this.zoomY=oe,!0)},setOptions:function(_){this._setOptions(_),this._initGradient(_.fill,"fill"),this._initGradient(_.stroke,"stroke"),this._initPattern(_.fill,"fill"),this._initPattern(_.stroke,"stroke")},transform:function(_){var w=this.calcTransformMatrix(!(this.group&&!this.group._transformDone||this.group&&this.canvas&&_===this.canvas.contextTop));_.transform(w[0],w[1],w[2],w[3],w[4],w[5])},toObject:function(_){var v=a.Object.NUM_FRACTION_DIGITS,w={type:this.type,version:a.version,originX:this.originX,originY:this.originY,left:i(this.left,v),top:i(this.top,v),width:i(this.width,v),height:i(this.height,v),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:i(this.strokeWidth,v),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:i(this.strokeMiterLimit,v),scaleX:i(this.scaleX,v),scaleY:i(this.scaleY,v),angle:i(this.angle,v),flipX:this.flipX,flipY:this.flipY,opacity:i(this.opacity,v),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:i(this.skewX,v),skewY:i(this.skewY,v)};return this.clipPath&&!this.clipPath.excludeFromExport&&(w.clipPath=this.clipPath.toObject(_),w.clipPath.inverted=this.clipPath.inverted,w.clipPath.absolutePositioned=this.clipPath.absolutePositioned),a.util.populateWithProperties(this,w,_),this.includeDefaultValues||(w=this._removeDefaultValues(w)),w},toDatalessObject:function(_){return this.toObject(_)},_removeDefaultValues:function(_){var v=a.util.getKlass(_.type).prototype;return v.stateProperties.forEach(function(w){"left"!==w&&"top"!==w&&(_[w]===v[w]&&delete _[w],Array.isArray(_[w])&&Array.isArray(v[w])&&0===_[w].length&&0===v[w].length&&delete _[w])}),_},toString:function(){return"#<fabric."+o(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var _=a.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(_.scaleX),scaleY:Math.abs(_.scaleY)}},getTotalObjectScaling:function(){var _=this.getObjectScaling(),v=_.scaleX,w=_.scaleY;if(this.canvas){var I=this.canvas.getZoom(),A=this.canvas.getRetinaScaling();v*=I*A,w*=I*A}return{scaleX:v,scaleY:w}},getObjectOpacity:function(){var _=this.opacity;return this.group&&(_*=this.group.getObjectOpacity()),_},_set:function(_,v){var I=this[_]!==v,A=!1;return("scaleX"===_||"scaleY"===_)&&(v=this._constrainScale(v)),"scaleX"===_&&v<0?(this.flipX=!this.flipX,v*=-1):"scaleY"===_&&v<0?(this.flipY=!this.flipY,v*=-1):"shadow"!==_||!v||v instanceof a.Shadow?"dirty"===_&&this.group&&this.group.set("dirty",v):v=new a.Shadow(v),this[_]=v,I&&(A=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(_)>-1?(this.dirty=!0,A&&this.group.set("dirty",!0)):A&&this.stateProperties.indexOf(_)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:a.iMatrix.concat()},isNotVisible:function(){return 0===this.opacity||!this.width&&!this.height&&0===this.strokeWidth||!this.visible},render:function(_){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(_.save(),this._setupCompositeOperation(_),this.drawSelectionBackground(_),this.transform(_),this._setOpacity(_),this._setShadow(_,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(_)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(_),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),_.restore())},renderCache:function(_){_=_||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,_.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&"transparent"!==this.stroke&&0!==this.strokeWidth},hasFill:function(){return this.fill&&"transparent"!==this.fill},needsItsOwnCache:function(){return!("stroke"!==this.paintFirst||!this.hasFill()||!this.hasStroke()||"object"!=typeof this.shadow)||!!this.clipPath},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY)},drawClipPathOnCache:function(_,v){if(_.save(),_.globalCompositeOperation=v.inverted?"destination-out":"destination-in",v.absolutePositioned){var w=a.util.invertTransform(this.calcTransformMatrix());_.transform(w[0],w[1],w[2],w[3],w[4],w[5])}v.transform(_),_.scale(1/v.zoomX,1/v.zoomY),_.drawImage(v._cacheCanvas,-v.cacheTranslationX,-v.cacheTranslationY),_.restore()},drawObject:function(_,v){var w=this.fill,I=this.stroke;v?(this.fill="black",this.stroke="",this._setClippingProperties(_)):this._renderBackground(_),this._render(_),this._drawClipPath(_,this.clipPath),this.fill=w,this.stroke=I},_drawClipPath:function(_,v){v&&(v.canvas=this.canvas,v.shouldCache(),v._transformDone=!0,v.renderCache({forClipping:!0}),this.drawClipPathOnCache(_,v))},drawCacheOnCanvas:function(_){_.scale(1/this.zoomX,1/this.zoomY),_.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(_){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!_&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!_){var v=this.cacheWidth/this.zoomX,w=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-v/2,-w/2,v,w)}return!0}return!1},_renderBackground:function(_){if(this.backgroundColor){var v=this._getNonTransformedDimensions();_.fillStyle=this.backgroundColor,_.fillRect(-v.x/2,-v.y/2,v.x,v.y),this._removeShadow(_)}},_setOpacity:function(_){this.group&&!this.group._transformDone?_.globalAlpha=this.getObjectOpacity():_.globalAlpha*=this.opacity},_setStrokeStyles:function(_,v){var w=v.stroke;w&&(_.lineWidth=v.strokeWidth,_.lineCap=v.strokeLineCap,_.lineDashOffset=v.strokeDashOffset,_.lineJoin=v.strokeLineJoin,_.miterLimit=v.strokeMiterLimit,w.toLive?"percentage"===w.gradientUnits||w.gradientTransform||w.patternTransform?this._applyPatternForTransformedGradient(_,w):(_.strokeStyle=w.toLive(_,this),this._applyPatternGradientTransform(_,w)):_.strokeStyle=v.stroke)},_setFillStyles:function(_,v){var w=v.fill;w&&(w.toLive?(_.fillStyle=w.toLive(_,this),this._applyPatternGradientTransform(_,v.fill)):_.fillStyle=w)},_setClippingProperties:function(_){_.globalAlpha=1,_.strokeStyle="transparent",_.fillStyle="#000000"},_setLineDash:function(_,v){v&&0!==v.length&&(1&v.length&&v.push.apply(v,v),_.setLineDash(v))},_renderControls:function(_,v){var w,I,A,M=this.getViewportTransform(),D=this.calcTransformMatrix();I=void 0!==(v=v||{}).hasBorders?v.hasBorders:this.hasBorders,A=void 0!==v.hasControls?v.hasControls:this.hasControls,D=a.util.multiplyTransformMatrices(M,D),w=a.util.qrDecompose(D),_.save(),_.translate(w.translateX,w.translateY),_.lineWidth=1*this.borderScaleFactor,this.group||(_.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(w.angle-=180),_.rotate(d(this.group?w.angle:this.angle)),v.forActiveSelection||this.group?I&&this.drawBordersInGroup(_,w,v):I&&this.drawBorders(_,v),A&&this.drawControls(_,v),_.restore()},_setShadow:function(_){if(this.shadow){var v,w=this.shadow,I=this.canvas,A=I&&I.viewportTransform[0]||1,M=I&&I.viewportTransform[3]||1;v=w.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),I&&I._isRetinaScaling()&&(A*=a.devicePixelRatio,M*=a.devicePixelRatio),_.shadowColor=w.color,_.shadowBlur=w.blur*a.browserShadowBlurConstant*(A+M)*(v.scaleX+v.scaleY)/4,_.shadowOffsetX=w.offsetX*A*v.scaleX,_.shadowOffsetY=w.offsetY*M*v.scaleY}},_removeShadow:function(_){this.shadow&&(_.shadowColor="",_.shadowBlur=_.shadowOffsetX=_.shadowOffsetY=0)},_applyPatternGradientTransform:function(_,v){if(!v||!v.toLive)return{offsetX:0,offsetY:0};var w=v.gradientTransform||v.patternTransform,I=-this.width/2+v.offsetX||0,A=-this.height/2+v.offsetY||0;return"percentage"===v.gradientUnits?_.transform(this.width,0,0,this.height,I,A):_.transform(1,0,0,1,I,A),w&&_.transform(w[0],w[1],w[2],w[3],w[4],w[5]),{offsetX:I,offsetY:A}},_renderPaintInOrder:function(_){"stroke"===this.paintFirst?(this._renderStroke(_),this._renderFill(_)):(this._renderFill(_),this._renderStroke(_))},_render:function(){},_renderFill:function(_){this.fill&&(_.save(),this._setFillStyles(_,this),"evenodd"===this.fillRule?_.fill("evenodd"):_.fill(),_.restore())},_renderStroke:function(_){if(this.stroke&&0!==this.strokeWidth){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(_),_.save(),this.strokeUniform&&this.group){var v=this.getObjectScaling();_.scale(1/v.scaleX,1/v.scaleY)}else this.strokeUniform&&_.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(_,this.strokeDashArray),this._setStrokeStyles(_,this),_.stroke(),_.restore()}},_applyPatternForTransformedGradient:function(_,v){var w,I=this._limitCacheSize(this._getCacheCanvasDimensions()),A=a.util.createCanvasElement(),M=this.canvas.getRetinaScaling(),D=I.x/this.scaleX/M,F=I.y/this.scaleY/M;A.width=D,A.height=F,(w=A.getContext("2d")).beginPath(),w.moveTo(0,0),w.lineTo(D,0),w.lineTo(D,F),w.lineTo(0,F),w.closePath(),w.translate(D/2,F/2),w.scale(I.zoomX/this.scaleX/M,I.zoomY/this.scaleY/M),this._applyPatternGradientTransform(w,v),w.fillStyle=v.toLive(_),w.fill(),_.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),_.scale(M*this.scaleX/I.zoomX,M*this.scaleY/I.zoomY),_.strokeStyle=w.createPattern(A,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var _=a.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",_.scaleX),this.set("scaleY",_.scaleY),this.angle=_.angle,this.skewX=_.skewX,this.skewY=0}},_removeTransformMatrix:function(_){var v=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),v=a.util.transformPoint(v,this.transformMatrix)),this.transformMatrix=null,_&&(this.scaleX*=_.scaleX,this.scaleY*=_.scaleY,this.cropX=_.cropX,this.cropY=_.cropY,v.x+=_.offsetLeft,v.y+=_.offsetTop,this.width=_.width,this.height=_.height),this.setPositionByOrigin(v,"center","center")},clone:function(_,v){var w=this.toObject(v);this.constructor.fromObject?this.constructor.fromObject(w,_):a.Object._fromObject("Object",w,_)},cloneAsImage:function(_,v){var w=this.toCanvasElement(v);return _&&_(new a.Image(w)),this},toCanvasElement:function(_){_||(_={});var v=a.util,w=v.saveObjectTransform(this),I=this.group,A=this.shadow,M=Math.abs,D=(_.multiplier||1)*(_.enableRetinaScaling?a.devicePixelRatio:1);delete this.group,_.withoutTransform&&v.resetObjectTransform(this),_.withoutShadow&&(this.shadow=null);var F,B,K,oe=a.util.createCanvasElement(),ne=this.getBoundingRect(!0,!0),ee=this.shadow,G={x:0,y:0};ee&&(B=ee.blur,F=ee.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),G.x=2*Math.round(M(ee.offsetX)+B)*M(F.scaleX),G.y=2*Math.round(M(ee.offsetY)+B)*M(F.scaleY)),K=ne.height+G.y,oe.width=Math.ceil(ne.width+G.x),oe.height=Math.ceil(K);var j=new a.StaticCanvas(oe,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});"jpeg"===_.format&&(j.backgroundColor="#fff"),this.setPositionByOrigin(new a.Point(j.width/2,j.height/2),"center","center");var Q=this.canvas;j.add(this);var se=j.toCanvasElement(D||1,_);return this.shadow=A,this.set("canvas",Q),I&&(this.group=I),this.set(w).setCoords(),j._objects=[],j.dispose(),j=null,se},toDataURL:function(_){return _||(_={}),a.util.toDataURL(this.toCanvasElement(_),_.format||"png",_.quality||1)},isType:function(_){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===_},complexity:function(){return 1},toJSON:function(_){return this.toObject(_)},rotate:function(_){var v=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;return v&&this._setOriginToCenter(),this.set("angle",_),v&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(_,v){v=v||this.canvas.getPointer(_);var w=new a.Point(v.x,v.y),I=this._getLeftTopCoords();return this.angle&&(w=a.util.rotatePoint(w,I,d(-this.angle))),{x:w.x-I.x,y:w.y-I.y}},_setupCompositeOperation:function(_){this.globalCompositeOperation&&(_.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){a.runningAnimations&&a.runningAnimations.cancelByTarget(this)}}),a.util.createAccessors&&a.util.createAccessors(a.Object),l(a.Object.prototype,a.Observable),a.Object.NUM_FRACTION_DIGITS=2,a.Object.ENLIVEN_PROPS=["clipPath"],a.Object._fromObject=function(_,v,w,I){var A=a[_];v=m(v,!0),a.util.enlivenPatterns([v.fill,v.stroke],function(M){void 0!==M[0]&&(v.fill=M[0]),void 0!==M[1]&&(v.stroke=M[1]),a.util.enlivenObjectEnlivables(v,v,function(){var D=I?new A(v[I],v):new A(v);w&&w(D)})})},a.Object.__uid=0)}(t),Ee=b.util.degreesToRadians,_e={left:-.5,center:0,right:.5},xe={top:-.5,center:0,bottom:.5},b.util.object.extend(b.Object.prototype,{translateToGivenOrigin:function(u,a,l,m,i){var o,d,y,_=u.x,v=u.y;return"string"==typeof a?a=_e[a]:a-=.5,"string"==typeof m?m=_e[m]:m-=.5,"string"==typeof l?l=xe[l]:l-=.5,"string"==typeof i?i=xe[i]:i-=.5,d=i-l,((o=m-a)||d)&&(y=this._getTransformedDimensions(),_=u.x+o*y.x,v=u.y+d*y.y),new b.Point(_,v)},translateToCenterPoint:function(u,a,l){var m=this.translateToGivenOrigin(u,a,l,"center","center");return this.angle?b.util.rotatePoint(m,u,Ee(this.angle)):m},translateToOriginPoint:function(u,a,l){var m=this.translateToGivenOrigin(u,"center","center",a,l);return this.angle?b.util.rotatePoint(m,u,Ee(this.angle)):m},getCenterPoint:function(){var u=new b.Point(this.left,this.top);return this.translateToCenterPoint(u,this.originX,this.originY)},getPointByOrigin:function(u,a){var l=this.getCenterPoint();return this.translateToOriginPoint(l,u,a)},toLocalPoint:function(u,a,l){var m,i,o=this.getCenterPoint();return m=void 0!==a&&void 0!==l?this.translateToGivenOrigin(o,"center","center",a,l):new b.Point(this.left,this.top),i=new b.Point(u.x,u.y),this.angle&&(i=b.util.rotatePoint(i,o,-Ee(this.angle))),i.subtractEquals(m)},setPositionByOrigin:function(u,a,l){var m=this.translateToCenterPoint(u,a,l),i=this.translateToOriginPoint(m,this.originX,this.originY);this.set("left",i.x),this.set("top",i.y)},adjustPosition:function(u){var a,l,m=Ee(this.angle),i=this.getScaledWidth(),o=b.util.cos(m)*i,d=b.util.sin(m)*i;this.left+=o*((l="string"==typeof u?_e[u]:u-.5)-(a="string"==typeof this.originX?_e[this.originX]:this.originX-.5)),this.top+=d*(l-a),this.setCoords(),this.originX=u},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var u=this.getCenterPoint();this.originX="center",this.originY="center",this.left=u.x,this.top=u.y},_resetOrigin:function(){var u=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=u.x,this.top=u.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}}),function(){var u=b.util,a=u.degreesToRadians,l=u.multiplyTransformMatrices,m=u.transformPoint;u.object.extend(b.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(i,o){return o?i?this.calcACoords():this.calcLineCoords():(this.aCoords&&this.lineCoords||this.setCoords(!0),i?this.aCoords:this.lineCoords)},getCoords:function(i,o){return d=this._getCoords(i,o),[new b.Point(d.tl.x,d.tl.y),new b.Point(d.tr.x,d.tr.y),new b.Point(d.br.x,d.br.y),new b.Point(d.bl.x,d.bl.y)];var d},intersectsWithRect:function(i,o,d,y){var _=this.getCoords(d,y);return"Intersection"===b.Intersection.intersectPolygonRectangle(_,i,o).status},intersectsWithObject:function(i,o,d){return"Intersection"===b.Intersection.intersectPolygonPolygon(this.getCoords(o,d),i.getCoords(o,d)).status||i.isContainedWithinObject(this,o,d)||this.isContainedWithinObject(i,o,d)},isContainedWithinObject:function(i,o,d){for(var y=this.getCoords(o,d),v=0,w=i._getImageLines(o?i.aCoords:i.lineCoords);v<4;v++)if(!i.containsPoint(y[v],w))return!1;return!0},isContainedWithinRect:function(i,o,d,y){var _=this.getBoundingRect(d,y);return _.left>=i.x&&_.left+_.width<=o.x&&_.top>=i.y&&_.top+_.height<=o.y},containsPoint:function(i,o,d,y){var _=this._getCoords(d,y),v=(o=o||this._getImageLines(_),this._findCrossPoints(i,o));return 0!==v&&v%2==1},isOnScreen:function(i){if(!this.canvas)return!1;var o=this.canvas.vptCoords.tl,d=this.canvas.vptCoords.br;return!!this.getCoords(!0,i).some(function(y){return y.x<=d.x&&y.x>=o.x&&y.y<=d.y&&y.y>=o.y})||!!this.intersectsWithRect(o,d,!0,i)||this._containsCenterOfCanvas(o,d,i)},_containsCenterOfCanvas:function(i,o,d){return!!this.containsPoint({x:(i.x+o.x)/2,y:(i.y+o.y)/2},null,!0,d)},isPartiallyOnScreen:function(i){if(!this.canvas)return!1;var o=this.canvas.vptCoords.tl,d=this.canvas.vptCoords.br;return!!this.intersectsWithRect(o,d,!0,i)||this.getCoords(!0,i).every(function(y){return(y.x>=d.x||y.x<=o.x)&&(y.y>=d.y||y.y<=o.y)})&&this._containsCenterOfCanvas(o,d,i)},_getImageLines:function(i){return{topline:{o:i.tl,d:i.tr},rightline:{o:i.tr,d:i.br},bottomline:{o:i.br,d:i.bl},leftline:{o:i.bl,d:i.tl}}},_findCrossPoints:function(i,o){var d,y,_,v=0;for(var w in o)if(!((_=o[w]).o.y<i.y&&_.d.y<i.y||_.o.y>=i.y&&_.d.y>=i.y||(_.o.x===_.d.x&&_.o.x>=i.x?y=_.o.x:(d=(_.d.y-_.o.y)/(_.d.x-_.o.x),y=-(i.y-0*i.x-(_.o.y-d*_.o.x))/(0-d)),y>=i.x&&(v+=1),2!==v)))break;return v},getBoundingRect:function(i,o){var d=this.getCoords(i,o);return u.makeBoundingBoxFromPoints(d)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(i){return Math.abs(i)<this.minScaleLimit?i<0?-this.minScaleLimit:this.minScaleLimit:0===i?1e-4:i},scale:function(i){return this._set("scaleX",i),this._set("scaleY",i),this.setCoords()},scaleToWidth:function(i,o){var d=this.getBoundingRect(o).width/this.getScaledWidth();return this.scale(i/this.width/d)},scaleToHeight:function(i,o){var d=this.getBoundingRect(o).height/this.getScaledHeight();return this.scale(i/this.height/d)},calcLineCoords:function(){var i=this.getViewportTransform(),o=this.padding,d=a(this.angle),y=u.cos(d)*o,_=u.sin(d)*o,v=y+_,w=y-_,I=this.calcACoords(),A={tl:m(I.tl,i),tr:m(I.tr,i),bl:m(I.bl,i),br:m(I.br,i)};return o&&(A.tl.x-=w,A.tl.y-=v,A.tr.x+=v,A.tr.y-=w,A.bl.x-=v,A.bl.y+=w,A.br.x+=w,A.br.y+=v),A},calcOCoords:function(){var i=this._calcRotateMatrix(),o=this._calcTranslateMatrix(),d=this.getViewportTransform(),y=l(d,o),_=l(y,i),v=(_=l(_,[1/d[0],0,0,1/d[3],0,0]),this._calculateCurrentDimensions()),w={};return this.forEachControl(function(I,A,M){w[A]=I.positionHandler(v,_,M)}),w},calcACoords:function(){var i=this._calcRotateMatrix(),o=this._calcTranslateMatrix(),d=l(o,i),y=this._getTransformedDimensions(),_=y.x/2,v=y.y/2;return{tl:m({x:-_,y:-v},d),tr:m({x:_,y:-v},d),bl:m({x:-_,y:v},d),br:m({x:_,y:v},d)}},setCoords:function(i){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),i||(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords()),this},_calcRotateMatrix:function(){return u.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var i=this.getCenterPoint();return[1,0,0,1,i.x,i.y]},transformMatrixKey:function(i){var o="_",d="";return!i&&this.group&&(d=this.group.transformMatrixKey(i)+o),d+this.top+o+this.left+o+this.scaleX+o+this.scaleY+o+this.skewX+o+this.skewY+o+this.angle+o+this.originX+o+this.originY+o+this.width+o+this.height+o+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(i){var o=this.calcOwnMatrix();if(i||!this.group)return o;var d=this.transformMatrixKey(i),y=this.matrixCache||(this.matrixCache={});return y.key===d?y.value:(this.group&&(o=l(this.group.calcTransformMatrix(!1),o)),y.key=d,y.value=o,o)},calcOwnMatrix:function(){var i=this.transformMatrixKey(!0),o=this.ownMatrixCache||(this.ownMatrixCache={});if(o.key===i)return o.value;var d=this._calcTranslateMatrix(),y={angle:this.angle,translateX:d[4],translateY:d[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return o.key=i,o.value=u.composeMatrix(y),o.value},_getNonTransformedDimensions:function(){var i=this.strokeWidth;return{x:this.width+i,y:this.height+i}},_getTransformedDimensions:function(i,o){void 0===i&&(i=this.skewX),void 0===o&&(o=this.skewY);var d,y,_,v=0===i&&0===o;if(this.strokeUniform?(y=this.width,_=this.height):(y=(d=this._getNonTransformedDimensions()).x,_=d.y),v)return this._finalizeDimensions(y*this.scaleX,_*this.scaleY);var w=u.sizeAfterTransform(y,_,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:i,skewY:o});return this._finalizeDimensions(w.x,w.y)},_finalizeDimensions:function(i,o){return this.strokeUniform?{x:i+this.strokeWidth,y:o+this.strokeWidth}:{x:i,y:o}},_calculateCurrentDimensions:function(){var i=this.getViewportTransform(),o=this._getTransformedDimensions();return m(o,i,!0).scalarAdd(2*this.padding)}})}(),b.util.object.extend(b.Object.prototype,{sendToBack:function(){return this.group?b.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?b.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(u){return this.group?b.StaticCanvas.prototype.sendBackwards.call(this.group,this,u):this.canvas&&this.canvas.sendBackwards(this,u),this},bringForward:function(u){return this.group?b.StaticCanvas.prototype.bringForward.call(this.group,this,u):this.canvas&&this.canvas.bringForward(this,u),this},moveTo:function(u){return this.group&&"activeSelection"!==this.group.type?b.StaticCanvas.prototype.moveTo.call(this.group,this,u):this.canvas&&this.canvas.moveTo(this,u),this}}),function(){function u(l,m){if(m){if(m.toLive)return l+": url(#SVGID_"+m.id+"); ";var i=new b.Color(m),o=l+": "+i.toRgb()+"; ",d=i.getAlpha();return 1!==d&&(o+=l+"-opacity: "+d.toString()+"; "),o}return l+": none; "}var a=b.util.toFixed;b.util.object.extend(b.Object.prototype,{getSvgStyles:function(l){var m=this.fillRule?this.fillRule:"nonzero",i=this.strokeWidth?this.strokeWidth:"0",o=this.strokeDashArray?this.strokeDashArray.join(" "):"none",d=this.strokeDashOffset?this.strokeDashOffset:"0",y=this.strokeLineCap?this.strokeLineCap:"butt",_=this.strokeLineJoin?this.strokeLineJoin:"miter",v=this.strokeMiterLimit?this.strokeMiterLimit:"4",w=void 0!==this.opacity?this.opacity:"1",I=this.visible?"":" visibility: hidden;",A=l?"":this.getSvgFilter(),M=u("fill",this.fill);return[u("stroke",this.stroke),"stroke-width: ",i,"; ","stroke-dasharray: ",o,"; ","stroke-linecap: ",y,"; ","stroke-dashoffset: ",d,"; ","stroke-linejoin: ",_,"; ","stroke-miterlimit: ",v,"; ",M,"fill-rule: ",m,"; ","opacity: ",w,";",A,I].join("")},getSvgSpanStyles:function(l,m){var i="; ",o=l.fontFamily?"font-family: "+(-1===l.fontFamily.indexOf("'")&&-1===l.fontFamily.indexOf('"')?"'"+l.fontFamily+"'":l.fontFamily)+i:"",d=l.strokeWidth?"stroke-width: "+l.strokeWidth+i:"",y=l.fontSize?"font-size: "+l.fontSize+"px"+i:"",_=l.fontStyle?"font-style: "+l.fontStyle+i:"",v=l.fontWeight?"font-weight: "+l.fontWeight+i:"",w=l.fill?u("fill",l.fill):"",I=l.stroke?u("stroke",l.stroke):"",A=this.getSvgTextDecoration(l);return A&&(A="text-decoration: "+A+i),[I,d,o,y,_,v,A,w,l.deltaY?"baseline-shift: "+-l.deltaY+"; ":"",m?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(l){return["overline","underline","line-through"].filter(function(m){return l[m.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(l,m){var i=l?this.calcTransformMatrix():this.calcOwnMatrix();return'transform="'+b.util.matrixToSVG(i)+(m||"")+'" '},_setSVGBg:function(l){if(this.backgroundColor){var m=b.Object.NUM_FRACTION_DIGITS;l.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',a(-this.width/2,m),'" y="',a(-this.height/2,m),'" width="',a(this.width,m),'" height="',a(this.height,m),'"></rect>\n')}},toSVG:function(l){return this._createBaseSVGMarkup(this._toSVG(l),{reviver:l})},toClipPathSVG:function(l){return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(l),{reviver:l})},_createBaseClipPathSVGMarkup:function(l,m){var i=(m=m||{}).reviver,d=[this.getSvgTransform(!0,m.additionalTransform||""),this.getSvgCommons()].join(""),y=l.indexOf("COMMON_PARTS");return l[y]=d,i?i(l.join("")):l.join("")},_createBaseSVGMarkup:function(l,m){var i,o,d=(m=m||{}).noStyle,y=m.reviver,_=d?"":'style="'+this.getSvgStyles()+'" ',v=m.withShadow?'style="'+this.getSvgFilter()+'" ':"",w=this.clipPath,I=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",A=w&&w.absolutePositioned,M=this.stroke,D=this.fill,F=this.shadow,B=[],z=l.indexOf("COMMON_PARTS"),K=m.additionalTransform;return w&&(w.clipPathId="CLIPPATH_"+b.Object.__uid++,o='<clipPath id="'+w.clipPathId+'" >\n'+w.toClipPathSVG(y)+"</clipPath>\n"),A&&B.push("<g ",v,this.getSvgCommons()," >\n"),B.push("<g ",this.getSvgTransform(!1),A?"":v+this.getSvgCommons()," >\n"),i=[_,I,d?"":this.addPaintOrder()," ",K?'transform="'+K+'" ':""].join(""),l[z]=i,D&&D.toLive&&B.push(D.toSVG(this)),M&&M.toLive&&B.push(M.toSVG(this)),F&&B.push(F.toSVG(this)),w&&B.push(o),B.push(l.join("")),B.push("</g>\n"),A&&B.push("</g>\n"),y?y(B.join("")):B.join("")},addPaintOrder:function(){return"fill"!==this.paintFirst?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var u=b.util.object.extend,a="stateProperties";function l(i,o,d){var y={};d.forEach(function(_){y[_]=i[_]}),u(i[o],y,!0)}function m(i,o,d){if(i===o)return!0;if(Array.isArray(i)){if(!Array.isArray(o)||i.length!==o.length)return!1;for(var y=0,_=i.length;y<_;y++)if(!m(i[y],o[y]))return!1;return!0}if(i&&"object"==typeof i){var v,w=Object.keys(i);if(!o||"object"!=typeof o||!d&&w.length!==Object.keys(o).length)return!1;for(y=0,_=w.length;y<_;y++)if("canvas"!==(v=w[y])&&"group"!==v&&!m(i[v],o[v]))return!1;return!0}}b.util.object.extend(b.Object.prototype,{hasStateChanged:function(i){var o="_"+(i=i||a);return Object.keys(this[o]).length<this[i].length||!m(this[o],this,!0)},saveState:function(i){var o=i&&i.propertySet||a,d="_"+o;return this[d]?(l(this,d,this[o]),i&&i.stateProperties&&l(this,d,i.stateProperties),this):this.setupState(i)},setupState:function(i){var o=(i=i||{}).propertySet||a;return i.propertySet=o,this["_"+o]={},this.saveState(i),this}})}(),function(){var u=b.util.degreesToRadians;b.util.object.extend(b.Object.prototype,{_findTargetCorner:function(a,l){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var m,i,o,d=a.x,y=a.y,_=Object.keys(this.oCoords),v=_.length-1;for(this.__corner=0;v>=0;v--)if(this.isControlVisible(o=_[v])&&(i=this._getImageLines(l?this.oCoords[o].touchCorner:this.oCoords[o].corner),0!==(m=this._findCrossPoints({x:d,y},i))&&m%2==1))return this.__corner=o,o;return!1},forEachControl:function(a){for(var l in this.controls)a(this.controls[l],l,this)},_setCornerCoords:function(){var a=this.oCoords;for(var l in a){var m=this.controls[l];a[l].corner=m.calcCornerCoords(this.angle,this.cornerSize,a[l].x,a[l].y,!1),a[l].touchCorner=m.calcCornerCoords(this.angle,this.touchCornerSize,a[l].x,a[l].y,!0)}},drawSelectionBackground:function(a){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;a.save();var l=this.getCenterPoint(),m=this._calculateCurrentDimensions(),i=this.canvas.viewportTransform;return a.translate(l.x,l.y),a.scale(1/i[0],1/i[3]),a.rotate(u(this.angle)),a.fillStyle=this.selectionBackgroundColor,a.fillRect(-m.x/2,-m.y/2,m.x,m.y),a.restore(),this},drawBorders:function(a,l){l=l||{};var m=this._calculateCurrentDimensions(),i=this.borderScaleFactor,o=m.x+i,d=m.y+i,y=void 0!==l.hasControls?l.hasControls:this.hasControls,_=!1;return a.save(),a.strokeStyle=l.borderColor||this.borderColor,this._setLineDash(a,l.borderDashArray||this.borderDashArray),a.strokeRect(-o/2,-d/2,o,d),y&&(a.beginPath(),this.forEachControl(function(v,w,I){v.withConnection&&v.getVisibility(I,w)&&(_=!0,a.moveTo(v.x*o,v.y*d),a.lineTo(v.x*o+v.offsetX,v.y*d+v.offsetY))}),_&&a.stroke()),a.restore(),this},drawBordersInGroup:function(a,l,m){m=m||{};var i=b.util.sizeAfterTransform(this.width,this.height,l),o=this.strokeWidth,d=this.strokeUniform,y=this.borderScaleFactor,_=i.x+o*(d?this.canvas.getZoom():l.scaleX)+y,v=i.y+o*(d?this.canvas.getZoom():l.scaleY)+y;return a.save(),this._setLineDash(a,m.borderDashArray||this.borderDashArray),a.strokeStyle=m.borderColor||this.borderColor,a.strokeRect(-_/2,-v/2,_,v),a.restore(),this},drawControls:function(a,l){l=l||{},a.save();var m,i,o=this.canvas.getRetinaScaling();return a.setTransform(o,0,0,o,0,0),a.strokeStyle=a.fillStyle=l.cornerColor||this.cornerColor,this.transparentCorners||(a.strokeStyle=l.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(a,l.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(m=this.group.calcTransformMatrix()),this.forEachControl(function(d,y,_){i=_.oCoords[y],d.getVisibility(_,y)&&(m&&(i=b.util.transformPoint(i,m)),d.render(a,i.x,i.y,l,_))}),a.restore(),this},isControlVisible:function(a){return this.controls[a]&&this.controls[a].getVisibility(this,a)},setControlVisible:function(a,l){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[a]=l,this},setControlsVisibility:function(a){for(var l in a||(a={}),a)this.setControlVisible(l,a[l]);return this},onDeselect:function(){},onSelect:function(){}})}(),b.util.object.extend(b.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(u,a){var l=function(){},m=(a=a||{}).onComplete||l,i=a.onChange||l,o=this;return b.util.animate({target:this,startValue:u.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(d){u.set("left",d),o.requestRenderAll(),i()},onComplete:function(){u.setCoords(),m()}})},fxCenterObjectV:function(u,a){var l=function(){},m=(a=a||{}).onComplete||l,i=a.onChange||l,o=this;return b.util.animate({target:this,startValue:u.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(d){u.set("top",d),o.requestRenderAll(),i()},onComplete:function(){u.setCoords(),m()}})},fxRemove:function(u,a){var l=function(){},m=(a=a||{}).onComplete||l,i=a.onChange||l,o=this;return b.util.animate({target:this,startValue:u.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(d){u.set("opacity",d),o.requestRenderAll(),i()},onComplete:function(){o.remove(u),m()}})}}),b.util.object.extend(b.Object.prototype,{animate:function(){if(arguments[0]&&"object"==typeof arguments[0]){var u,l=[],m=[];for(u in arguments[0])l.push(u);for(var i=0,o=l.length;i<o;i++)m.push(this._animate(u=l[i],arguments[0][u],arguments[1],i!==o-1));return m}return this._animate.apply(this,arguments)},_animate:function(u,a,l,m){var i,o=this;a=a.toString(),l=l?b.util.object.clone(l):{},~u.indexOf(".")&&(i=u.split("."));var d=o.colorProperties.indexOf(u)>-1||i&&o.colorProperties.indexOf(i[1])>-1,y=i?this.get(i[0])[i[1]]:this.get(u);"from"in l||(l.from=y),d||(a=~a.indexOf("=")?y+parseFloat(a.replace("=","")):parseFloat(a));var _={target:this,startValue:l.from,endValue:a,byValue:l.by,easing:l.easing,duration:l.duration,abort:l.abort&&function(v,w,I){return l.abort.call(o,v,w,I)},onChange:function(v,w,I){i?o[i[0]][i[1]]=v:o.set(u,v),m||l.onChange&&l.onChange(v,w,I)},onComplete:function(v,w,I){m||(o.setCoords(),l.onComplete&&l.onComplete(v,w,I))}};return d?b.util.animateColor(_.startValue,_.endValue,_.duration,_):b.util.animate(_)}}),function(u){var a=u.fabric||(u.fabric={}),l=a.util.object.extend,m=a.util.object.clone,i={x1:1,x2:1,y1:1,y2:1};function o(d,y){var _=d.origin,v=d.axis1,w=d.axis2,I=d.dimension,A=y.nearest,M=y.center,D=y.farthest;return function(){switch(this.get(_)){case A:return Math.min(this.get(v),this.get(w));case M:return Math.min(this.get(v),this.get(w))+.5*this.get(I);case D:return Math.max(this.get(v),this.get(w))}}}a.Line?a.warn("fabric.Line is already defined"):(a.Line=a.util.createClass(a.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:a.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(d,y){d||(d=[0,0,0,0]),this.callSuper("initialize",y),this.set("x1",d[0]),this.set("y1",d[1]),this.set("x2",d[2]),this.set("y2",d[3]),this._setWidthHeight(y)},_setWidthHeight:function(d){d||(d={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in d?d.left:this._getLeftToOriginX(),this.top="top"in d?d.top:this._getTopToOriginY()},_set:function(d,y){return this.callSuper("_set",d,y),void 0!==i[d]&&this._setWidthHeight(),this},_getLeftToOriginX:o({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:o({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(d){d.beginPath();var y=this.calcLinePoints();d.moveTo(y.x1,y.y1),d.lineTo(y.x2,y.y2),d.lineWidth=this.strokeWidth;var _=d.strokeStyle;d.strokeStyle=this.stroke||d.fillStyle,this.stroke&&this._renderStroke(d),d.strokeStyle=_},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(d){return l(this.callSuper("toObject",d),this.calcLinePoints())},_getNonTransformedDimensions:function(){var d=this.callSuper("_getNonTransformedDimensions");return"butt"===this.strokeLineCap&&(0===this.width&&(d.y-=this.strokeWidth),0===this.height&&(d.x-=this.strokeWidth)),d},calcLinePoints:function(){var d=this.x1<=this.x2?-1:1,y=this.y1<=this.y2?-1:1;return{x1:d*this.width*.5,x2:d*this.width*-.5,y1:y*this.height*.5,y2:y*this.height*-.5}},_toSVG:function(){var d=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',d.x1,'" y1="',d.y1,'" x2="',d.x2,'" y2="',d.y2,'" />\n']}}),a.Line.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),a.Line.fromElement=function(d,y,_){_=_||{};var v=a.parseAttributes(d,a.Line.ATTRIBUTE_NAMES);y(new a.Line([v.x1||0,v.y1||0,v.x2||0,v.y2||0],l(v,_)))},a.Line.fromObject=function(d,y){var _=m(d,!0);_.points=[d.x1,d.y1,d.x2,d.y2],a.Object._fromObject("Line",_,function(v){delete v.points,y&&y(v)},"points")})}(t),function(u){var a=u.fabric||(u.fabric={}),l=a.util.degreesToRadians;a.Circle?a.warn("fabric.Circle is already defined."):(a.Circle=a.util.createClass(a.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:a.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(m,i){return this.callSuper("_set",m,i),"radius"===m&&this.setRadius(i),this},toObject:function(m){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(m))},_toSVG:function(){var m,i=(this.endAngle-this.startAngle)%360;if(0===i)m=["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',this.radius,'" />\n'];else{var o=l(this.startAngle),d=l(this.endAngle),y=this.radius;m=['<path d="M '+a.util.cos(o)*y+" "+a.util.sin(o)*y," A "+y+" "+y," 0 ",+(i>180?"1":"0")+" 1"," "+a.util.cos(d)*y+" "+a.util.sin(d)*y,'" ',"COMMON_PARTS"," />\n"]}return m},_render:function(m){m.beginPath(),m.arc(0,0,this.radius,l(this.startAngle),l(this.endAngle),!1),this._renderPaintInOrder(m)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(m){return this.radius=m,this.set("width",2*m).set("height",2*m)}}),a.Circle.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),a.Circle.fromElement=function(m,i){var o,d=a.parseAttributes(m,a.Circle.ATTRIBUTE_NAMES);if(!("radius"in(o=d)&&o.radius>=0))throw new Error("value of `r` attribute is required and can not be negative");d.left=(d.left||0)-d.radius,d.top=(d.top||0)-d.radius,i(new a.Circle(d))},a.Circle.fromObject=function(m,i){a.Object._fromObject("Circle",m,i)})}(t),function(u){var a=u.fabric||(u.fabric={});a.Triangle?a.warn("fabric.Triangle is already defined"):(a.Triangle=a.util.createClass(a.Object,{type:"triangle",width:100,height:100,_render:function(l){var m=this.width/2,i=this.height/2;l.beginPath(),l.moveTo(-m,i),l.lineTo(0,-i),l.lineTo(m,i),l.closePath(),this._renderPaintInOrder(l)},_toSVG:function(){var l=this.width/2,m=this.height/2;return["<polygon ","COMMON_PARTS",'points="',[-l+" "+m,"0 "+-m,l+" "+m].join(","),'" />']}}),a.Triangle.fromObject=function(l,m){return a.Object._fromObject("Triangle",l,m)})}(t),function(u){var a=u.fabric||(u.fabric={}),l=2*Math.PI;a.Ellipse?a.warn("fabric.Ellipse is already defined."):(a.Ellipse=a.util.createClass(a.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:a.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(m){this.callSuper("initialize",m),this.set("rx",m&&m.rx||0),this.set("ry",m&&m.ry||0)},_set:function(m,i){switch(this.callSuper("_set",m,i),m){case"rx":this.rx=i,this.set("width",2*i);break;case"ry":this.ry=i,this.set("height",2*i)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(m){return this.callSuper("toObject",["rx","ry"].concat(m))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,'" />\n']},_render:function(m){m.beginPath(),m.save(),m.transform(1,0,0,this.ry/this.rx,0,0),m.arc(0,0,this.rx,0,l,!1),m.restore(),this._renderPaintInOrder(m)}}),a.Ellipse.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),a.Ellipse.fromElement=function(m,i){var o=a.parseAttributes(m,a.Ellipse.ATTRIBUTE_NAMES);o.left=(o.left||0)-o.rx,o.top=(o.top||0)-o.ry,i(new a.Ellipse(o))},a.Ellipse.fromObject=function(m,i){a.Object._fromObject("Ellipse",m,i)})}(t),function(u){var a=u.fabric||(u.fabric={}),l=a.util.object.extend;a.Rect?a.warn("fabric.Rect is already defined"):(a.Rect=a.util.createClass(a.Object,{stateProperties:a.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:a.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(m){this.callSuper("initialize",m),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(m){var i=this.rx?Math.min(this.rx,this.width/2):0,o=this.ry?Math.min(this.ry,this.height/2):0,d=this.width,y=this.height,_=-this.width/2,v=-this.height/2,w=0!==i||0!==o,I=.4477152502;m.beginPath(),m.moveTo(_+i,v),m.lineTo(_+d-i,v),w&&m.bezierCurveTo(_+d-I*i,v,_+d,v+I*o,_+d,v+o),m.lineTo(_+d,v+y-o),w&&m.bezierCurveTo(_+d,v+y-I*o,_+d-I*i,v+y,_+d-i,v+y),m.lineTo(_+i,v+y),w&&m.bezierCurveTo(_+I*i,v+y,_,v+y-I*o,_,v+y-o),m.lineTo(_,v+o),w&&m.bezierCurveTo(_,v+I*o,_+I*i,v,_+i,v),m.closePath(),this._renderPaintInOrder(m)},toObject:function(m){return this.callSuper("toObject",["rx","ry"].concat(m))},_toSVG:function(){return["<rect ","COMMON_PARTS",'x="',-this.width/2,'" y="',-this.height/2,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,'" />\n']}}),a.Rect.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),a.Rect.fromElement=function(m,i,o){if(!m)return i(null);o=o||{};var d=a.parseAttributes(m,a.Rect.ATTRIBUTE_NAMES);d.left=d.left||0,d.top=d.top||0,d.height=d.height||0,d.width=d.width||0;var y=new a.Rect(l(o?a.util.object.clone(o):{},d));y.visible=y.visible&&y.width>0&&y.height>0,i(y)},a.Rect.fromObject=function(m,i){return a.Object._fromObject("Rect",m,i)})}(t),function(u){var a=u.fabric||(u.fabric={}),l=a.util.object.extend,m=a.util.array.min,i=a.util.array.max,o=a.util.toFixed,d=a.util.projectStrokeOnPoints;a.Polyline?a.warn("fabric.Polyline is already defined"):(a.Polyline=a.util.createClass(a.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:a.Object.prototype.cacheProperties.concat("points"),initialize:function(y,_){_=_||{},this.points=y||[],this.callSuper("initialize",_),this._setPositionDimensions(_)},_projectStrokeOnPoints:function(){return d(this.points,this,!0)},_setPositionDimensions:function(y){var _,v=this._calcDimensions(y),w=this.exactBoundingBox?this.strokeWidth:0;this.width=v.width-w,this.height=v.height-w,y.fromSVG||(_=this.translateToGivenOrigin({x:v.left-this.strokeWidth/2+w/2,y:v.top-this.strokeWidth/2+w/2},"left","top",this.originX,this.originY)),void 0===y.left&&(this.left=y.fromSVG?v.left:_.x),void 0===y.top&&(this.top=y.fromSVG?v.top:_.y),this.pathOffset={x:v.left+this.width/2+w/2,y:v.top+this.height/2+w/2}},_calcDimensions:function(){var y=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,_=m(y,"x")||0,v=m(y,"y")||0;return{left:_,top:v,width:(i(y,"x")||0)-_,height:(i(y,"y")||0)-v}},toObject:function(y){return l(this.callSuper("toObject",y),{points:this.points.concat()})},_toSVG:function(){for(var y=[],_=this.pathOffset.x,v=this.pathOffset.y,w=a.Object.NUM_FRACTION_DIGITS,I=0,A=this.points.length;I<A;I++)y.push(o(this.points[I].x-_,w),",",o(this.points[I].y-v,w)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',y.join(""),'" />\n']},commonRender:function(y){var _,v=this.points.length,w=this.pathOffset.x,I=this.pathOffset.y;if(!v||isNaN(this.points[v-1].y))return!1;y.beginPath(),y.moveTo(this.points[0].x-w,this.points[0].y-I);for(var A=0;A<v;A++)y.lineTo((_=this.points[A]).x-w,_.y-I);return!0},_render:function(y){this.commonRender(y)&&this._renderPaintInOrder(y)},complexity:function(){return this.get("points").length}}),a.Polyline.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat(),a.Polyline.fromElementGenerator=function(y){return function(_,v,w){if(!_)return v(null);w||(w={});var I=a.parsePointsAttribute(_.getAttribute("points")),A=a.parseAttributes(_,a[y].ATTRIBUTE_NAMES);A.fromSVG=!0,v(new a[y](I,l(A,w)))}},a.Polyline.fromElement=a.Polyline.fromElementGenerator("Polyline"),a.Polyline.fromObject=function(y,_){return a.Object._fromObject("Polyline",y,_,"points")})}(t),function(u){var a=u.fabric||(u.fabric={}),l=a.util.projectStrokeOnPoints;a.Polygon?a.warn("fabric.Polygon is already defined"):(a.Polygon=a.util.createClass(a.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return l(this.points,this)},_render:function(m){this.commonRender(m)&&(m.closePath(),this._renderPaintInOrder(m))}}),a.Polygon.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat(),a.Polygon.fromElement=a.Polyline.fromElementGenerator("Polygon"),a.Polygon.fromObject=function(m,i){a.Object._fromObject("Polygon",m,i,"points")})}(t),function(u){var a=u.fabric||(u.fabric={}),l=a.util.array.min,m=a.util.array.max,i=a.util.object.extend,o=a.util.object.clone,d=a.util.toFixed;a.Path?a.warn("fabric.Path is already defined"):(a.Path=a.util.createClass(a.Object,{type:"path",path:null,cacheProperties:a.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:a.Object.prototype.stateProperties.concat("path"),initialize:function(y,_){delete(_=o(_||{})).path,this.callSuper("initialize",_),this._setPath(y||[],_)},_setPath:function(y,_){this.path=a.util.makePathSimpler(Array.isArray(y)?y:a.util.parsePath(y)),a.Polyline.prototype._setPositionDimensions.call(this,_||{})},_renderPathCommands:function(y){var _,v=0,w=0,I=0,A=0,F=-this.pathOffset.x,B=-this.pathOffset.y;y.beginPath();for(var z=0,K=this.path.length;z<K;++z)switch((_=this.path[z])[0]){case"L":y.lineTo((I=_[1])+F,(A=_[2])+B);break;case"M":v=I=_[1],w=A=_[2],y.moveTo(I+F,A+B);break;case"C":y.bezierCurveTo(_[1]+F,_[2]+B,_[3]+F,_[4]+B,(I=_[5])+F,(A=_[6])+B);break;case"Q":y.quadraticCurveTo(_[1]+F,_[2]+B,_[3]+F,_[4]+B),I=_[3],A=_[4];break;case"z":case"Z":I=v,A=w,y.closePath()}},_render:function(y){this._renderPathCommands(y),this._renderPaintInOrder(y)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(y){return i(this.callSuper("toObject",y),{path:this.path.map(function(_){return _.slice()})})},toDatalessObject:function(y){var _=this.toObject(["sourcePath"].concat(y));return _.sourcePath&&delete _.path,_},_toSVG:function(){return["<path ","COMMON_PARTS",'d="',a.util.joinPath(this.path),'" stroke-linecap="round" ',"/>\n"]},_getOffsetTransform:function(){var y=a.Object.NUM_FRACTION_DIGITS;return" translate("+d(-this.pathOffset.x,y)+", "+d(-this.pathOffset.y,y)+")"},toClipPathSVG:function(y){var _=this._getOffsetTransform();return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:y,additionalTransform:_})},toSVG:function(y){var _=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:y,additionalTransform:_})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var y,_,v=[],w=[],I=0,A=0,M=0,D=0,F=0,B=this.path.length;F<B;++F){switch((y=this.path[F])[0]){case"L":M=y[1],D=y[2],_=[];break;case"M":I=M=y[1],A=D=y[2],_=[];break;case"C":_=a.util.getBoundsOfCurve(M,D,y[1],y[2],y[3],y[4],y[5],y[6]),M=y[5],D=y[6];break;case"Q":_=a.util.getBoundsOfCurve(M,D,y[1],y[2],y[1],y[2],y[3],y[4]),M=y[3],D=y[4];break;case"z":case"Z":M=I,D=A}_.forEach(function(oe){v.push(oe.x),w.push(oe.y)}),v.push(M),w.push(D)}var z=l(v)||0,K=l(w)||0;return{left:z,top:K,width:(m(v)||0)-z,height:(m(w)||0)-K}}}),a.Path.fromObject=function(y,_){"string"==typeof y.sourcePath?a.loadSVGFromURL(y.sourcePath,function(w){var I=w[0];I.setOptions(y),_&&_(I)}):a.Object._fromObject("Path",y,_,"path")},a.Path.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat(["d"]),a.Path.fromElement=function(y,_,v){var w=a.parseAttributes(y,a.Path.ATTRIBUTE_NAMES);w.fromSVG=!0,_(new a.Path(w.d,i(w,v)))})}(t),function(u){var a=u.fabric||(u.fabric={}),l=a.util.array.min,m=a.util.array.max;a.Group||(a.Group=a.util.createClass(a.Object,a.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(i,o,d){o=o||{},this._objects=[],d&&this.callSuper("initialize",o),this._objects=i||[];for(var y=this._objects.length;y--;)this._objects[y].group=this;if(d)this._updateObjectsACoords();else{var _=o&&o.centerPoint;void 0!==o.originX&&(this.originX=o.originX),void 0!==o.originY&&(this.originY=o.originY),_||this._calcBounds(),this._updateObjectsCoords(_),delete o.centerPoint,this.callSuper("initialize",o)}this.setCoords()},_updateObjectsACoords:function(){for(var i=this._objects.length;i--;)this._objects[i].setCoords(!0)},_updateObjectsCoords:function(i){i=i||this.getCenterPoint();for(var o=this._objects.length;o--;)this._updateObjectCoords(this._objects[o],i)},_updateObjectCoords:function(i,o){i.set({left:i.left-o.x,top:i.top-o.y}),i.group=this,i.setCoords(!0)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(i){var o=!!this.group;return this._restoreObjectsState(),a.util.resetObjectTransform(this),i&&(o&&a.util.removeTransformFromObject(i,this.group.calcTransformMatrix()),this._objects.push(i),i.group=this,i._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,o?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(i){return this._restoreObjectsState(),a.util.resetObjectTransform(this),this.remove(i),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(i){this.dirty=!0,i.group=this,i._set("canvas",this.canvas)},_onObjectRemoved:function(i){this.dirty=!0,delete i.group},_set:function(i,o){var d=this._objects.length;if(this.useSetOnGroup)for(;d--;)this._objects[d].setOnGroup(i,o);if("canvas"===i)for(;d--;)this._objects[d]._set(i,o);a.Object.prototype._set.call(this,i,o)},toObject:function(i){var o=this.includeDefaultValues,d=this._objects.filter(function(_){return!_.excludeFromExport}).map(function(_){var v=_.includeDefaultValues;_.includeDefaultValues=o;var w=_.toObject(i);return _.includeDefaultValues=v,w}),y=a.Object.prototype.toObject.call(this,i);return y.objects=d,y},toDatalessObject:function(i){var o,d=this.sourcePath;if(d)o=d;else{var y=this.includeDefaultValues;o=this._objects.map(function(v){var w=v.includeDefaultValues;v.includeDefaultValues=y;var I=v.toDatalessObject(i);return v.includeDefaultValues=w,I})}var _=a.Object.prototype.toDatalessObject.call(this,i);return _.objects=o,_},render:function(i){this._transformDone=!0,this.callSuper("render",i),this._transformDone=!1},shouldCache:function(){var i=a.Object.prototype.shouldCache.call(this);if(i)for(var o=0,d=this._objects.length;o<d;o++)if(this._objects[o].willDrawShadow())return this.ownCaching=!1,!1;return i},willDrawShadow:function(){if(a.Object.prototype.willDrawShadow.call(this))return!0;for(var i=0,o=this._objects.length;i<o;i++)if(this._objects[i].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(i){for(var o=0,d=this._objects.length;o<d;o++)this._objects[o].render(i);this._drawClipPath(i,this.clipPath)},isCacheDirty:function(i){if(this.callSuper("isCacheDirty",i))return!0;if(!this.statefullCache)return!1;for(var o=0,d=this._objects.length;o<d;o++)if(this._objects[o].isCacheDirty(!0)){if(this._cacheCanvas){var y=this.cacheWidth/this.zoomX,_=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-y/2,-_/2,y,_)}return!0}return!1},_restoreObjectsState:function(){var i=this.calcOwnMatrix();return this._objects.forEach(function(o){a.util.addTransformToObject(o,i),delete o.group,o.setCoords()}),this},destroy:function(){return this._objects.forEach(function(i){i.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(i){i.dispose&&i.dispose()}),this._objects=[]},toActiveSelection:function(){if(this.canvas){var i=this._objects,o=this.canvas;this._objects=[];var d=this.toObject();delete d.objects;var y=new a.ActiveSelection([]);return y.set(d),y.type="activeSelection",o.remove(this),i.forEach(function(_){_.group=y,_.dirty=!0,o.add(_)}),y.canvas=o,y._objects=i,o._activeObject=y,y.setCoords(),y}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){return this.forEachObject(function(i){i.setCoords(!0)}),this},_calcBounds:function(i){for(var o,d,y,_,v=[],w=[],I=["tr","br","bl","tl"],A=0,M=this._objects.length,D=I.length;A<M;++A){for(y=(o=this._objects[A]).calcACoords(),_=0;_<D;_++)v.push(y[d=I[_]].x),w.push(y[d].y);o.aCoords=y}this._getBounds(v,w,i)},_getBounds:function(i,o,d){var y=new a.Point(l(i),l(o)),_=new a.Point(m(i),m(o)),v=y.y||0,w=y.x||0,A=_.y-y.y||0;this.width=_.x-y.x||0,this.height=A,d||this.setPositionByOrigin({x:w,y:v},"left","top")},_toSVG:function(i){for(var o=["<g ","COMMON_PARTS"," >\n"],d=0,y=this._objects.length;d<y;d++)o.push("\t\t",this._objects[d].toSVG(i));return o.push("</g>\n"),o},getSvgStyles:function(){var o=this.visible?"":" visibility: hidden;";return[void 0!==this.opacity&&1!==this.opacity?"opacity: "+this.opacity+";":"",this.getSvgFilter(),o].join("")},toClipPathSVG:function(i){for(var o=[],d=0,y=this._objects.length;d<y;d++)o.push("\t",this._objects[d].toClipPathSVG(i));return this._createBaseClipPathSVGMarkup(o,{reviver:i})}}),a.Group.fromObject=function(i,o){var d=i.objects,y=a.util.object.clone(i,!0);delete y.objects,"string"!=typeof d?a.util.enlivenObjects(d,function(_){var v=a.util.object.clone(i,!0);delete v.objects,a.util.enlivenObjectEnlivables(i,v,function(){o&&o(new a.Group(_,v,!0))})}):a.loadSVGFromURL(d,function(_){var v=a.util.groupSVGElements(_,i,d);v.set(y),o&&o(v)})})}(t),function(u){var a=u.fabric||(u.fabric={});a.ActiveSelection||(a.ActiveSelection=a.util.createClass(a.Group,{type:"activeSelection",initialize:function(l,m){m=m||{},this._objects=l||[];for(var i=this._objects.length;i--;)this._objects[i].group=this;m.originX&&(this.originX=m.originX),m.originY&&(this.originY=m.originY),this._calcBounds(),this._updateObjectsCoords(),a.Object.prototype.initialize.call(this,m),this.setCoords()},toGroup:function(){var l=this._objects.concat();this._objects=[];var m=a.Object.prototype.toObject.call(this),i=new a.Group([]);if(delete m.type,i.set(m),l.forEach(function(d){d.canvas.remove(d),d.group=i}),i._objects=l,!this.canvas)return i;var o=this.canvas;return o.add(i),o._activeObject=i,i.setCoords(),i},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(l,m,i){l.save(),l.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",l,m),void 0===(i=i||{}).hasControls&&(i.hasControls=!1),i.forActiveSelection=!0;for(var o=0,d=this._objects.length;o<d;o++)this._objects[o]._renderControls(l,i);l.restore()}}),a.ActiveSelection.fromObject=function(l,m){a.util.enlivenObjects(l.objects,function(i){delete l.objects,m&&m(new a.ActiveSelection(i,l,!0))})})}(t),function(u){var a=b.util.object.extend;u.fabric||(u.fabric={}),u.fabric.Image?b.warn("fabric.Image is already defined."):(b.Image=b.util.createClass(b.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:b.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:b.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(l,m){m||(m={}),this.filters=[],this.cacheKey="texture"+b.Object.__uid++,this.callSuper("initialize",m),this._initElement(l,m)},getElement:function(){return this._element||{}},setElement:function(l,m){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=l,this._originalElement=l,this._initConfig(m),0!==this.filters.length&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(l){var m=b.filterBackend;m&&m.evictCachesForKey&&m.evictCachesForKey(l)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(l){b.util.cleanUpJsdomNode(this[l]),this[l]=void 0}.bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var l=this.getElement();return{width:l.naturalWidth||l.width,height:l.naturalHeight||l.height}},_stroke:function(l){if(this.stroke&&0!==this.strokeWidth){var m=this.width/2,i=this.height/2;l.beginPath(),l.moveTo(-m,-i),l.lineTo(m,-i),l.lineTo(m,i),l.lineTo(-m,i),l.lineTo(-m,-i),l.closePath()}},toObject:function(l){var m=[];this.filters.forEach(function(o){o&&m.push(o.toObject())});var i=a(this.callSuper("toObject",["cropX","cropY"].concat(l)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:m});return this.resizeFilter&&(i.resizeFilter=this.resizeFilter.toObject()),i},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var l,m=[],i=[],o=this._element,d=-this.width/2,y=-this.height/2,_="",v="";if(!o)return[];if(this.hasCrop()){var w=b.Object.__uid++;m.push('<clipPath id="imageCrop_'+w+'">\n','\t<rect x="'+d+'" y="'+y+'" width="'+this.width+'" height="'+this.height+'" />\n',"</clipPath>\n"),_=' clip-path="url(#imageCrop_'+w+')" '}if(this.imageSmoothing||(v='" image-rendering="optimizeSpeed'),i.push("\t<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',d-this.cropX,'" y="',y-this.cropY,'" width="',o.width||o.naturalWidth,'" height="',o.height||o.height,v,'"',_,"></image>\n"),this.stroke||this.strokeDashArray){var I=this.fill;this.fill=null,l=["\t<rect ",'x="',d,'" y="',y,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'],this.fill=I}return"fill"!==this.paintFirst?m.concat(l,i):m.concat(i,l)},getSrc:function(l){var m=l?this._element:this._originalElement;return m?m.toDataURL?m.toDataURL():this.srcFromAttribute?m.getAttribute("src"):m.src:this.src||""},setSrc:function(l,m,i){return b.util.loadImage(l,function(o,d){this.setElement(o,i),this._setWidthHeight(),m&&m(this,d)},this,i&&i.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var l=this.resizeFilter,m=this.minimumScaleTrigger,i=this.getTotalObjectScaling(),o=i.scaleX,d=i.scaleY,y=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!l||o>m&&d>m)return this._element=y,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=o,void(this._lastScaleY=d);b.filterBackend||(b.filterBackend=b.initFilterBackend());var _=b.util.createCanvasElement(),v=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,w=y.width,I=y.height;_.width=w,_.height=I,this._element=_,this._lastScaleX=l.scaleX=o,this._lastScaleY=l.scaleY=d,b.filterBackend.applyFilters([l],y,w,I,this._element,v),this._filterScalingX=_.width/this._originalElement.width,this._filterScalingY=_.height/this._originalElement.height},applyFilters:function(l){if(l=(l=l||this.filters||[]).filter(function(y){return y&&!y.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),0===l.length)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var m=this._originalElement,i=m.naturalWidth||m.width,o=m.naturalHeight||m.height;if(this._element===this._originalElement){var d=b.util.createCanvasElement();d.width=i,d.height=o,this._element=d,this._filteredEl=d}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,i,o),this._lastScaleX=1,this._lastScaleY=1;return b.filterBackend||(b.filterBackend=b.initFilterBackend()),b.filterBackend.applyFilters(l,this._originalElement,i,o,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(l){b.util.setImageSmoothing(l,this.imageSmoothing),!0!==this.isMoving&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(l),this._renderPaintInOrder(l)},drawCacheOnCanvas:function(l){b.util.setImageSmoothing(l,this.imageSmoothing),b.Object.prototype.drawCacheOnCanvas.call(this,l)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(l){var m=this._element;if(m){var i=this._filterScalingX,o=this._filterScalingY,d=this.width,y=this.height,_=Math.min,v=Math.max,w=v(this.cropX,0),I=v(this.cropY,0),A=m.naturalWidth||m.width,M=m.naturalHeight||m.height,D=w*i,F=I*o,B=_(d*i,A-D),z=_(y*o,M-F),K=-d/2,oe=-y/2,ne=_(d,A/i-w),ee=_(y,M/o-I);m&&l.drawImage(m,D,F,B,z,K,oe,ne,ee)}},_needsResize:function(){var l=this.getTotalObjectScaling();return l.scaleX!==this._lastScaleX||l.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(l,m){this.setElement(b.util.getById(l),m),b.util.addClass(this.getElement(),b.Image.CSS_CANVAS)},_initConfig:function(l){l||(l={}),this.setOptions(l),this._setWidthHeight(l)},_initFilters:function(l,m){l&&l.length?b.util.enlivenObjects(l,function(i){m&&m(i)},"fabric.Image.filters"):m&&m()},_setWidthHeight:function(l){l||(l={});var m=this.getElement();this.width=l.width||m.naturalWidth||m.width||0,this.height=l.height||m.naturalHeight||m.height||0},parsePreserveAspectRatioAttribute:function(){var l,m=b.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),i=this._element.width,o=this._element.height,d=1,y=1,_=0,v=0,w=0,I=0,A=this.width,M=this.height,D={width:A,height:M};return!m||"none"===m.alignX&&"none"===m.alignY?(d=A/i,y=M/o):("meet"===m.meetOrSlice&&(l=(A-i*(d=y=b.util.findScaleToFit(this._element,D)))/2,"Min"===m.alignX&&(_=-l),"Max"===m.alignX&&(_=l),l=(M-o*y)/2,"Min"===m.alignY&&(v=-l),"Max"===m.alignY&&(v=l)),"slice"===m.meetOrSlice&&(l=i-A/(d=y=b.util.findScaleToCover(this._element,D)),"Mid"===m.alignX&&(w=l/2),"Max"===m.alignX&&(w=l),l=o-M/y,"Mid"===m.alignY&&(I=l/2),"Max"===m.alignY&&(I=l),i=A/d,o=M/y)),{width:i,height:o,scaleX:d,scaleY:y,offsetLeft:_,offsetTop:v,cropX:w,cropY:I}}}),b.Image.CSS_CANVAS="canvas-img",b.Image.prototype.getSvgSrc=b.Image.prototype.getSrc,b.Image.fromObject=function(l,m){var i=b.util.object.clone(l);b.util.loadImage(i.src,function(o,d){d?m&&m(null,!0):b.Image.prototype._initFilters.call(i,i.filters,function(y){i.filters=y||[],b.Image.prototype._initFilters.call(i,[i.resizeFilter],function(_){i.resizeFilter=_[0],b.util.enlivenObjectEnlivables(i,i,function(){var v=new b.Image(o,i);m(v,!1)})})})},null,i.crossOrigin)},b.Image.fromURL=function(l,m,i){b.util.loadImage(l,function(o,d){m&&m(new b.Image(o,i),d)},null,i&&i.crossOrigin)},b.Image.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),b.Image.fromElement=function(l,m,i){var o=b.parseAttributes(l,b.Image.ATTRIBUTE_NAMES);b.Image.fromURL(o["xlink:href"],m,a(i?b.util.object.clone(i):{},o))})}(t),b.util.object.extend(b.Object.prototype,{_getAngleValueForStraighten:function(){var u=this.angle%360;return u>0?90*Math.round((u-1)/90):90*Math.round(u/90)},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(u){var a=function(){},l=(u=u||{}).onComplete||a,m=u.onChange||a,i=this;return b.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(o){i.rotate(o),m()},onComplete:function(){i.setCoords(),l()}})}}),b.util.object.extend(b.StaticCanvas.prototype,{straightenObject:function(u){return u.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(u){return u.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function u(l,m){var i="precision "+m+" float;\nvoid main(){}",o=l.createShader(l.FRAGMENT_SHADER);return l.shaderSource(o,i),l.compileShader(o),!!l.getShaderParameter(o,l.COMPILE_STATUS)}function a(l){l&&l.tileSize&&(this.tileSize=l.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}b.isWebglSupported=function(l){if(b.isLikelyNode)return!1;l=l||b.WebglFilterBackend.prototype.tileSize;var m=document.createElement("canvas"),i=m.getContext("webgl")||m.getContext("experimental-webgl"),o=!1;if(i){b.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),o=b.maxTextureSize>=l;for(var d=["highp","mediump","lowp"],y=0;y<3;y++)if(u(i,d[y])){b.webGlPrecision=d[y];break}}return this.isSupported=o,o},b.WebglFilterBackend=a,a.prototype={tileSize:2048,resources:{},setupGLContext:function(l,m){this.dispose(),this.createWebGLCanvas(l,m),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(l,m)},chooseFastestCopyGLTo2DMethod:function(l,m){var i,o=void 0!==window.performance;try{new ImageData(1,1),i=!0}catch{i=!1}var d=typeof ArrayBuffer<"u",y=typeof Uint8ClampedArray<"u";if(o&&i&&d&&y){var _=b.util.createCanvasElement(),v=new ArrayBuffer(l*m*4);if(b.forceGLPutImageData)return this.imageBuffer=v,void(this.copyGLTo2D=je);var w,I,A={imageBuffer:v,destinationWidth:l,destinationHeight:m,targetCanvas:_};_.width=l,_.height=m,w=window.performance.now(),Re.call(A,this.gl,A),I=window.performance.now()-w,w=window.performance.now(),je.call(A,this.gl,A),I>window.performance.now()-w?(this.imageBuffer=v,this.copyGLTo2D=je):this.copyGLTo2D=Re}},createWebGLCanvas:function(l,m){var i=b.util.createCanvasElement();i.width=l,i.height=m;var o={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},d=i.getContext("webgl",o);d||(d=i.getContext("experimental-webgl",o)),d&&(d.clearColor(0,0,0,0),this.canvas=i,this.gl=d)},applyFilters:function(l,m,i,o,d,y){var _,v=this.gl;y&&(_=this.getCachedTexture(y,m));var A,M,B,z,w={originalWidth:m.width||m.originalWidth,originalHeight:m.height||m.originalHeight,sourceWidth:i,sourceHeight:o,destinationWidth:i,destinationHeight:o,context:v,sourceTexture:this.createTexture(v,i,o,!_&&m),targetTexture:this.createTexture(v,i,o),originalTexture:_||this.createTexture(v,i,o,!_&&m),passes:l.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:d},I=v.createFramebuffer();return v.bindFramebuffer(v.FRAMEBUFFER,I),l.forEach(function(A){A&&A.applyTo(w)}),z=(A=w).destinationHeight,(M=A.targetCanvas).width===(B=A.destinationWidth)&&M.height===z||(M.width=B,M.height=z),this.copyGLTo2D(v,w),v.bindTexture(v.TEXTURE_2D,null),v.deleteTexture(w.sourceTexture),v.deleteTexture(w.targetTexture),v.deleteFramebuffer(I),d.getContext("2d").setTransform(1,0,0,1,0,0),w},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(l,m,i,o){var d=l.createTexture();return l.bindTexture(l.TEXTURE_2D,d),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),o?l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,o):l.texImage2D(l.TEXTURE_2D,0,l.RGBA,m,i,0,l.RGBA,l.UNSIGNED_BYTE,null),d},getCachedTexture:function(l,m){if(this.textureCache[l])return this.textureCache[l];var i=this.createTexture(this.gl,m.width,m.height,m);return this.textureCache[l]=i,i},evictCachesForKey:function(l){this.textureCache[l]&&(this.gl.deleteTexture(this.textureCache[l]),delete this.textureCache[l])},copyGLTo2D:Re,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var l=this.gl,m={renderer:"",vendor:""};if(!l)return m;var i=l.getExtension("WEBGL_debug_renderer_info");if(i){var o=l.getParameter(i.UNMASKED_RENDERER_WEBGL),d=l.getParameter(i.UNMASKED_VENDOR_WEBGL);o&&(m.renderer=o.toLowerCase()),d&&(m.vendor=d.toLowerCase())}return this.gpuInfo=m,m}}}(),function(){var u=function(){};function a(){}b.Canvas2dFilterBackend=a,a.prototype={evictCachesForKey:u,dispose:u,clearWebGLCaches:u,resources:{},applyFilters:function(l,m,i,o,d){var y=d.getContext("2d");y.drawImage(m,0,0,i,o);var _={sourceWidth:i,sourceHeight:o,imageData:y.getImageData(0,0,i,o),originalEl:m,originalImageData:y.getImageData(0,0,i,o),canvasEl:d,ctx:y,filterBackend:this};return l.forEach(function(v){v.applyTo(_)}),_.imageData.width===i&&_.imageData.height===o||(d.width=_.imageData.width,d.height=_.imageData.height),y.putImageData(_.imageData,0,0),_}}}(),b.Image=b.Image||{},b.Image.filters=b.Image.filters||{},b.Image.filters.BaseFilter=b.util.createClass({type:"BaseFilter",vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvoid main() {\nvTexCoord = aPosition;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:"precision highp float;\nvarying vec2 vTexCoord;\nuniform sampler2D uTexture;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\n}",initialize:function(u){u&&this.setOptions(u)},setOptions:function(u){for(var a in u)this[a]=u[a]},createProgram:function(u,a,l){a=a||this.fragmentSource,l=l||this.vertexSource,"highp"!==b.webGlPrecision&&(a=a.replace(/precision highp float/g,"precision "+b.webGlPrecision+" float"));var m=u.createShader(u.VERTEX_SHADER);if(u.shaderSource(m,l),u.compileShader(m),!u.getShaderParameter(m,u.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+u.getShaderInfoLog(m));var i=u.createShader(u.FRAGMENT_SHADER);if(u.shaderSource(i,a),u.compileShader(i),!u.getShaderParameter(i,u.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+u.getShaderInfoLog(i));var o=u.createProgram();if(u.attachShader(o,m),u.attachShader(o,i),u.linkProgram(o),!u.getProgramParameter(o,u.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+u.getProgramInfoLog(o));var d=this.getAttributeLocations(u,o),y=this.getUniformLocations(u,o)||{};return y.uStepW=u.getUniformLocation(o,"uStepW"),y.uStepH=u.getUniformLocation(o,"uStepH"),{program:o,attributeLocations:d,uniformLocations:y}},getAttributeLocations:function(u,a){return{aPosition:u.getAttribLocation(a,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(u,a,l){var m=a.aPosition,i=u.createBuffer();u.bindBuffer(u.ARRAY_BUFFER,i),u.enableVertexAttribArray(m),u.vertexAttribPointer(m,2,u.FLOAT,!1,0,0),u.bufferData(u.ARRAY_BUFFER,l,u.STATIC_DRAW)},_setupFrameBuffer:function(u){var a,l,m=u.context;u.passes>1?(l=u.destinationHeight,u.sourceWidth===(a=u.destinationWidth)&&u.sourceHeight===l||(m.deleteTexture(u.targetTexture),u.targetTexture=u.filterBackend.createTexture(m,a,l)),m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,u.targetTexture,0)):(m.bindFramebuffer(m.FRAMEBUFFER,null),m.finish())},_swapTextures:function(u){u.passes--,u.pass++;var a=u.targetTexture;u.targetTexture=u.sourceTexture,u.sourceTexture=a},isNeutralState:function(){var u=this.mainParameter,a=b.Image.filters[this.type].prototype;if(u){if(Array.isArray(a[u])){for(var l=a[u].length;l--;)if(this[u][l]!==a[u][l])return!1;return!0}return a[u]===this[u]}return!1},applyTo:function(u){u.webgl?(this._setupFrameBuffer(u),this.applyToWebGL(u),this._swapTextures(u)):this.applyTo2d(u)},retrieveShader:function(u){return u.programCache.hasOwnProperty(this.type)||(u.programCache[this.type]=this.createProgram(u.context)),u.programCache[this.type]},applyToWebGL:function(u){var a=u.context,l=this.retrieveShader(u);a.bindTexture(a.TEXTURE_2D,0===u.pass&&u.originalTexture?u.originalTexture:u.sourceTexture),a.useProgram(l.program),this.sendAttributeData(a,l.attributeLocations,u.aPosition),a.uniform1f(l.uniformLocations.uStepW,1/u.sourceWidth),a.uniform1f(l.uniformLocations.uStepH,1/u.sourceHeight),this.sendUniformData(a,l.uniformLocations),a.viewport(0,0,u.destinationWidth,u.destinationHeight),a.drawArrays(a.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(u,a,l){u.activeTexture(l),u.bindTexture(u.TEXTURE_2D,a),u.activeTexture(u.TEXTURE0)},unbindAdditionalTexture:function(u,a){u.activeTexture(a),u.bindTexture(u.TEXTURE_2D,null),u.activeTexture(u.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(u){this[this.mainParameter]=u},sendUniformData:function(){},createHelpLayer:function(u){if(!u.helpLayer){var a=document.createElement("canvas");a.width=u.sourceWidth,a.height=u.sourceHeight,u.helpLayer=a}},toObject:function(){var u={type:this.type},a=this.mainParameter;return a&&(u[a]=this[a]),u},toJSON:function(){return this.toObject()}}),b.Image.filters.BaseFilter.fromObject=function(u,a){var l=new b.Image.filters[u.type](u);return a&&a(l),l},function(u){var a=u.fabric||(u.fabric={}),l=a.Image.filters;l.ColorMatrix=(0,a.util.createClass)(l.BaseFilter,{type:"ColorMatrix",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nuniform mat4 uColorMatrix;\nuniform vec4 uConstants;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor *= uColorMatrix;\ncolor += uConstants;\ngl_FragColor = color;\n}",matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(i){this.callSuper("initialize",i),this.matrix=this.matrix.slice(0)},applyTo2d:function(i){var o,d,y,_,v,w=i.imageData.data,I=w.length,A=this.matrix,M=this.colorsOnly;for(v=0;v<I;v+=4)o=w[v],d=w[v+1],y=w[v+2],M?(w[v]=o*A[0]+d*A[1]+y*A[2]+255*A[4],w[v+1]=o*A[5]+d*A[6]+y*A[7]+255*A[9],w[v+2]=o*A[10]+d*A[11]+y*A[12]+255*A[14]):(w[v]=o*A[0]+d*A[1]+y*A[2]+(_=w[v+3])*A[3]+255*A[4],w[v+1]=o*A[5]+d*A[6]+y*A[7]+_*A[8]+255*A[9],w[v+2]=o*A[10]+d*A[11]+y*A[12]+_*A[13]+255*A[14],w[v+3]=o*A[15]+d*A[16]+y*A[17]+_*A[18]+255*A[19])},getUniformLocations:function(i,o){return{uColorMatrix:i.getUniformLocation(o,"uColorMatrix"),uConstants:i.getUniformLocation(o,"uConstants")}},sendUniformData:function(i,o){var d=this.matrix,_=[d[4],d[9],d[14],d[19]];i.uniformMatrix4fv(o.uColorMatrix,!1,[d[0],d[1],d[2],d[3],d[5],d[6],d[7],d[8],d[10],d[11],d[12],d[13],d[15],d[16],d[17],d[18]]),i.uniform4fv(o.uConstants,_)}}),a.Image.filters.ColorMatrix.fromObject=a.Image.filters.BaseFilter.fromObject}(t),function(u){var a=u.fabric||(u.fabric={}),l=a.Image.filters;l.Brightness=(0,a.util.createClass)(l.BaseFilter,{type:"Brightness",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBrightness;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += uBrightness;\ngl_FragColor = color;\n}",brightness:0,mainParameter:"brightness",applyTo2d:function(i){if(0!==this.brightness){var o,d=i.imageData.data,y=d.length,_=Math.round(255*this.brightness);for(o=0;o<y;o+=4)d[o]=d[o]+_,d[o+1]=d[o+1]+_,d[o+2]=d[o+2]+_}},getUniformLocations:function(i,o){return{uBrightness:i.getUniformLocation(o,"uBrightness")}},sendUniformData:function(i,o){i.uniform1f(o.uBrightness,this.brightness)}}),a.Image.filters.Brightness.fromObject=a.Image.filters.BaseFilter.fromObject}(t),function(u){var a=u.fabric||(u.fabric={}),l=a.util.object.extend,m=a.Image.filters;m.Convolute=(0,a.util.createClass)(m.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_3_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_5_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_5_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_7_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_7_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_9_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_9_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}"},retrieveShader:function(o){var d=Math.sqrt(this.matrix.length),y=this.type+"_"+d+"_"+(this.opaque?1:0),_=this.fragmentSource[y];return o.programCache.hasOwnProperty(y)||(o.programCache[y]=this.createProgram(o.context,_)),o.programCache[y]},applyTo2d:function(o){var d,y,_,v,w,I,A,M,D,F,B,z,K,oe=o.imageData,ne=oe.data,ee=this.matrix,G=Math.round(Math.sqrt(ee.length)),j=Math.floor(G/2),Q=oe.width,se=oe.height,ae=o.ctx.createImageData(Q,se),Y=ae.data,V=this.opaque?1:0;for(B=0;B<se;B++)for(F=0;F<Q;F++){for(w=4*(B*Q+F),d=0,y=0,_=0,v=0,K=0;K<G;K++)for(z=0;z<G;z++)I=F+z-j,(A=B+K-j)<0||A>=se||I<0||I>=Q||(d+=ne[M=4*(A*Q+I)]*(D=ee[K*G+z]),y+=ne[M+1]*D,_+=ne[M+2]*D,V||(v+=ne[M+3]*D));Y[w]=d,Y[w+1]=y,Y[w+2]=_,Y[w+3]=V?ne[w+3]:v}o.imageData=ae},getUniformLocations:function(o,d){return{uMatrix:o.getUniformLocation(d,"uMatrix"),uOpaque:o.getUniformLocation(d,"uOpaque"),uHalfSize:o.getUniformLocation(d,"uHalfSize"),uSize:o.getUniformLocation(d,"uSize")}},sendUniformData:function(o,d){o.uniform1fv(d.uMatrix,this.matrix)},toObject:function(){return l(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),a.Image.filters.Convolute.fromObject=a.Image.filters.BaseFilter.fromObject}(t),function(u){var a=u.fabric||(u.fabric={}),l=a.Image.filters;l.Grayscale=(0,a.util.createClass)(l.BaseFilter,{type:"Grayscale",fragmentSource:{average:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat average = (color.r + color.b + color.g) / 3.0;\ngl_FragColor = vec4(average, average, average, color.a);\n}",lightness:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\ngl_FragColor = vec4(average, average, average, col.a);\n}",luminosity:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\ngl_FragColor = vec4(average, average, average, col.a);\n}"},mode:"average",mainParameter:"mode",applyTo2d:function(i){var o,d,y=i.imageData.data,_=y.length,v=this.mode;for(o=0;o<_;o+=4)"average"===v?d=(y[o]+y[o+1]+y[o+2])/3:"lightness"===v?d=(Math.min(y[o],y[o+1],y[o+2])+Math.max(y[o],y[o+1],y[o+2]))/2:"luminosity"===v&&(d=.21*y[o]+.72*y[o+1]+.07*y[o+2]),y[o]=d,y[o+1]=d,y[o+2]=d},retrieveShader:function(i){var o=this.type+"_"+this.mode;return i.programCache.hasOwnProperty(o)||(i.programCache[o]=this.createProgram(i.context,this.fragmentSource[this.mode])),i.programCache[o]},getUniformLocations:function(i,o){return{uMode:i.getUniformLocation(o,"uMode")}},sendUniformData:function(i,o){i.uniform1i(o.uMode,1)},isNeutralState:function(){return!1}}),a.Image.filters.Grayscale.fromObject=a.Image.filters.BaseFilter.fromObject}(t),function(u){var a=u.fabric||(u.fabric={}),l=a.Image.filters;l.Invert=(0,a.util.createClass)(l.BaseFilter,{type:"Invert",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uInvert;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nif (uInvert == 1) {\ngl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n} else {\ngl_FragColor = color;\n}\n}",invert:!0,mainParameter:"invert",applyTo2d:function(i){var o,d=i.imageData.data,y=d.length;for(o=0;o<y;o+=4)d[o]=255-d[o],d[o+1]=255-d[o+1],d[o+2]=255-d[o+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(i,o){return{uInvert:i.getUniformLocation(o,"uInvert")}},sendUniformData:function(i,o){i.uniform1i(o.uInvert,this.invert)}}),a.Image.filters.Invert.fromObject=a.Image.filters.BaseFilter.fromObject}(t),function(u){var a=u.fabric||(u.fabric={}),l=a.util.object.extend,m=a.Image.filters;m.Noise=(0,a.util.createClass)(m.BaseFilter,{type:"Noise",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uStepH;\nuniform float uNoise;\nuniform float uSeed;\nvarying vec2 vTexCoord;\nfloat rand(vec2 co, float seed, float vScale) {\nreturn fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n}\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\ngl_FragColor = color;\n}",mainParameter:"noise",noise:0,applyTo2d:function(o){if(0!==this.noise){var d,y,v,_=o.imageData.data,w=this.noise;for(d=0,v=_.length;d<v;d+=4)y=(.5-Math.random())*w,_[d]+=y,_[d+1]+=y,_[d+2]+=y}},getUniformLocations:function(o,d){return{uNoise:o.getUniformLocation(d,"uNoise"),uSeed:o.getUniformLocation(d,"uSeed")}},sendUniformData:function(o,d){o.uniform1f(d.uNoise,this.noise/255),o.uniform1f(d.uSeed,Math.random())},toObject:function(){return l(this.callSuper("toObject"),{noise:this.noise})}}),a.Image.filters.Noise.fromObject=a.Image.filters.BaseFilter.fromObject}(t),function(u){var a=u.fabric||(u.fabric={}),l=a.Image.filters;l.Pixelate=(0,a.util.createClass)(l.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBlocksize;\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nfloat blockW = uBlocksize * uStepW;\nfloat blockH = uBlocksize * uStepW;\nint posX = int(vTexCoord.x / blockW);\nint posY = int(vTexCoord.y / blockH);\nfloat fposX = float(posX);\nfloat fposY = float(posY);\nvec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\nvec4 color = texture2D(uTexture, squareCoords);\ngl_FragColor = color;\n}",applyTo2d:function(i){var o,d,y,_,v,w,I,A,M,D,F,B=i.imageData,z=B.data,K=B.height,oe=B.width;for(d=0;d<K;d+=this.blocksize)for(y=0;y<oe;y+=this.blocksize)for(_=z[o=4*d*oe+4*y],v=z[o+1],w=z[o+2],I=z[o+3],D=Math.min(d+this.blocksize,K),F=Math.min(y+this.blocksize,oe),A=d;A<D;A++)for(M=y;M<F;M++)z[o=4*A*oe+4*M]=_,z[o+1]=v,z[o+2]=w,z[o+3]=I},isNeutralState:function(){return 1===this.blocksize},getUniformLocations:function(i,o){return{uBlocksize:i.getUniformLocation(o,"uBlocksize"),uStepW:i.getUniformLocation(o,"uStepW"),uStepH:i.getUniformLocation(o,"uStepH")}},sendUniformData:function(i,o){i.uniform1f(o.uBlocksize,this.blocksize)}}),a.Image.filters.Pixelate.fromObject=a.Image.filters.BaseFilter.fromObject}(t),function(u){var a=u.fabric||(u.fabric={}),l=a.util.object.extend,m=a.Image.filters;m.RemoveColor=(0,a.util.createClass)(m.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uLow;\nuniform vec4 uHigh;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\nif(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\ngl_FragColor.a = 0.0;\n}\n}",distance:.02,useAlpha:!1,applyTo2d:function(o){var d,y,_,v,w=o.imageData.data,I=255*this.distance,A=new a.Color(this.color).getSource(),M=[A[0]-I,A[1]-I,A[2]-I],D=[A[0]+I,A[1]+I,A[2]+I];for(d=0;d<w.length;d+=4)_=w[d+1],v=w[d+2],(y=w[d])>M[0]&&_>M[1]&&v>M[2]&&y<D[0]&&_<D[1]&&v<D[2]&&(w[d+3]=0)},getUniformLocations:function(o,d){return{uLow:o.getUniformLocation(d,"uLow"),uHigh:o.getUniformLocation(d,"uHigh")}},sendUniformData:function(o,d){var y=new a.Color(this.color).getSource(),_=parseFloat(this.distance),w=[y[0]/255+_,y[1]/255+_,y[2]/255+_,1];o.uniform4fv(d.uLow,[0+y[0]/255-_,0+y[1]/255-_,0+y[2]/255-_,1]),o.uniform4fv(d.uHigh,w)},toObject:function(){return l(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),a.Image.filters.RemoveColor.fromObject=a.Image.filters.BaseFilter.fromObject}(t),function(u){var a=u.fabric||(u.fabric={}),l=a.Image.filters,m=a.util.createClass,i={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var o in i)l[o]=m(l.ColorMatrix,{type:o,matrix:i[o],mainParameter:!1,colorsOnly:!0}),a.Image.filters[o].fromObject=a.Image.filters.BaseFilter.fromObject}(t),function(u){var a=u.fabric,l=a.Image.filters;l.BlendColor=(0,a.util.createClass)(l.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:"gl_FragColor.rgb *= uColor.rgb;\n",screen:"gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\n",add:"gl_FragColor.rgb += uColor.rgb;\n",diff:"gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\n",subtract:"gl_FragColor.rgb -= uColor.rgb;\n",lighten:"gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\n",darken:"gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\n",exclusion:"gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n",overlay:"if (uColor.r < 0.5) {\ngl_FragColor.r *= 2.0 * uColor.r;\n} else {\ngl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n}\nif (uColor.g < 0.5) {\ngl_FragColor.g *= 2.0 * uColor.g;\n} else {\ngl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n}\nif (uColor.b < 0.5) {\ngl_FragColor.b *= 2.0 * uColor.b;\n} else {\ngl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n}\n",tint:"gl_FragColor.rgb *= (1.0 - uColor.a);\ngl_FragColor.rgb += uColor.rgb;\n"},buildSource:function(i){return"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ngl_FragColor = color;\nif (color.a > 0.0) {\n"+this.fragmentSource[i]+"}\n}"},retrieveShader:function(i){var o,d=this.type+"_"+this.mode;return i.programCache.hasOwnProperty(d)||(o=this.buildSource(this.mode),i.programCache[d]=this.createProgram(i.context,o)),i.programCache[d]},applyTo2d:function(i){var o,d,y,_,v,w,I,A=i.imageData.data,M=A.length,D=1-this.alpha;o=(I=new a.Color(this.color).getSource())[0]*this.alpha,d=I[1]*this.alpha,y=I[2]*this.alpha;for(var F=0;F<M;F+=4)switch(_=A[F],v=A[F+1],w=A[F+2],this.mode){case"multiply":A[F]=_*o/255,A[F+1]=v*d/255,A[F+2]=w*y/255;break;case"screen":A[F]=255-(255-_)*(255-o)/255,A[F+1]=255-(255-v)*(255-d)/255,A[F+2]=255-(255-w)*(255-y)/255;break;case"add":A[F]=_+o,A[F+1]=v+d,A[F+2]=w+y;break;case"diff":case"difference":A[F]=Math.abs(_-o),A[F+1]=Math.abs(v-d),A[F+2]=Math.abs(w-y);break;case"subtract":A[F]=_-o,A[F+1]=v-d,A[F+2]=w-y;break;case"darken":A[F]=Math.min(_,o),A[F+1]=Math.min(v,d),A[F+2]=Math.min(w,y);break;case"lighten":A[F]=Math.max(_,o),A[F+1]=Math.max(v,d),A[F+2]=Math.max(w,y);break;case"overlay":A[F]=o<128?2*_*o/255:255-2*(255-_)*(255-o)/255,A[F+1]=d<128?2*v*d/255:255-2*(255-v)*(255-d)/255,A[F+2]=y<128?2*w*y/255:255-2*(255-w)*(255-y)/255;break;case"exclusion":A[F]=o+_-2*o*_/255,A[F+1]=d+v-2*d*v/255,A[F+2]=y+w-2*y*w/255;break;case"tint":A[F]=o+_*D,A[F+1]=d+v*D,A[F+2]=y+w*D}},getUniformLocations:function(i,o){return{uColor:i.getUniformLocation(o,"uColor")}},sendUniformData:function(i,o){var d=new a.Color(this.color).getSource();d[0]=this.alpha*d[0]/255,d[1]=this.alpha*d[1]/255,d[2]=this.alpha*d[2]/255,d[3]=this.alpha,i.uniform4fv(o.uColor,d)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),a.Image.filters.BlendColor.fromObject=a.Image.filters.BaseFilter.fromObject}(t),function(u){var a=u.fabric,l=a.Image.filters;l.BlendImage=(0,a.util.createClass)(l.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nuniform mat3 uTransformMatrix;\nvoid main() {\nvTexCoord = aPosition;\nvTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:{multiply:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.rgba *= color2.rgba;\ngl_FragColor = color;\n}",mask:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.a = color2.a;\ngl_FragColor = color;\n}"},retrieveShader:function(i){var o=this.type+"_"+this.mode,d=this.fragmentSource[this.mode];return i.programCache.hasOwnProperty(o)||(i.programCache[o]=this.createProgram(i.context,d)),i.programCache[o]},applyToWebGL:function(i){var o=i.context,d=this.createTexture(i.filterBackend,this.image);this.bindAdditionalTexture(o,d,o.TEXTURE1),this.callSuper("applyToWebGL",i),this.unbindAdditionalTexture(o,o.TEXTURE1)},createTexture:function(i,o){return i.getCachedTexture(o.cacheKey,o._element)},calculateMatrix:function(){var i=this.image;return[1/i.scaleX,0,0,0,1/i.scaleY,0,-i.left/i._element.width,-i.top/i._element.height,1]},applyTo2d:function(i){var o,d,y,_,v,w,I,A,M,D,F,B=i.imageData,z=i.filterBackend.resources,K=B.data,oe=K.length,ne=B.width,ee=B.height,G=this.image;z.blendImage||(z.blendImage=a.util.createCanvasElement()),D=(M=z.blendImage).getContext("2d"),M.width!==ne||M.height!==ee?(M.width=ne,M.height=ee):D.clearRect(0,0,ne,ee),D.setTransform(G.scaleX,0,0,G.scaleY,G.left,G.top),D.drawImage(G._element,0,0,ne,ee),F=D.getImageData(0,0,ne,ee).data;for(var j=0;j<oe;j+=4)switch(v=K[j],w=K[j+1],I=K[j+2],A=K[j+3],o=F[j],d=F[j+1],y=F[j+2],_=F[j+3],this.mode){case"multiply":K[j]=v*o/255,K[j+1]=w*d/255,K[j+2]=I*y/255,K[j+3]=A*_/255;break;case"mask":K[j+3]=_}},getUniformLocations:function(i,o){return{uTransformMatrix:i.getUniformLocation(o,"uTransformMatrix"),uImage:i.getUniformLocation(o,"uImage")}},sendUniformData:function(i,o){var d=this.calculateMatrix();i.uniform1i(o.uImage,1),i.uniformMatrix3fv(o.uTransformMatrix,!1,d)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),a.Image.filters.BlendImage.fromObject=function(i,o){a.Image.fromObject(i.image,function(d){var y=a.util.object.clone(i);y.image=d,o(new a.Image.filters.BlendImage(y))})}}(t),function(u){var a=u.fabric||(u.fabric={}),l=Math.pow,m=Math.floor,i=Math.sqrt,o=Math.abs,d=Math.round,y=Math.sin,_=Math.ceil,v=a.Image.filters;v.Resize=(0,a.util.createClass)(v.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(I,A){return{uDelta:I.getUniformLocation(A,"uDelta"),uTaps:I.getUniformLocation(A,"uTaps")}},sendUniformData:function(I,A){I.uniform2fv(A.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),I.uniform1fv(A.uTaps,this.taps)},retrieveShader:function(I){var A=this.getFilterWindow(),M=this.type+"_"+A;if(!I.programCache.hasOwnProperty(M)){var D=this.generateShader(A);I.programCache[M]=this.createProgram(I.context,D)}return I.programCache[M]},getFilterWindow:function(){return Math.ceil(this.lanczosLobes/this.tempScale)},getTaps:function(){for(var I=this.lanczosCreate(this.lanczosLobes),A=this.tempScale,M=this.getFilterWindow(),D=new Array(M),F=1;F<=M;F++)D[F-1]=I(F*A);return D},generateShader:function(I){for(var A=new Array(I),M=this.fragmentSourceTOP,D=1;D<=I;D++)A[D-1]=D+".0 * uDelta";return M+="uniform float uTaps["+I+"];\n",M+="void main() {\n",M+="  vec4 color = texture2D(uTexture, vTexCoord);\n",M+="  float sum = 1.0;\n",A.forEach(function(F,B){M+="  color += texture2D(uTexture, vTexCoord + "+F+") * uTaps["+B+"];\n",M+="  color += texture2D(uTexture, vTexCoord - "+F+") * uTaps["+B+"];\n",M+="  sum += 2.0 * uTaps["+B+"];\n"}),M+="  gl_FragColor = color / sum;\n",M+="}"},fragmentSourceTOP:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\n",applyTo:function(I){I.webgl?(I.passes++,this.width=I.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=I.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),I.destinationWidth=this.dW,this._setupFrameBuffer(I),this.applyToWebGL(I),this._swapTextures(I),I.sourceWidth=I.destinationWidth,this.height=I.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),I.destinationHeight=this.dH,this._setupFrameBuffer(I),this.applyToWebGL(I),this._swapTextures(I),I.sourceHeight=I.destinationHeight):this.applyTo2d(I)},isNeutralState:function(){return 1===this.scaleX&&1===this.scaleY},lanczosCreate:function(I){return function(A){if(A>=I||A<=-I)return 0;if(A<1.1920929e-7&&A>-1.1920929e-7)return 1;var M=(A*=Math.PI)/I;return y(A)/A*y(M)/M}},applyTo2d:function(I){var A=I.imageData,M=this.scaleX,D=this.scaleY;this.rcpScaleX=1/M,this.rcpScaleY=1/D;var F,B=A.width,z=A.height,K=d(B*M),oe=d(z*D);"sliceHack"===this.resizeType?F=this.sliceByTwo(I,B,z,K,oe):"hermite"===this.resizeType?F=this.hermiteFastResize(I,B,z,K,oe):"bilinear"===this.resizeType?F=this.bilinearFiltering(I,B,z,K,oe):"lanczos"===this.resizeType&&(F=this.lanczosResize(I,B,z,K,oe)),I.imageData=F},sliceByTwo:function(I,A,M,D,F){var B,z,K=I.imageData,ne=!1,ee=!1,G=.5*A,j=.5*M,Q=a.filterBackend.resources,se=0,ae=0,Y=A,V=0;for(Q.sliceByTwo||(Q.sliceByTwo=document.createElement("canvas")),((B=Q.sliceByTwo).width<1.5*A||B.height<M)&&(B.width=1.5*A,B.height=M),(z=B.getContext("2d")).clearRect(0,0,1.5*A,M),z.putImageData(K,0,0),D=m(D),F=m(F);!ne||!ee;)A=G,M=j,D<m(.5*G)?G=m(.5*G):(G=D,ne=!0),F<m(.5*j)?j=m(.5*j):(j=F,ee=!0),z.drawImage(B,se,ae,A,M,Y,V,G,j),se=Y,ae=V,V+=j;return z.getImageData(se,ae,D,F)},lanczosResize:function(I,A,M,D,F){var B=I.imageData.data,z=I.ctx.createImageData(D,F),K=z.data,oe=this.lanczosCreate(this.lanczosLobes),ne=this.rcpScaleX,ee=this.rcpScaleY,G=2/this.rcpScaleX,j=2/this.rcpScaleY,Q=_(ne*this.lanczosLobes/2),se=_(ee*this.lanczosLobes/2),ae={},Y={},V={};return function $(le){var re,he,ve,fe,ue,pe,ge,Ce,Oe,we,Be;for(Y.x=(le+.5)*ne,V.x=m(Y.x),re=0;re<F;re++){for(Y.y=(re+.5)*ee,V.y=m(Y.y),ue=0,pe=0,ge=0,Ce=0,Oe=0,he=V.x-Q;he<=V.x+Q;he++)if(!(he<0||he>=A)){we=m(1e3*o(he-Y.x)),ae[we]||(ae[we]={});for(var Ke=V.y-se;Ke<=V.y+se;Ke++)Ke<0||Ke>=M||(Be=m(1e3*o(Ke-Y.y)),ae[we][Be]||(ae[we][Be]=oe(i(l(we*G,2)+l(Be*j,2))/1e3)),(ve=ae[we][Be])>0&&(ue+=ve,pe+=ve*B[fe=4*(Ke*A+he)],ge+=ve*B[fe+1],Ce+=ve*B[fe+2],Oe+=ve*B[fe+3]))}K[fe=4*(re*D+le)]=pe/ue,K[fe+1]=ge/ue,K[fe+2]=Ce/ue,K[fe+3]=Oe/ue}return++le<D?$(le):z}(0)},bilinearFiltering:function(I,A,M,D,F){var B,z,K,oe,ne,ee,G,Q,se=0,ae=this.rcpScaleX,Y=this.rcpScaleY,V=4*(A-1),$=I.imageData.data,le=I.ctx.createImageData(D,F),re=le.data;for(K=0;K<F;K++)for(oe=0;oe<D;oe++)for(ne=ae*oe-(B=m(ae*oe)),ee=Y*K-(z=m(Y*K)),Q=4*(z*A+B),G=0;G<4;G++)re[se++]=$[Q+G]*(1-ne)*(1-ee)+$[Q+4+G]*ne*(1-ee)+$[Q+V+G]*ee*(1-ne)+$[Q+V+4+G]*ne*ee;return le},hermiteFastResize:function(I,A,M,D,F){for(var B=this.rcpScaleX,z=this.rcpScaleY,K=_(B/2),oe=_(z/2),ne=I.imageData.data,ee=I.ctx.createImageData(D,F),G=ee.data,j=0;j<F;j++)for(var Q=0;Q<D;Q++){for(var se=4*(Q+j*D),ae=0,Y=0,V=0,$=0,le=0,re=0,he=0,ve=(j+.5)*z,fe=m(j*z);fe<(j+1)*z;fe++)for(var ue=o(ve-(fe+.5))/oe,pe=(Q+.5)*B,ge=ue*ue,Ce=m(Q*B);Ce<(Q+1)*B;Ce++){var Oe=o(pe-(Ce+.5))/K,we=i(ge+Oe*Oe);we>1&&we<-1||(ae=2*we*we*we-3*we*we+1)>0&&(he+=ae*ne[3+(Oe=4*(Ce+fe*A))],V+=ae,ne[Oe+3]<255&&(ae=ae*ne[Oe+3]/250),$+=ae*ne[Oe],le+=ae*ne[Oe+1],re+=ae*ne[Oe+2],Y+=ae)}G[se]=$/Y,G[se+1]=le/Y,G[se+2]=re/Y,G[se+3]=he/V}return ee},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),a.Image.filters.Resize.fromObject=a.Image.filters.BaseFilter.fromObject}(t),function(u){var a=u.fabric||(u.fabric={}),l=a.Image.filters;l.Contrast=(0,a.util.createClass)(l.BaseFilter,{type:"Contrast",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uContrast;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\ncolor.rgb = contrastF * (color.rgb - 0.5) + 0.5;\ngl_FragColor = color;\n}",contrast:0,mainParameter:"contrast",applyTo2d:function(i){if(0!==this.contrast){var o,d=i.imageData.data,y=d.length,_=Math.floor(255*this.contrast),v=259*(_+255)/(255*(259-_));for(o=0;o<y;o+=4)d[o]=v*(d[o]-128)+128,d[o+1]=v*(d[o+1]-128)+128,d[o+2]=v*(d[o+2]-128)+128}},getUniformLocations:function(i,o){return{uContrast:i.getUniformLocation(o,"uContrast")}},sendUniformData:function(i,o){i.uniform1f(o.uContrast,this.contrast)}}),a.Image.filters.Contrast.fromObject=a.Image.filters.BaseFilter.fromObject}(t),function(u){var a=u.fabric||(u.fabric={}),l=a.Image.filters;l.Saturation=(0,a.util.createClass)(l.BaseFilter,{type:"Saturation",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uSaturation;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat rgMax = max(color.r, color.g);\nfloat rgbMax = max(rgMax, color.b);\ncolor.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\ncolor.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\ncolor.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\ngl_FragColor = color;\n}",saturation:0,mainParameter:"saturation",applyTo2d:function(i){if(0!==this.saturation){var o,d,y=i.imageData.data,_=y.length,v=-this.saturation;for(o=0;o<_;o+=4)d=Math.max(y[o],y[o+1],y[o+2]),y[o]+=d!==y[o]?(d-y[o])*v:0,y[o+1]+=d!==y[o+1]?(d-y[o+1])*v:0,y[o+2]+=d!==y[o+2]?(d-y[o+2])*v:0}},getUniformLocations:function(i,o){return{uSaturation:i.getUniformLocation(o,"uSaturation")}},sendUniformData:function(i,o){i.uniform1f(o.uSaturation,-this.saturation)}}),a.Image.filters.Saturation.fromObject=a.Image.filters.BaseFilter.fromObject}(t),function(u){var a=u.fabric||(u.fabric={}),l=a.Image.filters;l.Vibrance=(0,a.util.createClass)(l.BaseFilter,{type:"Vibrance",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uVibrance;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat max = max(color.r, max(color.g, color.b));\nfloat avg = (color.r + color.g + color.b) / 3.0;\nfloat amt = (abs(max - avg) * 2.0) * uVibrance;\ncolor.r += max != color.r ? (max - color.r) * amt : 0.00;\ncolor.g += max != color.g ? (max - color.g) * amt : 0.00;\ncolor.b += max != color.b ? (max - color.b) * amt : 0.00;\ngl_FragColor = color;\n}",vibrance:0,mainParameter:"vibrance",applyTo2d:function(i){if(0!==this.vibrance){var o,d,_,v=i.imageData.data,w=v.length,I=-this.vibrance;for(o=0;o<w;o+=4)d=Math.max(v[o],v[o+1],v[o+2]),_=2*Math.abs(d-(v[o]+v[o+1]+v[o+2])/3)/255*I,v[o]+=d!==v[o]?(d-v[o])*_:0,v[o+1]+=d!==v[o+1]?(d-v[o+1])*_:0,v[o+2]+=d!==v[o+2]?(d-v[o+2])*_:0}},getUniformLocations:function(i,o){return{uVibrance:i.getUniformLocation(o,"uVibrance")}},sendUniformData:function(i,o){i.uniform1f(o.uVibrance,-this.vibrance)}}),a.Image.filters.Vibrance.fromObject=a.Image.filters.BaseFilter.fromObject}(t),function(u){var a=u.fabric||(u.fabric={}),l=a.Image.filters;l.Blur=(0,a.util.createClass)(l.BaseFilter,{type:"Blur",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\nconst float nSamples = 15.0;\nvec3 v3offset = vec3(12.9898, 78.233, 151.7182);\nfloat random(vec3 scale) {\nreturn fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n}\nvoid main() {\nvec4 color = vec4(0.0);\nfloat total = 0.0;\nfloat offset = random(v3offset);\nfor (float t = -nSamples; t <= nSamples; t++) {\nfloat percent = (t + offset - 0.5) / nSamples;\nfloat weight = 1.0 - abs(percent);\ncolor += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\ntotal += weight;\n}\ngl_FragColor = color / total;\n}",blur:0,mainParameter:"blur",applyTo:function(i){i.webgl?(this.aspectRatio=i.sourceWidth/i.sourceHeight,i.passes++,this._setupFrameBuffer(i),this.horizontal=!0,this.applyToWebGL(i),this._swapTextures(i),this._setupFrameBuffer(i),this.horizontal=!1,this.applyToWebGL(i),this._swapTextures(i)):this.applyTo2d(i)},applyTo2d:function(i){i.imageData=this.simpleBlur(i)},simpleBlur:function(i){var o,d,y=i.filterBackend.resources,_=i.imageData.width,v=i.imageData.height;y.blurLayer1||(y.blurLayer1=a.util.createCanvasElement(),y.blurLayer2=a.util.createCanvasElement()),d=y.blurLayer2,(o=y.blurLayer1).width===_&&o.height===v||(d.width=o.width=_,d.height=o.height=v);var w,I,A,M,D=o.getContext("2d"),F=d.getContext("2d"),B=.06*this.blur*.5;for(D.putImageData(i.imageData,0,0),F.clearRect(0,0,_,v),M=-15;M<=15;M++)A=B*(I=M/15)*_+(w=(Math.random()-.5)/4),F.globalAlpha=1-Math.abs(I),F.drawImage(o,A,w),D.drawImage(d,0,0),F.globalAlpha=1,F.clearRect(0,0,d.width,d.height);for(M=-15;M<=15;M++)A=B*(I=M/15)*v+(w=(Math.random()-.5)/4),F.globalAlpha=1-Math.abs(I),F.drawImage(o,w,A),D.drawImage(d,0,0),F.globalAlpha=1,F.clearRect(0,0,d.width,d.height);i.ctx.drawImage(o,0,0);var z=i.ctx.getImageData(0,0,o.width,o.height);return D.globalAlpha=1,D.clearRect(0,0,o.width,o.height),z},getUniformLocations:function(i,o){return{delta:i.getUniformLocation(o,"uDelta")}},sendUniformData:function(i,o){var d=this.chooseRightDelta();i.uniform2fv(o.delta,d)},chooseRightDelta:function(){var i,o=1,d=[0,0];return this.horizontal?this.aspectRatio>1&&(o=1/this.aspectRatio):this.aspectRatio<1&&(o=this.aspectRatio),i=o*this.blur*.12,this.horizontal?d[0]=i:d[1]=i,d}}),l.Blur.fromObject=a.Image.filters.BaseFilter.fromObject}(t),function(u){var a=u.fabric||(u.fabric={}),l=a.Image.filters;l.Gamma=(0,a.util.createClass)(l.BaseFilter,{type:"Gamma",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec3 uGamma;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec3 correction = (1.0 / uGamma);\ncolor.r = pow(color.r, correction.r);\ncolor.g = pow(color.g, correction.g);\ncolor.b = pow(color.b, correction.b);\ngl_FragColor = color;\ngl_FragColor.rgb *= color.a;\n}",gamma:[1,1,1],mainParameter:"gamma",initialize:function(i){this.gamma=[1,1,1],l.BaseFilter.prototype.initialize.call(this,i)},applyTo2d:function(i){var o,d=i.imageData.data,y=this.gamma,_=d.length,v=1/y[0],w=1/y[1],I=1/y[2];for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),o=0,_=256;o<_;o++)this.rVals[o]=255*Math.pow(o/255,v),this.gVals[o]=255*Math.pow(o/255,w),this.bVals[o]=255*Math.pow(o/255,I);for(o=0,_=d.length;o<_;o+=4)d[o]=this.rVals[d[o]],d[o+1]=this.gVals[d[o+1]],d[o+2]=this.bVals[d[o+2]]},getUniformLocations:function(i,o){return{uGamma:i.getUniformLocation(o,"uGamma")}},sendUniformData:function(i,o){i.uniform3fv(o.uGamma,this.gamma)}}),a.Image.filters.Gamma.fromObject=a.Image.filters.BaseFilter.fromObject}(t),function(u){var a=u.fabric||(u.fabric={}),l=a.Image.filters;l.Composed=(0,a.util.createClass)(l.BaseFilter,{type:"Composed",subFilters:[],initialize:function(i){this.callSuper("initialize",i),this.subFilters=this.subFilters.slice(0)},applyTo:function(i){i.passes+=this.subFilters.length-1,this.subFilters.forEach(function(o){o.applyTo(i)})},toObject:function(){return a.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(i){return i.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(i){return!i.isNeutralState()})}}),a.Image.filters.Composed.fromObject=function(i,o){var d=(i.subFilters||[]).map(function(_){return new a.Image.filters[_.type](_)}),y=new a.Image.filters.Composed({subFilters:d});return o&&o(y),y}}(t),function(u){var a=u.fabric||(u.fabric={}),l=a.Image.filters;l.HueRotation=(0,a.util.createClass)(l.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var i=this.rotation*Math.PI,o=a.util.cos(i),d=a.util.sin(i),y=1/3,_=Math.sqrt(y)*d,v=1-o;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=o+v/3,this.matrix[1]=y*v-_,this.matrix[2]=y*v+_,this.matrix[5]=y*v+_,this.matrix[6]=o+y*v,this.matrix[7]=y*v-_,this.matrix[10]=y*v-_,this.matrix[11]=y*v+_,this.matrix[12]=o+y*v},isNeutralState:function(i){return this.calculateMatrix(),l.BaseFilter.prototype.isNeutralState.call(this,i)},applyTo:function(i){this.calculateMatrix(),l.BaseFilter.prototype.applyTo.call(this,i)}}),a.Image.filters.HueRotation.fromObject=a.Image.filters.BaseFilter.fromObject}(t),function(u){var a=u.fabric||(u.fabric={}),l=a.util.object.clone;if(a.Text)a.warn("fabric.Text is already defined");else{var m="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");a.Text=a.util.createClass(a.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:a.Object.prototype.stateProperties.concat(m),cacheProperties:a.Object.prototype.cacheProperties.concat(m),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(i,o){this.styles=o&&o.styles||{},this.text=i,this.__skipDimension=!0,this.callSuper("initialize",o),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var i=this.path;i&&(i.segmentsInfo=a.util.getPathSegmentsInfo(i.path))},getMeasuringContext:function(){return a._measuringContext||(a._measuringContext=this.canvas&&this.canvas.contextCache||a.util.createCanvasElement().getContext("2d")),a._measuringContext},_splitText:function(){var i=this._splitTextIntoLines(this.text);return this.textLines=i.lines,this._textLines=i.graphemeLines,this._unwrappedTextLines=i._unwrappedLines,this._text=i.graphemeText,i},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var i,o,y,_,v,w,I=0,A=this._textLines.length;I<A;I++)if(("justify"===this.textAlign||I!==A-1&&!this.isEndOfWrapping(I))&&(y=0,_=this._textLines[I],(o=this.getLineWidth(I))<this.width&&(w=this.textLines[I].match(this._reSpacesAndTabs)))){i=(this.width-o)/w.length;for(var M=0,D=_.length;M<=D;M++)v=this.__charBounds[I][M],this._reSpaceAndTab.test(_[M])?(v.width+=i,v.kernedWidth+=i,v.left+=y,y+=i):v.left+=y}},isEndOfWrapping:function(i){return i===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var i=this.callSuper("_getCacheCanvasDimensions"),o=this.fontSize;return i.width+=o*i.zoomX,i.height+=o*i.zoomY,i},_render:function(i){var o=this.path;o&&!o.isNotVisible()&&o._render(i),this._setTextStyles(i),this._renderTextLinesBackground(i),this._renderTextDecoration(i,"underline"),this._renderText(i),this._renderTextDecoration(i,"overline"),this._renderTextDecoration(i,"linethrough")},_renderText:function(i){"stroke"===this.paintFirst?(this._renderTextStroke(i),this._renderTextFill(i)):(this._renderTextFill(i),this._renderTextStroke(i))},_setTextStyles:function(i,o,d){if(i.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":i.textBaseline="middle";break;case"ascender":i.textBaseline="top";break;case"descender":i.textBaseline="bottom"}i.font=this._getFontDeclaration(o,d)},calcTextWidth:function(){for(var i=this.getLineWidth(0),o=1,d=this._textLines.length;o<d;o++){var y=this.getLineWidth(o);y>i&&(i=y)}return i},_renderTextLine:function(i,o,d,y,_,v){this._renderChars(i,o,d,y,_,v)},_renderTextLinesBackground:function(i){if(this.textBackgroundColor||this.styleHas("textBackgroundColor")){for(var o,d,y,_,v,w,I,A=i.fillStyle,M=this._getLeftOffset(),D=this._getTopOffset(),F=0,B=0,z=this.path,K=0,oe=this._textLines.length;K<oe;K++)if(o=this.getHeightOfLine(K),this.textBackgroundColor||this.styleHas("textBackgroundColor",K)){y=this._textLines[K],d=this._getLineLeftOffset(K),B=0,F=0,_=this.getValueOfPropertyAt(K,0,"textBackgroundColor");for(var ne=0,ee=y.length;ne<ee;ne++)v=this.__charBounds[K][ne],w=this.getValueOfPropertyAt(K,ne,"textBackgroundColor"),z?(i.save(),i.translate(v.renderLeft,v.renderTop),i.rotate(v.angle),i.fillStyle=w,w&&i.fillRect(-v.width/2,-o/this.lineHeight*(1-this._fontSizeFraction),v.width,o/this.lineHeight),i.restore()):w!==_?(I=M+d+F,"rtl"===this.direction&&(I=this.width-I-B),i.fillStyle=_,_&&i.fillRect(I,D,B,o/this.lineHeight),F=v.left,B=v.width,_=w):B+=v.kernedWidth;w&&!z&&(I=M+d+F,"rtl"===this.direction&&(I=this.width-I-B),i.fillStyle=w,i.fillRect(I,D,B,o/this.lineHeight)),D+=o}else D+=o;i.fillStyle=A,this._removeShadow(i)}},getFontCache:function(i){var o=i.fontFamily.toLowerCase();a.charWidthsCache[o]||(a.charWidthsCache[o]={});var d=a.charWidthsCache[o],y=i.fontStyle.toLowerCase()+"_"+(i.fontWeight+"").toLowerCase();return d[y]||(d[y]={}),d[y]},_measureChar:function(i,o,d,y){var _,v,w,I,A=this.getFontCache(o),M=d+i,D=this._getFontDeclaration(o)===this._getFontDeclaration(y),F=o.fontSize/this.CACHE_FONT_SIZE;if(d&&void 0!==A[d]&&(w=A[d]),void 0!==A[i]&&(I=_=A[i]),D&&void 0!==A[M]&&(I=(v=A[M])-w),void 0===_||void 0===w||void 0===v){var B=this.getMeasuringContext();this._setTextStyles(B,o,!0)}return void 0===_&&(I=_=B.measureText(i).width,A[i]=_),void 0===w&&D&&d&&(w=B.measureText(d).width,A[d]=w),D&&void 0===v&&(v=B.measureText(M).width,A[M]=v,I=v-w),{width:_*F,kernedWidth:I*F}},getHeightOfChar:function(i,o){return this.getValueOfPropertyAt(i,o,"fontSize")},measureLine:function(i){var o=this._measureLine(i);return 0!==this.charSpacing&&(o.width-=this._getWidthOfCharSpacing()),o.width<0&&(o.width=0),o},_measureLine:function(i){var o,d,y,_,v,w,I=0,A=this._textLines[i],M=new Array(A.length),D=0,F=this.path,B="right"===this.pathSide;for(this.__charBounds[i]=M,o=0;o<A.length;o++)_=this._getGraphemeBox(d=A[o],i,o,y),M[o]=_,I+=_.kernedWidth,y=d;if(M[o]={left:_?_.left+_.width:0,width:0,kernedWidth:0,height:this.fontSize},F){switch(w=F.segmentsInfo[F.segmentsInfo.length-1].length,(v=a.util.getPointOnPath(F.path,0,F.segmentsInfo)).x+=F.pathOffset.x,v.y+=F.pathOffset.y,this.textAlign){case"left":D=B?w-I:0;break;case"center":D=(w-I)/2;break;case"right":D=B?0:w-I}for(D+=this.pathStartOffset*(B?-1:1),o=B?A.length-1:0;B?o>=0:o<A.length;B?o--:o++)D>w?D%=w:D<0&&(D+=w),this._setGraphemeOnPath(D,_=M[o],v),D+=_.kernedWidth}return{width:I,numOfSpaces:0}},_setGraphemeOnPath:function(i,o,d){var _=this.path,v=a.util.getPointOnPath(_.path,i+o.kernedWidth/2,_.segmentsInfo);o.renderLeft=v.x-d.x,o.renderTop=v.y-d.y,o.angle=v.angle+("right"===this.pathSide?Math.PI:0)},_getGraphemeBox:function(i,o,d,y,_){var v,w=this.getCompleteStyleDeclaration(o,d),I=y?this.getCompleteStyleDeclaration(o,d-1):{},A=this._measureChar(i,w,y,I),M=A.kernedWidth,D=A.width;0!==this.charSpacing&&(D+=v=this._getWidthOfCharSpacing(),M+=v);var F={width:D,left:0,height:w.fontSize,kernedWidth:M,deltaY:w.deltaY};if(d>0&&!_){var B=this.__charBounds[o][d-1];F.left=B.left+B.width+A.kernedWidth-A.width}return F},getHeightOfLine:function(i){if(this.__lineHeights[i])return this.__lineHeights[i];for(var o=this._textLines[i],d=this.getHeightOfChar(i,0),y=1,_=o.length;y<_;y++)d=Math.max(this.getHeightOfChar(i,y),d);return this.__lineHeights[i]=d*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var i,o=0,d=0,y=this._textLines.length;d<y;d++)i=this.getHeightOfLine(d),o+=d===y-1?i/this.lineHeight:i;return o},_getLeftOffset:function(){return"ltr"===this.direction?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(i,o){i.save();for(var d=0,y=this._getLeftOffset(),_=this._getTopOffset(),v=0,w=this._textLines.length;v<w;v++){var I=this.getHeightOfLine(v),A=I/this.lineHeight,M=this._getLineLeftOffset(v);this._renderTextLine(o,i,this._textLines[v],y+M,_+d+A,v),d+=I}i.restore()},_renderTextFill:function(i){(this.fill||this.styleHas("fill"))&&this._renderTextCommon(i,"fillText")},_renderTextStroke:function(i){(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(i),i.save(),this._setLineDash(i,this.strokeDashArray),i.beginPath(),this._renderTextCommon(i,"strokeText"),i.closePath(),i.restore())},_renderChars:function(i,o,d,y,_,v){var w,I,A,M,F=this.getHeightOfLine(v),B=-1!==this.textAlign.indexOf("justify"),z="",K=0,oe=this.path,ne=!B&&0===this.charSpacing&&this.isEmptyStyles(v)&&!oe,ee="ltr"===this.direction,G="ltr"===this.direction?1:-1,j=o.canvas.getAttribute("dir");if(o.save(),j!==this.direction&&(o.canvas.setAttribute("dir",ee?"ltr":"rtl"),o.direction=ee?"ltr":"rtl",o.textAlign=ee?"left":"right"),_-=F*this._fontSizeFraction/this.lineHeight,ne)return this._renderChar(i,o,v,0,d.join(""),y,_,F),void o.restore();for(var Q=0,se=d.length-1;Q<=se;Q++)M=Q===se||this.charSpacing||oe,z+=d[Q],A=this.__charBounds[v][Q],0===K?(y+=G*(A.kernedWidth-A.width),K+=A.width):K+=A.kernedWidth,B&&!M&&this._reSpaceAndTab.test(d[Q])&&(M=!0),M||(w=w||this.getCompleteStyleDeclaration(v,Q),I=this.getCompleteStyleDeclaration(v,Q+1),M=this._hasStyleChanged(w,I)),M&&(oe?(o.save(),o.translate(A.renderLeft,A.renderTop),o.rotate(A.angle),this._renderChar(i,o,v,Q,z,-K/2,0,F),o.restore()):this._renderChar(i,o,v,Q,z,y,_,F),z="",w=I,y+=G*K,K=0);o.restore()},_applyPatternGradientTransformText:function(i){var o,d=a.util.createCanvasElement(),y=this.width+this.strokeWidth,_=this.height+this.strokeWidth;return d.width=y,d.height=_,(o=d.getContext("2d")).beginPath(),o.moveTo(0,0),o.lineTo(y,0),o.lineTo(y,_),o.lineTo(0,_),o.closePath(),o.translate(y/2,_/2),o.fillStyle=i.toLive(o),this._applyPatternGradientTransform(o,i),o.fill(),o.createPattern(d,"no-repeat")},handleFiller:function(i,o,d){var y,_;return d.toLive?"percentage"===d.gradientUnits||d.gradientTransform||d.patternTransform?(i.translate(y=-this.width/2,_=-this.height/2),i[o]=this._applyPatternGradientTransformText(d),{offsetX:y,offsetY:_}):(i[o]=d.toLive(i,this),this._applyPatternGradientTransform(i,d)):(i[o]=d,{offsetX:0,offsetY:0})},_setStrokeStyles:function(i,o){return i.lineWidth=o.strokeWidth,i.lineCap=this.strokeLineCap,i.lineDashOffset=this.strokeDashOffset,i.lineJoin=this.strokeLineJoin,i.miterLimit=this.strokeMiterLimit,this.handleFiller(i,"strokeStyle",o.stroke)},_setFillStyles:function(i,o){return this.handleFiller(i,"fillStyle",o.fill)},_renderChar:function(i,o,d,y,_,v,w){var I,A,M=this._getStyleDeclaration(d,y),D=this.getCompleteStyleDeclaration(d,y),F="fillText"===i&&D.fill,B="strokeText"===i&&D.stroke&&D.strokeWidth;(B||F)&&(o.save(),F&&(I=this._setFillStyles(o,D)),B&&(A=this._setStrokeStyles(o,D)),o.font=this._getFontDeclaration(D),M&&M.textBackgroundColor&&this._removeShadow(o),M&&M.deltaY&&(w+=M.deltaY),F&&o.fillText(_,v-I.offsetX,w-I.offsetY),B&&o.strokeText(_,v-A.offsetX,w-A.offsetY),o.restore())},setSuperscript:function(i,o){return this._setScript(i,o,this.superscript)},setSubscript:function(i,o){return this._setScript(i,o,this.subscript)},_setScript:function(i,o,d){var y=this.get2DCursorLocation(i,!0),_=this.getValueOfPropertyAt(y.lineIndex,y.charIndex,"fontSize"),v=this.getValueOfPropertyAt(y.lineIndex,y.charIndex,"deltaY");return this.setSelectionStyles({fontSize:_*d.size,deltaY:v+_*d.baseline},i,o),this},_hasStyleChanged:function(i,o){return i.fill!==o.fill||i.stroke!==o.stroke||i.strokeWidth!==o.strokeWidth||i.fontSize!==o.fontSize||i.fontFamily!==o.fontFamily||i.fontWeight!==o.fontWeight||i.fontStyle!==o.fontStyle||i.deltaY!==o.deltaY},_hasStyleChangedForSvg:function(i,o){return this._hasStyleChanged(i,o)||i.overline!==o.overline||i.underline!==o.underline||i.linethrough!==o.linethrough},_getLineLeftOffset:function(i){var o=this.getLineWidth(i),d=this.width-o,y=this.textAlign,_=this.direction,v=0,w=this.isEndOfWrapping(i);return"justify"===y||"justify-center"===y&&!w||"justify-right"===y&&!w||"justify-left"===y&&!w?0:("center"===y&&(v=d/2),"right"===y&&(v=d),"justify-center"===y&&(v=d/2),"justify-right"===y&&(v=d),"rtl"===_&&(v-=d),v)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var i=this._forceClearCache;return i||(i=this.hasStateChanged("_dimensionAffectingProps")),i&&(this.dirty=!0,this._forceClearCache=!1),i},getLineWidth:function(i){if(void 0!==this.__lineWidths[i])return this.__lineWidths[i];var o=this.measureLine(i).width;return this.__lineWidths[i]=o,o},_getWidthOfCharSpacing:function(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(i,o,d){var y=this._getStyleDeclaration(i,o);return y&&void 0!==y[d]?y[d]:this[d]},_renderTextDecoration:function(i,o){if(this[o]||this.styleHas(o)){for(var d,y,_,v,w,I,A,M,D,F,B,z,K,oe,ne,ee,G=this._getLeftOffset(),j=this._getTopOffset(),Q=this.path,se=this._getWidthOfCharSpacing(),ae=this.offsets[o],Y=0,V=this._textLines.length;Y<V;Y++)if(d=this.getHeightOfLine(Y),this[o]||this.styleHas(o,Y)){A=this._textLines[Y],oe=d/this.lineHeight,v=this._getLineLeftOffset(Y),F=0,B=0,M=this.getValueOfPropertyAt(Y,0,o),ee=this.getValueOfPropertyAt(Y,0,"fill"),D=j+oe*(1-this._fontSizeFraction),y=this.getHeightOfChar(Y,0),w=this.getValueOfPropertyAt(Y,0,"deltaY");for(var $=0,le=A.length;$<le;$++)if(z=this.__charBounds[Y][$],K=this.getValueOfPropertyAt(Y,$,o),ne=this.getValueOfPropertyAt(Y,$,"fill"),_=this.getHeightOfChar(Y,$),I=this.getValueOfPropertyAt(Y,$,"deltaY"),Q&&K&&ne)i.save(),i.fillStyle=ee,i.translate(z.renderLeft,z.renderTop),i.rotate(z.angle),i.fillRect(-z.kernedWidth/2,ae*_+I,z.kernedWidth,this.fontSize/15),i.restore();else if((K!==M||ne!==ee||_!==y||I!==w)&&B>0){var re=G+v+F;"rtl"===this.direction&&(re=this.width-re-B),M&&ee&&(i.fillStyle=ee,i.fillRect(re,D+ae*y+w,B,this.fontSize/15)),F=z.left,B=z.width,M=K,ee=ne,y=_,w=I}else B+=z.kernedWidth;re=G+v+F,"rtl"===this.direction&&(re=this.width-re-B),i.fillStyle=ne,K&&ne&&i.fillRect(re,D+ae*y+w,B-se,this.fontSize/15),j+=d}else j+=d;this._removeShadow(i)}},_getFontDeclaration:function(i,o){var d=i||this,y=this.fontFamily,_=a.Text.genericFonts.indexOf(y.toLowerCase())>-1,v=void 0===y||y.indexOf("'")>-1||y.indexOf(",")>-1||y.indexOf('"')>-1||_?d.fontFamily:'"'+d.fontFamily+'"';return[a.isLikelyNode?d.fontWeight:d.fontStyle,a.isLikelyNode?d.fontStyle:d.fontWeight,o?this.CACHE_FONT_SIZE+"px":d.fontSize+"px",v].join(" ")},render:function(i){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",i)))},_splitTextIntoLines:function(i){for(var o=i.split(this._reNewline),d=new Array(o.length),y=["\n"],_=[],v=0;v<o.length;v++)d[v]=a.util.string.graphemeSplit(o[v]),_=_.concat(d[v],y);return _.pop(),{_unwrappedLines:d,lines:o,graphemeText:_,graphemeLines:d}},toObject:function(i){var o=m.concat(i),d=this.callSuper("toObject",o);return d.styles=l(this.styles,!0),d.path&&(d.path=this.path.toObject()),d},set:function(i,o){this.callSuper("set",i,o);var d=!1,y=!1;if("object"==typeof i)for(var _ in i)"path"===_&&this.setPathInfo(),d=d||-1!==this._dimensionAffectingProps.indexOf(_),y=y||"path"===_;else d=-1!==this._dimensionAffectingProps.indexOf(i),y="path"===i;return y&&this.setPathInfo(),d&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),a.Text.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),a.Text.DEFAULT_SVG_FONT_SIZE=16,a.Text.fromElement=function(i,o,d){if(!i)return o(null);var y=a.parseAttributes(i,a.Text.ATTRIBUTE_NAMES),_=y.textAnchor||"left";if((d=a.util.object.extend(d?l(d):{},y)).top=d.top||0,d.left=d.left||0,y.textDecoration){var v=y.textDecoration;-1!==v.indexOf("underline")&&(d.underline=!0),-1!==v.indexOf("overline")&&(d.overline=!0),-1!==v.indexOf("line-through")&&(d.linethrough=!0),delete d.textDecoration}"dx"in y&&(d.left+=y.dx),"dy"in y&&(d.top+=y.dy),"fontSize"in d||(d.fontSize=a.Text.DEFAULT_SVG_FONT_SIZE);var w="";"textContent"in i?w=i.textContent:"firstChild"in i&&null!==i.firstChild&&"data"in i.firstChild&&null!==i.firstChild.data&&(w=i.firstChild.data),w=w.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var I=d.strokeWidth;d.strokeWidth=0;var A=new a.Text(w,d),M=A.getScaledHeight()/A.height,D=((A.height+A.strokeWidth)*A.lineHeight-A.height)*M,F=A.getScaledHeight()+D,B=0;"center"===_&&(B=A.getScaledWidth()/2),"right"===_&&(B=A.getScaledWidth()),A.set({left:A.left-B,top:A.top-(F-A.fontSize*(.07+A._fontSizeFraction))/A.lineHeight,strokeWidth:void 0!==I?I:1}),o(A)},a.Text.fromObject=function(i,o){var d=l(i),y=i.path;return delete d.path,a.Object._fromObject("Text",d,function(_){y?a.Object._fromObject("Path",y,function(v){_.set("path",v),o(_)},"path"):o(_)},"text")},a.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],a.util.createAccessors&&a.util.createAccessors(a.Text)}}(t),b.util.object.extend(b.Text.prototype,{isEmptyStyles:function(u){if(!this.styles||void 0!==u&&!this.styles[u])return!0;var a=void 0===u?this.styles:{line:this.styles[u]};for(var l in a)for(var m in a[l])for(var i in a[l][m])return!1;return!0},styleHas:function(u,a){if(!this.styles||!u||""===u||void 0!==a&&!this.styles[a])return!1;var l=void 0===a?this.styles:{0:this.styles[a]};for(var m in l)for(var i in l[m])if(void 0!==l[m][i][u])return!0;return!1},cleanStyle:function(u){if(!this.styles||!u||""===u)return!1;var a,l,m=this.styles,i=0,o=!0,d=0;for(var y in m){for(var _ in a=0,m[y]){var v;i++,(v=m[y][_]).hasOwnProperty(u)?(l?v[u]!==l&&(o=!1):l=v[u],v[u]===this[u]&&delete v[u]):o=!1,0!==Object.keys(v).length?a++:delete m[y][_]}0===a&&delete m[y]}for(var w=0;w<this._textLines.length;w++)d+=this._textLines[w].length;o&&i===d&&(this[u]=l,this.removeStyle(u))},removeStyle:function(u){if(this.styles&&u&&""!==u){var a,l,m,i=this.styles;for(l in i){for(m in a=i[l])delete a[m][u],0===Object.keys(a[m]).length&&delete a[m];0===Object.keys(a).length&&delete i[l]}}},_extendStyles:function(u,a){var l=this.get2DCursorLocation(u);this._getLineStyle(l.lineIndex)||this._setLineStyle(l.lineIndex),this._getStyleDeclaration(l.lineIndex,l.charIndex)||this._setStyleDeclaration(l.lineIndex,l.charIndex,{}),b.util.object.extend(this._getStyleDeclaration(l.lineIndex,l.charIndex),a)},get2DCursorLocation:function(u,a){void 0===u&&(u=this.selectionStart);for(var l=a?this._unwrappedTextLines:this._textLines,m=l.length,i=0;i<m;i++){if(u<=l[i].length)return{lineIndex:i,charIndex:u};u-=l[i].length+this.missingNewlineOffset(i)}return{lineIndex:i-1,charIndex:l[i-1].length<u?l[i-1].length:u}},getSelectionStyles:function(u,a,l){void 0===u&&(u=this.selectionStart||0),void 0===a&&(a=this.selectionEnd||u);for(var m=[],i=u;i<a;i++)m.push(this.getStyleAtPosition(i,l));return m},getStyleAtPosition:function(u,a){var l=this.get2DCursorLocation(u);return(a?this.getCompleteStyleDeclaration(l.lineIndex,l.charIndex):this._getStyleDeclaration(l.lineIndex,l.charIndex))||{}},setSelectionStyles:function(u,a,l){void 0===a&&(a=this.selectionStart||0),void 0===l&&(l=this.selectionEnd||a);for(var m=a;m<l;m++)this._extendStyles(m,u);return this._forceClearCache=!0,this},_getStyleDeclaration:function(u,a){var l=this.styles&&this.styles[u];return l?l[a]:null},getCompleteStyleDeclaration:function(u,a){for(var l,m=this._getStyleDeclaration(u,a)||{},i={},o=0;o<this._styleProperties.length;o++)i[l=this._styleProperties[o]]=void 0===m[l]?this[l]:m[l];return i},_setStyleDeclaration:function(u,a,l){this.styles[u][a]=l},_deleteStyleDeclaration:function(u,a){delete this.styles[u][a]},_getLineStyle:function(u){return!!this.styles[u]},_setLineStyle:function(u){this.styles[u]={}},_deleteLineStyle:function(u){delete this.styles[u]}}),function(){function u(a){a.textDecoration&&(a.textDecoration.indexOf("underline")>-1&&(a.underline=!0),a.textDecoration.indexOf("line-through")>-1&&(a.linethrough=!0),a.textDecoration.indexOf("overline")>-1&&(a.overline=!0),delete a.textDecoration)}b.IText=b.util.createClass(b.Text,b.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(a,l){this.callSuper("initialize",a,l),this.initBehavior()},setSelectionStart:function(a){a=Math.max(a,0),this._updateAndFire("selectionStart",a)},setSelectionEnd:function(a){a=Math.min(a,this.text.length),this._updateAndFire("selectionEnd",a)},_updateAndFire:function(a,l){this[a]!==l&&(this._fireSelectionChanged(),this[a]=l),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(a){this.clearContextTop(),this.callSuper("render",a),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(a){this.callSuper("_render",a)},clearContextTop:function(a){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var l=this.canvas.contextTop,m=this.canvas.viewportTransform;l.save(),l.transform(m[0],m[1],m[2],m[3],m[4],m[5]),this.transform(l),this._clearTextArea(l),a||l.restore()}},renderCursorOrSelection:function(){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var a=this._getCursorBoundaries(),l=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(a,l):this.renderSelection(a,l),l.restore()}},_clearTextArea:function(a){var l=this.width+4,m=this.height+4;a.clearRect(-l/2,-m/2,l,m)},_getCursorBoundaries:function(a){void 0===a&&(a=this.selectionStart);var l=this._getLeftOffset(),m=this._getTopOffset(),i=this._getCursorBoundariesOffsets(a);return{left:l,top:m,leftOffset:i.left,topOffset:i.top}},_getCursorBoundariesOffsets:function(a){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var l,m,i,o,d=0,y=0,_=this.get2DCursorLocation(a);i=_.charIndex,m=_.lineIndex;for(var v=0;v<m;v++)d+=this.getHeightOfLine(v);l=this._getLineLeftOffset(m);var w=this.__charBounds[m][i];return w&&(y=w.left),0!==this.charSpacing&&i===this._textLines[m].length&&(y-=this._getWidthOfCharSpacing()),o={top:d,left:l+(y>0?y:0)},"rtl"===this.direction&&(o.left*=-1),this.cursorOffsetCache=o,this.cursorOffsetCache},renderCursor:function(a,l){var m=this.get2DCursorLocation(),i=m.lineIndex,o=m.charIndex>0?m.charIndex-1:0,d=this.getValueOfPropertyAt(i,o,"fontSize"),y=this.scaleX*this.canvas.getZoom(),_=this.cursorWidth/y,v=a.topOffset,w=this.getValueOfPropertyAt(i,o,"deltaY");v+=(1-this._fontSizeFraction)*this.getHeightOfLine(i)/this.lineHeight-d*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(a,l),l.fillStyle=this.cursorColor||this.getValueOfPropertyAt(i,o,"fill"),l.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,l.fillRect(a.left+a.leftOffset-_/2,v+a.top+w,_,d)},renderSelection:function(a,l){for(var m=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,i=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,o=-1!==this.textAlign.indexOf("justify"),d=this.get2DCursorLocation(m),y=this.get2DCursorLocation(i),_=d.lineIndex,v=y.lineIndex,w=d.charIndex<0?0:d.charIndex,I=y.charIndex<0?0:y.charIndex,A=_;A<=v;A++){var M,D=this._getLineLeftOffset(A)||0,F=this.getHeightOfLine(A),B=0,z=0;if(A===_&&(B=this.__charBounds[_][w].left),A>=_&&A<v)z=o&&!this.isEndOfWrapping(A)?this.width:this.getLineWidth(A)||5;else if(A===v)if(0===I)z=this.__charBounds[v][I].left;else{var K=this._getWidthOfCharSpacing();z=this.__charBounds[v][I-1].left+this.__charBounds[v][I-1].width-K}M=F,(this.lineHeight<1||A===v&&this.lineHeight>1)&&(F/=this.lineHeight);var oe=a.left+D+B,ne=z-B,ee=F,G=0;this.inCompositionMode?(l.fillStyle=this.compositionColor||"black",ee=1,G=F):l.fillStyle=this.selectionColor,"rtl"===this.direction&&(oe=this.width-oe-ne),l.fillRect(oe,a.top+a.topOffset+G,ne,ee),a.topOffset+=M}},getCurrentCharFontSize:function(){var a=this._getCurrentCharIndex();return this.getValueOfPropertyAt(a.l,a.c,"fontSize")},getCurrentCharColor:function(){var a=this._getCurrentCharIndex();return this.getValueOfPropertyAt(a.l,a.c,"fill")},_getCurrentCharIndex:function(){var a=this.get2DCursorLocation(this.selectionStart,!0);return{l:a.lineIndex,c:a.charIndex>0?a.charIndex-1:0}}}),b.IText.fromObject=function(a,l){if(u(a),a.styles)for(var m in a.styles)for(var i in a.styles[m])u(a.styles[m][i]);b.Object._fromObject("IText",a,l,"text")}}(),Ie=b.util.object.clone,b.util.object.extend(b.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var u=this;this.on("added",function(){var a=u.canvas;a&&(a._hasITextHandlers||(a._hasITextHandlers=!0,u._initCanvasHandlers(a)),a._iTextInstances=a._iTextInstances||[],a._iTextInstances.push(u))})},initRemovedHandler:function(){var u=this;this.on("removed",function(){var a=u.canvas;a&&(a._iTextInstances=a._iTextInstances||[],b.util.removeFromArray(a._iTextInstances,u),0===a._iTextInstances.length&&(a._hasITextHandlers=!1,u._removeCanvasHandlers(a)))})},_initCanvasHandlers:function(u){u._mouseUpITextHandler=function(){u._iTextInstances&&u._iTextInstances.forEach(function(a){a.__isMousedown=!1})},u.on("mouse:up",u._mouseUpITextHandler)},_removeCanvasHandlers:function(u){u.off("mouse:up",u._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(u,a,l,m){var i;return i={isAborted:!1,abort:function(){this.isAborted=!0}},u.animate("_currentCursorOpacity",a,{duration:l,onComplete:function(){i.isAborted||u[m]()},onChange:function(){u.canvas&&u.selectionStart===u.selectionEnd&&u.renderCursorOrSelection()},abort:function(){return i.isAborted}}),i},_onTickComplete:function(){var u=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){u._currentTickCompleteState=u._animateCursor(u,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(u){var a=this,l=u?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){a._tick()},l)},abortCursorAnimation:function(){var u=this._currentTickState||this._currentTickCompleteState,a=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,u&&a&&a.clearContext(a.contextTop||a.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(u){var a=0,l=u-1;if(this._reSpace.test(this._text[l]))for(;this._reSpace.test(this._text[l]);)a++,l--;for(;/\S/.test(this._text[l])&&l>-1;)a++,l--;return u-a},findWordBoundaryRight:function(u){var a=0,l=u;if(this._reSpace.test(this._text[l]))for(;this._reSpace.test(this._text[l]);)a++,l++;for(;/\S/.test(this._text[l])&&l<this._text.length;)a++,l++;return u+a},findLineBoundaryLeft:function(u){for(var a=0,l=u-1;!/\n/.test(this._text[l])&&l>-1;)a++,l--;return u-a},findLineBoundaryRight:function(u){for(var a=0,l=u;!/\n/.test(this._text[l])&&l<this._text.length;)a++,l++;return u+a},searchWordBoundary:function(u,a){for(var l=this._text,m=this._reSpace.test(l[u])?u-1:u,i=l[m],o=b.reNonWord;!o.test(i)&&m>0&&m<l.length;)i=l[m+=a];return o.test(i)&&(m+=1===a?0:1),m},selectWord:function(u){var a=this.searchWordBoundary(u=u||this.selectionStart,-1),l=this.searchWordBoundary(u,1);this.selectionStart=a,this.selectionEnd=l,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(u){var a=this.findLineBoundaryLeft(u=u||this.selectionStart),l=this.findLineBoundaryRight(u);return this.selectionStart=a,this.selectionEnd=l,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(u){if(!this.isEditing&&this.editable)return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(u),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(u){u._iTextInstances&&u._iTextInstances.forEach(function(a){a.selected=!1,a.isEditing&&a.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(u){if(this.__isMousedown&&this.isEditing){var a=this.getSelectionStartFromPointer(u.e),l=this.selectionStart,m=this.selectionEnd;(a===this.__selectionStartOnMouseDown&&l!==m||l!==a&&m!==a)&&(a>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=a):(this.selectionStart=a,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===l&&this.selectionEnd===m||(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(u,a,l){var m=l.slice(0,u),i=b.util.string.graphemeSplit(m).length;if(u===a)return{selectionStart:i,selectionEnd:i};var o=l.slice(u,a);return{selectionStart:i,selectionEnd:i+b.util.string.graphemeSplit(o).length}},fromGraphemeToStringSelection:function(u,a,l){var m=l.slice(0,u).join("").length;return u===a?{selectionStart:m,selectionEnd:m}:{selectionStart:m,selectionEnd:m+l.slice(u,a).join("").length}},_updateTextarea:function(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){var u=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=u.selectionStart,this.hiddenTextarea.selectionEnd=u.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var u=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=u.selectionEnd,this.inCompositionMode||(this.selectionStart=u.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var u=this._calcTextareaPosition();this.hiddenTextarea.style.left=u.left,this.hiddenTextarea.style.top=u.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var u=this.inCompositionMode?this.compositionStart:this.selectionStart,a=this._getCursorBoundaries(u),l=this.get2DCursorLocation(u),o=this.getValueOfPropertyAt(l.lineIndex,l.charIndex,"fontSize")*this.lineHeight,d=a.leftOffset,y=this.calcTransformMatrix(),_={x:a.left+d,y:a.top+a.topOffset+o},v=this.canvas.getRetinaScaling(),w=this.canvas.upperCanvasEl,I=w.width/v,A=w.height/v,M=I-o,D=A-o,F=w.clientWidth/I,B=w.clientHeight/A;return _=b.util.transformPoint(_,y),(_=b.util.transformPoint(_,this.canvas.viewportTransform)).x*=F,_.y*=B,_.x<0&&(_.x=0),_.x>M&&(_.x=M),_.y<0&&(_.y=0),_.y>D&&(_.y=D),_.x+=this.canvas._offset.left,_.y+=this.canvas._offset.top,{left:_.x+"px",top:_.y+"px",fontSize:o+"px",charHeight:o}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var u=this._textBeforeEdit!==this.text,a=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,a&&(a.blur&&a.blur(),a.parentNode&&a.parentNode.removeChild(a)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),u&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),u&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var u in this.styles)this._textLines[u]||delete this.styles[u]},removeStyleFromTo:function(u,a){var l,m,i=this.get2DCursorLocation(u,!0),o=this.get2DCursorLocation(a,!0),d=i.lineIndex,y=i.charIndex,_=o.lineIndex,v=o.charIndex;if(d!==_){if(this.styles[d])for(l=y;l<this._unwrappedTextLines[d].length;l++)delete this.styles[d][l];if(this.styles[_])for(l=v;l<this._unwrappedTextLines[_].length;l++)(m=this.styles[_][l])&&(this.styles[d]||(this.styles[d]={}),this.styles[d][y+l-v]=m);for(l=d+1;l<=_;l++)delete this.styles[l];this.shiftLineStyles(_,d-_)}else if(this.styles[d]){m=this.styles[d];var w,I,A=v-y;for(l=y;l<v;l++)delete m[l];for(I in this.styles[d])(w=parseInt(I,10))>=v&&(m[w-A]=m[I],delete m[I])}},shiftLineStyles:function(u,a){var l=Ie(this.styles);for(var m in this.styles){var i=parseInt(m,10);i>u&&(this.styles[i+a]=l[i],l[i-a]||delete this.styles[i])}},restartCursorIfNeeded:function(){this._currentTickState&&!this._currentTickState.isAborted&&this._currentTickCompleteState&&!this._currentTickCompleteState.isAborted||this.initDelayedCursor()},insertNewlineStyleObject:function(u,a,l,m){var i,o={},d=!1,y=this._unwrappedTextLines[u].length===a;for(var _ in l||(l=1),this.shiftLineStyles(u,l),this.styles[u]&&(i=this.styles[u][0===a?a:a-1]),this.styles[u]){var v=parseInt(_,10);v>=a&&(d=!0,o[v-a]=this.styles[u][_],y&&0===a||delete this.styles[u][_])}var w=!1;for(d&&!y&&(this.styles[u+l]=o,w=!0),w&&l--;l>0;)m&&m[l-1]?this.styles[u+l]={0:Ie(m[l-1])}:i?this.styles[u+l]={0:Ie(i)}:delete this.styles[u+l],l--;this._forceClearCache=!0},insertCharStyleObject:function(u,a,l,m){this.styles||(this.styles={});var i=this.styles[u],o=i?Ie(i):{};for(var d in l||(l=1),o){var y=parseInt(d,10);y>=a&&(i[y+l]=o[y],o[y-l]||delete i[y])}if(this._forceClearCache=!0,m)for(;l--;)Object.keys(m[l]).length&&(this.styles[u]||(this.styles[u]={}),this.styles[u][a+l]=Ie(m[l]));else if(i)for(var _=i[a?a-1:1];_&&l--;)this.styles[u][a+l]=Ie(_)},insertNewStyleBlock:function(u,a,l){for(var m=this.get2DCursorLocation(a,!0),i=[0],o=0,d=0;d<u.length;d++)"\n"===u[d]?i[++o]=0:i[o]++;for(i[0]>0&&(this.insertCharStyleObject(m.lineIndex,m.charIndex,i[0],l),l=l&&l.slice(i[0]+1)),o&&this.insertNewlineStyleObject(m.lineIndex,m.charIndex+i[0],o),d=1;d<o;d++)i[d]>0?this.insertCharStyleObject(m.lineIndex+d,0,i[d],l):l&&this.styles[m.lineIndex+d]&&l[0]&&(this.styles[m.lineIndex+d][0]=l[0]),l=l&&l.slice(i[d]+1);i[d]>0&&this.insertCharStyleObject(m.lineIndex+d,0,i[d],l)},setSelectionStartEndWithShift:function(u,a,l){l<=u?(a===u?this._selectionDirection="left":"right"===this._selectionDirection&&(this._selectionDirection="left",this.selectionEnd=u),this.selectionStart=l):l>u&&l<a?"right"===this._selectionDirection?this.selectionEnd=l:this.selectionStart=l:(a===u?this._selectionDirection="right":"left"===this._selectionDirection&&(this._selectionDirection="right",this.selectionStart=a),this.selectionEnd=l)},setSelectionInBoundaries:function(){var u=this.text.length;this.selectionStart>u?this.selectionStart=u:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>u?this.selectionEnd=u:this.selectionEnd<0&&(this.selectionEnd=0)}}),b.util.object.extend(b.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(u){if(this.canvas){this.__newClickTime=+new Date;var a=u.pointer;this.isTripleClick(a)&&(this.fire("tripleclick",u),this._stopEvent(u.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=a,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(u){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===u.x&&this.__lastPointer.y===u.y},_stopEvent:function(u){u.preventDefault&&u.preventDefault(),u.stopPropagation&&u.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(u){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(u.e))},tripleClickHandler:function(u){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(u.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(u){!this.canvas||!this.editable||u.e.button&&1!==u.e.button||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(u.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(u){!this.canvas||!this.editable||u.e.button&&1!==u.e.button||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(u){if(this.__isMousedown=!1,!(!this.editable||this.group||u.transform&&u.transform.actionPerformed||u.e.button&&1!==u.e.button)){if(this.canvas){var a=this.canvas._activeObject;if(a&&a!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(u.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(u){var a=this.getSelectionStartFromPointer(u);u.shiftKey?this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,a):(this.selectionStart=a,this.selectionEnd=a),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(u){for(var a,l=this.getLocalPointer(u),m=0,i=0,o=0,d=0,y=0,_=0,v=this._textLines.length;_<v&&o<=l.y;_++)o+=this.getHeightOfLine(_)*this.scaleY,y=_,_>0&&(d+=this._textLines[_-1].length+this.missingNewlineOffset(_-1));i=this._getLineLeftOffset(y)*this.scaleX,a=this._textLines[y],"rtl"===this.direction&&(l.x=this.width*this.scaleX-l.x+i);for(var w=0,I=a.length;w<I&&(m=i,(i+=this.__charBounds[y][w].kernedWidth*this.scaleX)<=l.x);w++)d++;return this._getNewSelectionStartFromOffset(l,m,i,d,I)},_getNewSelectionStartFromOffset:function(u,a,l,m,i){var d=l-u.x,y=m+(d>u.x-a||d<0?0:1);return this.flipX&&(y=i-y),y>this._text.length&&(y=this._text.length),y}}),b.util.object.extend(b.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=b.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var u=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+u.top+"; left: "+u.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding\uff70top: "+u.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):b.document.body.appendChild(this.hiddenTextarea),b.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),b.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),b.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),b.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),b.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),b.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),b.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),b.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),b.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(b.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(u){if(this.isEditing){var a="rtl"===this.direction?this.keysMapRtl:this.keysMap;if(u.keyCode in a)this[a[u.keyCode]](u);else{if(!(u.keyCode in this.ctrlKeysMapDown)||!u.ctrlKey&&!u.metaKey)return;this[this.ctrlKeysMapDown[u.keyCode]](u)}u.stopImmediatePropagation(),u.preventDefault(),u.keyCode>=33&&u.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(u){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:u.keyCode in this.ctrlKeysMapUp&&(u.ctrlKey||u.metaKey)&&(this[this.ctrlKeysMapUp[u.keyCode]](u),u.stopImmediatePropagation(),u.preventDefault(),this.canvas&&this.canvas.requestRenderAll())},onInput:function(u){var a=this.fromPaste;if(this.fromPaste=!1,u&&u.stopPropagation(),this.isEditing){var l,m,i,o,d,y=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,_=this._text.length,v=y.length,w=v-_,I=this.selectionStart,A=this.selectionEnd,M=I!==A;if(""===this.hiddenTextarea.value)return this.styles={},this.updateFromTextArea(),this.fire("changed"),void(this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll()));var D=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),F=I>D.selectionStart;M?(l=this._text.slice(I,A),w+=A-I):v<_&&(l=F?this._text.slice(A+w,A):this._text.slice(I,I-w)),m=y.slice(D.selectionEnd-w,D.selectionEnd),l&&l.length&&(m.length&&(i=this.getSelectionStyles(I,I+1,!1),i=m.map(function(){return i[0]})),M?(o=I,d=A):F?(o=A-l.length,d=A):(o=A,d=A+l.length),this.removeStyleFromTo(o,d)),m.length&&(a&&m.join("")===b.copiedText&&!b.disableStyleCopyPaste&&(i=b.copiedTextStyle),this.insertNewStyleBlock(m,I,i)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(u){this.compositionStart=u.target.selectionStart,this.compositionEnd=u.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(b.copiedText=this.getSelectedText(),b.copiedTextStyle=b.disableStyleCopyPaste?null:this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(u){return u&&u.clipboardData||b.window.clipboardData},_getWidthBeforeCursor:function(u,a){var l,m=this._getLineLeftOffset(u);return a>0&&(m+=(l=this.__charBounds[u][a-1]).left+l.width),m},getDownCursorOffset:function(u,a){var l=this._getSelectionForOffset(u,a),m=this.get2DCursorLocation(l),i=m.lineIndex;if(i===this._textLines.length-1||u.metaKey||34===u.keyCode)return this._text.length-l;var o=m.charIndex,d=this._getWidthBeforeCursor(i,o),y=this._getIndexOnLine(i+1,d);return this._textLines[i].slice(o).length+y+1+this.missingNewlineOffset(i)},_getSelectionForOffset:function(u,a){return u.shiftKey&&this.selectionStart!==this.selectionEnd&&a?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(u,a){var l=this._getSelectionForOffset(u,a),m=this.get2DCursorLocation(l),i=m.lineIndex;if(0===i||u.metaKey||33===u.keyCode)return-l;var o=m.charIndex,d=this._getWidthBeforeCursor(i,o),y=this._getIndexOnLine(i-1,d),_=this._textLines[i].slice(0,o),v=this.missingNewlineOffset(i-1);return-this._textLines[i-1].length+y-_.length+(1-v)},_getIndexOnLine:function(u,a){for(var l,m,i=this._textLines[u],o=this._getLineLeftOffset(u),d=0,y=0,_=i.length;y<_;y++)if((o+=l=this.__charBounds[u][y].width)>a){m=!0;var w=o,I=Math.abs(o-l-a);d=Math.abs(w-a)<I?y:y-1;break}return m||(d=i.length-1),d},moveCursorDown:function(u){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",u)},moveCursorUp:function(u){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorUpOrDown("Up",u)},_moveCursorUpOrDown:function(u,a){var l=this["get"+u+"CursorOffset"](a,"right"===this._selectionDirection);a.shiftKey?this.moveCursorWithShift(l):this.moveCursorWithoutShift(l),0!==l&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(u){return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,"left"===this._selectionDirection?this.selectionStart+u:this.selectionEnd+u),0!==u},moveCursorWithoutShift:function(u){return u<0?(this.selectionStart+=u,this.selectionEnd=this.selectionStart):(this.selectionEnd+=u,this.selectionStart=this.selectionEnd),0!==u},moveCursorLeft:function(u){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorLeftOrRight("Left",u)},_move:function(u,a,l){var m;if(u.altKey)m=this["findWordBoundary"+l](this[a]);else{if(!u.metaKey&&35!==u.keyCode&&36!==u.keyCode)return this[a]+="Left"===l?-1:1,!0;m=this["findLineBoundary"+l](this[a])}if(void 0!==typeof m&&this[a]!==m)return this[a]=m,!0},_moveLeft:function(u,a){return this._move(u,a,"Left")},_moveRight:function(u,a){return this._move(u,a,"Right")},moveCursorLeftWithoutShift:function(u){var a=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(a=this._moveLeft(u,"selectionStart")),this.selectionEnd=this.selectionStart,a},moveCursorLeftWithShift:function(u){return"right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(u,"selectionEnd"):0!==this.selectionStart?(this._selectionDirection="left",this._moveLeft(u,"selectionStart")):void 0},moveCursorRight:function(u){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",u)},_moveCursorLeftOrRight:function(u,a){var l="moveCursor"+u+"With";this._currentCursorOpacity=1,this[l+=a.shiftKey?"Shift":"outShift"](a)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(u){return"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveRight(u,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection="right",this._moveRight(u,"selectionEnd")):void 0},moveCursorRightWithoutShift:function(u){var a=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(a=this._moveRight(u,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,a},removeChars:function(u,a){void 0===a&&(a=u+1),this.removeStyleFromTo(u,a),this._text.splice(u,a-u),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(u,a,l,m){void 0===m&&(m=l),m>l&&this.removeStyleFromTo(l,m);var i=b.util.string.graphemeSplit(u);this.insertNewStyleBlock(i,l,a),this._text=[].concat(this._text.slice(0,l),i,this._text.slice(m)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var u=b.util.toFixed,a=/  +/g;b.util.object.extend(b.Text.prototype,{_toSVG:function(){var l=this._getSVGLeftTopOffsets(),m=this._getSVGTextAndBg(l.textTop,l.textLeft);return this._wrapSVGTextAndBg(m)},toSVG:function(l){return this._createBaseSVGMarkup(this._toSVG(),{reviver:l,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(l){var m=this.getSvgTextDecoration(this);return[l.textBgRects.join(""),'\t\t<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",m?'text-decoration="'+m+'" ':"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",l.textSpans.join(""),"</text>\n"]},_getSVGTextAndBg:function(l,m){var i,o=[],d=[],y=l;this._setSVGBg(d);for(var _=0,v=this._textLines.length;_<v;_++)i=this._getLineLeftOffset(_),(this.textBackgroundColor||this.styleHas("textBackgroundColor",_))&&this._setSVGTextLineBg(d,_,m+i,y),this._setSVGTextLineText(o,_,m+i,y),y+=this.getHeightOfLine(_);return{textSpans:o,textBgRects:d}},_createTextCharSpan:function(l,m,i,o){var d=l!==l.trim()||l.match(a),y=this.getSvgSpanStyles(m,d),_=y?'style="'+y+'"':"",v=m.deltaY,w="",I=b.Object.NUM_FRACTION_DIGITS;return v&&(w=' dy="'+u(v,I)+'" '),['<tspan x="',u(i,I),'" y="',u(o,I),'" ',w,_,">",b.util.string.escapeXml(l),"</tspan>"].join("")},_setSVGTextLineText:function(l,m,i,o){var d,y,_,v,w,I=this.getHeightOfLine(m),A=-1!==this.textAlign.indexOf("justify"),M="",D=0,F=this._textLines[m];o+=I*(1-this._fontSizeFraction)/this.lineHeight;for(var B=0,z=F.length-1;B<=z;B++)w=B===z||this.charSpacing,M+=F[B],_=this.__charBounds[m][B],0===D?(i+=_.kernedWidth-_.width,D+=_.width):D+=_.kernedWidth,A&&!w&&this._reSpaceAndTab.test(F[B])&&(w=!0),w||(d=d||this.getCompleteStyleDeclaration(m,B),y=this.getCompleteStyleDeclaration(m,B+1),w=this._hasStyleChangedForSvg(d,y)),w&&(v=this._getStyleDeclaration(m,B)||{},l.push(this._createTextCharSpan(M,v,i,o)),M="",d=y,i+=D,D=0)},_pushTextBgRect:function(l,m,i,o,d,y){var _=b.Object.NUM_FRACTION_DIGITS;l.push("\t\t<rect ",this._getFillAttributes(m),' x="',u(i,_),'" y="',u(o,_),'" width="',u(d,_),'" height="',u(y,_),'"></rect>\n')},_setSVGTextLineBg:function(l,m,i,o){for(var d,y,_=this._textLines[m],v=this.getHeightOfLine(m)/this.lineHeight,w=0,I=0,A=this.getValueOfPropertyAt(m,0,"textBackgroundColor"),M=0,D=_.length;M<D;M++)d=this.__charBounds[m][M],(y=this.getValueOfPropertyAt(m,M,"textBackgroundColor"))!==A?(A&&this._pushTextBgRect(l,A,i+I,o,w,v),I=d.left,w=d.width,A=y):w+=d.kernedWidth;y&&this._pushTextBgRect(l,y,i+I,o,w,v)},_getFillAttributes:function(l){var m=l&&"string"==typeof l?new b.Color(l):"";return m&&m.getSource()&&1!==m.getAlpha()?'opacity="'+m.getAlpha()+'" fill="'+m.setAlpha(1).toRgb()+'"':'fill="'+l+'"'},_getSVGLineTopOffset:function(l){for(var m,i=0,o=0;o<l;o++)i+=this.getHeightOfLine(o);return m=this.getHeightOfLine(o),{lineTop:i,offset:(this._fontSizeMult-this._fontSizeFraction)*m/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(l){return b.Object.prototype.getSvgStyles.call(this,l)+" white-space: pre;"}})}(),function(u){var a=u.fabric||(u.fabric={});a.Textbox=a.util.createClass(a.IText,a.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:a.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(l){for(var m=0,i=0,o=0,d={},y=0;y<l.graphemeLines.length;y++)"\n"===l.graphemeText[o]&&y>0?(i=0,o++,m++):!this.splitByGrapheme&&this._reSpaceAndTab.test(l.graphemeText[o])&&y>0&&(i++,o++),d[y]={line:m,offset:i},o+=l.graphemeLines[y].length,i+=l.graphemeLines[y].length;return d},styleHas:function(l,m){if(this._styleMap&&!this.isWrapping){var i=this._styleMap[m];i&&(m=i.line)}return a.Text.prototype.styleHas.call(this,l,m)},isEmptyStyles:function(l){if(!this.styles)return!0;var m,i,o=0,d=!1,y=this._styleMap[l],_=this._styleMap[l+1];for(var v in y&&(l=y.line,o=y.offset),_&&(d=_.line===l,m=_.offset),i=void 0===l?this.styles:{line:this.styles[l]})for(var w in i[v])if(w>=o&&(!d||w<m))for(var I in i[v][w])return!1;return!0},_getStyleDeclaration:function(l,m){if(this._styleMap&&!this.isWrapping){var i=this._styleMap[l];if(!i)return null;l=i.line,m=i.offset+m}return this.callSuper("_getStyleDeclaration",l,m)},_setStyleDeclaration:function(l,m,i){var o=this._styleMap[l];this.styles[l=o.line][m=o.offset+m]=i},_deleteStyleDeclaration:function(l,m){var i=this._styleMap[l];delete this.styles[l=i.line][m=i.offset+m]},_getLineStyle:function(l){return!!this.styles[this._styleMap[l].line]},_setLineStyle:function(l){this.styles[this._styleMap[l].line]={}},_wrapText:function(l,m){var i,o=[];for(this.isWrapping=!0,i=0;i<l.length;i++)o=o.concat(this._wrapLine(l[i],i,m));return this.isWrapping=!1,o},_measureWord:function(l,m,i){var o,d=0;i=i||0;for(var y=0,_=l.length;y<_;y++)d+=this._getGraphemeBox(l[y],m,y+i,o,!0).kernedWidth,o=l[y];return d},_wrapLine:function(l,m,i,o){var d=0,y=this.splitByGrapheme,_=[],v=[],w=y?a.util.string.graphemeSplit(l):l.split(this._wordJoiners),I="",A=0,M=y?"":" ",D=0,F=0,B=0,z=!0,K=this._getWidthOfCharSpacing();o=o||0,0===w.length&&w.push([]),i-=o;for(var oe=0;oe<w.length;oe++)I=y?w[oe]:a.util.string.graphemeSplit(w[oe]),D=this._measureWord(I,m,A),A+=I.length,(d+=F+D-K)>i&&!z?(_.push(v),v=[],d=D,z=!0):d+=K,z||y||v.push(M),v=v.concat(I),F=y?0:this._measureWord([M],m,A),A++,z=!1,D>B&&(B=D);return oe&&_.push(v),B+o>this.dynamicMinWidth&&(this.dynamicMinWidth=B-K+o),_},isEndOfWrapping:function(l){return!this._styleMap[l+1]||this._styleMap[l+1].line!==this._styleMap[l].line},missingNewlineOffset:function(l){return this.splitByGrapheme?this.isEndOfWrapping(l)?1:0:1},_splitTextIntoLines:function(l){for(var m=a.Text.prototype._splitTextIntoLines.call(this,l),i=this._wrapText(m.lines,this.width),o=new Array(i.length),d=0;d<i.length;d++)o[d]=i[d].join("");return m.lines=o,m.graphemeLines=i,m},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var l={};for(var m in this._styleMap)this._textLines[m]&&(l[this._styleMap[m].line]=1);for(var m in this.styles)l[m]||delete this.styles[m]},toObject:function(l){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(l))}}),a.Textbox.fromObject=function(l,m){return a.Object._fromObject("Textbox",l,m,"text")}}(t),function(){var u=b.controlsUtils,a=u.scaleSkewCursorStyleHandler,l=u.scaleCursorStyleHandler,m=u.scalingEqually,i=u.scalingYOrSkewingX,o=u.scalingXOrSkewingY,d=u.scaleOrSkewActionName,y=b.Object.prototype.controls;if(y.ml=new b.Control({x:-.5,y:0,cursorStyleHandler:a,actionHandler:o,getActionName:d}),y.mr=new b.Control({x:.5,y:0,cursorStyleHandler:a,actionHandler:o,getActionName:d}),y.mb=new b.Control({x:0,y:.5,cursorStyleHandler:a,actionHandler:i,getActionName:d}),y.mt=new b.Control({x:0,y:-.5,cursorStyleHandler:a,actionHandler:i,getActionName:d}),y.tl=new b.Control({x:-.5,y:-.5,cursorStyleHandler:l,actionHandler:m}),y.tr=new b.Control({x:.5,y:-.5,cursorStyleHandler:l,actionHandler:m}),y.bl=new b.Control({x:-.5,y:.5,cursorStyleHandler:l,actionHandler:m}),y.br=new b.Control({x:.5,y:.5,cursorStyleHandler:l,actionHandler:m}),y.mtr=new b.Control({x:0,y:-.5,actionHandler:u.rotationWithSnapping,cursorStyleHandler:u.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),b.Textbox){var _=b.Textbox.prototype.controls={};_.mtr=y.mtr,_.tr=y.tr,_.br=y.br,_.tl=y.tl,_.bl=y.bl,_.mt=y.mt,_.mb=y.mb,_.mr=new b.Control({x:.5,y:0,actionHandler:u.changeWidth,cursorStyleHandler:a,actionName:"resizing"}),_.ml=new b.Control({x:-.5,y:0,actionHandler:u.changeWidth,cursorStyleHandler:a,actionName:"resizing"})}}()},192:()=>{},898:()=>{},245:()=>{}},Do={};function Ai(p){var t=Do[p];if(void 0!==t)return t.exports;var r=Do[p]={exports:{}};return Aa[p](r,r.exports,Ai),r.exports}Ai.d=(p,t)=>{for(var r in t)Ai.o(t,r)&&!Ai.o(p,r)&&Object.defineProperty(p,r,{enumerable:!0,get:t[r]})},Ai.o=(p,t)=>Object.prototype.hasOwnProperty.call(p,t);var Lo={};(()=>{let p;Ai.d(Lo,{R:()=>p}),p=typeof document<"u"&&typeof window<"u"?Ai(653).fabric:{version:"5.2.1"}})();var mt,wt,fi,Mo,Ue=Lo.R;(function(p){p[p.DIMT_RECTANGLE=1]="DIMT_RECTANGLE",p[p.DIMT_QUADRILATERAL=2]="DIMT_QUADRILATERAL",p[p.DIMT_TEXT=4]="DIMT_TEXT",p[p.DIMT_ARC=8]="DIMT_ARC",p[p.DIMT_IMAGE=16]="DIMT_IMAGE",p[p.DIMT_POLYGON=32]="DIMT_POLYGON",p[p.DIMT_LINE=64]="DIMT_LINE",p[p.DIMT_GROUP=128]="DIMT_GROUP"})(mt||(mt={})),function(p){p[p.DIS_DEFAULT=1]="DIS_DEFAULT",p[p.DIS_SELECTED=2]="DIS_SELECTED"}(wt||(wt={})),function(p){p[p.EF_ENHANCED_FOCUS=4]="EF_ENHANCED_FOCUS",p[p.EF_AUTO_ZOOM=16]="EF_AUTO_ZOOM",p[p.EF_TAP_TO_FOCUS=64]="EF_TAP_TO_FOCUS"}(fi||(fi={})),function(p){p.GREY="grey",p.GREY32="grey32",p.RGBA="rgba",p.RBGA="rbga",p.GRBA="grba",p.GBRA="gbra",p.BRGA="brga",p.BGRA="bgra"}(Mo||(Mo={}));const Gi=p=>"number"==typeof p&&!Number.isNaN(p),as=p=>"string"==typeof p;var lr,En,Vi,ls,Yt,hr;(function(p){p[p.ARC=0]="ARC",p[p.IMAGE=1]="IMAGE",p[p.LINE=2]="LINE",p[p.POLYGON=3]="POLYGON",p[p.QUAD=4]="QUAD",p[p.RECT=5]="RECT",p[p.TEXT=6]="TEXT",p[p.GROUP=7]="GROUP"})(Yt||(Yt={})),function(p){p[p.DEFAULT=0]="DEFAULT",p[p.SELECTED=1]="SELECTED"}(hr||(hr={}));class Ct{get mediaType(){return new Map([["rect",mt.DIMT_RECTANGLE],["quad",mt.DIMT_QUADRILATERAL],["text",mt.DIMT_TEXT],["arc",mt.DIMT_ARC],["image",mt.DIMT_IMAGE],["polygon",mt.DIMT_POLYGON],["line",mt.DIMT_LINE],["group",mt.DIMT_GROUP]]).get(this._mediaType)}get styleSelector(){switch(R(this,En,"f")){case wt.DIS_DEFAULT:return"default";case wt.DIS_SELECTED:return"selected"}}set drawingStyleId(t){this.styleId=t}get drawingStyleId(){return this.styleId}set coordinateBase(t){if(!["view","image"].includes(t))throw new Error("Invalid 'coordinateBase'.");this._drawingLayer&&("image"===R(this,Vi,"f")&&"view"===t?this.updateCoordinateBaseFromImageToView():"view"===R(this,Vi,"f")&&"image"===t&&this.updateCoordinateBaseFromViewToImage()),Te(this,Vi,t,"f")}get coordinateBase(){return R(this,Vi,"f")}get drawingLayerId(){return this._drawingLayerId}constructor(t,r){if(lr.add(this),En.set(this,void 0),Vi.set(this,"image"),this._zIndex=null,this._drawingLayer=null,this._drawingLayerId=null,this._mapStyle=new Map,this._mapState_StyleId=new Map,this.mapEvent_Callbacks=new Map([["selected",new Map],["deselected",new Map],["mousedown",new Map],["mouseup",new Map],["dblclick",new Map],["mouseover",new Map],["mouseout",new Map]]),this.mapNoteName_Content=new Map([]),this.isDrawingItem=!0,null!=r&&!Gi(r))throw new TypeError("Invalid 'drawingStyleId'.");t&&this._setFabricObject(t),this.setState(wt.DIS_DEFAULT),this.styleId=r}_setFabricObject(t){this._fabricObject=t,this._fabricObject.on("selected",()=>{this.setState(wt.DIS_SELECTED)}),this._fabricObject.on("deselected",()=>{this._fabricObject.canvas&&this._fabricObject.canvas.getActiveObjects().includes(this._fabricObject)?this.setState(wt.DIS_SELECTED):this.setState(wt.DIS_DEFAULT),"textbox"===this._fabricObject.type&&(this._fabricObject.isEditing&&this._fabricObject.exitEditing(),this._fabricObject.selected=!1)}),t.getDrawingItem=()=>this}_getFabricObject(){return this._fabricObject}setState(t){Te(this,En,t,"f")}getState(){return R(this,En,"f")}_on(t,r){if(!r)return;const f=t.toLowerCase(),C=this.mapEvent_Callbacks.get(f);if(!C)throw new Error(`Event '${t}' does not exist.`);let T=C.get(r);T||(T=S=>{const O=S.e;if(!O)return void(r&&r.apply(this,[{targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null}]));const x={targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null};if(this._drawingLayer){let L,P,N,k;const W=O.target.getBoundingClientRect();L=W.left,P=W.top,N=L+window.scrollX,k=P+window.scrollY;const{width:H,height:Z}=this._drawingLayer.fabricCanvas.lowerCanvasEl.getBoundingClientRect(),X=this._drawingLayer.width,q=this._drawingLayer.height,ie=H/Z,J=X/q,Ee=this._drawingLayer._getObjectFit();let _e,xe,Ie,b,me=1;if("contain"===Ee)ie<J?(me=H/X,_e=L+this.get("x")*me,xe=P+this.get("y")*me+(Z-q*me)/2,Ie=N+this.get("x")*me,b=k+this.get("y")*me+(Z-q*me)/2):(me=Z/q,_e=L+this.get("x")*me+(H-X*me)/2,xe=P+this.get("y")*me,Ie=N+this.get("x")*me+(H-X*me)/2,b=k+this.get("y")*me);else if("cover"===Ee)if(ie<J){me=Z/q;let Re=this.get("x")*me-(X*me-H)/2;Re=Math.max(Re,0),Re=Math.min(Re,H),_e=L+Re,xe=P+this.get("y")*me,Ie=N+Re,b=k+this.get("y")*me}else{me=H/X;let Re=this.get("y")*me-(q*me-Z)/2;Re=Math.max(Re,0),Re=Math.min(Re,Z),_e=L+this.get("x")*me,xe=P+Re,Ie=N+this.get("x")*me,b=k+Re}x.itemClientX=Math.round(_e),x.itemClientY=Math.round(xe),x.itemPageX=Math.round(Ie),x.itemPageY=Math.round(b)}for(let L of Object.getOwnPropertyNames(x))Object.defineProperty(O,L,{value:x[L],writable:!0});r&&r.apply(this,[O])},C.set(r,T),this._fabricObject.on("dblclick"===f?"mousedblclick":f,T))}on(t,r){this._on(t,r)}_off(t,r){const f=t.toLowerCase(),C=this.mapEvent_Callbacks.get(f);if(!C)throw new Error(`Event '${t}' does not exist.`);let T=C.get(r);T&&(C.delete(r),this._fabricObject.off("dblclick"===f?"mousedblclick":f,T))}off(t,r){this._off(t,r)}_setEditable(t){const r=this._fabricObject;t?(r.selectable=!0,r.hasControls=!0,r.hoverCursor=null):(r.selectable=!1,r.hasControls=!1,r.hoverCursor="default")}hasNote(t){return this.mapNoteName_Content.has(t)}addNote(t,r){if(this.hasNote(t.name)&&!r)throw new Error("A note with the same name already exists, please use a different name.");const f=t.content?JSON.parse(JSON.stringify(t.content)):t.content;this.mapNoteName_Content.set(t.name,[f])}getNote(t){const r=this.mapNoteName_Content.get(t);return r?1===r.length?{name:t,content:r[0]?JSON.parse(JSON.stringify(r[0])):r[0]}:{name:t,content:JSON.parse(JSON.stringify(r))}:null}getNotes(){const t=[];for(let r of this.mapNoteName_Content){let f=1===r[1].length?r[1][0]:r[1];f=f&&JSON.parse(JSON.stringify(f)),t.push({name:r[0],content:f})}return t}updateNote(t,r,f){const C=this.mapNoteName_Content.get(t);if(!C)throw new Error("The note name does not exist.");f||(C.length=0),r=r&&JSON.parse(JSON.stringify(r)),C.push(r)}deleteNote(t){this.mapNoteName_Content.delete(t)}clearNotes(){this.mapNoteName_Content.clear()}set(t,r){if(!this.extendSet(t,r))if("x"===t){const f=this._fabricObject.group;f?(this._fabricObject.set("left",r-f.left-f.width/2),f.addWithUpdate()):this._fabricObject.set("left",r)}else if("y"===t){const f=this._fabricObject.group;f?(this._fabricObject.set("top",r-f.top-f.height/2),f.addWithUpdate()):this._fabricObject.set("top",r)}else"styleId"===t?this.styleId=r:this._fabricObject.set(t,r);["vertices","startPoint","endPoint","x","y","left","top","width","height","scaleX","scaleY","skewX","skewY","padding","angle","strokeWidth"].includes(t)&&this._fabricObject.setCoords()}get(t){let r=this.extendGet(t);if(void 0===r)if("x"===t){const f=this._fabricObject.group;r=f?this._fabricObject.get("left")+f.left+f.width/2:this._fabricObject.get("left")}else if("y"===t){const f=this._fabricObject.group;r=f?this._fabricObject.get("top")+f.top+f.height/2:this._fabricObject.get("top")}else r="scaledWidth"===t?this._fabricObject.getScaledWidth():"scaledHeight"===t?this._fabricObject.getScaledHeight():["type","mediaType"].includes(t)?this.mediaType:"state"===t?this.getState():"styleId"===t?this.styleId:"drawingLayerId"===t?this.drawingLayerId:this._fabricObject.get(t);return r}remove(){this._drawingLayer&&this._drawingLayer.removeDrawingItem(this)}convertPropFromImageToView(t){if("number"!=typeof t)throw new TypeError("Invalid value.");return t*R(this,lr,"m",ls).call(this)}convertPropFromViewToImage(t){if("number"!=typeof t)throw new TypeError("Invalid value.");return t/R(this,lr,"m",ls).call(this)}_setLineWidth(t){if(this._drawingLayer)if("view"===this.coordinateBase)this.set("strokeWidth",this.convertPropFromViewToImage(t));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("strokeWidth",t)}}_getLineWidth(){if(this._drawingLayer){if("view"===this.coordinateBase)return this.convertPropFromImageToView(this.get("strokeWidth"));if("image"===this.coordinateBase)return this.get("strokeWidth");throw new Error("Invalid 'coordinateBase'.")}}_setFontSize(t){if(this._drawingLayer)if("view"===this.coordinateBase)this.set("fontSize",this.convertPropFromViewToImage(t));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("fontSize",t)}}_getFontSize(){if(this._drawingLayer){if("view"===this.coordinateBase)return this.convertPropFromImageToView(this.get("fontSize"));if("image"===this.coordinateBase)return this.get("fontSize");throw new Error("Invalid 'coordinateBase'.")}}}En=new WeakMap,Vi=new WeakMap,lr=new WeakSet,ls=function(){const p=this._drawingLayer;if(!p)return 1;const t=p.width,r=p.height,{width:f,height:C}=p.fabricCanvas.wrapperEl.getBoundingClientRect();if(f<=0||C<=0)throw new Error("Unable to get drawing layer dimensions. Layer may not be rendered on the page.");const T=f/t,S=C/r,O=p._getObjectFit();let x=1;return"contain"===O?x=T<S?f/t:C/r:"cover"===O&&(x=T<S?C/r:f/t),x},Ct.arrMediaTypes=["rect","arc","polygon","image","text","line","quad"],Ct.mapItemType=new Map([[Yt.ARC,"arc"],[Yt.IMAGE,"image"],[Yt.LINE,"line"],[Yt.POLYGON,"polygon"],[Yt.QUAD,"quad"],[Yt.RECT,"rect"],[Yt.TEXT,"text"],[Yt.GROUP,"group"]]),Ct.arrStyleSelectors=["default","selected"],Ct.mapItemState=new Map([[hr.DEFAULT,"default"],[hr.SELECTED,"selected"]]);const Fo=p=>null!==p&&"object"==typeof p&&!Array.isArray(p),hs=p=>!!as(p)&&""!==p,us=p=>!(!Nt(p)||!ot(p.left)||p.left<0||!ot(p.top)||p.top<0||!ot(p.right)||p.right<0||!ot(p.bottom)||p.bottom<0||p.left>=p.right||p.top>=p.bottom||!Hr(p.isMeasuredInPercentage)),ko=p=>!!Nt(p)&&!!Yr(p.points)&&0!=p.points.length&&!p.points.some(t=>!Bi(t)),Oa=Bi,No=p=>!!Nt(p)&&!!Yr(p.points)&&0!=p.points.length&&4==p.points.length&&!p.points.some(t=>!Bi(t)),Kt=p=>!(!Nt(p)||!ot(p.x)||!ot(p.y)||!ot(p.width)||p.width<0||!ot(p.height)||p.height<0||"isMeasuredInPercentage"in p&&!Hr(p.isMeasuredInPercentage)),Bo=p=>!(!Fo(p)||"id"in p&&!Gi(p.id)||"lineWidth"in p&&!Gi(p.lineWidth)||"fillStyle"in p&&!hs(p.fillStyle)||"strokeStyle"in p&&!hs(p.strokeStyle)||"paintMode"in p&&!["fill","stroke","strokeAndFill"].includes(p.paintMode)||"fontFamily"in p&&!hs(p.fontFamily)||"fontSize"in p&&!Gi(p.fontSize));class cr{static convert(t,r,f){const C={x:0,y:0,width:r,height:f};if(!t)return C;if(Kt(t))t.isMeasuredInPercentage?(C.x=t.x/100*r,C.y=t.y/100*f,C.width=t.width/100*r,C.height=t.height/100*f):(C.x=t.x,C.y=t.y,C.width=t.width,C.height=t.height);else{if(!us(t))throw TypeError("Invalid region.");t.isMeasuredInPercentage?(C.x=t.left/100*r,C.y=t.top/100*f,C.width=(t.right-t.left)/100*r,C.height=(t.bottom-t.top)/100*f):(C.x=t.left,C.y=t.top,C.width=t.right-t.left,C.height=t.bottom-t.top)}return C.x=Math.round(C.x),C.y=Math.round(C.y),C.width=Math.round(C.width),C.height=Math.round(C.height),C}}var Oi,ur;class Uo{constructor(){Oi.set(this,new Map),ur.set(this,!1)}get disposed(){return R(this,ur,"f")}on(t,r){t=t.toLowerCase();const f=R(this,Oi,"f").get(t);if(f){if(f.includes(r))return;f.push(r)}else R(this,Oi,"f").set(t,[r])}off(t,r){t=t.toLowerCase();const f=R(this,Oi,"f").get(t);if(!f)return;const C=f.indexOf(r);-1!==C&&f.splice(C,1)}offAll(t){t=t.toLowerCase();const r=R(this,Oi,"f").get(t);r&&(r.length=0)}fire(t,r=[],f={async:!1,copy:!0}){var C=this;return te(function*(){r||(r=[]),t=t.toLowerCase();const T=R(C,Oi,"f").get(t);if(T&&T.length){f=Object.assign({async:!1,copy:!0},f);for(let S of T){if(!S)continue;let O=[];if(f.copy)for(let L of r){try{L=JSON.parse(JSON.stringify(L))}catch{}O.push(L)}else O=r;let x=!1;if(f.async)setTimeout(()=>{C.disposed||S.apply(f.target,O)},0);else try{x=yield S.apply(f.target,O)}catch{}if(!0===x)break}}})()}dispose(){Te(this,ur,!0,"f")}}function Ra(p,t,r){return(r.x-p.x)*(t.y-p.y)==(t.x-p.x)*(r.y-p.y)&&Math.min(p.x,t.x)<=r.x&&r.x<=Math.max(p.x,t.x)&&Math.min(p.y,t.y)<=r.y&&r.y<=Math.max(p.y,t.y)}function ds(p){return Math.abs(p)<1e-6?0:p<0?-1:1}function dr(p,t,r,f){let C=p[0]*(r[1]-t[1])+t[0]*(p[1]-r[1])+r[0]*(t[1]-p[1]),T=p[0]*(f[1]-t[1])+t[0]*(p[1]-f[1])+f[0]*(t[1]-p[1]);return!((C^T)>=0&&0!==C&&0!==T||(C=r[0]*(p[1]-f[1])+f[0]*(r[1]-p[1])+p[0]*(f[1]-r[1]),T=r[0]*(t[1]-f[1])+f[0]*(r[1]-t[1])+t[0]*(f[1]-r[1]),(C^T)>=0&&0!==C&&0!==T))}Oi=new WeakMap,ur=new WeakMap;const fs=function(){var p=te(function*(t){if("string"!=typeof t)throw new TypeError("Invalid url.");const r=yield fetch(t);if(!r.ok)throw Error("Network Error: "+r.statusText);const f=yield r.text();if(!f.trim().startsWith("<"))throw Error("Unable to get valid HTMLElement.");const C=document.createElement("div");C.insertAdjacentHTML("beforeend",f);for(let T=0;T<C.childElementCount;++T){let S=C.children[T];S instanceof HTMLStyleElement&&document.head.append(S)}return 1==C.childElementCount?C.children[0]:C});return function(r){return p.apply(this,arguments)}}();var gi,mi,_i;class Wi extends Ct{constructor(t,r){if(super(null,r),gi.set(this,void 0),!Kt(t))throw new TypeError("Invalid 'rect'.");this._setFabricObject(new Ue.Rect({left:t.x,top:t.y,width:t.width,height:t.height})),Te(this,gi,JSON.parse(JSON.stringify(t)),"f"),this._mediaType="rect"}extendSet(t,r){return!1}extendGet(t){}updateCoordinateBaseFromImageToView(){this.set("left",this.convertPropFromViewToImage(this.get("left"))),this.set("top",this.convertPropFromViewToImage(this.get("top"))),this.set("width",this.convertPropFromViewToImage(this.get("scaledWidth"))),this.set("height",this.convertPropFromViewToImage(this.get("scaledHeight")))}updateCoordinateBaseFromViewToImage(){this.set("left",this.convertPropFromImageToView(this.get("left"))),this.set("top",this.convertPropFromImageToView(this.get("top"))),this.set("width",this.convertPropFromImageToView(this.get("scaledWidth"))),this.set("height",this.convertPropFromImageToView(this.get("scaledHeight")))}setPosition(t){this.setRect(t)}getPosition(){return this.getRect()}updatePosition(){R(this,gi,"f")&&this.setRect(R(this,gi,"f"))}setRect(t){if(!Kt(t))throw new TypeError("Invalid 'rect'.");if(this._drawingLayer){if("view"===this.coordinateBase)this.set("left",this.convertPropFromViewToImage(t.x)),this.set("top",this.convertPropFromViewToImage(t.y)),this.set("width",this.convertPropFromViewToImage(t.width)),this.set("height",this.convertPropFromViewToImage(t.height));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("left",t.x),this.set("top",t.y),this.set("width",t.width),this.set("height",t.height)}this._drawingLayer.renderAll()}else Te(this,gi,JSON.parse(JSON.stringify(t)),"f")}getRect(){if(this._drawingLayer){if("view"===this.coordinateBase)return{x:this.convertPropFromImageToView(this.get("left")),y:this.convertPropFromImageToView(this.get("top")),width:this.convertPropFromImageToView(this.get("scaledWidth")),height:this.convertPropFromImageToView(this.get("scaledHeight"))};if("image"===this.coordinateBase)return{x:this.get("left"),y:this.get("top"),width:this.get("scaledWidth"),height:this.get("scaledHeight")};throw new Error("Invalid 'coordinateBase'.")}return R(this,gi,"f")?JSON.parse(JSON.stringify(R(this,gi,"f"))):null}}function gs(p,t,r){return Ue.util.transformPoint({x:r.points[this.pointIndex].x-r.pathOffset.x,y:r.points[this.pointIndex].y-r.pathOffset.y},r.calcTransformMatrix())}function jo(p){let t=new Ue.Point(p.strokeUniform?1/p.scaleX:1,p.strokeUniform?1/p.scaleY:1).multiply(p.strokeWidth);return new Ue.Point(p.width+t.x,p.height+t.y)}function ms(p,t,r,f){let C=t.target,T=C.controls[C.__corner],S=C.toLocalPoint(new Ue.Point(r,f),"center","center"),O=jo(C),x=C._getTransformedDimensions(0,0);return C.points[T.pointIndex]={x:S.x*O.x/x.x+C.pathOffset.x,y:S.y*O.y/x.y+C.pathOffset.y},Ue.controlsUtils.fireEvent("scaling",{e:p,transform:t,pointer:{x:r,y:f}}),!0}function ps(p,t){return function(r,f,C,T){let S=f.target,O=Ue.util.transformPoint({x:S.points[p].x-S.pathOffset.x,y:S.points[p].y-S.pathOffset.y},S.calcTransformMatrix()),x=t(r,f,C,T);S._setPositionDimensions({});let L=jo(S);return S.setPositionByOrigin(O,(S.points[p].x-S.pathOffset.x)/L.x+.5,(S.points[p].y-S.pathOffset.y)/L.y+.5),x}}gi=new WeakMap;class _s extends Ct{constructor(t,r){if(super(null,r),mi.set(this,void 0),!ko(t))throw new TypeError("Invalid 'polygon'.");this._setFabricObject(new Ue.Polygon(t.points,{objectCaching:!1}));const f=this._fabricObject;let C=f.points.length-1;f.controls=f.points.reduce(function(T,S,O){return T["p"+O]=new Ue.Control({positionHandler:gs,actionHandler:ps(O>0?O-1:C,ms),actionName:"modifyPolygon",pointIndex:O}),T},{}),Te(this,mi,JSON.parse(JSON.stringify(t)),"f"),this._mediaType="polygon"}extendSet(t,r){if("vertices"===t){const f=this._fabricObject;if(f.group){const T=f.group;f.points=r.map(S=>({x:S.x-T.left-T.width/2,y:S.y-T.top-T.height/2})),T.addWithUpdate()}else f.points=r;const C=f.points.length-1;return f.controls=f.points.reduce(function(T,S,O){return T["p"+O]=new Ue.Control({positionHandler:gs,actionHandler:ps(O>0?O-1:C,ms),actionName:"modifyPolygon",pointIndex:O}),T},{}),f._setPositionDimensions({}),!0}}extendGet(t){if("vertices"===t){const r=[],f=this._fabricObject;if(f.selectable&&!f.group)for(let C in f.oCoords)r.push({x:f.oCoords[C].x,y:f.oCoords[C].y});else for(let C of f.points){const O=Ue.util.transformPoint({x:C.x-f.pathOffset.x,y:C.y-f.pathOffset.y},f.calcTransformMatrix());r.push({x:O.x,y:O.y})}return r}}updateCoordinateBaseFromImageToView(){const t=this.get("vertices").map(r=>({x:this.convertPropFromViewToImage(r.x),y:this.convertPropFromViewToImage(r.y)}));this.set("vertices",t)}updateCoordinateBaseFromViewToImage(){const t=this.get("vertices").map(r=>({x:this.convertPropFromImageToView(r.x),y:this.convertPropFromImageToView(r.y)}));this.set("vertices",t)}setPosition(t){this.setPolygon(t)}getPosition(){return this.getPolygon()}updatePosition(){R(this,mi,"f")&&this.setPolygon(R(this,mi,"f"))}setPolygon(t){if(!ko(t))throw new TypeError("Invalid 'polygon'.");if(this._drawingLayer){if("view"===this.coordinateBase){const r=t.points.map(f=>({x:this.convertPropFromViewToImage(f.x),y:this.convertPropFromViewToImage(f.y)}));this.set("vertices",r)}else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("vertices",t.points)}this._drawingLayer.renderAll()}else Te(this,mi,JSON.parse(JSON.stringify(t)),"f")}getPolygon(){if(this._drawingLayer){if("view"===this.coordinateBase)return{points:this.get("vertices").map(t=>({x:this.convertPropFromImageToView(t.x),y:this.convertPropFromImageToView(t.y)}))};if("image"===this.coordinateBase)return{points:this.get("vertices")};throw new Error("Invalid 'coordinateBase'.")}return R(this,mi,"f")?JSON.parse(JSON.stringify(R(this,mi,"f"))):null}}mi=new WeakMap;const Go=p=>{let t=p.split("\n").map(f=>f.split("\t"));return(r=>{for(let f=0;;f++){let C=-1;for(let T=0;T<r.length;T++){let S=r[T][f];void 0!==S&&S.length>C&&(C=S.length)}if(-1===C)break;for(let T=0;T<r.length;T++){if(f>=r[T].length-1)continue;let S=" ".repeat(C+2-r[T][f].length);r[T][f]=r[T][f].concat(S)}}})(t),(r=>{let f="";for(let C=0;C<r.length;C++)f=f.concat(...r[C],C===r.length-1?"":"\n");return f})(t)};class Da extends Ct{constructor(t,r,f){if(super(null,f),_i.set(this,void 0),!as(t))throw new TypeError("Invalid 'text'.");if(!Kt(r))throw new TypeError("Invalid 'rect'.");this._setFabricObject(new Ue.Textbox(Go(t),{left:r.x,top:r.y,width:r.width})),this._text=t,Te(this,_i,JSON.parse(JSON.stringify(r)),"f"),this._mediaType="text"}extendSet(t,r){if("text"===t)return this._text=r,this._fabricObject.set("text",Go(r)),!0}extendGet(t){if("text"===t)return this._text}updateCoordinateBaseFromImageToView(){this.set("left",this.convertPropFromViewToImage(this.get("left"))),this.set("top",this.convertPropFromViewToImage(this.get("top"))),this.set("width",this.convertPropFromViewToImage(this.get("scaledWidth")))}updateCoordinateBaseFromViewToImage(){this.set("left",this.convertPropFromImageToView(this.get("left"))),this.set("top",this.convertPropFromImageToView(this.get("top"))),this.set("width",this.convertPropFromImageToView(this.get("scaledWidth")))}setPosition(t){this.setTextRect(t)}getPosition(){return this.getTextRect()}updatePosition(){R(this,_i,"f")&&this.setTextRect(R(this,_i,"f"))}setText(t){if(!as(t))throw new TypeError("Invalid 'text'.");this.set("text",t)}getText(){return this.get("text")}setTextRect(t){if(!Kt(t))throw new TypeError("Invalid 'rect'.");if(this._drawingLayer){if("view"===this.coordinateBase)this.set("left",this.convertPropFromViewToImage(t.x)),this.set("top",this.convertPropFromViewToImage(t.y)),this.set("width",this.convertPropFromViewToImage(t.width));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("left",t.x),this.set("top",t.y),this.set("width",t.width)}this._drawingLayer.renderAll()}else Te(this,_i,JSON.parse(JSON.stringify(t)),"f")}getTextRect(){if(this._drawingLayer){if("view"===this.coordinateBase)return{x:this.convertPropFromImageToView(this.get("left")),y:this.convertPropFromImageToView(this.get("top")),width:this.convertPropFromImageToView(this.get("scaledWidth")),height:this.convertPropFromImageToView(this.get("scaledHeight"))};if("image"===this.coordinateBase)return{x:this.get("left"),y:this.get("top"),width:this.get("scaledWidth"),height:this.get("scaledHeight")};throw new Error("Invalid 'coordinateBase'.")}return R(this,_i,"f")?JSON.parse(JSON.stringify(R(this,_i,"f"))):null}}var yi,Ci,Yi,vs,Hi,wn,Xi,Tt,Tn,bn,Sn,Vo,Wo,Yo,Ho,fr,Je,In,xn,An,ut,gr,mr,pr,Ei,On,Rn,ys,bt,_r,Xo,Cs,Es,Dn,vr;_i=new WeakMap;class La extends _s{constructor(t,r){if(super({points:t?.points},r),yi.set(this,void 0),!No(t))throw new TypeError("Invalid 'quad'.");Te(this,yi,JSON.parse(JSON.stringify(t)),"f"),this._mediaType="quad"}setPosition(t){this.setQuad(t)}getPosition(){return this.getQuad()}updatePosition(){R(this,yi,"f")&&this.setQuad(R(this,yi,"f"))}setPolygon(){}getPolygon(){return null}setQuad(t){if(!No(t))throw new TypeError("Invalid 'quad'.");if(this._drawingLayer){if("view"===this.coordinateBase){const r=t.points.map(f=>({x:this.convertPropFromViewToImage(f.x),y:this.convertPropFromViewToImage(f.y)}));this.set("vertices",r)}else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("vertices",t.points)}this._drawingLayer.renderAll()}else Te(this,yi,JSON.parse(JSON.stringify(t)),"f")}getQuad(){if(this._drawingLayer){if("view"===this.coordinateBase)return{points:this.get("vertices").map(t=>({x:this.convertPropFromImageToView(t.x),y:this.convertPropFromImageToView(t.y)}))};if("image"===this.coordinateBase)return{points:this.get("vertices")};throw new Error("Invalid 'coordinateBase'.")}return R(this,yi,"f")?JSON.parse(JSON.stringify(R(this,yi,"f"))):null}}yi=new WeakMap;class Ma extends Ct{constructor(t){super(new Ue.Group(t.map(r=>r._getFabricObject()))),this._fabricObject.on("selected",()=>{this.setState(wt.DIS_SELECTED);const r=this._fabricObject._objects;for(let f of r)setTimeout(()=>{f&&f.fire("selected")},0);setTimeout(()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())},0)}),this._fabricObject.on("deselected",()=>{this.setState(wt.DIS_DEFAULT);const r=this._fabricObject._objects;for(let f of r)setTimeout(()=>{f&&f.fire("deselected")},0);setTimeout(()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())},0)}),this._mediaType="group"}extendSet(t,r){return!1}extendGet(t){}updateCoordinateBaseFromImageToView(){}updateCoordinateBaseFromViewToImage(){}setPosition(){}getPosition(){}updatePosition(){}getChildDrawingItems(){return this._fabricObject._objects.map(t=>t.getDrawingItem())}setChildDrawingItems(t){if(!t||!t.isDrawingItem)throw TypeError("Illegal drawing item.");this._drawingLayer?this._drawingLayer._updateGroupItem(this,t,"add"):this._fabricObject.addWithUpdate(t._getFabricObject())}removeChildItem(t){t&&t.isDrawingItem&&(this._drawingLayer?this._drawingLayer._updateGroupItem(this,t,"remove"):this._fabricObject.removeWithUpdate(t._getFabricObject()))}}class de{static createDrawingStyle(t){if(!Bo(t))throw new Error("Invalid style definition.");let r,f=de.USER_START_STYLE_ID;for(;R(de,Ci,"f",Yi).has(f);)f++;r=f;const C=JSON.parse(JSON.stringify(t));C.id=r;for(let T in R(de,Ci,"f",vs))C.hasOwnProperty(T)||(C[T]=R(de,Ci,"f",vs)[T]);return R(de,Ci,"f",Yi).set(r,C),C.id}static _getDrawingStyle(t,r){if("number"!=typeof t)throw new Error("Invalid style id.");const f=R(de,Ci,"f",Yi).get(t);return f?r?JSON.parse(JSON.stringify(f)):f:null}static getDrawingStyle(t){return this._getDrawingStyle(t,!0)}static getAllDrawingStyles(){return JSON.parse(JSON.stringify(Array.from(R(de,Ci,"f",Yi).values())))}static _updateDrawingStyle(t,r){if(!Bo(r))throw new Error("Invalid style definition.");const f=R(de,Ci,"f",Yi).get(t);if(f)for(let C in r)f.hasOwnProperty(C)&&(f[C]=r[C])}static updateDrawingStyle(t,r){this._updateDrawingStyle(t,r)}}Ci=de,de.STYLE_BLUE_STROKE=1,de.STYLE_GREEN_STROKE=2,de.STYLE_ORANGE_STROKE=3,de.STYLE_YELLOW_STROKE=4,de.STYLE_BLUE_STROKE_FILL=5,de.STYLE_GREEN_STROKE_FILL=6,de.STYLE_ORANGE_STROKE_FILL=7,de.STYLE_YELLOW_STROKE_FILL=8,de.STYLE_BLUE_STROKE_TRANSPARENT=9,de.STYLE_GREEN_STROKE_TRANSPARENT=10,de.STYLE_ORANGE_STROKE_TRANSPARENT=11,de.USER_START_STYLE_ID=1024,Yi={value:new Map([[de.STYLE_BLUE_STROKE,{id:de.STYLE_BLUE_STROKE,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[de.STYLE_GREEN_STROKE,{id:de.STYLE_GREEN_STROKE,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[de.STYLE_ORANGE_STROKE,{id:de.STYLE_ORANGE_STROKE,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[de.STYLE_YELLOW_STROKE,{id:de.STYLE_YELLOW_STROKE,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[de.STYLE_BLUE_STROKE_FILL,{id:de.STYLE_BLUE_STROKE_FILL,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[de.STYLE_GREEN_STROKE_FILL,{id:de.STYLE_GREEN_STROKE_FILL,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[de.STYLE_ORANGE_STROKE_FILL,{id:de.STYLE_ORANGE_STROKE_FILL,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[de.STYLE_YELLOW_STROKE_FILL,{id:de.STYLE_YELLOW_STROKE_FILL,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[de.STYLE_BLUE_STROKE_TRANSPARENT,{id:de.STYLE_BLUE_STROKE_TRANSPARENT,lineWidth:4,fillStyle:"rgba(73, 245, 73, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[de.STYLE_GREEN_STROKE_TRANSPARENT,{id:de.STYLE_GREEN_STROKE_TRANSPARENT,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[de.STYLE_ORANGE_STROKE_TRANSPARENT,{id:de.STYLE_ORANGE_STROKE_TRANSPARENT,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}]])},vs={value:{lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}},typeof document<"u"&&typeof window<"u"&&(Ue.StaticCanvas.prototype.dispose=function(){return this.isRendering&&(Ue.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(p){p.dispose&&p.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),Ue.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},Ue.Object.prototype.transparentCorners=!1,Ue.Object.prototype.cornerSize=20,Ue.Object.prototype.touchCornerSize=100,Ue.Object.prototype.cornerColor="rgb(254,142,20)",Ue.Object.prototype.cornerStyle="circle",Ue.Object.prototype.strokeUniform=!0,Ue.Object.prototype.hasBorders=!1,Ue.Canvas.prototype.containerClass="",Ue.Canvas.prototype.getPointer=function(p,t){if(this._absolutePointer&&!t)return this._absolutePointer;if(this._pointer&&t)return this._pointer;var r,f=this.upperCanvasEl,C=Ue.util.getPointer(p,f),T=f.getBoundingClientRect(),S=T.width||0,O=T.height||0;S&&O||("top"in T&&"bottom"in T&&(O=Math.abs(T.top-T.bottom)),"right"in T&&"left"in T&&(S=Math.abs(T.right-T.left))),this.calcOffset(),C.x=C.x-this._offset.left,C.y=C.y-this._offset.top,t||(C=this.restorePointerVpt(C));var x=this.getRetinaScaling();if(1!==x&&(C.x/=x,C.y/=x),0!==S&&0!==O){var L=window.getComputedStyle(f).objectFit,P=f.width,N=f.height;r={width:P/S,height:N/O};var X=P/N,q=S/O;return"contain"===L?X>q?{x:C.x*r.width,y:(C.y-(O-S/X)/2)*r.width}:{x:(C.x-(S-O*X)/2)*r.height,y:C.y*r.height}:"cover"===L?X>q?{x:(P-r.height*S)/2+C.x*r.height,y:C.y*r.height}:{x:C.x*r.width,y:(N-r.width*O)/2+C.y*r.width}:{x:C.x*r.width,y:C.y*r.height}}return{x:C.x*(r={width:1,height:1}).width,y:C.y*r.height}},Ue.Canvas.prototype._onTouchStart=function(p){var t=this.findTarget(p);!this.allowTouchScrolling&&p.cancelable&&p.preventDefault&&p.preventDefault(),t&&p.cancelable&&p.preventDefault&&p.preventDefault(),null===this.mainTouchId&&(this.mainTouchId=this.getPointerId(p)),this.__onMouseDown(p),this._resetTransformEventData();var r=this.upperCanvasEl,f=this._getEventPrefix();Ue.util.addListener(Ue.document,"touchend",this._onTouchEnd,{passive:!1}),Ue.util.addListener(Ue.document,"touchmove",this._onMouseMove,{passive:!1}),Ue.util.removeListener(r,f+"down",this._onMouseDown)},Ue.Textbox.prototype._wrapLine=function(p,t,r,f){const C=p.match(/[\u3040-\u30ff\u3400-\u4dbf\u4e00-\u9fff\uf900-\ufaff\uff66-\uff9f]/g);var S=0,O=this.splitByGrapheme||!(!C||!C.length),x=[],L=[],P=O?Ue.util.string.graphemeSplit(p):p.split(this._wordJoiners),N="",k=0,W=O?"":" ",H=0,Z=0,X=0,q=!0,ie=this._getWidthOfCharSpacing();f=f||0,0===P.length&&P.push([]),r-=f;for(var J=0;J<P.length;J++)N=O?P[J]:Ue.util.string.graphemeSplit(P[J]),H=this._measureWord(N,t,k),k+=N.length,(S+=Z+H-ie)>r&&!q?(x.push(L),L=[],S=H,q=!0):S+=ie,q||O||L.push(W),L=L.concat(N),Z=O?0:this._measureWord([W],t,k),k++,q=!1,H>X&&(X=H);return J&&x.push(L),X+f>this.dynamicMinWidth&&(this.dynamicMinWidth=X-ie+f),x});class nt{get width(){return this.fabricCanvas.width}get height(){return this.fabricCanvas.height}set _allowMultiSelect(t){this.fabricCanvas.selection=t,this.fabricCanvas.renderAll()}get _allowMultiSelect(){return this.fabricCanvas.selection}constructor(t,r,f){let C,T;switch(this.mapMediaType_Style=new Map,this.mapType_StateAndStyleId=new Map,this.mode="viewer",this.onSelectionChanged=null,this._arrDrwaingItem=[],this._arrFabricObject=[],this._visible=!0,t.hasOwnProperty("getFabricCanvas")?this.fabricCanvas=t.getFabricCanvas():(this.fabricCanvas=new Ue.Canvas(t,Object.assign(f,{allowTouchScrolling:!0,selection:!1})),this.fabricCanvas.setDimensions({width:"100%",height:"100%"},{cssOnly:!0}),this.fabricCanvas.lowerCanvasEl.className="",this.fabricCanvas.upperCanvasEl.className="",this.fabricCanvas.on("selection:created",function(S){const O=S.selected,x=[];for(let L of O){const P=L.getDrawingItem()._drawingLayer;P&&!x.includes(P)&&x.push(P)}for(let L of x){const P=[];for(let N of O){const k=N.getDrawingItem();k._drawingLayer===L&&P.push(k)}setTimeout(()=>{L.onSelectionChanged&&L.onSelectionChanged(P,[])},0)}}),this.fabricCanvas.on("before:selection:cleared",function(S){const O=this.getActiveObjects(),x=[];for(let L of O){const P=L.getDrawingItem()._drawingLayer;P&&!x.includes(P)&&x.push(P)}for(let L of x){const P=[];for(let N of O){const k=N.getDrawingItem();k._drawingLayer===L&&P.push(k)}setTimeout(()=>{const N=[];for(let k of P)L.hasDrawingItem(k)&&N.push(k);N.length>0&&L.onSelectionChanged&&L.onSelectionChanged([],N)},0)}}),this.fabricCanvas.on("selection:updated",function(S){const O=S.selected,x=S.deselected,L=[];for(let P of O){const N=P.getDrawingItem()._drawingLayer;N&&!L.includes(N)&&L.push(N)}for(let P of x){const N=P.getDrawingItem()._drawingLayer;N&&!L.includes(N)&&L.push(N)}for(let P of L){const N=[],k=[];for(let W of O){const H=W.getDrawingItem();H._drawingLayer===P&&N.push(H)}for(let W of x){const H=W.getDrawingItem();H._drawingLayer===P&&k.push(H)}setTimeout(()=>{P.onSelectionChanged&&P.onSelectionChanged(N,k)},0)}}),this.fabricCanvas.wrapperEl.style.position="absolute",t.getFabricCanvas=()=>this.fabricCanvas),this.id=r,r){case nt.DDN_LAYER_ID:C=de.getDrawingStyle(de.STYLE_BLUE_STROKE),T=de.getDrawingStyle(de.STYLE_BLUE_STROKE_FILL);break;case nt.DBR_LAYER_ID:C=de.getDrawingStyle(de.STYLE_ORANGE_STROKE),T=de.getDrawingStyle(de.STYLE_ORANGE_STROKE_FILL);break;case nt.DLR_LAYER_ID:C=de.getDrawingStyle(de.STYLE_GREEN_STROKE),T=de.getDrawingStyle(de.STYLE_GREEN_STROKE_FILL);break;default:C=de.getDrawingStyle(de.STYLE_YELLOW_STROKE),T=de.getDrawingStyle(de.STYLE_YELLOW_STROKE_FILL)}for(let S of Ct.arrMediaTypes)this.mapType_StateAndStyleId.set(S,{default:C.id,selected:T.id})}getId(){return this.id}setVisible(t){if(t){for(let r of this._arrFabricObject)r.visible=!0,r.hasControls=!0;this._visible=!0}else{for(let r of this._arrFabricObject)r.visible=!1,r.hasControls=!1;this._visible=!1}this.fabricCanvas.renderAll()}isVisible(){return this._visible}_getItemCurrentStyleId(t){return t.styleId?t.styleId:this.mapType_StateAndStyleId.get(t._mediaType)[t.styleSelector]}_getItemCurrentStyle(t){return t.styleId?de.getDrawingStyle(t.styleId):de.getDrawingStyle(t._mapState_StyleId.get(t.styleSelector))||null}_changeMediaTypeCurStyleInStyleSelector(t,r,f,C){const T=this.getDrawingItems(S=>S._mediaType===t);for(let S of T)S.styleSelector===r&&this._changeItemStyle(S,f,!0);C||this.fabricCanvas.renderAll()}_changeItemStyle(t,r,f){if(!t||!r)return;const C=t._getFabricObject();"number"==typeof t.styleId&&(r=de.getDrawingStyle(t.styleId)),C.strokeWidth=r.lineWidth,"fill"===r.paintMode?(C.fill=r.fillStyle,C.stroke=r.fillStyle):"stroke"===r.paintMode?(C.fill="transparent",C.stroke=r.strokeStyle):"strokeAndFill"===r.paintMode&&(C.fill=r.fillStyle,C.stroke=r.strokeStyle),C.fontFamily&&(C.fontFamily=r.fontFamily),C.fontSize&&(C.fontSize=r.fontSize),C.group||(C.dirty=!0),f||this.fabricCanvas.renderAll()}_updateGroupItem(t,r,f){if(!t||!r)return;const C=t.getChildDrawingItems();if("add"===f){if(C.includes(r))return;const T=r._getFabricObject();if(this.fabricCanvas.getObjects().includes(T)){if(!this._arrFabricObject.includes(T))throw new Error("Existed in other drawing layers.");r._zIndex=null}else{let S;if(r.styleId)S=de.getDrawingStyle(r.styleId);else{const O=this.mapType_StateAndStyleId.get(r._mediaType);S=de.getDrawingStyle(O[t.styleSelector]);const x=()=>{this._changeItemStyle(r,de.getDrawingStyle(this.mapType_StateAndStyleId.get(r._mediaType).selected),!0)},L=()=>{this._changeItemStyle(r,de.getDrawingStyle(this.mapType_StateAndStyleId.get(r._mediaType).default),!0)};r._on("selected",x),r._on("deselected",L),r._funcChangeStyleToSelected=x,r._funcChangeStyleToDefault=L}r._drawingLayer=this,r._drawingLayerId=this.id,this._changeItemStyle(r,S,!0)}t._fabricObject.addWithUpdate(r._getFabricObject())}else{if("remove"!==f||!C.includes(r))return;r._zIndex=null,r._drawingLayer=null,r._drawingLayerId=null,r._off("selected",r._funcChangeStyleToSelected),r._off("deselected",r._funcChangeStyleToDefault),r._funcChangeStyleToSelected=null,r._funcChangeStyleToDefault=null,t._fabricObject.removeWithUpdate(r._getFabricObject())}this.fabricCanvas.renderAll()}_addDrawingItem(t,r){if(!(t instanceof Ct))throw new TypeError("Invalid 'drawingItem'.");if(t._drawingLayer){if(t._drawingLayer==this)return;throw new Error("This drawing item has existed in other layer.")}let f=t._getFabricObject();const C=this.fabricCanvas.getObjects();let T,S;if(C.includes(f)){if(this._arrFabricObject.includes(f))return;throw new Error("Existed in other drawing layers.")}if("group"===t._mediaType){T=t.getChildDrawingItems();for(let L of T)if(L._drawingLayer&&L._drawingLayer!==this)throw new Error("The childItems of DT_Group have existed in other drawing layers.")}if(r&&"object"==typeof r&&!Array.isArray(r))for(let L in r)f.set(L,r[L]);if(T){for(let L of T){const P=this.mapType_StateAndStyleId.get(L._mediaType);for(let N of Ct.arrStyleSelectors)L._mapState_StyleId.set(N,P[N]);if(L.styleId)S=de.getDrawingStyle(L.styleId);else{S=de.getDrawingStyle(P.default);const N=()=>{this._changeItemStyle(L,de.getDrawingStyle(this.mapType_StateAndStyleId.get(L._mediaType).selected),!0)},k=()=>{this._changeItemStyle(L,de.getDrawingStyle(this.mapType_StateAndStyleId.get(L._mediaType).default),!0)};L._on("selected",N),L._on("deselected",k),L._funcChangeStyleToSelected=N,L._funcChangeStyleToDefault=k}L._drawingLayer=this,L._drawingLayerId=this.id,this._changeItemStyle(L,S,!0)}f.dirty=!0,this.fabricCanvas.renderAll()}else{const L=this.mapType_StateAndStyleId.get(t._mediaType);for(let P of Ct.arrStyleSelectors)t._mapState_StyleId.set(P,L[P]);if(t.styleId)S=de.getDrawingStyle(t.styleId);else{S=de.getDrawingStyle(L.default);const P=()=>{this._changeItemStyle(t,de.getDrawingStyle(this.mapType_StateAndStyleId.get(t._mediaType).selected))},N=()=>{this._changeItemStyle(t,de.getDrawingStyle(this.mapType_StateAndStyleId.get(t._mediaType).default))};t._on("selected",P),t._on("deselected",N),t._funcChangeStyleToSelected=P,t._funcChangeStyleToDefault=N}this._changeItemStyle(t,S)}t._zIndex=this.id,t._drawingLayer=this,t._drawingLayerId=this.id;const O=this._arrFabricObject.length;let x=C.length;if(O)x=C.indexOf(this._arrFabricObject[O-1])+1;else for(let L=0;L<C.length;L++)if(t._zIndex<C[L].getDrawingItem()._zIndex){x=L;break}this._arrDrwaingItem.push(t),this._arrFabricObject.push(f),f.visible=!!this._visible,this.fabricCanvas.insertAt(f,x,!1)}addDrawingItem(t){if(!t||!t.isDrawingItem)throw TypeError("Illegal drawing item.");if("viewer"===this.mode)t._setEditable(!1);else{if("editor"!==this.mode)throw new Error("Illegal 'mode'.");t._setEditable(!0)}this._addDrawingItem(t),t.updatePosition()}addDrawingItems(t){for(let r of t)this.addDrawingItem(r)}removeDrawingItem(t){if(!t||!t.isDrawingItem)throw TypeError("Illegal drawing item.");if(!this.hasDrawingItem(t))return;if(t._zIndex=null,t._drawingLayer=null,t._drawingLayerId=null,"group"===t._mediaType){const f=t.getChildDrawingItems();for(let C of f)C._zIndex=null,C._drawingLayer=null,C._drawingLayerId=null,C._off("selected",C._funcChangeStyleToSelected),C._off("deselected",C._funcChangeStyleToDefault),C._funcChangeStyleToSelected=null,C._funcChangeStyleToDefault=null,C._mapState_StyleId.clear()}else t._off("selected",t._funcChangeStyleToSelected),t._off("deselected",t._funcChangeStyleToDefault),t._funcChangeStyleToSelected=null,t._funcChangeStyleToDefault=null,t._mapState_StyleId.clear();const r=t._getFabricObject();"selected"===t.styleSelector&&(r.group?r.group.removeWithUpdate(r):this.fabricCanvas._activeObject=null,t.setState(wt.DIS_DEFAULT)),this.fabricCanvas.remove(r),this._arrDrwaingItem.splice(this._arrDrwaingItem.indexOf(t),1),this._arrFabricObject.splice(this._arrFabricObject.indexOf(r),1)}removeDrawingItems(t){for(let r of t)this.removeDrawingItem(r)}setDrawingItems(t){this.clearDrawingItems(),this.addDrawingItems(t)}getDrawingItems(t){return t&&"function"==typeof t?this._arrDrwaingItem.filter(t):Array.from(this._arrDrwaingItem)}getSelectedDrawingItems(){const t=this.fabricCanvas.getActiveObjects(),r=[];for(let f of t)this._arrFabricObject.includes(f)&&r.push(f.getDrawingItem());return r}hasDrawingItem(t){if(!t||!t.isDrawingItem)throw TypeError("Illegal drawing item.");return this._arrDrwaingItem.includes(t)}clearDrawingItems(){this.removeDrawingItems(Array.from(this._arrDrwaingItem))}_setDefaultStyle(t,r,f){r?r.forEach(S=>S.toLowerCase()):r=Ct.arrMediaTypes,f?f.forEach(S=>S.toLowerCase()):f=Ct.arrStyleSelectors;const C=de.getDrawingStyle(t);if(!C)throw new Error(`The 'drawingStyle' with id '${t}' doesn't exist.`);let T;for(let S of r)if(T=this.mapType_StateAndStyleId.get(S),T)for(let O of f){this._changeMediaTypeCurStyleInStyleSelector(S,O,C,!0),T[O]=t;for(let x of this._arrDrwaingItem)x._mediaType===S&&x._mapState_StyleId.set(O,t)}this.fabricCanvas.renderAll()}setDefaultStyle(t,r,f){const C=[];f&mt.DIMT_RECTANGLE&&C.push("rect"),f&mt.DIMT_QUADRILATERAL&&C.push("quad"),f&mt.DIMT_TEXT&&C.push("text"),f&mt.DIMT_ARC&&C.push("arc"),f&mt.DIMT_IMAGE&&C.push("image"),f&mt.DIMT_POLYGON&&C.push("polygon"),f&mt.DIMT_LINE&&C.push("line");const T=[];r&wt.DIS_DEFAULT&&T.push("default"),r&wt.DIS_SELECTED&&T.push("selected"),this._setDefaultStyle(t,C.length?C:null,T.length?T:null)}setMode(t){if("viewer"===(t=t.toLowerCase())){for(let r of this._arrDrwaingItem)r._setEditable(!1);this.fabricCanvas.discardActiveObject(),this.fabricCanvas.renderAll(),this.mode="viewer"}else{if("editor"!==t)throw new RangeError("Invalid value.");for(let r of this._arrDrwaingItem)r._setEditable(!0);this.mode="editor"}this._manager._switchPointerEvent()}getMode(){return this.mode}_setDimensions(t,r){this.fabricCanvas.setDimensions(t,r)}_setObjectFit(t){if(t=t.toLowerCase(),!["contain","cover"].includes(t))throw new Error(`Unsupported value '${t}'.`);this.fabricCanvas.lowerCanvasEl.style.objectFit=t,this.fabricCanvas.upperCanvasEl.style.objectFit=t}_getObjectFit(){return this.fabricCanvas.lowerCanvasEl.style.objectFit}renderAll(){for(let t of this._arrDrwaingItem){const r=this._getItemCurrentStyle(t);this._changeItemStyle(t,r,!0)}this.fabricCanvas.renderAll()}dispose(){this.clearDrawingItems(),1===this._manager._arrDrawingLayer.length&&(this.fabricCanvas.wrapperEl.style.pointerEvents="none",this.fabricCanvas.dispose(),this._arrDrwaingItem.length=0,this._arrFabricObject.length=0)}}nt.DDN_LAYER_ID=1,nt.DBR_LAYER_ID=2,nt.DLR_LAYER_ID=3,nt.USER_DEFINED_LAYER_BASE_ID=100,nt.TIP_LAYER_ID=999;class Fa{constructor(){this._arrDrawingLayer=[]}createDrawingLayer(t,r){if(this.getDrawingLayer(r))throw new Error("Existed drawing layer id.");const f=new nt(t,r,{enableRetinaScaling:!1});return f._manager=this,this._arrDrawingLayer.push(f),this._switchPointerEvent(),f}deleteDrawingLayer(t){const r=this.getDrawingLayer(t);if(!r)return;const f=this._arrDrawingLayer;r.dispose(),f.splice(f.indexOf(r),1),this._switchPointerEvent()}clearDrawingLayers(){for(let t of this._arrDrawingLayer)t.dispose();this._arrDrawingLayer.length=0}getDrawingLayer(t){for(let r of this._arrDrawingLayer)if(r.getId()===t)return r;return null}getAllDrawingLayers(){return Array.from(this._arrDrawingLayer)}getSelectedDrawingItems(){if(!this._arrDrawingLayer.length)return;const t=this._getFabricCanvas().getActiveObjects(),r=[];for(let f of t)r.push(f.getDrawingItem());return r}setDimensions(t,r){this._arrDrawingLayer.length&&this._arrDrawingLayer[0]._setDimensions(t,r)}setObjectFit(t){for(let r of this._arrDrawingLayer)r&&r._setObjectFit(t)}getObjectFit(){return this._arrDrawingLayer.length?this._arrDrawingLayer[0]._getObjectFit():null}setVisible(t){this._arrDrawingLayer.length&&(this._getFabricCanvas().wrapperEl.style.display=t?"block":"none")}_getFabricCanvas(){return this._arrDrawingLayer.length?this._arrDrawingLayer[0].fabricCanvas:null}_switchPointerEvent(){if(this._arrDrawingLayer.length)for(let t of this._arrDrawingLayer)t.getMode()}}class Pa extends Da{constructor(t,r,f,C,T){super(t,{x:r,y:f,width:C,height:0},T),Hi.set(this,void 0),wn.set(this,void 0),this._fabricObject.paddingTop=15,this._fabricObject.calcTextHeight=function(){for(var S=0,O=0,x=this._textLines.length;O<x;O++)S+=this.getHeightOfLine(O);return S+2*this.paddingTop},this._fabricObject._getTopOffset=function(){return-this.height/2+this.getHeightOfLine(0)*(1-1/this.lineHeight)/2+this.paddingTop},this.set("backgroundColor","rgba(50, 50, 52, .8)"),this.set("lineHeight",1.3),this.set("textAlign","center")}setDuration(t){Te(this,Hi,t,"f"),R(this,wn,"f")&&clearTimeout(R(this,wn,"f")),R(this,Hi,"f")>=0&&Te(this,wn,setTimeout(()=>{this.set("visible",!1),this._drawingLayer&&this._drawingLayer.renderAll()},R(this,Hi,"f")),"f")}getDuration(){return R(this,Hi,"f")}}Hi=new WeakMap,wn=new WeakMap;class ka{constructor(){Xi.add(this),Tt.set(this,void 0),Tn.set(this,void 0),bn.set(this,void 0),Sn.set(this,!0),this._drawingLayerManager=new Fa}createDrawingLayerBaseCvs(t,r,f="contain"){if("number"!=typeof t||t<=1)throw new Error("Invalid 'width'.");if("number"!=typeof r||r<=1)throw new Error("Invalid 'height'.");if(!["contain","cover"].includes(f))throw new Error("Unsupported 'objectFit'.");const C=document.createElement("canvas");return C.width==t&&C.height==r||(C.width=t,C.height=r),C.style.objectFit=f,C}_createDrawingLayer(t,r,f,C){if(!this._layerBaseCvs){let O;try{O=this.getContentDimensions()}catch(x){if("Invalid content dimensions."!==(x.message||x))throw x}r||(r=O?.width||1280),f||(f=O?.height||720),C||(C=O?.objectFit||"contain"),this._layerBaseCvs=this.createDrawingLayerBaseCvs(r,f,C)}const T=this._layerBaseCvs,S=this._drawingLayerManager.createDrawingLayer(T,t);return this._innerComponent.getElement("drawing-layer")||this._innerComponent.setElement("drawing-layer",T.parentElement),S}createDrawingLayer(){let t;for(let r=nt.USER_DEFINED_LAYER_BASE_ID;;r++)if(!this._drawingLayerManager.getDrawingLayer(r)&&r!==nt.TIP_LAYER_ID){t=r;break}return this._createDrawingLayer(t)}deleteDrawingLayer(t){var r;this._drawingLayerManager.deleteDrawingLayer(t),this._drawingLayerManager.getAllDrawingLayers().length||(null===(r=this._innerComponent)||void 0===r||r.removeElement("drawing-layer"),this._layerBaseCvs=null)}deleteUserDefinedDrawingLayer(t){if("number"!=typeof t)throw new TypeError("Invalid id.");if(t<nt.USER_DEFINED_LAYER_BASE_ID)throw new Error(`The drawing layer with id ${t} is not defined by users.`);this.deleteDrawingLayer(t)}_clearDrawingLayers(){const t=this.getAllDrawingLayers();for(let r of t)this.deleteDrawingLayer(r.getId())}clearUserDefinedDrawingLayers(){const t=this.getAllDrawingLayers();for(let r of t){const f=r.getId();f<nt.USER_DEFINED_LAYER_BASE_ID||this.deleteUserDefinedDrawingLayer(f)}}getDrawingLayer(t){return t==nt.TIP_LAYER_ID?null:this._drawingLayerManager.getDrawingLayer(t)||([nt.DDN_LAYER_ID,nt.DBR_LAYER_ID,nt.DLR_LAYER_ID].includes(t)?this._createDrawingLayer(t):null)}getAllDrawingLayers(){return this._drawingLayerManager.getAllDrawingLayers().filter(t=>t.getId()>=0&&t.getId()!==nt.TIP_LAYER_ID)}updateDrawingLayers(t){((r,f,C)=>{if(!(r<=1||f<=1)){if(!["contain","cover"].includes(C))throw new Error("Unsupported 'objectFit'.");this._drawingLayerManager.setDimensions({width:r,height:f},{backstoreOnly:!0}),this._drawingLayerManager.setObjectFit(C)}})(t.width,t.height,t.objectFit)}getSelectedDrawingItems(){return this._drawingLayerManager.getSelectedDrawingItems()}setTipConfig(t){if(!(Fo(r=t)&&Oa(r.topLeftPoint)&&Gi(r.width))||r.width<=0||!Gi(r.duration)||"coordinateBase"in r&&!["view","image"].includes(r.coordinateBase))throw new Error("Invalid tip config.");var r;Te(this,Tt,JSON.parse(JSON.stringify(t)),"f"),R(this,Tt,"f").coordinateBase||(R(this,Tt,"f").coordinateBase="view"),Te(this,bn,t.duration,"f"),R(this,Xi,"m",Ho).call(this)}getTipConfig(){return R(this,Tt,"f")?R(this,Tt,"f"):null}setTipVisible(t){if("boolean"!=typeof t)throw new TypeError("Invalid value.");this._tip&&(this._tip.set("visible",t),this._drawingLayerOfTip&&this._drawingLayerOfTip.renderAll()),Te(this,Sn,t,"f")}isTipVisible(){return R(this,Sn,"f")}updateTipMessage(t){if(!R(this,Tt,"f"))throw new Error("Tip config is not set.");this._tipStyleId||(this._tipStyleId=de.createDrawingStyle({fillStyle:"#FFFFFF",paintMode:"fill",fontFamily:"Open Sans",fontSize:40})),this._drawingLayerOfTip||(this._drawingLayerOfTip=this._drawingLayerManager.getDrawingLayer(nt.TIP_LAYER_ID)||this._createDrawingLayer(nt.TIP_LAYER_ID)),this._tip?this._tip.set("text",t):this._tip=R(this,Xi,"m",Vo).call(this,t,R(this,Tt,"f").topLeftPoint.x,R(this,Tt,"f").topLeftPoint.y,R(this,Tt,"f").width,R(this,Tt,"f").coordinateBase,this._tipStyleId),R(this,Xi,"m",Wo).call(this,this._tip,this._drawingLayerOfTip),this._tip.set("visible",R(this,Sn,"f")),this._drawingLayerOfTip&&this._drawingLayerOfTip.renderAll(),R(this,Tn,"f")&&clearTimeout(R(this,Tn,"f")),R(this,bn,"f")>=0&&Te(this,Tn,setTimeout(()=>{R(this,Xi,"m",Yo).call(this)},R(this,bn,"f")),"f")}}Tt=new WeakMap,Tn=new WeakMap,bn=new WeakMap,Sn=new WeakMap,Xi=new WeakSet,Vo=function(p,t,r,f,C,T){const S=new Pa(p,t,r,f,T);return S.coordinateBase=C,S},Wo=function(p,t){t.hasDrawingItem(p)||t.addDrawingItems([p])},Yo=function(){this._tip&&this._drawingLayerOfTip.removeDrawingItems([this._tip])},Ho=function(){if(!this._tip)return;const p=R(this,Tt,"f");this._tip.coordinateBase=p.coordinateBase,this._tip.setTextRect({x:p.topLeftPoint.x,y:p.topLeftPoint.y,width:p.width,height:0}),this._tip.set("width",this._tip.get("width")),this._tip._drawingLayer&&this._tip._drawingLayer.renderAll()};class ws extends HTMLElement{constructor(){super(),fr.set(this,void 0);const t=document.createElement("template").content,r=document.createElement("div");r.setAttribute("class","wrapper"),t.appendChild(r),Te(this,fr,r,"f");const f=document.createElement("slot");f.setAttribute("name","single-frame-input-container"),r.append(f);const C=document.createElement("slot");C.setAttribute("name","content"),r.append(C);const T=document.createElement("slot");T.setAttribute("name","drawing-layer"),r.append(T);const S=document.createElement("style");S.textContent='\n.wrapper {\n  position: relative;\n  width: 100%;\n  height: 100%;\n}\n::slotted(canvas[slot="content"]) {\n  object-fit: contain;\n  pointer-events: none;\n}\n::slotted(div[slot="single-frame-input-container"]) {\n  width: 1px;\n  height: 1px;\n  overflow: hidden;\n  pointer-events: none;\n}\n::slotted(*) {\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 100%;\n}\n    ',t.appendChild(S),this.attachShadow({mode:"open"}).appendChild(t.cloneNode(!0))}getWrapper(){return R(this,fr,"f")}setElement(t,r){if(!(r instanceof HTMLElement))throw new TypeError("Invalid 'el'.");if(!["content","single-frame-input-container","drawing-layer"].includes(t))throw new TypeError("Invalid 'slot'.");this.removeElement(t),r.setAttribute("slot",t),this.appendChild(r)}getElement(t){if(!["content","single-frame-input-container","drawing-layer"].includes(t))throw new TypeError("Invalid 'slot'.");return this.querySelector(`[slot="${t}"]`)}removeElement(t){var r;if(!["content","single-frame-input-container","drawing-layer"].includes(t))throw new TypeError("Invalid 'slot'.");null===(r=this.querySelectorAll(`[slot="${t}"]`))||void 0===r||r.forEach(f=>f.remove())}}fr=new WeakMap,customElements.get("dce-component")||customElements.define("dce-component",ws);class zi extends HTMLElement{constructor(){super();const t=window._dce_default_template.content;this.attachShadow({mode:"open"}).appendChild(t.cloneNode(!0))}showScanLaser(){const t=this.shadowRoot.querySelector(".dce-scanlight");t&&(t.style.display="")}hideScanLaser(){const t=this.shadowRoot.querySelector(".dce-scanlight");t&&(t.style.display="none")}getElement(t){return this.shadowRoot.querySelector(t)}getVideoContainer(){return this.shadowRoot.querySelector(".dce-video-container")}getScanAreaEl(){return this.shadowRoot.querySelector(".dce-scanarea")}getScanLightEl(){return this.shadowRoot.querySelector(".dce-scanlight")}getLoadingBackgroundEl(){return this.shadowRoot.querySelector(".dce-bg-loading")}getCameraBackgroundEl(){return this.shadowRoot.querySelector(".dce-bg-camera")}getCameraSelectEl(){return this.shadowRoot.querySelector(".dce-sel-camera")}getResolutionSelectEl(){return this.shadowRoot.querySelector(".dce-sel-resolution")}getResolutionOptionEl(){return this.shadowRoot.querySelector(".dce-opt-gotResolution")}getCloseBtnEl(){return this.shadowRoot.querySelector(".dce-btn-close")}getDLRSelectEl(){return this.shadowRoot.querySelector(".dlr-sel-minletter")}getDLROptionEl(){return this.shadowRoot.querySelector(".dlr-opt-gotMinLtr")}}class lt extends ka{static get engineResourcePath(){return at.engineResourcePaths.dce}static set defaultUIElementURL(t){lt._defaultUIElementURL=t}static get defaultUIElementURL(){var t;return null===(t=lt._defaultUIElementURL)||void 0===t?void 0:t.replace("@engineResourcePath/",lt.engineResourcePath)}static createInstance(t){return te(function*(){customElements.get(lt.uiComponentName)||customElements.define(lt.uiComponentName,zi);const r=new lt;return yield r.setUIElement(t||lt.defaultUIElementURL),r})()}static _transformCoordinates(t,r,f,C,T,S,O){const L=O/T;t.x=Math.round(t.x/(S/C)+r),t.y=Math.round(t.y/L+f)}set _singleFrameMode(t){if(!["disabled","image","camera"].includes(t))throw new Error("Invalid value.");if(t!==R(this,On,"f")){if(Te(this,On,t,"f"),R(this,Je,"m",bt).call(this))Te(this,ut,null,"f"),this._videoContainer=null,this._innerComponent.removeElement("content"),this._innerComponent&&(this._innerComponent.addEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="block");else if(this._innerComponent&&(this._innerComponent.removeEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none"),!R(this,ut,"f")){const r=document.createElement("video");r.style.position="absolute",r.style.left="0",r.style.top="0",r.style.width="100%",r.style.height="100%",r.style.objectFit=this.getVideoFit(),r.setAttribute("autoplay","true"),r.setAttribute("playsinline","true"),r.setAttribute("muted","true"),["iPhone","iPad","Mac"].includes(gt.OS)&&r.setAttribute("poster","data:image/gif;base64,R0lGODlhAQABAIEAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAgEAAEEBAA7"),Te(this,ut,r,"f");const f=document.createElement("div");f.append(r),f.style.overflow="hidden",this._videoContainer=f,this._innerComponent.setElement("content",f)}R(this,Je,"m",bt).call(this)||this._hideDefaultSelection?(this._selCam&&(this._selCam.style.display="none"),this._selRsl&&(this._selRsl.style.display="none"),this._selMinLtr&&(this._selMinLtr.style.display="none")):(this._selCam&&(this._selCam.style.display="block"),this._selRsl&&(this._selRsl.style.display="block"),this._selMinLtr&&(this._selMinLtr.style.display="block"),this._stopLoading())}}get _singleFrameMode(){return R(this,On,"f")}get disposed(){return R(this,ys,"f")}constructor(){var t;super(),t=this,Je.add(this),In.set(this,void 0),xn.set(this,void 0),An.set(this,void 0),this.containerClassName="dce-video-container",ut.set(this,void 0),this.videoFit="contain",this._hideDefaultSelection=!1,this._divScanArea=null,this._divScanLight=null,this._bgLoading=null,this._selCam=null,this._bgCamera=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,gr.set(this,null),this.regionMaskFillStyle="rgba(0,0,0,0.5)",this.regionMaskStrokeStyle="rgb(254,142,20)",this.regionMaskLineWidth=6,mr.set(this,!1),pr.set(this,!1),Ei.set(this,{width:0,height:0}),this._updateLayersTimeout=500,this._videoResizeListener=()=>{R(this,Je,"m",Dn).call(this),this._updateLayersTimeoutId&&clearTimeout(this._updateLayersTimeoutId),this._updateLayersTimeoutId=setTimeout(()=>{this.disposed||(this.eventHandler.fire("videoEl:resized",null,{async:!1}),this.eventHandler.fire("content:updated",null,{async:!1}),this.isScanLaserVisible()&&R(this,Je,"m",Es).call(this))},this._updateLayersTimeout)},this._windowResizeListener=()=>{lt._onLog&&lt._onLog("window resize event triggered."),R(this,Ei,"f").width===document.documentElement.clientWidth&&R(this,Ei,"f").height===document.documentElement.clientHeight||(R(this,Ei,"f").width=document.documentElement.clientWidth,R(this,Ei,"f").height=document.documentElement.clientHeight,this._videoResizeListener())},On.set(this,"disabled"),this._clickIptSingleFrameMode=()=>{if(!R(this,Je,"m",bt).call(this))return;let r;if(this._singleFrameInputContainer)r=this._singleFrameInputContainer.firstElementChild;else{r=document.createElement("input"),r.setAttribute("type","file"),"camera"===this._singleFrameMode?(r.setAttribute("capture",""),r.setAttribute("accept","image/*")):"image"===this._singleFrameMode&&(r.removeAttribute("capture"),r.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp")),r.addEventListener("change",te(function*(){const C=r.files[0];r.value="";{const T=function(){var W=te(function*(H){let Z=null,X=null;if(typeof createImageBitmap<"u")try{if(Z=yield createImageBitmap(H),Z)return Z}catch{}var q;return Z||(X=yield(q=H,new Promise((ie,J)=>{let Ee=URL.createObjectURL(q),_e=new Image;_e.src=Ee,_e.onload=()=>{URL.revokeObjectURL(_e.src),ie(_e)},_e.onerror=xe=>{J(new Error("Can't convert blob to image : "+(xe instanceof Event?xe.type:xe)))}}))),X});return function(Z){return W.apply(this,arguments)}}(),S=(W,H,Z,X)=>{W.width==Z&&W.height==X||(W.width=Z,W.height=X);const q=W.getContext("2d");q.clearRect(0,0,W.width,W.height),q.drawImage(H,0,0)},O=yield T(C),x=O instanceof HTMLImageElement?O.naturalWidth:O.width,L=O instanceof HTMLImageElement?O.naturalHeight:O.height;let P=t._cvsSingleFrameMode;const N=P?.width,k=P?.height;P||(P=document.createElement("canvas"),t._cvsSingleFrameMode=P),S(P,O,x,L),t._innerComponent.setElement("content",P),N===P.width&&k===P.height||t.eventHandler.fire("content:updated",null,{async:!1})}t._onSingleFrameAcquired&&setTimeout(()=>{t._onSingleFrameAcquired(t._cvsSingleFrameMode)},0)})),r.style.position="absolute",r.style.top="-9999px",r.style.backgroundColor="transparent",r.style.color="transparent";const f=document.createElement("div");f.append(r),this._innerComponent.setElement("single-frame-input-container",f),this._singleFrameInputContainer=f}r?.click()},this.extraBindings=[],Rn.set(this,[]),this._capturedResultReceiver={onCapturedResultReceived:(r,f)=>{var C,T,S,O;if(this.disposed||(this.clearAllInnerDrawingItems(),!r))return;const x=r.originalImageTag;if(!x)return;const L=r.items;if(!L?.length)return;const P=(null===(C=x.cropRegion)||void 0===C?void 0:C.left)||0,N=(null===(T=x.cropRegion)||void 0===T?void 0:T.top)||0,k=null!==(S=x.cropRegion)&&void 0!==S&&S.right?x.cropRegion.right-P:x.originalWidth,W=null!==(O=x.cropRegion)&&void 0!==O&&O.bottom?x.cropRegion.bottom-N:x.originalHeight,H=x.currentWidth,Z=x.currentHeight,X=(J,Ee,_e,xe,Ie,b,me,Re,je=[],u)=>{Ee.forEach(l=>lt._transformCoordinates(l,_e,xe,Ie,b,me,Re));const a=new La({points:[{x:Ee[0].x,y:Ee[0].y},{x:Ee[1].x,y:Ee[1].y},{x:Ee[2].x,y:Ee[2].y},{x:Ee[3].x,y:Ee[3].y}]},u);for(let l of je)a.addNote(l);J.addDrawingItems([a]),R(this,Rn,"f").push(a)};let q,ie;for(let J of L)switch(J.type){case Le.CRIT_ORIGINAL_IMAGE:break;case Le.CRIT_BARCODE:q=this.getDrawingLayer(nt.DBR_LAYER_ID),ie=[{name:"format",content:J.formatString},{name:"text",content:J.text}],f?.isBarcodeVerifyOpen?J.verified?X(q,J.location.points,P,N,k,W,H,Z,ie):X(q,J.location.points,P,N,k,W,H,Z,ie,de.STYLE_ORANGE_STROKE_TRANSPARENT):X(q,J.location.points,P,N,k,W,H,Z,ie);break;case Le.CRIT_TEXT_LINE:q=this.getDrawingLayer(nt.DLR_LAYER_ID),ie=[{name:"text",content:J.text}],f.isLabelVerifyOpen?J.verified?X(q,J.location.points,P,N,k,W,H,Z,ie):X(q,J.location.points,P,N,k,W,H,Z,ie,de.STYLE_GREEN_STROKE_TRANSPARENT):X(q,J.location.points,P,N,k,W,H,Z,ie);break;case Le.CRIT_DETECTED_QUAD:q=this.getDrawingLayer(nt.DDN_LAYER_ID),f?.isDetectVerifyOpen?J.verified?X(q,J.location.points,P,N,k,W,H,Z,[]):X(q,J.location.points,P,N,k,W,H,Z,[],de.STYLE_BLUE_STROKE_TRANSPARENT):X(q,J.location.points,P,N,k,W,H,Z,[]);break;case Le.CRIT_NORMALIZED_IMAGE:q=this.getDrawingLayer(nt.DDN_LAYER_ID),f?.isNormalizeVerifyOpen?J.verified?X(q,J.location.points,P,N,k,W,H,Z,[]):X(q,J.location.points,P,N,k,W,H,Z,[],de.STYLE_BLUE_STROKE_TRANSPARENT):X(q,J.location.points,P,N,k,W,H,Z,[]);break;case Le.CRIT_PARSED_RESULT:break;default:throw new Error("Illegal item type.")}}},ys.set(this,!1),this.eventHandler=new Uo,this.eventHandler.on("content:updated",()=>{R(this,In,"f")&&clearTimeout(R(this,In,"f")),Te(this,In,setTimeout(()=>{if(this.disposed)return;let r;this._updateVideoContainer();try{r=this.getContentDimensions()}catch(f){if("Invalid content dimensions."===(f.message||f))return;throw f}this.updateDrawingLayers(r),this.updateConvertedRegion(r)},0),"f")}),this.eventHandler.on("videoEl:resized",()=>{R(this,xn,"f")&&clearTimeout(R(this,xn,"f")),Te(this,xn,setTimeout(()=>{this.disposed||this._updateVideoContainer()},0),"f")})}_setUIElement(t){t instanceof HTMLTemplateElement?(window._dce_default_template=t,this.UIElement=new zi):this.UIElement=t,this._unbindUI(),this._bindUI()}setUIElement(t){var r=this;return te(function*(){let f;if(f="string"==typeof t?yield fs(t):t,f instanceof HTMLDivElement&&0==f.childElementCount){const C=yield fs(lt.defaultUIElementURL);C instanceof HTMLTemplateElement?(window._dce_default_template=C,f.append(new zi)):f.append(C),r._setUIElement(f)}else r._setUIElement(f)})()}getUIElement(){return this.UIElement}_bindUI(){var t;if(!this.UIElement)throw new Error("Need to set 'UIElement'.");if(this._innerComponent)return;let r,f=this.UIElement;if(f instanceof zi?r=f.getElement(`.${this.containerClassName}`):f instanceof HTMLDivElement&&1===f.childElementCount&&f.firstElementChild instanceof zi?(r=f.firstElementChild.getElement(`.${this.containerClassName}`),f=f.firstElementChild):r=f.classList.contains(this.containerClassName)?f:f.querySelector(`.${this.containerClassName}`),!r)throw Error(`Can not find the element with class '${this.containerClassName}'.`);if(this._innerComponent=new ws,r.appendChild(this._innerComponent),!R(this,Je,"m",bt).call(this)){const C=document.createElement("video");C.style.position="absolute",C.style.left="0",C.style.top="0",C.style.width="100%",C.style.height="100%",C.style.objectFit=this.getVideoFit(),C.setAttribute("autoplay","true"),C.setAttribute("playsinline","true"),C.setAttribute("muted","true"),["iPhone","iPad","Mac"].includes(gt.OS)&&C.setAttribute("poster","data:image/gif;base64,R0lGODlhAQABAIEAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAgEAAEEBAA7"),Te(this,ut,C,"f");const T=document.createElement("div");T.append(C),T.style.overflow="hidden",this._videoContainer=T,this._innerComponent.setElement("content",T)}if(f instanceof zi?(this._selRsl=f.getElement(".dce-sel-resolution"),this._selMinLtr=f.getElement(".dlr-sel-minletter"),this._divScanArea=f.getElement(".dce-scanarea"),this._divScanLight=f.getElement(".dce-scanlight"),this._bgLoading=f.getElement(".dce-bg-loading"),this._bgCamera=f.getElement(".dce-bg-camera"),this._selCam=f.getElement(".dce-sel-camera"),this._optGotRsl=f.getElement(".dce-opt-gotResolution"),this._btnClose=f.getElement(".dce-btn-close"),this._optGotMinLtr=f.getElement(".dlr-opt-gotMinLtr")):(this._selRsl=f.querySelector(".dce-sel-resolution"),this._selMinLtr=f.querySelector(".dlr-sel-minletter"),this._divScanArea=f.querySelector(".dce-scanarea"),this._divScanLight=f.querySelector(".dce-scanlight"),this._bgLoading=f.querySelector(".dce-bg-loading"),this._bgCamera=f.querySelector(".dce-bg-camera"),this._selCam=f.querySelector(".dce-sel-camera"),this._optGotRsl=f.querySelector(".dce-opt-gotResolution"),this._btnClose=f.querySelector(".dce-btn-close"),this._optGotMinLtr=f.querySelector(".dlr-opt-gotMinLtr")),this._selRsl&&(this._hideDefaultSelection||R(this,Je,"m",bt).call(this)||this._selRsl.options.length||(this._selRsl.innerHTML=['<option class="dce-opt-gotResolution" value="got"></option>','<option data-width="1920" data-height="1080">ask 1920x1080</option>','<option data-width="1280" data-height="720">ask 1280x720</option>','<option data-width="640" data-height="480">ask 640x480</option>'].join(""),this._optGotRsl=this._selRsl.options[0])),this._selMinLtr&&(this._hideDefaultSelection||R(this,Je,"m",bt).call(this)||this._selMinLtr.options.length||(this._selMinLtr.innerHTML=['<option class="dlr-opt-gotMinLtr" value="got"></option>','<option value="0" selected>any letter</option>','<option value="3">3+ letters</option>','<option value="5">5+ letters</option>','<option value="8">8+ letters</option>','<option value="12">12+ letters</option>','<option value="17">17+ letters</option>','<option value="30">30+ letters</option>','<option value="50">50+ letters</option>','<option value="80">80+ letters</option>','<option value="120">120+ letters</option>'].join(""),this._optGotMinLtr=this._selMinLtr.options[0])),this.isScanLaserVisible()||R(this,Je,"m",Dn).call(this),R(this,Je,"m",bt).call(this)&&(this._innerComponent&&(this._innerComponent.addEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="block")),R(this,Je,"m",bt).call(this)||this._hideDefaultSelection?(this._selCam&&(this._selCam.style.display="none"),this._selRsl&&(this._selRsl.style.display="none"),this._selMinLtr&&(this._selMinLtr.style.display="none")):(this._selCam&&(this._selCam.style.display="block"),this._selRsl&&(this._selRsl.style.display="block"),this._selMinLtr&&(this._selMinLtr.style.display="block"),this._stopLoading()),window.ResizeObserver){this._resizeObserver||(this._resizeObserver=new ResizeObserver(T=>{var S;lt._onLog&&lt._onLog("resize observer triggered.");for(let O of T)O.target===(null===(S=this._innerComponent)||void 0===S?void 0:S.getWrapper())&&this._videoResizeListener()}));const C=null===(t=this._innerComponent)||void 0===t?void 0:t.getWrapper();C&&this._resizeObserver.observe(C)}R(this,Ei,"f").width=document.documentElement.clientWidth,R(this,Ei,"f").height=document.documentElement.clientHeight,window.addEventListener("resize",this._windowResizeListener)}_unbindUI(){var t,r,f,C;R(this,Je,"m",bt).call(this)?(this._innerComponent&&(this._innerComponent.removeEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none")):this._stopLoading(),R(this,Je,"m",Dn).call(this),null===(t=this._drawingLayerManager)||void 0===t||t.clearDrawingLayers(),null===(r=this._innerComponent)||void 0===r||r.removeElement("drawing-layer"),this._layerBaseCvs=null,this._drawingLayerOfMask=null,this._drawingLayerOfTip=null,null===(f=this._innerComponent)||void 0===f||f.remove(),this._innerComponent=null,Te(this,ut,null,"f"),null===(C=this._videoContainer)||void 0===C||C.remove(),this._videoContainer=null,this._selCam=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,this._divScanArea=null,this._divScanLight=null,this._singleFrameInputContainer&&(this._singleFrameInputContainer.remove(),this._singleFrameInputContainer=null),window.ResizeObserver&&this._resizeObserver&&this._resizeObserver.disconnect(),window.removeEventListener("resize",this._windowResizeListener)}_startLoading(){this._bgLoading&&(this._bgLoading.style.display="",this._bgLoading.style.animationPlayState="")}_stopLoading(){this._bgLoading&&(this._bgLoading.style.display="none",this._bgLoading.style.animationPlayState="paused")}_renderCamerasInfo(t,r){if(!this._selCam)return;let f;this._selCam.textContent="";for(let C of r){const T=document.createElement("option");T.value=C.deviceId,T.innerText=C.label,this._selCam.append(T),C.deviceId&&t&&t.deviceId==C.deviceId&&(f=T)}this._selCam.value=f?f.value:""}_renderResolutionInfo(t){this._optGotRsl&&(this._optGotRsl.setAttribute("data-width",t.width),this._optGotRsl.setAttribute("data-height",t.height),this._optGotRsl.innerText="got "+t.width+"x"+t.height,this._selRsl&&this._optGotRsl.parentNode==this._selRsl&&(this._selRsl.value="got"))}getVideoElement(){return R(this,ut,"f")}isVideoLoaded(){return!!R(this,ut,"f")&&4==R(this,ut,"f").readyState}setVideoFit(t){if(t=t.toLowerCase(),!["contain","cover"].includes(t))throw new Error(`Unsupported value '${t}'.`);if(this.videoFit=t,!R(this,ut,"f")||(R(this,ut,"f").style.objectFit=t,R(this,Je,"m",bt).call(this)))return;let r;this._updateVideoContainer();try{r=this.getContentDimensions()}catch(f){if("Invalid content dimensions."===(f.message||f))return;throw f}R(this,Je,"m",vr).call(this,r,this.getConvertedRegion()),this.updateDrawingLayers(r)}getVideoFit(){return this.videoFit}getContentDimensions(){var t,r,f,C;let T,S,O;if(R(this,Je,"m",bt).call(this)?(T=null===(f=this._cvsSingleFrameMode)||void 0===f?void 0:f.width,S=null===(C=this._cvsSingleFrameMode)||void 0===C?void 0:C.height,O="contain"):(T=null===(t=R(this,ut,"f"))||void 0===t?void 0:t.videoWidth,S=null===(r=R(this,ut,"f"))||void 0===r?void 0:r.videoHeight,O=this.getVideoFit()),!T||!S)throw new Error("Invalid content dimensions.");return{width:T,height:S,objectFit:O}}updateConvertedRegion(t){const r=cr.convert(this.scanRegion,t.width,t.height);Te(this,gr,r,"f"),R(this,An,"f")&&clearTimeout(R(this,An,"f")),Te(this,An,setTimeout(()=>{let f;try{f=this.getContentDimensions()}catch(C){if("Invalid content dimensions."===(C.message||C))return;throw C}R(this,Je,"m",_r).call(this,f,r),R(this,Je,"m",vr).call(this,f,r)},0),"f")}getConvertedRegion(){return R(this,gr,"f")}setScanRegion(t){if(null!=t&&!us(t)&&!Kt(t))throw TypeError("Invalid 'region'.");let r;this.scanRegion=t?JSON.parse(JSON.stringify(t)):null;try{r=this.getContentDimensions()}catch(f){if("Invalid content dimensions."===(f.message||f))return;throw f}this.updateConvertedRegion(r)}getScanRegion(){return JSON.parse(JSON.stringify(this.scanRegion))}getVisibleRegionOfVideo(t){if(!this.isVideoLoaded())throw new Error("The video is not loaded.");const r=R(this,ut,"f").videoWidth,f=R(this,ut,"f").videoHeight,C=this.getVideoFit(),{width:T,height:S}=this._innerComponent.getBoundingClientRect();if(T<=0||S<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");let O;const x={x:0,y:0,width:r,height:f,isMeasuredInPercentage:!1};if("cover"===C&&(T/S<r/f?(O=S/f,x.x=Math.floor((r-T/O)/2),x.y=0,x.width=Math.ceil(T/O),x.height=f):(O=T/r,x.x=0,x.y=Math.floor((f-S/O)/2),x.width=r,x.height=Math.ceil(S/O))),t?.inPixels)return x;const L=x;return L.x=Math.ceil(L.x/f*100),L.y=Math.ceil(L.y/r*100),L.width=Math.floor(L.width/r*100),L.height=Math.floor(L.height/f*100),L.isMeasuredInPercentage=!0,x}setScanRegionMask(t,r,f,C){this._drawingLayerOfMask||(this._drawingLayerOfMask=this._createDrawingLayer(-2),this.isScanRegionMaskVisible()||R(this,Je,"m",Cs).call(this)),this.clearScanRegionMask(),this._maskBackRectStyleId||(this._maskBackRectStyleId=de.createDrawingStyle({paintMode:"fill",fillStyle:this.regionMaskFillStyle,lineWidth:0})),this._maskCenterRectStyleId||(this._maskCenterRectStyleId=de.createDrawingStyle({paintMode:"stroke",strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth}));const T=this._drawingLayerOfMask.width,S=this._drawingLayerOfMask.height,O=new Wi({x:0,y:0,width:T,height:S},this._maskBackRectStyleId),x=new Wi({x:-T/2,y:-S/2+r,width:t,height:C}),L=new Wi({x:-T/2+t+f,y:-S/2+r,width:T-t-f<0?0:T-t-f,height:C}),P=new Wi({x:-T/2,y:-S/2,width:T,height:r}),N=new Wi({x:-T/2,y:-S/2+r+C,width:T,height:S-r-C<0?0:S-r-C});x.set("strokeWidth",0),L.set("strokeWidth",0),P.set("strokeWidth",0),N.set("strokeWidth",0);const k=new Ma([x,L,P,N])._getFabricObject();O.set("clipPath",k);const W=new Wi({x:t,y:r,width:f,height:C},this._maskCenterRectStyleId);this._drawingLayerOfMask.addDrawingItems([O,W])}clearScanRegionMask(){this._drawingLayerOfMask&&this._drawingLayerOfMask.clearDrawingItems()}deleteScanRegionMask(){this._drawingLayerOfMask&&this.deleteDrawingLayer(this._drawingLayerOfMask.getId())}_setScanRegionMaskVisible(t){Te(this,mr,t,"f"),t?R(this,Je,"m",Xo).call(this):R(this,Je,"m",Cs).call(this)}setScanRegionMaskVisible(t){this._setScanRegionMaskVisible(t),this._userSetMaskVisible=t}isScanRegionMaskVisible(){return R(this,mr,"f")}setScanRegionMaskStyle(t){if(!t)return;let r;t.fillStyle&&(this.regionMaskFillStyle=t.fillStyle),t.strokeStyle&&(this.regionMaskStrokeStyle=t.strokeStyle),t.lineWidth&&(this.regionMaskLineWidth=t.lineWidth),this._maskBackRectStyleId&&de.updateDrawingStyle(this._maskBackRectStyleId,{fillStyle:this.regionMaskFillStyle}),this._maskCenterRectStyleId&&de.updateDrawingStyle(this._maskCenterRectStyleId,{strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth});try{r=this.getContentDimensions()}catch(f){if("Invalid content dimensions."===(f.message||f))return;throw f}R(this,Je,"m",_r).call(this,r,this.getConvertedRegion())}getScanRegionMaskStyle(){return{fillStyle:this.regionMaskFillStyle,strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth}}_setScanLaserVisible(t){Te(this,pr,t,"f"),t?R(this,Je,"m",Es).call(this):R(this,Je,"m",Dn).call(this)}setScanLaserVisible(t){this._setScanLaserVisible(t),this._userSetLaserVisible=t}isScanLaserVisible(){return R(this,pr,"f")}_updateVideoContainer(){if(!R(this,ut,"f")||R(this,Je,"m",bt).call(this))return;let t=1;const r=R(this,ut,"f").style.transform.match(/scale\((.+)\)/);r&&(t=parseFloat(r[1]));const f=this._videoContainer;if("contain"===this.videoFit&&t>1){const C=R(this,ut,"f").videoWidth,T=R(this,ut,"f").videoHeight,{width:S,height:O}=this._innerComponent.getBoundingClientRect(),x=C/T;if(S/O<x){let L=S/x;f.style.left="0",f.style.top=(O-L)/2/O*100+"%",f.style.width="100%",f.style.height=L/O*100+"%"}else{let L=O*x;f.style.left=(S-L)/2/S*100+"%",f.style.top="0",f.style.width=L/S*100+"%",f.style.height="100%"}}else f.style.left="0",f.style.top="0",f.style.width="100%",f.style.height="100%"}updateLayers(){let t;this._updateVideoContainer();try{t=this.getContentDimensions()}catch(f){if("Invalid content dimensions."===(f.message||f))return;throw f}const r=this.getConvertedRegion();R(this,Je,"m",vr).call(this,t,r),this.updateDrawingLayers(t),R(this,Je,"m",_r).call(this,t,r)}clearAllInnerDrawingItems(){R(this,Rn,"f").forEach(t=>t.remove()),R(this,Rn,"f").length=0}dispose(){this._unbindUI(),delete window._dce_default_template,this.__proto__=null;for(let t in this)delete this[t];Object.defineProperty(this,"disposed",{value:!0})}}function U(p,t,r,f){if("a"===r&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?p!==t||!f:!t.has(p))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?f:"a"===r?f.call(p):f?f.value:t.get(p)}function Ve(p,t,r,f,C){if("m"===f)throw new TypeError("Private method is not writable");if("a"===f&&!C)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?p!==t||!C:!t.has(p))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===f?C.call(p,r):C?C.value=r:t.set(p,r),r}In=new WeakMap,xn=new WeakMap,An=new WeakMap,ut=new WeakMap,gr=new WeakMap,mr=new WeakMap,pr=new WeakMap,Ei=new WeakMap,On=new WeakMap,Rn=new WeakMap,ys=new WeakMap,Je=new WeakSet,bt=function(){return"disabled"!==this._singleFrameMode},_r=function(p,t){!t||0===t.x&&0===t.y&&t.width===p.width&&t.height===p.height?this.clearScanRegionMask():this.setScanRegionMask(t.x,t.y,t.width,t.height)},Xo=function(){this._drawingLayerOfMask&&this._drawingLayerOfMask.setVisible(!0)},Cs=function(){this._drawingLayerOfMask&&this._drawingLayerOfMask.setVisible(!1)},Es=function(){this._divScanLight&&"none"==this._divScanLight.style.display&&(this._divScanLight.style.display="block")},Dn=function(){this._divScanLight&&(this._divScanLight.style.display="none")},vr=function(p,t){if(!this._divScanArea||!this._innerComponent.getElement("content"))return;const{width:r,height:f,objectFit:C}=p;t||(t={x:0,y:0,width:r,height:f});const{width:T,height:S}=this._innerComponent.getBoundingClientRect();if(T<=0||S<=0)return;const O=T/S,x=r/f;let L,P,N,k,W=1;if("contain"===C)O<x?(W=T/r,L=0,P=(S-f*W)/2):(W=S/f,L=(T-r*W)/2,P=0),L+=t.x*W,P+=t.y*W,N=t.width*W,k=t.height*W;else if("cover"===C)if(O<x){W=S/f,L=t.x*W-(r*W-T)/2,L=Math.max(L,0),L=Math.min(L,T),P=t.y*W;let H=(t.x+t.width)*W-(r*W-T)/2;H=Math.max(H,0),H=Math.min(H,T),N=H-L,k=t.height*W}else{W=T/r,L=t.x*W,P=t.y*W-(f*W-S)/2,P=Math.max(P,0),P=Math.min(P,S);let H=(t.y+t.height)*W-(f*W-S)/2;H=Math.max(H,0),H=Math.min(H,S),N=t.width*W,k=H-P}else L=0,P=0,N=0,k=0;this._divScanArea.style.left=L+"px",this._divScanArea.style.top=P+"px",this._divScanArea.style.width=N+"px",this._divScanArea.style.height=k+"px"},lt.uiComponentName="default-camera-view",lt._defaultUIElementURL="@engineResourcePath/dce.ui.html","function"==typeof SuppressedError&&SuppressedError;const zo=typeof self>"u";let Ln,Qt,yr,Ts,ht;function _t(p,t,r,f){if("a"===r&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?p!==t||!f:!t.has(p))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?f:"a"===r?f.call(p):f?f.value:t.get(p)}function Ut(p,t,r,f,C){if("m"===f)throw new TypeError("Private method is not writable");if("a"===f&&!C)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?p!==t||!C:!t.has(p))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===f?C.call(p,r):C?C.value=r:t.set(p,r),r}typeof navigator<"u"&&(Ln=navigator,Qt=Ln.userAgent,yr=Ln.platform,Ts=Ln.mediaDevices),function(){if(!zo){const p={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Ln.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},t={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:yr,search:"Win"},Mac:{str:yr},Linux:{str:yr}};let r="unknownBrowser",f=0,C="unknownOS";for(let T in p){const S=p[T]||{};let L=S.verStr||Qt,P=S.verSearch||T;if(P instanceof Array||(P=[P]),-1!=(S.str||Qt).indexOf(S.search||T)){r=T;for(let N of P){let k=L.indexOf(N);if(-1!=k){f=parseFloat(L.substring(k+N.length+1));break}}break}}for(let T in t){const S=t[T]||{};if(-1!=(S.str||Qt).indexOf(S.search||T)){C=T;break}}"Linux"==C&&-1!=Qt.indexOf("Windows NT")&&(C="HarmonyOS"),ht={browser:r,version:f,OS:C}}zo&&(ht={browser:"ssr",version:0,OS:"ssr"})}(),typeof WebAssembly<"u"&&Qt&&(!/Safari/.test(Qt)||/Chrome/.test(Qt)||/\(.+\s11_2_([2-6]).*\)/.test(Qt)),"function"==typeof SuppressedError&&SuppressedError;class St{static multiply(t,r){const f=[];for(let C=0;C<3;C++){const T=r.slice(3*C,3*C+3);for(let S=0;S<3;S++){const O=[t[S],t[S+3],t[S+6]].reduce((x,L,P)=>x+L*T[P],0);f.push(O)}}return f}static identity(){return[1,0,0,0,1,0,0,0,1]}static translate(t,r,f){return St.multiply(t,[1,0,0,0,1,0,r,f,1])}static rotate(t,r){var f=Math.cos(r),C=Math.sin(r);return St.multiply(t,[f,-C,0,C,f,0,0,0,1])}static scale(t,r,f){return St.multiply(t,[r,0,0,0,f,0,0,0,1])}}var We,$t,ei,Cr,Zi,Mn,Fn,qi,Er,Ri,wr,bs,Se,ke,Ye,Tr,br,Qe,Mt,ti,Ki,Sr,Ht,ii,It,Ji,Qi,Pn,Ir,$i,Di,ni,ri,Ss,dt,Is,Li,en,xr,Ar,Zo,jt,xs,As,tn,kn,Or,xt,nn,Os,Rs,qo;!function(p){p.GREY="grey",p.GREY32="grey32",p.RGBA="rgba",p.RBGA="rbga",p.GRBA="grba",p.GBRA="gbra",p.BRGA="brga",p.BGRA="bgra"}(We||(We={}));class Fe{static get version(){return"1.1.0"}static checkWebGLSupport(){return null===document.createElement("canvas").getContext("webgl")?(Ut(Fe,$t,!1,"f",ei),!1):(Ut(Fe,$t,!0,"f",ei),!0)}get disposed(){return _t(this,Er,"f")}constructor(){Cr.set(this,We.RGBA),Zi.set(this,null),Mn.set(this,null),Fn.set(this,null),this.useWebGLByDefault=!0,this._reusedCvs=null,this._reusedWebGLCvs=null,qi.set(this,null),Er.set(this,!1)}drawImage(t,r,f,C,T,S){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!f||!C)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==_t(Fe,$t,"f",ei)&&Fe.checkWebGLSupport(),S?.bUseWebGL&&!_t(Fe,$t,"f",ei))throw new Error("Your browser or machine may not support WebGL.");if(r instanceof HTMLVideoElement&&4!==r.readyState||r instanceof HTMLImageElement&&!r.complete)throw new Error("The source is not loaded.");let O;Fe._onLog&&(O=Date.now(),Fe._onLog("drawImage(), START: "+O));let x=0,L=0,P=f,N=C,k=0,W=0,H=f,Z=C;T&&(T.sx&&(x=Math.round(T.sx)),T.sy&&(L=Math.round(T.sy)),T.sWidth&&(P=Math.round(T.sWidth)),T.sHeight&&(N=Math.round(T.sHeight)),T.dx&&(k=Math.round(T.dx)),T.dy&&(W=Math.round(T.dy)),T.dWidth&&(H=Math.round(T.dWidth)),T.dHeight&&(Z=Math.round(T.dHeight)));let X,q=We.RGBA;if(S?.pixelFormat&&(q=S.pixelFormat),S?.bufferContainer&&(X=S.bufferContainer,X.length<4*H*Z))throw new Error("Unexpected size of the 'bufferContainer'.");const ie=t;if(!_t(Fe,$t,"f",ei)||!(this.useWebGLByDefault&&null==S?.bUseWebGL||S?.bUseWebGL)){Fe._onLog&&Fe._onLog("drawImage() in context2d."),ie.ctx2d||(ie.ctx2d=ie.getContext("2d",{willReadFrequently:!0}));const J=ie.ctx2d;if(!J)throw new Error("Unable to get 'CanvasRenderingContext2D' from canvas.");return(ie.width<k+H||ie.height<W+Z)&&(ie.width=k+H,ie.height=W+Z),J.drawImage(r,x,L,P,N,k,W,H,Z),Fe._onLog&&Fe._onLog("drawImage() in context2d end. Costs: "+(Date.now()-O)),{context:J,pixelFormat:We.RGBA,bUseWebGL:!1}}Fe._onLog&&Fe._onLog("drawImage() in WebGL.");try{(ie.width<k+H||ie.height<W+Z)&&(ie.width=k+H,ie.height=W+Z,ie.ctxWebGL&&ie.ctxWebGL.viewport(0,0,k+H,W+Z));const J=ie.ctxWebGL||ie.getContext("webgl",{antialias:!1})||ie.getContext("experimental-webgl",{antialias:!1});if(!J){Fe._onLog&&Fe._onLog("Browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");const b=new Error("Unable to get 'WebGLRenderingContext'. Your browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");throw b.name="WebGLError",b}if(!ie.ctxWebGL||q!==_t(this,Cr,"f")){ie.ctxWebGL=J;const b=i=>{const o=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,o),i.bufferData(i.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),i.STATIC_DRAW);const d=i.createBuffer();return i.bindBuffer(i.ARRAY_BUFFER,d),i.bufferData(i.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),i.STATIC_DRAW),{positions:o,texCoords:d}},me=i=>{const o=i.createTexture();return i.bindTexture(i.TEXTURE_2D,o),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),o},Re=(i,o)=>{const d=i.createProgram();if(o.forEach(y=>i.attachShader(d,y)),i.linkProgram(d),!i.getProgramParameter(d,i.LINK_STATUS)){const y=new Error(`An error occured linking the program: ${i.getProgramInfoLog(d)}.`);throw y.name="WebGLError",y}return i.useProgram(d),d},je=(i,o,d)=>{const y=i.createShader(o);if(i.shaderSource(y,d),i.compileShader(y),!i.getShaderParameter(y,i.COMPILE_STATUS)){const _=new Error(`An error occured compiling the shader: ${i.getShaderInfoLog(y)}.`);throw _.name="WebGLError",_}return y},u="\n                  attribute vec2 a_position;\n                  attribute vec2 a_texCoord;\n  \n                  uniform mat3 u_matrix;\n                  uniform mat3 u_textureMatrix;\n  \n                  varying vec2 v_texCoord;\n                  void main(void) {\n                  gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1.0);\n                  v_texCoord = vec4((u_textureMatrix * vec3(a_texCoord, 1)).xy, 0, 1.0).xy;\n                  }\n              ";let a="rgb";["rgba","rbga","grba","gbra","brga","bgra"].includes(q)&&(a=q.slice(0,3));const l=`\n                  precision mediump float;\n                  varying vec2 v_texCoord;\n                  uniform sampler2D u_image;\n                  uniform float uColorFactor;\n  \n                  void main() {\n                      vec4 sample = texture2D(u_image, v_texCoord);\n                      float grey = 0.21 * sample.r + 0.71 * sample.g + 0.07 * sample.b;\n                      gl_FragColor = vec4(sample.${a} * (1.0 - uColorFactor) + (grey * uColorFactor), sample.a);\n                  }\n              `,m=Re(J,[je(J,J.VERTEX_SHADER,u),je(J,J.FRAGMENT_SHADER,l)]);Ut(this,Mn,{program:m,attribLocations:{vertexPosition:J.getAttribLocation(m,"a_position"),texPosition:J.getAttribLocation(m,"a_texCoord")},uniformLocations:{uSampler:J.getUniformLocation(m,"u_image"),uColorFactor:J.getUniformLocation(m,"uColorFactor"),uMatrix:J.getUniformLocation(m,"u_matrix"),uTextureMatrix:J.getUniformLocation(m,"u_textureMatrix")}},"f"),Ut(this,Fn,b(J),"f"),Ut(this,Zi,me(J),"f"),Ut(this,Cr,q,"f")}const Ee=(b,me,Re)=>{b.bindBuffer(b.ARRAY_BUFFER,me),b.enableVertexAttribArray(Re),b.vertexAttribPointer(Re,2,b.FLOAT,!1,0,0)},xe=(b,me,Re,je)=>{b.clearColor(0,0,0,1),b.clearDepth(1),b.enable(b.DEPTH_TEST),b.depthFunc(b.LEQUAL),b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT),Ee(b,Re.positions,me.attribLocations.vertexPosition),Ee(b,Re.texCoords,me.attribLocations.texPosition),b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,je),b.uniform1i(me.uniformLocations.uSampler,0),b.uniform1f(me.uniformLocations.uColorFactor,[We.GREY,We.GREY32].includes(q)?1:0);let u,a,l=St.translate(St.identity(),-1,-1);l=St.scale(l,2,2),l=St.scale(l,1/b.canvas.width,1/b.canvas.height),u=St.translate(l,k,W),u=St.scale(u,H,Z),b.uniformMatrix3fv(me.uniformLocations.uMatrix,!1,u),a=St.translate(St.identity(),x/f,L/C),a=St.scale(a,P/f,N/C),b.uniformMatrix3fv(me.uniformLocations.uTextureMatrix,!1,a),b.drawArrays(b.TRIANGLES,0,6)};((b,me,Re)=>{const je=b.RGBA,u=b.RGBA,a=b.UNSIGNED_BYTE;b.bindTexture(b.TEXTURE_2D,me),b.texImage2D(b.TEXTURE_2D,0,je,u,a,Re)})(J,_t(this,Zi,"f"),r),xe(J,_t(this,Mn,"f"),_t(this,Fn,"f"),_t(this,Zi,"f"));const Ie=X||new Uint8Array(4*H*Z);if(J.readPixels(k,W,H,Z,J.RGBA,J.UNSIGNED_BYTE,Ie),255!==Ie[3]){Fe._onLog&&Fe._onLog("Incorrect WebGL drawing .");const b=new Error("WebGL error: incorrect drawing.");throw b.name="WebGLError",b}return Fe._onLog&&Fe._onLog("drawImage() in WebGL end. Costs: "+(Date.now()-O)),{context:J,pixelFormat:q===We.GREY?We.GREY32:q,bUseWebGL:!0}}catch(J){if(this.forceLoseContext(),null==S?.bUseWebGL)return Fe._onLog&&Fe._onLog("'drawImage()' in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.drawImage(t,r,f,C,T,Object.assign({},S,{bUseWebGL:!1}));throw J.name="WebGLError",J}}readCvsData(t,r,f){if(!(t instanceof CanvasRenderingContext2D||t instanceof WebGLRenderingContext))throw new Error("Invalid 'context'.");let C,T=0,S=0,O=t.canvas.width,x=t.canvas.height;if(r&&(r.x&&(T=r.x),r.y&&(S=r.y),r.width&&(O=r.width),r.height&&(x=r.height)),f?.length<4*O*x)throw new Error("Unexpected size of the 'bufferContainer'.");if(t instanceof WebGLRenderingContext){const L=t;f?(L.readPixels(T,S,O,x,L.RGBA,L.UNSIGNED_BYTE,f),C=new Uint8Array(f.buffer,0,4*O*x)):(C=new Uint8Array(4*O*x),L.readPixels(T,S,O,x,L.RGBA,L.UNSIGNED_BYTE,C))}else if(t instanceof CanvasRenderingContext2D){let L;L=t.getImageData(T,S,O,x),C=new Uint8Array(L.data.buffer),f?.set(C)}return C}transformPixelFormat(t,r,f,C){let T,S;if(Fe._onLog&&(T=Date.now(),Fe._onLog("transformPixelFormat(), START: "+T)),r===f)return Fe._onLog&&Fe._onLog("transformPixelFormat() end. Costs: "+(Date.now()-T)),C?new Uint8Array(t):t;const O=[We.RGBA,We.RBGA,We.GRBA,We.GBRA,We.BRGA,We.BGRA];if(O.includes(r))if(f===We.GREY){S=new Uint8Array(t.length/4);for(let x=0;x<t.length;x+=4)S[x/4]=.21*t[x]+.71*t[x+1]+.07*t[x+2]}else if(f===We.GREY32){S=C?new Uint8Array(t):t;for(let x=0;x<t.length;x+=4){const L=.21*t[x]+.71*t[x+1]+.07*t[x+2];S[x]=L,S[x+1]=L,S[x+2]=L}}else{if(!O.includes(f))throw new Error("Unable to transform.");if(C){S=new Uint8Array(t);const x=r.indexOf("r"),L=r.indexOf("g"),P=r.indexOf("b"),N=f.indexOf("r"),k=f.indexOf("g"),W=f.indexOf("b");for(let H=0;H<t.length;H+=4)S[H+N]=t[H+x],S[H+k]=t[H+L],S[H+W]=t[H+P]}else{S=t;const x=r.indexOf("r"),L=r.indexOf("g"),P=r.indexOf("b"),N=f.indexOf("r"),k=f.indexOf("g"),W=f.indexOf("b");for(let H=0;H<t.length;H+=4){let Z=[t[H],t[H+1],t[H+2]];S[H+N]=Z[x],S[H+k]=Z[L],S[H+W]=Z[P]}}}else if(r===We.GREY){if(f!==We.GREY32)throw new Error("Unable to transform.");S=new Uint8Array(4*t.length);for(let x=0;x<t.length;x++)S[4*x]=t[x],S[4*x+1]=t[x],S[4*x+2]=t[x],S[4*x+3]=255}else{if(r!==We.GREY32)throw new Error("Unable to transform.");if(f!==We.GREY)throw new Error("Unable to transform.");S=new Uint8Array(t.length/4);for(let x=0;x<t.length;x+=4)S[x/4]=t[x]}return Fe._onLog&&Fe._onLog("transformPixelFormat() end. Costs: "+(Date.now()-T)),S}getImageData(t,r,f,C,T){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!r||!f)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==_t(Fe,$t,"f",ei)&&Fe.checkWebGLSupport(),T?.bUseWebGL&&!_t(Fe,$t,"f",ei))throw new Error("Your browser or machine may not support WebGL.");if(C.sx>r||C.sy>f||C.sx+C.sWidth>r||C.sy+C.sHeight>f)throw new Error("Invalid position.");if(t instanceof HTMLVideoElement&&4!==t.readyState||t instanceof HTMLImageElement&&!t.complete)throw new Error("The source is not loaded.");let S;Fe._onLog&&(S=Date.now(),Fe._onLog("getImageData(), START: "+S));const O=Math.round(C.sx),x=Math.round(C.sy),L=Math.round(C.sWidth),P=Math.round(C.sHeight),N=Math.round(C.dWidth),k=Math.round(C.dHeight);let W=We.RGBA;T?.pixelFormat&&(W=T.pixelFormat);let H,Z,X,q=null;if(T?.bufferContainer&&(q=T.bufferContainer),_t(Fe,$t,"f",ei)&&(this.useWebGLByDefault&&null==T?.bUseWebGL||T?.bUseWebGL)){Fe._onLog&&Fe._onLog("getImageData() in WebGL."),this._reusedWebGLCvs||(this._reusedWebGLCvs=document.createElement("canvas")),H=this._reusedWebGLCvs;try{if(q)if(W===We.GREY){if(X=new Uint8Array(4*N*k),Z=this.drawImage(H,t,r,f,{sx:O,sy:x,sWidth:L,sHeight:P,dWidth:N,dHeight:k},{pixelFormat:W,bUseWebGL:!0,bufferContainer:X}),X=this.transformPixelFormat(X,Z.pixelFormat,W),q){if(q.length<X.length)throw new Error("Unexpected size of the 'bufferContainer'.");q.set(X)}}else Z=this.drawImage(H,t,r,f,{sx:O,sy:x,sWidth:L,sHeight:P,dWidth:N,dHeight:k},{pixelFormat:W,bUseWebGL:!0,bufferContainer:q}),X=new Uint8Array(q.buffer,0,4*N*k),X=this.transformPixelFormat(X,Z.pixelFormat,W);else W===We.GREY?((!_t(this,qi,"f")||_t(this,qi,"f").length<4*N*k)&&Ut(this,qi,new Uint8Array(4*N*k),"f"),X=new Uint8Array(_t(this,qi,"f").buffer,0,4*N*k)):X=new Uint8Array(4*N*k),Z=this.drawImage(H,t,r,f,{sx:O,sy:x,sWidth:L,sHeight:P,dWidth:N,dHeight:k},{pixelFormat:W,bUseWebGL:!0,bufferContainer:X}),X=this.transformPixelFormat(X,Z.pixelFormat,W)}catch(ie){if("WebGLError"===ie.name&&(this.forceLoseContext(),null==T?.bUseWebGL))return Fe._onLog&&Fe._onLog("getImageData() in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.getImageData(t,r,f,{sx:O,sy:x,sWidth:L,sHeight:P,dWidth:N,dHeight:k},Object.assign({},T,{bUseWebGL:!1}));throw ie}}else if(Fe._onLog&&Fe._onLog("getImageData() in context2d."),this._reusedCvs||(this._reusedCvs=document.createElement("canvas")),H=this._reusedCvs,Z=this.drawImage(H,t,r,f,{sx:O,sy:x,sWidth:L,sHeight:P,dWidth:N,dHeight:k},{pixelFormat:We.RGBA,bUseWebGL:!1}),X=this.readCvsData(Z.context,{width:N,height:k},null),X=this.transformPixelFormat(X,Z.pixelFormat,W),q){if(q.length<X.length)throw new Error("Unexpected size of the 'bufferContainer'.");q.set(X)}return Fe._onLog&&Fe._onLog("getImageData() end. Costs: "+(Date.now()-S)),{data:X,pixelFormat:W,width:N,height:k,bUseWebGL:Z.bUseWebGL}}convertDataToCvs(t,r,f,C){if(!(t instanceof Uint8Array||t instanceof Uint8ClampedArray))throw new TypeError("Invalid 'data'.");if("number"!=typeof r||r<=0)throw new Error("Invalid 'width'.");if("number"!=typeof f||f<=0)throw new Error("Invalid 'height'.");const T=document.createElement("canvas");let S;if(T.width=r,T.height=f,C===We.GREY){S=new Uint8ClampedArray(4*r*f);for(let x=0;x<S.length;x+=4)S[x]=t[x/4],S[x+1]=t[x/4],S[x+2]=t[x/4],S[x+3]=255}else S=new Uint8ClampedArray(t.buffer);const O=new ImageData(S,r,f);return T.getContext("2d").putImageData(O,0,0),T}forceLoseContext(){if(!this._reusedWebGLCvs)return;const t=this._reusedWebGLCvs.ctxWebGL;t&&!t.isContextLost()&&t.getExtension("WEBGL_lose_context")&&t.getExtension("WEBGL_lose_context").loseContext(),Ut(this,Zi,null,"f"),Ut(this,Mn,null,"f"),Ut(this,Fn,null,"f"),this._reusedWebGLCvs=null}dispose(){this.forceLoseContext(),Ut(this,Er,!0,"f")}}$t=Fe,Cr=new WeakMap,Zi=new WeakMap,Mn=new WeakMap,Fn=new WeakMap,qi=new WeakMap,Er=new WeakMap,ei={value:void 0};class Na{constructor(){Ri.set(this,new Map),wr.set(this,!1)}get disposed(){return U(this,wr,"f")}on(t,r){t=t.toLowerCase();const f=U(this,Ri,"f").get(t);if(f){if(f.includes(r))return;f.push(r)}else U(this,Ri,"f").set(t,[r])}off(t,r){t=t.toLowerCase();const f=U(this,Ri,"f").get(t);if(!f)return;const C=f.indexOf(r);-1!==C&&f.splice(C,1)}offAll(t){t=t.toLowerCase();const r=U(this,Ri,"f").get(t);r&&(r.length=0)}fire(t,r=[],f={async:!1,copy:!0}){var C=this;return te(function*(){r||(r=[]),t=t.toLowerCase();const T=U(C,Ri,"f").get(t);if(T&&T.length){f=Object.assign({async:!1,copy:!0},f);for(let S of T){if(!S)continue;let O=[];if(f.copy)for(let L of r){try{L=JSON.parse(JSON.stringify(L))}catch{}O.push(L)}else O=r;let x=!1;if(f.async)setTimeout(()=>{C.disposed||S.apply(f.target,O)},0);else try{x=yield S.apply(f.target,O)}catch{}if(!0===x)break}}})()}dispose(){Ve(this,wr,!0,"f")}}Ri=new WeakMap,wr=new WeakMap;const Et=(p,t,r,f)=>{if(!r)return p;let C=t+Math.round((p-t)/r)*r;return f&&(C=Math.min(C,f)),C};class Me{static get version(){return"2.0.2"}static isStorageAvailable(t){let r;try{r=window[t];const f="__storage_test__";return r.setItem(f,f),r.removeItem(f),!0}catch(f){return f instanceof DOMException&&(22===f.code||1014===f.code||"QuotaExceededError"===f.name||"NS_ERROR_DOM_QUOTA_REACHED"===f.name)&&r&&0!==r.length}}static findBestRearCameraInIOS(t,r){if(!t||!t.length)return null;let f=!1;if(r?.getMainCamera&&(f=!0),f){const C=["\ud6c4\uba74 \uce74\uba54\ub77c","\u80cc\u9762\u30ab\u30e1\u30e9","\u5f8c\u7f6e\u93e1\u982d","\u540e\u7f6e\u76f8\u673a","\u0e01\u0e25\u0e49\u0e2d\u0e07\u0e14\u0e49\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07","\u092c\u0948\u0915 \u0915\u0948\u092e\u0930\u093e","\u0627\u0644\u0643\u0627\u0645\u064a\u0631\u0627 \u0627\u0644\u062e\u0644\u0641\u064a\u0629","\u05de\u05e6\u05dc\u05de\u05d4 \u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u043a\u0430\u043c\u0435\u0440\u0430 \u043d\u0430 \u0437\u0430\u0434\u043d\u0435\u0439 \u043f\u0430\u043d\u0435\u043b\u0438","\u0437\u0430\u0434\u043d\u044f \u043a\u0430\u043c\u0435\u0440\u0430","\u0437\u0430\u0434\u043d\u0430 \u043a\u0430\u043c\u0435\u0440\u0430","\u0430\u0440\u0442\u049b\u044b \u043a\u0430\u043c\u0435\u0440\u0430","\u03c0\u03af\u03c3\u03c9 \u03ba\u03ac\u03bc\u03b5\u03c1\u03b1","zadn\xed fotoapar\xe1t","zadn\xe1 kamera","tylny aparat","takakamera","stra\u017enja kamera","r\xfcckkamera","kamera p\xe5 baksidan","kamera belakang","kamera bak","h\xe1ts\xf3 kamera","fotocamera (posteriore)","c\xe2mera traseira","c\xe2mara traseira","c\xe1mara trasera","c\xe0mera posterior","cam\xe9ra arri\xe8re","camer\u0103 spate","camera m\u1eb7t sau","camera aan achterzijde","bagsidekamera","back camera","arka kamera"],T=t.find(S=>C.includes(S.label.toLowerCase()));return T?.deviceId}{const C=["\ud6c4\uba74","\u80cc\u9762","\u5f8c\u7f6e","\u540e\u7f6e","\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07","\u092c\u0948\u0915","\u062e\u0644\u0641\u064a\u0629","\u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u0437\u0430\u0434\u043d\u044f\u044f","\u0437\u0430\u0434\u043d\u0435\u0439","\u0437\u0430\u0434\u043d\u0430","\u03c0\u03af\u03c3\u03c9","zadn\xed","zadn\xe1","tylny","trasera","traseira","taka","stra\u017enja","spate","sau","r\xfcck","posteriore","posterior","h\xe1ts\xf3","belakang","baksidan","bakre","bak","bagside","back","a\u0440\u0442\u049b\u044b","arri\xe8re","arka","achterzijde"],T=["\ud2b8\ub9ac\ud50c","\u4e09\u955c\u5934","\u4e09\u93e1\u982d","\u30c8\u30ea\u30d7\u30eb","\u0e2a\u0e32\u0e21","\u091f\u094d\u0930\u093f\u092a\u0932","\u062b\u0644\u0627\u062b\u064a\u0629","\u05de\u05e9\u05d5\u05dc\u05e9\u05ea","\u04af\u0448\u0442\u0456\u043a","\u0442\u0440\u043e\u0439\u043d\u0430\u044f","\u0442\u0440\u043e\u0439\u043d\u0430","\u043f\u043e\u0442\u0440\u043e\u0454\u043d\u0430","\u03c4\u03c1\u03b9\u03c0\u03bb\u03ae","\xfc\xe7l\xfc","tr\xf3jobiektywowy","trostruka","trojn\xfd","trojit\xe1","trippelt","trippel","tripl\u0103","triple","tripla","tiga","kolmois","ba camera"],S=["\ub4c0\uc5bc \uc640\uc774\ub4dc","\u96d9\u5ee3\u89d2","\u53cc\u5e7f\u89d2","\u30c7\u30e5\u30a2\u30eb\u5e83\u89d2","\u0e04\u0e39\u0e48\u0e14\u0e49\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07\u0e21\u0e38\u0e21\u0e01\u0e27\u0e49\u0e32\u0e07","\u0921\u094d\u092f\u0941\u0905\u0932 \u0935\u093e\u0907\u0921","\u0645\u0632\u062f\u0648\u062c\u0629 \u0639\u0631\u064a\u0636\u0629","\u05db\u05e4\u05d5\u05dc\u05d4 \u05e8\u05d7\u05d1\u05d4","\u049b\u043e\u0441 \u043a\u0435\u04a3 \u0431\u04b1\u0440\u044b\u0448\u0442\u044b","\u0437\u0434\u0432\u043e\u0454\u043d\u0430 \u0448\u0438\u0440\u043e\u043a\u043e\u043a\u0443\u0442\u043d\u0430","\u0434\u0432\u043e\u0439\u043d\u0430\u044f \u0448\u0438\u0440\u043e\u043a\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u0430\u044f","\u0434\u0432\u043e\u0439\u043d\u0430 \u0448\u0438\u0440\u043e\u043a\u043e\u044a\u0433\u044a\u043b\u043d\u0430","\u03b4\u03b9\u03c0\u03bb\u03ae \u03b5\u03c5\u03c1\u03b5\u03af\u03b1","\xe7ift geni\u015f","laajakulmainen kaksois","k\xe9p r\u1ed9ng m\u1eb7t sau","kett\u0151s, sz\xe9les l\xe1t\xf3sz\xf6g\u0171","grande angular dupla","ganda","dwuobiektywowy","dwikamera","dvostruka \u0161iroka","du\xe1ln\xed \u0161iroko\xfahl\xfd","du\xe1lna \u0161irokouhl\xe1","dupla grande-angular","dubl\u0103","dubbel vidvinkel","dual-weitwinkel","dual wide","dual con gran angular","dual","double","doppia con grandangolo","doble","dobbelt vidvinkelkamera"],O=t.filter(P=>{const N=P.label.toLowerCase();return C.some(k=>N.includes(k))});if(!O.length)return null;const x=O.find(P=>{const N=P.label.toLowerCase();return T.some(k=>N.includes(k))});if(x)return x.deviceId;const L=O.find(P=>{const N=P.label.toLowerCase();return S.some(k=>N.includes(k))});return L?L.deviceId:O[0].deviceId}}static findBestRearCamera(t,r){if(!t||!t.length)return null;if(["iPhone","iPad","Mac"].includes(ht.OS))return Me.findBestRearCameraInIOS(t,{getMainCamera:r?.getMainCameraInIOS});const f=["\ud6c4","\u80cc\u9762","\u80cc\u7f6e","\u5f8c\u9762","\u5f8c\u7f6e","\u540e\u9762","\u540e\u7f6e","\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07","\u0e2b\u0e25\u0e31\u0e07","\u092c\u0948\u0915","\u062e\u0644\u0641\u064a\u0629","\u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u0437\u0430\u0434\u043d\u044f\u044f","\u0437\u0430\u0434\u043d\u044f","\u0437\u0430\u0434\u043d\u0435\u0439","\u0437\u0430\u0434\u043d\u0430","\u03c0\u03af\u03c3\u03c9","zadn\xed","zadn\xe1","tylny","tr\xe1s","trasera","traseira","taka","stra\u017enja","spate","sau","r\xfcck","rear","posteriore","posterior","h\xe1ts\xf3","darrere","belakang","baksidan","bakre","bak","bagside","back","a\u0440\u0442\u049b\u044b","arri\xe8re","arka","achterzijde"];for(let C of t){const T=C.label.toLowerCase();if(T&&f.some(S=>T.includes(S))&&/\b0(\b)?/.test(T))return C.deviceId}return["Android","HarmonyOS"].includes(ht.OS)?t[t.length-1].deviceId:null}static findBestCamera(t,r,f){return t&&t.length?"environment"===r?this.findBestRearCamera(t,f):"user"===r?null:r?void 0:null:null}static playVideo(t,r,f){return te(function*(){if(!t)throw new Error("Invalid 'videoEl'.");if(!r)throw new Error("Invalid 'source'.");return new Promise(function(){var C=te(function*(T,S){let O;const x=()=>{t.removeEventListener("loadstart",k),t.removeEventListener("abort",W),t.removeEventListener("play",H),t.removeEventListener("error",Z),t.removeEventListener("loadedmetadata",ie)};let L=!1;const P=()=>{L=!0,O&&clearTimeout(O),x(),T(t)},N=J=>{O&&clearTimeout(O),x(),S(J)},k=()=>{t.addEventListener("abort",W,{once:!0})},W=()=>{const J=new Error("Video playing was interrupted.");J.name="AbortError",N(J)},H=()=>{P()},Z=()=>{N(new Error(`Video error ${t.error.code}: ${t.error.message}.`))};let X;const q=new Promise(J=>{X=J}),ie=()=>{X()};if(t.addEventListener("loadstart",k,{once:!0}),t.addEventListener("play",H,{once:!0}),t.addEventListener("error",Z,{once:!0}),t.addEventListener("loadedmetadata",ie,{once:!0}),"string"==typeof r||r instanceof String?t.src=r:t.srcObject=r,t.autoplay&&(yield new Promise(J=>{setTimeout(J,1e3)})),!L){f&&(O=setTimeout(()=>{x(),S(new Error("Failed to play video. Timeout."))},f));try{t.src&&(yield t.load()),yield t.play(),P()}catch(J){Me._onLog&&Me._onLog("1st play error: "+(J?.message||J)),yield q;try{yield t.play(),P()}catch(Ee){Me._onLog&&Me._onLog("2rd play error: "+(Ee?.message||Ee)),N(Ee)}}}});return function(T,S){return C.apply(this,arguments)}}())})()}static testCameraAccess(t){return te(function*(){var r,f;if(null===(f=null===(r=window?.navigator)||void 0===r?void 0:r.mediaDevices)||void 0===f||!f.getUserMedia)return{ok:!1,errorName:"InsecureContext",errorMessage:"Insecure context."};let C;try{C=t?yield navigator.mediaDevices.getUserMedia(t):yield navigator.mediaDevices.getUserMedia({video:!0})}catch(T){return{ok:!1,errorName:T.name,errorMessage:T.message}}finally{C?.getTracks().forEach(T=>{T.stop()})}return{ok:!0}})()}get state(){if(!U(this,It,"f"))return"closed";if("pending"===U(this,It,"f"))return"opening";if("fulfilled"===U(this,It,"f"))return"opened";throw new Error("Unknown state.")}set ifSaveLastUsedCamera(t){t?Me.isStorageAvailable("localStorage")?Ve(this,Ki,!0,"f"):(Ve(this,Ki,!1,"f"),console.warn("Local storage is unavailable")):Ve(this,Ki,!1,"f")}get ifSaveLastUsedCamera(){return U(this,Ki,"f")}get isVideoPlaying(){return!(!U(this,ke,"f")||U(this,ke,"f").paused)&&"opened"===this.state}set tapFocusEventBoundEl(t){var r,f,C;if(!(t instanceof HTMLElement)&&null!=t)throw new TypeError("Invalid 'element'.");null===(r=U(this,Di,"f"))||void 0===r||r.removeEventListener("click",U(this,$i,"f")),null===(f=U(this,Di,"f"))||void 0===f||f.removeEventListener("touchend",U(this,$i,"f")),null===(C=U(this,Di,"f"))||void 0===C||C.removeEventListener("touchmove",U(this,Ir,"f")),Ve(this,Di,t,"f"),t&&(window.TouchEvent&&["Android","HarmonyOS","iPhone","iPad"].includes(ht.OS)?(t.addEventListener("touchend",U(this,$i,"f")),t.addEventListener("touchmove",U(this,Ir,"f"))):t.addEventListener("click",U(this,$i,"f")))}get tapFocusEventBoundEl(){return U(this,Di,"f")}get disposed(){return U(this,Ar,"f")}constructor(t){var f,C,r=this;Se.add(this),ke.set(this,null),Ye.set(this,void 0),Tr.set(this,()=>{"opened"===this.state&&U(this,dt,"f").fire("resumed",null,{target:this,async:!0})}),br.set(this,()=>{U(this,dt,"f").fire("paused",null,{target:this,async:!1})}),Qe.set(this,void 0),Mt.set(this,void 0),this.cameraOpenTimeout=15e3,this._arrCameras=[],ti.set(this,void 0),Ki.set(this,!1),this.ifSkipCameraInspection=!1,this.selectIOSRearMainCameraAsDefault=!1,Sr.set(this,void 0),Ht.set(this,!0),ii.set(this,void 0),It.set(this,void 0),Ji.set(this,!1),this._focusParameters={maxTimeout:400,minTimeout:300,kTimeout:void 0,oldDistance:null,fds:null,isDoingFocus:0,taskBackToContinous:null,curFocusTaskId:0,focusCancelableTime:1500,defaultFocusAreaSizeRatio:6,focusBackToContinousTime:5e3,tapFocusMinDistance:null,tapFocusMaxDistance:null,focusArea:null,tempBufferContainer:null,defaultTempBufferContainerLenRatio:1/4},Qi.set(this,!1),this._focusSupported=!0,this.calculateCoordInVideo=(T,S)=>{let O,x;const L=window.getComputedStyle(U(this,ke,"f")).objectFit,P=this.getResolution(),N=U(this,ke,"f").getBoundingClientRect(),k=N.left,W=N.top,{width:H,height:Z}=U(this,ke,"f").getBoundingClientRect();if(H<=0||Z<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const X=H/Z,q=P.width/P.height;let ie=1;if("contain"===L)q>X?(ie=H/P.width,O=(T-k)/ie,x=(S-W-(Z-H/q)/2)/ie):(ie=Z/P.height,x=(S-W)/ie,O=(T-k-(H-Z*q)/2)/ie);else{if("cover"!==L)throw new Error("Unsupported object-fit.");q>X?(ie=Z/P.height,x=(S-W)/ie,O=(T-k+(Z*q-H)/2)/ie):(ie=H/P.width,O=(T-k)/ie,x=(S-W+(H/q-Z)/2)/ie)}return{x:O,y:x}},Pn.set(this,!1),Ir.set(this,()=>{Ve(this,Pn,!0,"f")}),$i.set(this,function(){var T=te(function*(S){var O;if(U(r,Pn,"f"))return void Ve(r,Pn,!1,"f");if(!(U(r,Qi,"f")&&r.isVideoPlaying&&U(r,Ye,"f")&&r._focusSupported))return;if(!r._focusParameters.fds&&(r._focusParameters.fds=null===(O=r.getCameraCapabilities())||void 0===O?void 0:O.focusDistance,!r._focusParameters.fds))return void(r._focusSupported=!1);if(null==r._focusParameters.kTimeout&&(r._focusParameters.kTimeout=(r._focusParameters.maxTimeout-r._focusParameters.minTimeout)/(1/r._focusParameters.fds.min-1/r._focusParameters.fds.max)),1==r._focusParameters.isDoingFocus)return;let x,L;if(r._focusParameters.taskBackToContinous&&(clearTimeout(r._focusParameters.taskBackToContinous),r._focusParameters.taskBackToContinous=null),S instanceof MouseEvent)x=S.clientX,L=S.clientY;else{if(!(S instanceof TouchEvent))throw new Error("Unknown event type.");if(!S.changedTouches.length)return;x=S.changedTouches[0].clientX,L=S.changedTouches[0].clientY}const P=r.getResolution(),N=2*Math.round(Math.min(P.width,P.height)/r._focusParameters.defaultFocusAreaSizeRatio/2);let k;try{k=r.calculateCoordInVideo(x,L)}catch{}if(k.x<0||k.x>P.width||k.y<0||k.y>P.height)return;const W={x:k.x+"px",y:k.y+"px"},H=N+"px",Z=H;let X;Me._onLog&&(X=Date.now());try{yield U(r,Se,"m",Os).call(r,W,H,Z,r._focusParameters.tapFocusMinDistance,r._focusParameters.tapFocusMaxDistance)}catch(q){if(Me._onLog)throw Me._onLog(q),q}Me._onLog&&Me._onLog(`Tap focus costs: ${Date.now()-X} ms`),r._focusParameters.taskBackToContinous=setTimeout(()=>{var q;Me._onLog&&Me._onLog("Back to continuous focus."),null===(q=U(r,Ye,"f"))||void 0===q||q.applyConstraints({advanced:[{focusMode:"continuous"}]}).catch(()=>{})},r._focusParameters.focusBackToContinousTime),U(r,dt,"f").fire("tapfocus",null,{target:r,async:!0})});return function(S){return T.apply(this,arguments)}}()),Di.set(this,null),ni.set(this,1),ri.set(this,{x:0,y:0}),this.updateVideoElWhenSoftwareScaled=()=>{if(!U(this,ke,"f"))return;const T=U(this,ni,"f");if(T<1)throw new RangeError("Invalid scale value.");if(1===T)U(this,ke,"f").style.transform="";else{const S=window.getComputedStyle(U(this,ke,"f")).objectFit,O=U(this,ke,"f").videoWidth,x=U(this,ke,"f").videoHeight,{width:L,height:P}=U(this,ke,"f").getBoundingClientRect();if(L<=0||P<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const N=L/P,k=O/x;let W=1;"contain"===S?W=N<k?L/(O/T):P/(x/T):"cover"===S&&(W=k>N?P/(O/T):L/(x/T));const H=W*(1-1/T)*(O/2-U(this,ri,"f").x),Z=W*(1-1/T)*(x/2-U(this,ri,"f").y);U(this,ke,"f").style.transform=`translate(${H}px, ${Z}px) scale(${T})`}},Ss.set(this,function(){if(!(this.data instanceof Uint8Array||this.data instanceof Uint8ClampedArray))throw new TypeError("Invalid data.");if("number"!=typeof this.width||this.width<=0)throw new Error("Invalid width.");if("number"!=typeof this.height||this.height<=0)throw new Error("Invalid height.");const T=document.createElement("canvas");let S;if(T.width=this.width,T.height=this.height,this.pixelFormat===We.GREY){S=new Uint8ClampedArray(this.width*this.height*4);for(let x=0;x<S.length;x+=4)S[x]=this.data[x/4],S[x+1]=this.data[x/4],S[x+2]=this.data[x/4],S[x+3]=255}else S=new Uint8ClampedArray(this.data.buffer);const O=new ImageData(S,this.width,this.height);return T.getContext("2d").putImageData(O,0,0),T}),dt.set(this,void 0),Is.set(this,["before:open","opened","before:close","closed","before:camera:change","camera:changed","before:resolution:change","resolution:changed","played","paused","resumed","tapfocus"]),this.detectedResolutions=[{width:160,height:120},{width:320,height:240},{width:480,height:360},{width:640,height:480},{width:800,height:600},{width:960,height:720},{width:1280,height:720},{width:1920,height:1080},{width:2560,height:1440},{width:3840,height:2160}],Li.set(this,new Map),en.set(this,!1),xr.set(this,te(function*(){var T,S;if("visible"===document.visibilityState){if(Me._onLog&&Me._onLog("document visible. video paused: "+(null===(T=U(r,ke,"f"))||void 0===T?void 0:T.paused)),U(r,en,"f")&&U(r,ke,"f")&&r.videoSrc&&"opened"===r.state)return void r.resume().catch(()=>{});if(!r._mediaStream)return;if(r._mediaStream.active&&U(r,Ye,"f"))if(U(r,Ye,"f").muted&&["iPhone","iPad","Mac"].includes(ht.OS)){if(ht.version>=17)return void Me.playVideo(U(r,ke,"f"),r._mediaStream,r.cameraOpenTimeout);yield U(r,Se,"m",tn).call(r)}else U(r,en,"f")&&r.resume().catch(()=>{});else yield U(r,Se,"m",tn).call(r)}else if("hidden"===document.visibilityState&&(Me._onLog&&Me._onLog("document hidden. video paused: "+(null===(S=U(r,ke,"f"))||void 0===S?void 0:S.paused)),["iPhone","iPad","Mac"].includes(ht.OS)?Ve(r,en,!0,"f"):Ve(r,en,r.isVideoPlaying,"f"),r.isVideoLoaded()&&"opened"==r.state)){if(["iPhone","iPad","Mac"].includes(ht.OS)&&ht.version>=17)return;r.pause()}})),Ar.set(this,!1),!(null===(C=null===(f=window?.navigator)||void 0===f?void 0:f.mediaDevices)||void 0===C)&&C.getUserMedia||setTimeout(()=>{Me.onWarning&&Me.onWarning("The browser is too old or the page is loaded from an insecure origin.")},0),this.defaultConstraints={video:{facingMode:{ideal:"environment"}}},this.resetMediaStreamConstraints(),t instanceof HTMLVideoElement&&this.setVideoEl(t),Ve(this,dt,new Na,"f"),this.imageDataGetter=new Fe,document.addEventListener("visibilitychange",U(this,xr,"f"))}setVideoEl(t){if(!(t&&t instanceof HTMLVideoElement))throw new Error("Invalid 'videoEl'.");t.addEventListener("play",U(this,Tr,"f")),t.addEventListener("pause",U(this,br,"f")),Ve(this,ke,t,"f")}getVideoEl(){return U(this,ke,"f")}releaseVideoEl(){var t,r;null===(t=U(this,ke,"f"))||void 0===t||t.removeEventListener("play",U(this,Tr,"f")),null===(r=U(this,ke,"f"))||void 0===r||r.removeEventListener("pause",U(this,br,"f")),Ve(this,ke,null,"f")}isVideoLoaded(){return!!U(this,ke,"f")&&4==U(this,ke,"f").readyState}open(){var t=this;return te(function*(){if(U(t,ii,"f")&&!U(t,Ht,"f")){if("pending"===U(t,It,"f"))return U(t,ii,"f");if("fulfilled"===U(t,It,"f"))return}U(t,dt,"f").fire("before:open",null,{target:t}),yield U(t,Se,"m",tn).call(t),U(t,dt,"f").fire("opened",null,{target:t,async:!0}),U(t,dt,"f").fire("played",null,{target:t,async:!0})})()}close(){var t=this;return te(function*(){if("closed"===t.state)return;U(t,dt,"f").fire("before:close",null,{target:t});const r=U(t,ii,"f");if(U(t,Se,"m",Or).call(t),r&&"pending"===U(t,It,"f")){try{yield r}catch{}if(!1===U(t,Ht,"f")){const f=new Error("'close()' was interrupted.");throw f.name="AbortError",f}}Ve(t,ii,null,"f"),Ve(t,It,null,"f"),U(t,dt,"f").fire("closed",null,{target:t,async:!0})})()}pause(){if(!this.isVideoLoaded())throw new Error("Video is not loaded.");if("opened"!==this.state)throw new Error("Camera or video is not open.");U(this,ke,"f").pause()}resume(){var t=this;return te(function*(){if(!t.isVideoLoaded())throw new Error("Video is not loaded.");if("opened"!==t.state)throw new Error("Camera or video is not open.");yield U(t,ke,"f").play()})()}setCamera(t){var r=this;return te(function*(){if("string"!=typeof t)throw new TypeError("Invalid 'deviceId'.");if("object"!=typeof U(r,Qe,"f").video&&(U(r,Qe,"f").video={}),delete U(r,Qe,"f").video.facingMode,U(r,Qe,"f").video.deviceId={exact:t},!("closed"===r.state||r.videoSrc||"opening"===r.state&&U(r,Ht,"f"))){U(r,dt,"f").fire("before:camera:change",[],{target:r,async:!1}),yield U(r,Se,"m",kn).call(r);try{r.resetSoftwareScale()}catch{}return U(r,Mt,"f")}})()}switchToFrontCamera(t){var r=this;return te(function*(){if("object"!=typeof U(r,Qe,"f").video&&(U(r,Qe,"f").video={}),t?.resolution&&(U(r,Qe,"f").video.width={ideal:t.resolution.width},U(r,Qe,"f").video.height={ideal:t.resolution.height}),delete U(r,Qe,"f").video.deviceId,U(r,Qe,"f").video.facingMode={exact:"user"},Ve(r,ti,null,"f"),!("closed"===r.state||r.videoSrc||"opening"===r.state&&U(r,Ht,"f"))){U(r,dt,"f").fire("before:camera:change",[],{target:r,async:!1}),U(r,Se,"m",kn).call(r);try{r.resetSoftwareScale()}catch{}return U(r,Mt,"f")}})()}getCamera(){var t;if(U(this,Mt,"f"))return U(this,Mt,"f");{let r=(null===(t=U(this,Qe,"f").video)||void 0===t?void 0:t.deviceId)||"";if(r){r=r.exact||r.ideal||r;for(let f of this._arrCameras)if(f.deviceId===r)return JSON.parse(JSON.stringify(f))}return{deviceId:"",label:"",_checked:!1}}}_getCameras(t){var r=this;return te(function*(){var f,C;if(null===(C=null===(f=window?.navigator)||void 0===f?void 0:f.mediaDevices)||void 0===C||!C.getUserMedia)throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let T;if(t){let x=yield navigator.mediaDevices.getUserMedia({video:!0});T=(yield navigator.mediaDevices.enumerateDevices()).filter(L=>"videoinput"===L.kind),x.getTracks().forEach(L=>{L.stop()})}else T=(yield navigator.mediaDevices.enumerateDevices()).filter(x=>"videoinput"===x.kind);const S=[],O=[];if(r._arrCameras)for(let x of r._arrCameras)x._checked&&O.push(x);for(let x=0;x<T.length;x++){let L,P=T[x];for(let N of O)if(P.deviceId==N.deviceId){L=N;break}L||(L={deviceId:P.deviceId,label:P.label?P.label:"camera "+x,_checked:!1}),L.deviceId&&S.push(L)}return r._arrCameras=S,Me._onLog&&Me._onLog(JSON.stringify(r._arrCameras)),S})()}getCameras(){var t=this;return te(function*(){var r,f;if(null===(f=null===(r=window?.navigator)||void 0===r?void 0:r.mediaDevices)||void 0===f||!f.enumerateDevices)throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");const C=(yield navigator.mediaDevices.enumerateDevices()).filter(T=>"videoinput"===T.kind);return t._getCameras(!(!C||!C.length||C[0].deviceId))})()}getAllCameras(){var t=this;return te(function*(){return t.getCameras()})()}setResolution(t,r,f){var C=this;return te(function*(){if("number"!=typeof t||t<=0)throw new TypeError("Invalid 'width'.");if("number"!=typeof r||r<=0)throw new TypeError("Invalid 'height'.");if("object"!=typeof U(C,Qe,"f").video&&(U(C,Qe,"f").video={}),f?(U(C,Qe,"f").video.width={exact:t},U(C,Qe,"f").video.height={exact:r}):(U(C,Qe,"f").video.width={ideal:t},U(C,Qe,"f").video.height={ideal:r}),"closed"===C.state||C.videoSrc||"opening"===C.state&&U(C,Ht,"f"))return null;U(C,dt,"f").fire("before:resolution:change",[],{target:C,async:!1}),yield U(C,Se,"m",kn).call(C);try{C.resetSoftwareScale()}catch{}const T=C.getResolution();return{width:T.width,height:T.height}})()}getResolution(){if("opened"===this.state&&this.videoSrc&&U(this,ke,"f"))return{width:U(this,ke,"f").videoWidth,height:U(this,ke,"f").videoHeight};if(U(this,Ye,"f")){const t=U(this,Ye,"f").getSettings();return{width:t.width,height:t.height}}if(this.isVideoLoaded())return{width:U(this,ke,"f").videoWidth,height:U(this,ke,"f").videoHeight};{const t={width:0,height:0};let r=U(this,Qe,"f").video.width||0,f=U(this,Qe,"f").video.height||0;return r&&(t.width=r.exact||r.ideal||r),f&&(t.height=f.exact||f.ideal||f),t}}getResolutions(t){var r=this;return te(function*(){var f,C,T,S,O,x,L,P,N,k,W;if(null===(C=null===(f=window?.navigator)||void 0===f?void 0:f.mediaDevices)||void 0===C||!C.getUserMedia)throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let H="";const Z=(X,q)=>{const ie=U(r,Li,"f").get(X);if(!ie||!ie.length)return!1;for(let J of ie)if(J.width===q.width&&J.height===q.height)return!0;return!1};if(r._mediaStream){H=null===(W=U(r,Mt,"f"))||void 0===W?void 0:W.deviceId;let X=U(r,Li,"f").get(H);if(X&&!t)return JSON.parse(JSON.stringify(X));X=[],U(r,Li,"f").set(H,X),Ve(r,Ji,!0,"f");try{for(let q of r.detectedResolutions){yield U(r,Ye,"f").applyConstraints({width:{ideal:q.width},height:{ideal:q.height}}),U(r,Se,"m",jt).call(r);const ie=U(r,Ye,"f").getSettings(),J={width:ie.width,height:ie.height};Z(H,J)||X.push({width:J.width,height:J.height})}}catch(q){throw U(r,Se,"m",Or).call(r),Ve(r,Ji,!1,"f"),q}try{yield U(r,Se,"m",tn).call(r)}catch(q){if("AbortError"===q.name)return X;throw q}finally{Ve(r,Ji,!1,"f")}return X}{const X=function(){var J=te(function*(Ee,_e,xe){const Ie={video:{deviceId:{exact:Ee},width:{ideal:_e},height:{ideal:xe}}};let b=null;try{b=yield navigator.mediaDevices.getUserMedia(Ie)}catch{return null}if(!b)return null;const me=b.getVideoTracks();let Re=null;try{const je=me[0].getSettings();Re={width:je.width,height:je.height}}catch{const u=document.createElement("video");u.srcObject=b,Re={width:u.videoWidth,height:u.videoHeight},u.srcObject=null}return me.forEach(je=>{je.stop()}),Re});return function(_e,xe,Ie){return J.apply(this,arguments)}}();let q=(null===(O=null===(S=null===(T=U(r,Qe,"f"))||void 0===T?void 0:T.video)||void 0===S?void 0:S.deviceId)||void 0===O?void 0:O.exact)||(null===(P=null===(L=null===(x=U(r,Qe,"f"))||void 0===x?void 0:x.video)||void 0===L?void 0:L.deviceId)||void 0===P?void 0:P.ideal)||(null===(k=null===(N=U(r,Qe,"f"))||void 0===N?void 0:N.video)||void 0===k?void 0:k.deviceId);if(!q)return[];let ie=U(r,Li,"f").get(q);if(ie&&!t)return JSON.parse(JSON.stringify(ie));ie=[],U(r,Li,"f").set(q,ie);for(let J of r.detectedResolutions){const Ee=yield X(q,J.width,J.height);Ee&&!Z(q,Ee)&&ie.push({width:Ee.width,height:Ee.height})}return ie}})()}setMediaStreamConstraints(t,r){var f=this;return te(function*(){if(null===(C=t)||"[object Object]"!==Object.prototype.toString.call(C))throw new TypeError("Invalid 'mediaStreamConstraints'.");var C;Ve(f,Qe,JSON.parse(JSON.stringify(t)),"f"),Ve(f,ti,null,"f"),r&&U(f,Se,"m",kn).call(f)})()}getMediaStreamConstraints(){return JSON.parse(JSON.stringify(U(this,Qe,"f")))}resetMediaStreamConstraints(){Ve(this,Qe,this.defaultConstraints?JSON.parse(JSON.stringify(this.defaultConstraints)):null,"f")}getCameraCapabilities(){if(!U(this,Ye,"f")||"opened"!==this.state)throw new Error("Camera is not open.");return U(this,Ye,"f").getCapabilities?U(this,Ye,"f").getCapabilities():{}}getCameraSettings(){if(!U(this,Ye,"f")||"opened"!==this.state)throw new Error("Camera is not open.");return U(this,Ye,"f").getSettings()}turnOnTorch(){var t=this;return te(function*(){if(!U(t,Ye,"f")||"opened"!==t.state)throw new Error("Camera is not open.");const r=t.getCameraCapabilities();if(!r?.torch)throw Error("Not supported.");yield U(t,Ye,"f").applyConstraints({advanced:[{torch:!0}]})})()}turnOffTorch(){var t=this;return te(function*(){if(!U(t,Ye,"f")||"opened"!==t.state)throw new Error("Camera is not open.");const r=t.getCameraCapabilities();if(!r?.torch)throw Error("Not supported.");yield U(t,Ye,"f").applyConstraints({advanced:[{torch:!1}]})})()}setColorTemperature(t,r){var f=this;return te(function*(){var C;if("number"!=typeof t)throw new TypeError("Invalid 'value'.");if(!U(f,Ye,"f")||"opened"!==f.state)throw new Error("Camera is not open.");const T=null===(C=f.getCameraCapabilities())||void 0===C?void 0:C.colorTemperature;if(!T)throw Error("Not supported.");return r&&(t<T.min?t=T.min:t>T.max&&(t=T.max),t=Et(t,T.min,T.step,T.max)),yield U(f,Ye,"f").applyConstraints({advanced:[{colorTemperature:t,whiteBalanceMode:"manual"}]}),t})()}getColorTemperature(){return this.getCameraSettings().colorTemperature||0}setExposureCompensation(t,r){var f=this;return te(function*(){var C;if("number"!=typeof t)throw new TypeError("Invalid 'value'.");if(!U(f,Ye,"f")||"opened"!==f.state)throw new Error("Camera is not open.");const T=null===(C=f.getCameraCapabilities())||void 0===C?void 0:C.exposureCompensation;if(!T)throw Error("Not supported.");return r&&(t<T.min?t=T.min:t>T.max&&(t=T.max),t=Et(t,T.min,T.step,T.max)),yield U(f,Ye,"f").applyConstraints({advanced:[{exposureCompensation:t}]}),t})()}getExposureCompensation(){return this.getCameraSettings().exposureCompensation||0}setFrameRate(t,r){var f=this;return te(function*(){var C;if("number"!=typeof t)throw new TypeError("Invalid 'value'.");if(!U(f,Ye,"f")||"opened"!==f.state)throw new Error("Camera is not open.");let T=null===(C=f.getCameraCapabilities())||void 0===C?void 0:C.frameRate;if(!T)throw Error("Not supported.");r&&(t<T.min?t=T.min:t>T.max&&(t=T.max));const S=f.getResolution();return yield U(f,Ye,"f").applyConstraints({width:{ideal:Math.max(S.width,S.height)},frameRate:t}),t})()}getFrameRate(){return this.getCameraSettings().frameRate}setFocus(t,r){var f=this;return te(function*(){if("object"!=typeof t||Array.isArray(t)||null==t)throw new TypeError("Invalid 'settings'.");if(!U(f,Ye,"f")||"opened"!==f.state)throw new Error("Camera is not open.");const C=f.getCameraCapabilities(),T=C?.focusMode,S=C?.focusDistance;if(!T)throw Error("Not supported.");if("string"!=typeof t.mode)throw TypeError("Invalid 'mode'.");const O=t.mode.toLowerCase();if(!T.includes(O))throw Error("Unsupported focus mode.");if("manual"===O){if(!S)throw Error("Manual focus unsupported.");if(t.hasOwnProperty("distance")){let x=t.distance;r&&(x<S.min?x=S.min:x>S.max&&(x=S.max),x=Et(x,S.min,S.step,S.max)),f._focusParameters.focusArea=null,yield U(f,Ye,"f").applyConstraints({advanced:[{focusMode:O,focusDistance:x}]})}else{if(!t.area)throw new Error("'distance' or 'area' should be specified in 'manual' mode.");{const x=t.area.centerPoint;let L=t.area.width,P=t.area.height;if(!L||!P){const N=f.getResolution();L||(L=2*Math.round(Math.min(N.width,N.height)/f._focusParameters.defaultFocusAreaSizeRatio/2)+"px"),P||(P=2*Math.round(Math.min(N.width,N.height)/f._focusParameters.defaultFocusAreaSizeRatio/2)+"px")}f._focusParameters.focusArea={centerPoint:{x:x.x,y:x.y},width:L,height:P},yield U(f,Se,"m",Os).call(f,x,L,P)}}}else f._focusParameters.focusArea=null,yield U(f,Ye,"f").applyConstraints({advanced:[{focusMode:O}]})})()}getFocus(){const t=this.getCameraSettings(),r=t.focusMode;return r?"manual"===r?this._focusParameters.focusArea?{mode:"manual",area:JSON.parse(JSON.stringify(this._focusParameters.focusArea))}:{mode:"manual",distance:t.focusDistance}:{mode:r}:null}enableTapToFocus(){var t=this;return te(function*(){Ve(t,Qi,!0,"f")})()}disableTapToFocus(){Ve(this,Qi,!1,"f")}isTapToFocusEnabled(){return U(this,Qi,"f")}setZoom(t){var r=this;return te(function*(){if("object"!=typeof t||Array.isArray(t)||null==t)throw new TypeError("Invalid 'settings'.");if("number"!=typeof t.factor)throw new TypeError("Illegal type of 'factor'.");if(t.factor<1)throw new RangeError("Invalid 'factor'.");if("opened"!==r.state)throw new Error("Video is not playing.");t.centerPoint?U(r,Se,"m",Rs).call(r,t.centerPoint):r.resetScaleCenter();try{if(U(r,Se,"m",qo).call(r,U(r,ri,"f"))){const f=yield r.setHardwareScale(t.factor,!0);let C=r.getHardwareScale();1==C&&1!=f&&(C=f),r.setSoftwareScale(t.factor>C?t.factor/C:1)}else yield r.setHardwareScale(1),r.setSoftwareScale(t.factor)}catch(f){const C=f.message||f;if("Not supported."!==C&&"Camera is not open."!==C)throw f;r.setSoftwareScale(t.factor)}})()}getZoom(){if("opened"!==this.state)throw new Error("Video is not playing.");let t=1;try{t=this.getHardwareScale()}catch(r){if("Camera is not open."!==(r.message||r))throw r}return{factor:t*U(this,ni,"f")}}resetZoom(){var t=this;return te(function*(){yield t.setZoom({factor:1})})()}setHardwareScale(t,r){var f=this;return te(function*(){var C;if("number"!=typeof t)throw new TypeError("Invalid 'value'.");if(t<1)throw new RangeError("Invalid 'value'.");if(!U(f,Ye,"f")||"opened"!==f.state)throw new Error("Camera is not open.");const T=null===(C=f.getCameraCapabilities())||void 0===C?void 0:C.zoom;if(!T)throw Error("Not supported.");return r&&(t<T.min?t=T.min:t>T.max&&(t=T.max),t=Et(t,T.min,T.step,T.max)),yield U(f,Ye,"f").applyConstraints({advanced:[{zoom:t}]}),t})()}getHardwareScale(){return this.getCameraSettings().zoom||1}setSoftwareScale(t,r){if("number"!=typeof t)throw new TypeError("Invalid 'value'.");if(t<1)throw new RangeError("Invalid 'value'.");if("opened"!==this.state)throw new Error("Video is not playing.");r&&U(this,Se,"m",Rs).call(this,r),Ve(this,ni,t,"f"),this.updateVideoElWhenSoftwareScaled()}getSoftwareScale(){return U(this,ni,"f")}resetScaleCenter(){if("opened"!==this.state)throw new Error("Video is not playing.");const t=this.getResolution();Ve(this,ri,{x:t.width/2,y:t.height/2},"f")}resetSoftwareScale(){this.setSoftwareScale(1),this.resetScaleCenter()}getFrameData(t){if(this.disposed)throw Error("The 'Camera' instance has been disposed.");if(!this.isVideoLoaded()||U(this,Ji,"f"))return null;const r=Date.now();Me._onLog&&Me._onLog("getFrameData() START: "+r);const f=U(this,ke,"f").videoWidth,C=U(this,ke,"f").videoHeight;let T={sx:0,sy:0,sWidth:f,sHeight:C,dWidth:f,dHeight:C};t?.position&&(T=JSON.parse(JSON.stringify(t.position)));let S=We.RGBA;t?.pixelFormat&&(S=t.pixelFormat);let O=U(this,ni,"f");t?.scale&&(O=t.scale);let x=U(this,ri,"f");if(t?.scaleCenter){if("string"!=typeof t.scaleCenter.x||"string"!=typeof t.scaleCenter.y)throw new Error("Invalid scale center.");let k=0,W=0;if(t.scaleCenter.x.endsWith("px"))k=parseFloat(t.scaleCenter.x);else{if(!t.scaleCenter.x.endsWith("%"))throw new Error("Invalid scale center.");k=parseFloat(t.scaleCenter.x)/100*f}if(t.scaleCenter.y.endsWith("px"))W=parseFloat(t.scaleCenter.y);else{if(!t.scaleCenter.y.endsWith("%"))throw new Error("Invalid scale center.");W=parseFloat(t.scaleCenter.y)/100*C}if(isNaN(k)||isNaN(W))throw new Error("Invalid scale center.");x.x=Math.round(k),x.y=Math.round(W)}let L=null;if(t?.bufferContainer&&(L=t.bufferContainer),0==f||0==C)return null;1!==O&&(T.sWidth=Math.round(T.sWidth/O),T.sHeight=Math.round(T.sHeight/O),T.sx=Math.round((1-1/O)*x.x+T.sx/O),T.sy=Math.round((1-1/O)*x.y+T.sy/O));const P=this.imageDataGetter.getImageData(U(this,ke,"f"),f,C,T,{pixelFormat:S,bufferContainer:L});if(!P)return null;const N=Date.now();return Me._onLog&&Me._onLog("getFrameData() END: "+N),{data:P.data,width:P.width,height:P.height,pixelFormat:P.pixelFormat,timeSpent:N-r,timeStamp:N,toCanvas:U(this,Ss,"f")}}on(t,r){if(!U(this,Is,"f").includes(t.toLowerCase()))throw new Error(`Event '${t}' does not exist.`);U(this,dt,"f").on(t,r)}off(t,r){U(this,dt,"f").off(t,r)}dispose(){var t=this;return te(function*(){t.tapFocusEventBoundEl=null,yield t.close(),t.releaseVideoEl(),U(t,dt,"f").dispose(),t.imageDataGetter.dispose(),document.removeEventListener("visibilitychange",U(t,xr,"f")),Ve(t,Ar,!0,"f")})()}}var Nn,Rr,rn,Mi,Dr,sn,Ko,Jo,He,Ds,Ls,be,Ae,Bn,si,Fi,Lr,Mr,Fr,Un,Pi,Pr,oi,At,$e,ye,Xt,Ms,et,Qo,$o,Fs,Ps;ke=new WeakMap,Ye=new WeakMap,Tr=new WeakMap,br=new WeakMap,Qe=new WeakMap,Mt=new WeakMap,ti=new WeakMap,Ki=new WeakMap,Sr=new WeakMap,Ht=new WeakMap,ii=new WeakMap,It=new WeakMap,Ji=new WeakMap,Qi=new WeakMap,Pn=new WeakMap,Ir=new WeakMap,$i=new WeakMap,Di=new WeakMap,ni=new WeakMap,ri=new WeakMap,Ss=new WeakMap,dt=new WeakMap,Is=new WeakMap,Li=new WeakMap,en=new WeakMap,xr=new WeakMap,Ar=new WeakMap,Se=new WeakSet,Zo=function(){var p=te(function*(){var t=this;const r=this.getMediaStreamConstraints();if("boolean"==typeof r.video&&(r.video={}),!r.video.deviceId)if(U(this,ti,"f"))delete r.video.facingMode,r.video.deviceId={exact:U(this,ti,"f")};else if(this.ifSaveLastUsedCamera&&Me.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")){delete r.video.facingMode,r.video.deviceId={ideal:window.localStorage.getItem("dce_last_camera_id")};const f=JSON.parse(window.localStorage.getItem("dce_last_apply_width")),C=JSON.parse(window.localStorage.getItem("dce_last_apply_height"));f&&C&&(r.video.width=f,r.video.height=C)}else if(!this.ifSkipCameraInspection){const f=function(){var S=te(function*(O){let x=null;return"environment"===O&&["Android","HarmonyOS","iPhone","iPad"].includes(ht.OS)?(yield t._getCameras(!1),U(t,Se,"m",jt).call(t),x=Me.findBestCamera(t._arrCameras,"environment",{getMainCameraInIOS:t.selectIOSRearMainCameraAsDefault})):O||["Android","HarmonyOS","iPhone","iPad"].includes(ht.OS)||(yield t._getCameras(!1),U(t,Se,"m",jt).call(t),x=Me.findBestCamera(t._arrCameras,null,{getMainCameraInIOS:t.selectIOSRearMainCameraAsDefault})),x});return function(x){return S.apply(this,arguments)}}();let C=r.video.facingMode;C instanceof Array&&C.length&&(C=C[0]),"object"==typeof C&&(C=C.exact||C.ideal);const T=yield f(C);T&&(delete r.video.facingMode,r.video.deviceId={exact:T})}return r});return function(){return p.apply(this,arguments)}}(),jt=function(){if(U(this,Ht,"f")){const p=new Error("The operation was interrupted.");throw p.name="AbortError",p}},xs=function(){var p=te(function*(t){var f,C,r=this;if(null===(C=null===(f=window?.navigator)||void 0===f?void 0:f.mediaDevices)||void 0===C||!C.getUserMedia)throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let T;try{Me._onLog&&Me._onLog("======try getUserMedia========");let S=[0,500,1e3,2e3],O=null;const x=function(){var L=te(function*(P){for(let N of S){N&&(yield new Promise(k=>setTimeout(k,N)),U(r,Se,"m",jt).call(r));try{Me._onLog&&Me._onLog("ask "+JSON.stringify(P)),T=yield navigator.mediaDevices.getUserMedia(P),U(r,Se,"m",jt).call(r);break}catch(k){if("NotFoundError"===k.name||"NotAllowedError"===k.name||"AbortError"===k.name||"OverconstrainedError"===k.name)throw k;O=k,Me._onLog&&Me._onLog(k.message||k)}}});return function(N){return L.apply(this,arguments)}}();if(yield x(t),T||"object"!=typeof t.video||(t.video.deviceId&&(delete t.video.deviceId,yield x(t)),!T&&t.video.facingMode&&(delete t.video.facingMode,yield x(t)),T||!t.video.width&&!t.video.height||(delete t.video.width,delete t.video.height,yield x(t))),!T)throw O;return T}catch(S){throw T?.getTracks().forEach(O=>{O.stop()}),"NotFoundError"===S.name&&(DOMException?S=new DOMException("No camera available, please use a device with an accessible camera.",S.name):(S=new Error("No camera available, please use a device with an accessible camera.")).name="NotFoundError"),S}});return function(r){return p.apply(this,arguments)}}(),As=function(){this._mediaStream&&(this._mediaStream.getTracks().forEach(p=>{p.stop()}),this._mediaStream=null),Ve(this,Ye,null,"f")},tn=function(){var p=te(function*(){var t=this;Ve(this,Ht,!1,"f");const r=Ve(this,Sr,Symbol(),"f");if(U(this,ii,"f")&&"pending"===U(this,It,"f")){try{yield U(this,ii,"f")}catch{}U(this,Se,"m",jt).call(this)}return r!==U(this,Sr,"f")?void 0:Ve(this,ii,te(function*(){Ve(t,It,"pending","f");try{if(t.videoSrc){if(!U(t,ke,"f"))throw new Error("'videoEl' should be set.");yield Me.playVideo(U(t,ke,"f"),t.videoSrc,t.cameraOpenTimeout),U(t,Se,"m",jt).call(t)}else{let C=yield U(t,Se,"m",Zo).call(t);U(t,Se,"m",As).call(t);let T=yield U(t,Se,"m",xs).call(t,C);yield t._getCameras(!1),U(t,Se,"m",jt).call(t);const S=()=>{const P=T.getVideoTracks();let N,k;if(P.length&&(N=P[0]),N){const W=N.getSettings();if(W)for(let H of t._arrCameras)if(W.deviceId===H.deviceId){H._checked=!0,H.label=N.label,k=H;break}}return k},O=U(t,Qe,"f");if("object"==typeof O.video){let P=O.video.facingMode;if(P instanceof Array&&P.length&&(P=P[0]),"object"==typeof P&&(P=P.exact||P.ideal),!(U(t,ti,"f")||t.ifSaveLastUsedCamera&&Me.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")||t.ifSkipCameraInspection||O.video.deviceId)){const N=S(),k=Me.findBestCamera(t._arrCameras,P,{getMainCameraInIOS:t.selectIOSRearMainCameraAsDefault});k&&k!=N?.deviceId&&(T.getTracks().forEach(W=>{W.stop()}),C.video.deviceId={exact:k},T=yield U(t,Se,"m",xs).call(t,C),U(t,Se,"m",jt).call(t))}}const x=S();x?.deviceId&&(Ve(t,ti,x&&x.deviceId,"f"),t.ifSaveLastUsedCamera&&Me.isStorageAvailable&&(window.localStorage.setItem("dce_last_camera_id",U(t,ti,"f")),"object"==typeof C.video&&C.video.width&&C.video.height&&(window.localStorage.setItem("dce_last_apply_width",JSON.stringify(C.video.width)),window.localStorage.setItem("dce_last_apply_height",JSON.stringify(C.video.height))))),U(t,ke,"f")&&(yield Me.playVideo(U(t,ke,"f"),T,t.cameraOpenTimeout),U(t,Se,"m",jt).call(t)),t._mediaStream=T;const L=T.getVideoTracks();L?.length&&Ve(t,Ye,L[0],"f"),Ve(t,Mt,x,"f")}}catch(C){throw U(t,Se,"m",Or).call(t),Ve(t,It,null,"f"),C}Ve(t,It,"fulfilled","f")})(),"f")});return function(){return p.apply(this,arguments)}}(),kn=function(){var p=te(function*(){var t;if("closed"===this.state||this.videoSrc)return;const r=null===(t=U(this,Mt,"f"))||void 0===t?void 0:t.deviceId,f=this.getResolution();yield U(this,Se,"m",tn).call(this);const C=this.getResolution();r&&r!==U(this,Mt,"f").deviceId&&U(this,dt,"f").fire("camera:changed",[U(this,Mt,"f").deviceId,r],{target:this,async:!0}),f.width==C.width&&f.height==C.height||U(this,dt,"f").fire("resolution:changed",[{width:C.width,height:C.height},{width:f.width,height:f.height}],{target:this,async:!0}),U(this,dt,"f").fire("played",null,{target:this,async:!0})});return function(){return p.apply(this,arguments)}}(),Or=function(){U(this,Se,"m",As).call(this),Ve(this,Mt,null,"f"),U(this,ke,"f")&&(U(this,ke,"f").srcObject=null,this.videoSrc&&(U(this,ke,"f").pause(),U(this,ke,"f").currentTime=0)),Ve(this,Ht,!0,"f");try{this.resetSoftwareScale()}catch{}},xt=function(){var p=te(function*(r,f){const C=X=>{if(!U(this,Ye,"f")||!this.isVideoPlaying||X.focusTaskId!=this._focusParameters.curFocusTaskId){U(this,Ye,"f")&&this.isVideoPlaying||(this._focusParameters.isDoingFocus=0);const q=new Error(`Focus task ${X.focusTaskId} canceled.`);throw q.name="DeprecatedTaskError",q}1===this._focusParameters.isDoingFocus&&Date.now()-X.timeStart>this._focusParameters.focusCancelableTime&&(this._focusParameters.isDoingFocus=-1)};let T;f=Et(f,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),yield U(this,Ye,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:f}]}),C(r),T=null==this._focusParameters.oldDistance?this._focusParameters.kTimeout*Math.max(Math.abs(1/this._focusParameters.fds.min-1/f),Math.abs(1/this._focusParameters.fds.max-1/f))+this._focusParameters.minTimeout:this._focusParameters.kTimeout*Math.abs(1/this._focusParameters.oldDistance-1/f)+this._focusParameters.minTimeout,this._focusParameters.oldDistance=f,yield new Promise(X=>{setTimeout(X,T)}),C(r);let S=r.focusL-r.focusW/2,O=r.focusT-r.focusH/2,x=r.focusW,L=r.focusH;const P=this.getResolution();if(S>=P.width||O>=P.height)throw new Error("Invalid area.");S+x>P.width&&(x=P.width-S),O+L>P.height&&(L=P.height-O),S=Math.round(S),O=Math.round(O),x=Math.round(x),L=Math.round(L);const N=4*P.width*P.height*this._focusParameters.defaultTempBufferContainerLenRatio,k=4*x*L;let W=this._focusParameters.tempBufferContainer;if(W){const X=W.length;N>X&&N>=k?W=new Uint8Array(N):k>X&&k>=N&&(W=new Uint8Array(k))}else W=this._focusParameters.tempBufferContainer=new Uint8Array(Math.max(N,k));if(!this.imageDataGetter.getImageData(U(this,ke,"f"),P.width,P.height,{sx:S,sy:O,sWidth:x,sHeight:L,dWidth:x,dHeight:L},{pixelFormat:We.RGBA,bufferContainer:W}))return U(this,Se,"m",t).call(this,r,f);const H=W;let Z=0;for(let X=0,q=k-8;X<q;++X){let ie=H[X]-H[X+8];++X;let J=H[X]-H[X+8];++X;let Ee=H[X]-H[X+8];++X,Z+=ie*ie+J*J+Ee*Ee}return-Z});function t(r,f){return p.apply(this,arguments)}return t}(),nn=function(){var p=te(function*(r,f,C,T,S,O,x){let L;if(f=Et(f,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),T=Et(T,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),O?O=Et(O,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max):(O=Et(Math.sqrt((f||this._focusParameters.fds.step)*(T||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),x=yield U(this,Se,"m",xt).call(this,r,O)),x<=C&&x<=S?L=3:C<S&&C<x?L=1:S<C&&S<x&&(L=2),(T-f)/2<=this._focusParameters.fds.step)return 3===L||(1===L?yield U(this,Ye,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:f}]}):2===L&&(yield U(this,Ye,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:T}]}))),!0;if(1===L)return yield U(this,Se,"m",t).call(this,r,f,C,O,x);if(2===L)return yield U(this,Se,"m",t).call(this,r,O,x,T,S);if(3!==L)return C=yield U(this,Se,"m",xt).call(this,r,f),S=yield U(this,Se,"m",xt).call(this,r,T),yield U(this,Se,"m",t).call(this,r,f,C,T,S);let P=Et(Math.sqrt((f||this._focusParameters.fds.step)*(O||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),N=Et(Math.sqrt((T||this._focusParameters.fds.step)*(O||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max);if(Math.abs(1/this._focusParameters.oldDistance-1/P)<=Math.abs(1/this._focusParameters.oldDistance-1/N)){let k=yield U(this,Se,"m",xt).call(this,r,P);if(k<x)return yield U(this,Se,"m",t).call(this,r,f,C,O,x,P,k);if(k==x)return yield U(this,Se,"m",t).call(this,r,P,k,O,x);let W=yield U(this,Se,"m",xt).call(this,r,N);if(k>x&&x<W)return yield U(this,Se,"m",t).call(this,r,P,k,N,W,O,x);if(x==W)return yield U(this,Se,"m",t).call(this,r,O,x,N,W);if(x>W)return yield U(this,Se,"m",t).call(this,r,O,x,T,S,N,W)}else{let k=yield U(this,Se,"m",xt).call(this,r,N);if(x>k)return yield U(this,Se,"m",t).call(this,r,O,x,T,S,N,k);if(x==k)return yield U(this,Se,"m",t).call(this,r,O,x,N,k);let W=yield U(this,Se,"m",xt).call(this,r,P);if(W>x&&x<k)return yield U(this,Se,"m",t).call(this,r,P,W,N,k,O,x);if(W==x)return yield U(this,Se,"m",t).call(this,r,P,W,O,x);if(W<x)return yield U(this,Se,"m",t).call(this,r,f,C,O,x,P,W)}return!1});function t(r,f,C,T,S,O,x){return p.apply(this,arguments)}return t}(),Os=function(){var p=te(function*(t,r,f,C,T){var O,S=this;if(1==this._focusParameters.isDoingFocus)return!1;if(!t||"string"!=typeof t.x||"string"!=typeof t.y)throw new Error("Invalid 'centerPoint'.");if(!r||"string"!=typeof r)throw new Error("Invalid 'width'.");if(!f||"string"!=typeof f)throw new Error("Invalid 'height'.");const x=this.getResolution();let L=0,P=0;if(t.x.endsWith("px"))L=parseFloat(t.x);else{if(!t.x.endsWith("%"))throw new Error("Invalid 'centerPoint'.");L=parseFloat(t.x)/100*x.width}if(t.y.endsWith("px"))P=parseFloat(t.y);else{if(!t.y.endsWith("%"))throw new Error("Invalid 'centerPoint'.");P=parseFloat(t.y)/100*x.height}if(isNaN(L)||isNaN(P)||L<0||L>x.width||P<0||P>x.height)throw new Error("Invalid 'centerPoint'.");let N=0;if(r.endsWith("px"))N=parseFloat(r);else{if(!r.endsWith("%"))throw new Error("Invalid 'width'.");N=parseFloat(r)/100*x.width}if(isNaN(N)||N<0)throw new Error("Invalid 'width'.");let k=0;if(f.endsWith("px"))k=parseFloat(f);else{if(!f.endsWith("%"))throw new Error("Invalid 'height'.");k=parseFloat(f)/100*x.height}if(isNaN(k)||k<0)throw new Error("Invalid 'height'.");if(1!==U(this,ni,"f")){const Z=U(this,ni,"f"),X=U(this,ri,"f");N/=Z,k/=Z,L=(1-1/Z)*X.x+L/Z,P=(1-1/Z)*X.y+P/Z}if(!this._focusSupported)throw new Error("Manual focus unsupported.");if(!this._focusParameters.fds&&(this._focusParameters.fds=null===(O=this.getCameraCapabilities())||void 0===O?void 0:O.focusDistance,!this._focusParameters.fds))throw this._focusSupported=!1,new Error("Manual focus unsupported.");null==this._focusParameters.kTimeout&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),this._focusParameters.isDoingFocus=1;const W={focusL:L,focusT:P,focusW:N,focusH:k,focusTaskId:++this._focusParameters.curFocusTaskId,timeStart:Date.now()},H=function(){var Z=te(function*(X,q,ie){try{(null==q||q<S._focusParameters.fds.min)&&(q=S._focusParameters.fds.min),(null==ie||ie>S._focusParameters.fds.max)&&(ie=S._focusParameters.fds.max),S._focusParameters.oldDistance=null;let J=Et(Math.sqrt(ie*(q||S._focusParameters.fds.step)),S._focusParameters.fds.min,S._focusParameters.fds.step,S._focusParameters.fds.max),Ee=Et(Math.sqrt((q||S._focusParameters.fds.step)*J),S._focusParameters.fds.min,S._focusParameters.fds.step,S._focusParameters.fds.max),_e=Et(Math.sqrt(J*ie),S._focusParameters.fds.min,S._focusParameters.fds.step,S._focusParameters.fds.max),xe=yield U(S,Se,"m",xt).call(S,X,_e),Ie=yield U(S,Se,"m",xt).call(S,X,Ee),b=yield U(S,Se,"m",xt).call(S,X,J);if(Ie>b&&b<xe){const me=yield U(S,Se,"m",nn).call(S,X,Ee,Ie,_e,xe,J,b);return S._focusParameters.isDoingFocus=0,me}if(Ie<b&&Ie<xe){let me=yield U(S,Se,"m",xt).call(S,X,q);const Re=yield U(S,Se,"m",nn).call(S,X,q,me,J,b,Ee,Ie);return S._focusParameters.isDoingFocus=0,Re}if(b>xe&&Ie>xe){let me=yield U(S,Se,"m",xt).call(S,X,ie);const Re=yield U(S,Se,"m",nn).call(S,X,J,b,ie,me,_e,xe);return S._focusParameters.isDoingFocus=0,Re}if(Ie==b&&b<xe){const me=yield U(S,Se,"m",nn).call(S,X,Ee,Ie,J,b);return S._focusParameters.isDoingFocus=0,me}if(b==xe&&Ie>b){const me=yield U(S,Se,"m",nn).call(S,X,J,b,_e,xe);return S._focusParameters.isDoingFocus=0,me}return H(X,q,ie)}catch(J){if("DeprecatedTaskError"!==J.name)throw J}});return function(q,ie,J){return Z.apply(this,arguments)}}();return H(W,C,T)});return function(r,f,C,T,S){return p.apply(this,arguments)}}(),Rs=function(p){if("opened"!==this.state)throw new Error("Video is not playing.");if(!p||"string"!=typeof p.x||"string"!=typeof p.y)throw new Error("Invalid 'center'.");const t=this.getResolution();let r=0,f=0;if(p.x.endsWith("px"))r=parseFloat(p.x);else{if(!p.x.endsWith("%"))throw new Error("Invalid scale center.");r=parseFloat(p.x)/100*t.width}if(p.y.endsWith("px"))f=parseFloat(p.y);else{if(!p.y.endsWith("%"))throw new Error("Invalid scale center.");f=parseFloat(p.y)/100*t.height}if(isNaN(r)||isNaN(f))throw new Error("Invalid scale center.");Ve(this,ri,{x:r,y:f},"f")},qo=function(p){if("opened"!==this.state)throw new Error("Video is not playing.");const t=this.getResolution();return p&&p.x==t.width/2&&p.y==t.height/2},Me.browserInfo=ht,Me.onWarning=null===(bs=window?.console)||void 0===bs?void 0:bs.warn;class ai{constructor(t){Nn.add(this),Rr.set(this,void 0),rn.set(this,0),Mi.set(this,void 0),Dr.set(this,0),sn.set(this,!1),Te(this,Rr,t,"f")}startCharging(){R(this,sn,"f")||(ai._onLog&&ai._onLog("start charging."),R(this,Nn,"m",Jo).call(this),Te(this,sn,!0,"f"))}stopCharging(){R(this,Mi,"f")&&clearTimeout(R(this,Mi,"f")),R(this,sn,"f")&&(ai._onLog&&ai._onLog("stop charging."),Te(this,rn,Date.now()-R(this,Dr,"f"),"f"),Te(this,sn,!1,"f"))}}Rr=new WeakMap,rn=new WeakMap,Mi=new WeakMap,Dr=new WeakMap,sn=new WeakMap,Nn=new WeakSet,Ko=function(){at.cfd(1),ai._onLog&&ai._onLog("charge 1.")},Jo=function p(){0==R(this,rn,"f")&&R(this,Nn,"m",Ko).call(this),Te(this,Dr,Date.now(),"f"),R(this,Mi,"f")&&clearTimeout(R(this,Mi,"f")),Te(this,Mi,setTimeout(()=>{Te(this,rn,0,"f"),R(this,Nn,"m",p).call(this)},R(this,Rr,"f")-R(this,rn,"f")),"f")};const ea=new Map([[De.IPF_GRAYSCALED,We.GREY],[De.IPF_ABGR_8888,We.RGBA],[De.IPF_ARGB_8888,We.BGRA]]),ta=new Map([[We.GREY,De.IPF_GRAYSCALED],[We.RGBA,De.IPF_ABGR_8888],[We.BGRA,De.IPF_ARGB_8888]]),ks="function"==typeof BigInt?{BF_NULL:BigInt(0),BF_ALL:BigInt(0x10000000000000000),BF_DEFAULT:BigInt(4265345023),BF_ONED:BigInt(3147775),BF_GS1_DATABAR:BigInt(260096),BF_CODE_39:BigInt(1),BF_CODE_128:BigInt(2),BF_CODE_93:BigInt(4),BF_CODABAR:BigInt(8),BF_ITF:BigInt(16),BF_EAN_13:BigInt(32),BF_EAN_8:BigInt(64),BF_UPC_A:BigInt(128),BF_UPC_E:BigInt(256),BF_INDUSTRIAL_25:BigInt(512),BF_CODE_39_EXTENDED:BigInt(1024),BF_GS1_DATABAR_OMNIDIRECTIONAL:BigInt(2048),BF_GS1_DATABAR_TRUNCATED:BigInt(4096),BF_GS1_DATABAR_STACKED:BigInt(8192),BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:BigInt(16384),BF_GS1_DATABAR_EXPANDED:BigInt(32768),BF_GS1_DATABAR_EXPANDED_STACKED:BigInt(65536),BF_GS1_DATABAR_LIMITED:BigInt(131072),BF_PATCHCODE:BigInt(262144),BF_CODE_32:BigInt(16777216),BF_PDF417:BigInt(33554432),BF_QR_CODE:BigInt(67108864),BF_DATAMATRIX:BigInt(134217728),BF_AZTEC:BigInt(268435456),BF_MAXICODE:BigInt(536870912),BF_MICRO_QR:BigInt(1073741824),BF_MICRO_PDF417:BigInt(524288),BF_GS1_COMPOSITE:BigInt(2147483648),BF_MSI_CODE:BigInt(1048576),BF_CODE_11:BigInt(2097152),BF_TWO_DIGIT_ADD_ON:BigInt(4194304),BF_FIVE_DIGIT_ADD_ON:BigInt(8388608),BF_MATRIX_25:BigInt(68719476736),BF_POSTALCODE:BigInt(0x3f0000000000000),BF_NONSTANDARD_BARCODE:BigInt(4294967296),BF_USPSINTELLIGENTMAIL:BigInt(4503599627370496),BF_POSTNET:BigInt(9007199254740992),BF_PLANET:BigInt(0x40000000000000),BF_AUSTRALIANPOST:BigInt(0x80000000000000),BF_RM4SCC:BigInt(72057594037927940),BF_KIX:BigInt(0x200000000000000),BF_DOTCODE:BigInt(8589934592),BF_PHARMACODE_ONE_TRACK:BigInt(17179869184),BF_PHARMACODE_TWO_TRACK:BigInt(34359738368),BF_PHARMACODE:BigInt(51539607552)}:{BF_NULL:"0x00",BF_ALL:"0xFFFFFFFFFFFFFFFF",BF_DEFAULT:"0xFE3BFFFF",BF_ONED:"0x003007FF",BF_GS1_DATABAR:"0x0003F800",BF_CODE_39:"0x1",BF_CODE_128:"0x2",BF_CODE_93:"0x4",BF_CODABAR:"0x8",BF_ITF:"0x10",BF_EAN_13:"0x20",BF_EAN_8:"0x40",BF_UPC_A:"0x80",BF_UPC_E:"0x100",BF_INDUSTRIAL_25:"0x200",BF_CODE_39_EXTENDED:"0x400",BF_GS1_DATABAR_OMNIDIRECTIONAL:"0x800",BF_GS1_DATABAR_TRUNCATED:"0x1000",BF_GS1_DATABAR_STACKED:"0x2000",BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:"0x4000",BF_GS1_DATABAR_EXPANDED:"0x8000",BF_GS1_DATABAR_EXPANDED_STACKED:"0x10000",BF_GS1_DATABAR_LIMITED:"0x20000",BF_PATCHCODE:"0x00040000",BF_CODE_32:"0x01000000",BF_PDF417:"0x02000000",BF_QR_CODE:"0x04000000",BF_DATAMATRIX:"0x08000000",BF_AZTEC:"0x10000000",BF_MAXICODE:"0x20000000",BF_MICRO_QR:"0x40000000",BF_MICRO_PDF417:"0x00080000",BF_GS1_COMPOSITE:"0x80000000",BF_MSI_CODE:"0x100000",BF_CODE_11:"0x200000",BF_TWO_DIGIT_ADD_ON:"0x400000",BF_FIVE_DIGIT_ADD_ON:"0x800000",BF_MATRIX_25:"0x1000000000",BF_POSTALCODE:"0x3F0000000000000",BF_NONSTANDARD_BARCODE:"0x100000000",BF_USPSINTELLIGENTMAIL:"0x10000000000000",BF_POSTNET:"0x20000000000000",BF_PLANET:"0x40000000000000",BF_AUSTRALIANPOST:"0x80000000000000",BF_RM4SCC:"0x100000000000000",BF_KIX:"0x200000000000000",BF_DOTCODE:"0x200000000",BF_PHARMACODE_ONE_TRACK:"0x400000000",BF_PHARMACODE_TWO_TRACK:"0x800000000",BF_PHARMACODE:"0xC00000000"};class Ne extends Dt{static set _onLog(t){Te(Ne,Ds,t,"f",Ls),Me._onLog=t,ai._onLog=t}static get _onLog(){return R(Ne,Ds,"f",Ls)}static detectEnvironment(){return te(function*(){return yield te(function*(){return{wasm:Sa,worker:Ia,getUserMedia:Ro,camera:yield xa(),browser:gt.browser,version:gt.version,OS:gt.OS}})()})()}static testCameraAccess(){return te(function*(){const t=yield Me.testCameraAccess();return t.ok?{ok:!0,message:"Successfully accessed the camera."}:"InsecureContext"===t.errorName?{ok:!1,message:"Insecure context."}:"OverconstrainedError"===t.errorName||"NotFoundError"===t.errorName?{ok:!1,message:"No camera detected."}:"NotAllowedError"===t.errorName?{ok:!1,message:"No permission to access camera."}:"AbortError"===t.errorName?{ok:!1,message:"Some problem occurred which prevented the device from being used."}:"NotReadableError"===t.errorName?{ok:!1,message:"A hardware error occurred."}:"SecurityError"===t.errorName?{ok:!1,message:"User media support is disabled."}:{ok:!1,message:t.errorMessage}})()}static createInstance(t){return te(function*(){var r,f;if(t&&!(t instanceof lt))throw new TypeError("Invalid view.");if(null!==(r=pt.license)&&void 0!==r&&r.LicenseManager){if(null===(f=pt.license)||void 0===f||!f.LicenseManager.bCallInitLicense)throw new Error("License is not set.");yield at.loadWasm(["license"]),yield pt.license.dynamsoft()}const C=new Ne(t);return Ne.onWarning&&(location&&"file:"===location.protocol?setTimeout(()=>{Ne.onWarning&&Ne.onWarning({id:1,message:"The page is opened over file:// and Dynamsoft Camera Enhancer may not work properly. Please open the page via https://."})},0):!1!==window.isSecureContext&&navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||setTimeout(()=>{Ne.onWarning&&Ne.onWarning({id:2,message:"Dynamsoft Camera Enhancer may not work properly in a non-secure context. Please open the page via https://."})},0)),C})()}get video(){return R(this,be,"f").getVideoEl()}set videoSrc(t){if(!R(this,be,"f"))throw new Error("Camera manager is null.");R(this,Ae,"f")&&(R(this,Ae,"f")._hideDefaultSelection=!0),R(this,be,"f").videoSrc=t}get videoSrc(){var t;return null===(t=R(this,be,"f"))||void 0===t?void 0:t.videoSrc}set ifSaveLastUsedCamera(t){if(!R(this,be,"f"))throw new Error("Camera manager is null.");R(this,be,"f").ifSaveLastUsedCamera=t}get ifSaveLastUsedCamera(){var t;return null===(t=R(this,be,"f"))||void 0===t?void 0:t.ifSaveLastUsedCamera}set ifSkipCameraInspection(t){if(!R(this,be,"f"))throw new Error("Camera manager is null.");R(this,be,"f").ifSkipCameraInspection=t}get ifSkipCameraInspection(){var t;return null===(t=R(this,be,"f"))||void 0===t?void 0:t.ifSkipCameraInspection}set cameraOpenTimeout(t){if(!R(this,be,"f"))throw new Error("Camera manager is null.");R(this,be,"f").cameraOpenTimeout=t}get cameraOpenTimeout(){var t;return null===(t=R(this,be,"f"))||void 0===t?void 0:t.cameraOpenTimeout}set singleFrameMode(t){if(!["disabled","image","camera"].includes(t))throw new Error("Invalid value.");if(this.isOpen())throw new Error("It is not allowed to change `singleFrameMode` when the camera is open.");Te(this,Lr,t,"f")}get singleFrameMode(){return R(this,Lr,"f")}get _isFetchingStarted(){return R(this,oi,"f")}get disposed(){return R(this,Ms,"f")}constructor(t){var r;if(super(),r=this,He.add(this),be.set(this,void 0),Ae.set(this,void 0),Bn.set(this,"closed"),si.set(this,void 0),Fi.set(this,!1),Lr.set(this,void 0),this._onCameraSelChange=te(function*(){r.isOpen()&&R(r,Ae,"f")&&!R(r,Ae,"f").disposed&&(yield r.selectCamera(R(r,Ae,"f")._selCam.value))}),this._onResolutionSelChange=te(function*(){if(!r.isOpen()||!R(r,Ae,"f")||R(r,Ae,"f").disposed)return;let f,C;if(R(r,Ae,"f")._selRsl&&-1!=R(r,Ae,"f")._selRsl.selectedIndex){let T=R(r,Ae,"f")._selRsl.options[R(r,Ae,"f")._selRsl.selectedIndex];f=parseInt(T.getAttribute("data-width")),C=parseInt(T.getAttribute("data-height"))}yield r.setResolution({width:f,height:C})}),this._onCloseBtnClick=te(function*(){r.isOpen()&&R(r,Ae,"f")&&!R(r,Ae,"f").disposed&&r.close()}),Mr.set(this,(f,C,T,S)=>{const O=Date.now(),x={sx:S.x,sy:S.y,sWidth:S.width,sHeight:S.height,dWidth:S.width,dHeight:S.height},L=Math.max(x.dWidth,x.dHeight);if(this.canvasSizeLimit&&L>this.canvasSizeLimit){const k=this.canvasSizeLimit/L;x.dWidth>x.dHeight?(x.dWidth=this.canvasSizeLimit,x.dHeight=Math.round(x.dHeight*k)):(x.dWidth=Math.round(x.dWidth*k),x.dHeight=this.canvasSizeLimit)}const P=R(this,be,"f").imageDataGetter.getImageData(f,C,T,x,{pixelFormat:ea.get(this.getPixelFormat())});let N=null;if(P){const k=Date.now();let W;W=P.pixelFormat===We.GREY?P.width:4*P.width;let H=!0;0===x.sx&&0===x.sy&&x.sWidth===C&&x.sHeight===T&&(H=!1),N={bytes:P.data,width:P.width,height:P.height,stride:W,format:ta.get(P.pixelFormat),tag:{imageId:this._imageId==Number.MAX_VALUE?this._imageId=0:++this._imageId,type:ir.ITT_FILE_IMAGE,isCropped:H,cropRegion:{left:S.x,top:S.y,right:S.x+S.width,bottom:S.y+S.height,isMeasuredInPercentage:!1},originalWidth:C,originalHeight:T,currentWidth:P.width,currentHeight:P.height,timeSpent:k-O,timeStamp:k},toCanvas:R(this,Fr,"f"),isDCEFrame:!0}}return N}),this._onSingleFrameAcquired=f=>{let C;C=R(this,Ae,"f")?R(this,Ae,"f").getConvertedRegion():cr.convert(R(this,Pi,"f"),f.width,f.height),C||(C={x:0,y:0,width:f.width,height:f.height});const T=R(this,Mr,"f").call(this,f,f.width,f.height,C);R(this,si,"f").fire("singleFrameAcquired",[T],{async:!1,copy:!1})},Fr.set(this,function(){if(!(this.bytes instanceof Uint8Array||this.bytes instanceof Uint8ClampedArray))throw new TypeError("Invalid bytes.");if("number"!=typeof this.width||this.width<=0)throw new Error("Invalid width.");if("number"!=typeof this.height||this.height<=0)throw new Error("Invalid height.");const f=document.createElement("canvas");let C;if(f.width=this.width,f.height=this.height,this.format===De.IPF_GRAYSCALED){C=new Uint8ClampedArray(this.width*this.height*4);for(let T=0;T<C.length;T+=4)C[T]=this.bytes[T/4],C[T+1]=this.bytes[T/4],C[T+2]=this.bytes[T/4],C[T+3]=255}else C=new Uint8ClampedArray(this.bytes.buffer);return f.getContext("2d").putImageData(new ImageData(C,this.width,this.height),0,0),f}),Un.set(this,void 0),Pi.set(this,void 0),Pr.set(this,De.IPF_ABGR_8888),oi.set(this,!1),this._imageId=-1,At.set(this,void 0),this.fetchInterval=0,$e.set(this,{enhancedFocus:!1,autoZoom:!1,tapToFocus:!1}),ye.set(this,{minValue:1,maxValue:999,autoFocusFrameArray:[],autoFocusFrameLimit:[5,3],autoZoomDetectionArea:.5,autoZoomTargetBorder:.9,autoZoomIdealArea:[0,.05],autoZoomInFrameArray:[],autoZoomInFrameLimit:[5,3],autoZoomInMaxTimes:5,autoZoomInMinStep:Math.pow(10,.2),autoZoomInIdealModuleSize:6,autoZoomOutFrameCount:0,autoZoomOutFrameLimit:3,autoZoomOutStepRate:1/3,autoZoomOutStepRate_2:.05,autoZoomOutMinStep:2,frameArrayInIdealZoom:[],frameLimitInIdealZoom:[5,3],nextActionInIdealZoom:"focus",noIntermediateResultsCount:[],enableZoomOutInIdealZoom:!1}),Xt.set(this,void 0),Ms.set(this,!1),this.isCameraEnhancer=!0,t&&!(t instanceof lt))throw new TypeError("Invalid view.");Te(this,si,new Uo,"f"),Te(this,be,new Me,"f"),this._imageDataGetter=R(this,be,"f").imageDataGetter,R(this,be,"f").updateVideoElWhenSoftwareScaled=()=>{if(!this.video)return;const f=R(this,be,"f").getSoftwareScale();if(f<1)throw new RangeError("Invalid scale value.");R(this,Ae,"f")&&!R(this,Ae,"f").disposed?(this.video.style.transform=1===f?"":`scale(${f})`,R(this,Ae,"f")._updateVideoContainer()):this.video.style.transform=1===f?"":`scale(${f})`},["iPhone","iPad","Android","HarmonyOS"].includes(gt.OS)?R(this,be,"f").setResolution(1280,720):R(this,be,"f").setResolution(1920,1080),this.singleFrameMode=navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?"disabled":"image",t&&this.setCameraView(t),this._on("before:camera:change",()=>{R(this,Xt,"f").stopCharging();const f=R(this,Ae,"f");f&&!f.disposed&&(f._startLoading(),f.clearAllInnerDrawingItems())}),this._on("camera:changed",()=>{this.clearBuffer()}),this._on("before:resolution:change",()=>{const f=R(this,Ae,"f");f&&!f.disposed&&(f._startLoading(),f.clearAllInnerDrawingItems())}),this._on("resolution:changed",()=>{this.clearBuffer(),t.eventHandler.fire("content:updated",null,{async:!1})}),this._on("paused",()=>{R(this,Xt,"f").stopCharging(),R(this,Ae,"f")}),this._on("resumed",()=>{R(this,Ae,"f")}),this._on("tapfocus",()=>{R(this,$e,"f").tapToFocus&&R(this,Xt,"f").startCharging()}),this._intermediateResultReceiver={},this._intermediateResultReceiver.onTaskResultsReceived=function(){var f=te(function*(C,T){var S,O,x,L;if(R(r,He,"m",et).call(r)||!r.isOpen()||r.isPaused())return;const P=C.intermediateResultUnits;Ne._onLog&&(Ne._onLog("intermediateResultUnits:"),Ne._onLog(P));let N=!1,k=!1;for(let W of P){if(W.unitType===Ui.IRUT_DECODED_BARCODES&&W.decodedBarcodes.length){N=!0;break}W.unitType===Ui.IRUT_LOCALIZED_BARCODES&&W.localizedBarcodes.length&&(k=!0)}if(Ne._onLog&&(Ne._onLog("hasLocalizedBarcodes:"),Ne._onLog(k)),R(r,$e,"f").autoZoom||R(r,$e,"f").enhancedFocus)if(N)R(r,ye,"f").autoZoomInFrameArray.length=0,R(r,ye,"f").autoZoomOutFrameCount=0,R(r,ye,"f").frameArrayInIdealZoom.length=0,R(r,$e,"f").autoZoom&&R(r,$e,"f").enhancedFocus&&(R(r,ye,"f").nextActionInIdealZoom="focus"),R(r,ye,"f").autoFocusFrameArray.length=0,R(r,ye,"f").noIntermediateResultsCount=0;else{const W=function(){var Z=te(function*(X){yield r.setZoom(X),R(r,$e,"f").autoZoom&&R(r,Xt,"f").startCharging()});return function(q){return Z.apply(this,arguments)}}(),H=function(){var Z=te(function*(X){yield r.setFocus(X),R(r,$e,"f").enhancedFocus&&R(r,Xt,"f").startCharging()});return function(q){return Z.apply(this,arguments)}}();if(k){const Z=P[0].originalImageTag,X=(null===(S=Z.cropRegion)||void 0===S?void 0:S.left)||0,q=(null===(O=Z.cropRegion)||void 0===O?void 0:O.top)||0,ie=null!==(x=Z.cropRegion)&&void 0!==x&&x.right?Z.cropRegion.right-X:Z.originalWidth,J=null!==(L=Z.cropRegion)&&void 0!==L&&L.bottom?Z.cropRegion.bottom-q:Z.originalHeight,Ee=Z.currentWidth,_e=Z.currentHeight;let xe;{let Ie,b,me,Re,je;{const l=r.video.videoWidth*(1-R(r,ye,"f").autoZoomDetectionArea)/2,m=r.video.videoWidth*(1+R(r,ye,"f").autoZoomDetectionArea)/2,i=m,o=l,d=r.video.videoHeight*(1-R(r,ye,"f").autoZoomDetectionArea)/2,y=d,_=r.video.videoHeight*(1+R(r,ye,"f").autoZoomDetectionArea)/2;je=[{x:l,y:d},{x:m,y},{x:i,y:_},{x:o,y:_}]}Ne._onLog&&(Ne._onLog("detectionArea:"),Ne._onLog(je));const u=[];{const l=(m,i)=>{const o=(y,_)=>{if(!y&&!_)throw new Error("Invalid arguments.");return function(v,w,I){let A=!1;const M=v.length;if(M<=2)return!1;for(let D=0;D<M;D++){const F=v[D],B=v[(D+1)%M];if(Ra(F,B,{x:w,y:I}))return!0;ds(F.y-I)>0!=ds(B.y-I)>0&&ds(w-(I-F.y)*(F.x-B.x)/(F.y-B.y)-F.x)<0&&(A=!A)}return A}(_,y.x,y.y)},d=(y,_)=>!!(dr([y[0],y[1]],[y[2],y[3]],[_[0].x,_[0].y],[_[1].x,_[1].y])||dr([y[0],y[1]],[y[2],y[3]],[_[1].x,_[1].y],[_[2].x,_[2].y])||dr([y[0],y[1]],[y[2],y[3]],[_[2].x,_[2].y],[_[3].x,_[3].y])||dr([y[0],y[1]],[y[2],y[3]],[_[3].x,_[3].y],[_[0].x,_[0].y]));return!!(o({x:m[0].x,y:m[0].y},i)||o({x:m[1].x,y:m[1].y},i)||o({x:m[2].x,y:m[2].y},i)||o({x:m[3].x,y:m[3].y},i))||!!(o({x:i[0].x,y:i[0].y},m)||o({x:i[1].x,y:i[1].y},m)||o({x:i[2].x,y:i[2].y},m)||o({x:i[3].x,y:i[3].y},m))||!!(d([i[0].x,i[0].y,i[1].x,i[1].y],m)||d([i[1].x,i[1].y,i[2].x,i[2].y],m)||d([i[2].x,i[2].y,i[3].x,i[3].y],m)||d([i[3].x,i[3].y,i[0].x,i[0].y],m))};for(let m of P)if(m.unitType===Ui.IRUT_LOCALIZED_BARCODES)for(let i of m.localizedBarcodes){if(!i)continue;const o=i.location.points;o.forEach(d=>{lt._transformCoordinates(d,X,q,ie,J,Ee,_e)}),l(je,o)&&u.push(i)}if(Ne._debug&&R(r,Ae,"f")){const m=r.__layer||(r.__layer=R(r,Ae,"f")._createDrawingLayer(99));m.clearDrawingItems();const i=r.__styleId2||(r.__styleId2=de.createDrawingStyle({strokeStyle:"red"}));for(let o of P)if(o.unitType===Ui.IRUT_LOCALIZED_BARCODES)for(let d of o.localizedBarcodes){if(!d)continue;const _=new _s({points:d.location.points},i);m.addDrawingItems([_])}}}if(Ne._onLog&&(Ne._onLog("intersectedResults:"),Ne._onLog(u)),!u.length)return;let a;if(u.length){let l=u.filter(m=>m.possibleFormats==ks.BF_QR_CODE||m.possibleFormats==ks.BF_DATAMATRIX);if(l.length||(l=u.filter(m=>m.possibleFormats==ks.BF_ONED),l.length||(l=u)),l.length){const m=o=>{const d=o.location.points,y=(d[0].x+d[1].x+d[2].x+d[3].x)/4,_=(d[0].y+d[1].y+d[2].y+d[3].y)/4;return(y-Ee/2)*(y-Ee/2)+(_-_e/2)*(_-_e/2)};a=l[0];let i=m(a);if(1!=l.length)for(let o=1;o<l.length;o++){const d=m(l[o]);(l[o].confidence>1.1*a.confidence||l[o].confidence>.9*a.confidence&&d<i)&&(a=l[o],i=d)}}}if(Ne._onLog&&(Ne._onLog("highPriorityResult:"),Ne._onLog(a)),a){const l=a.location.points;Ie=Math.min(l[0].x,l[1].x,l[2].x,l[3].x),b=Math.max(l[0].x,l[1].x,l[2].x,l[3].x),me=Math.min(l[0].y,l[1].y,l[2].y,l[3].y),Re=Math.max(l[0].y,l[1].y,l[2].y,l[3].y),xe={points:[{x:Ie,y:me},{x:b,y:me},{x:b,y:Re},{x:Ie,y:Re}],result:a}}}if(Ne._onLog&&(Ne._onLog("boundingRect:"),Ne._onLog(xe)),!xe)return;if(Ne._debug&&R(r,Ae,"f")&&xe?.points){const Ie=r.__layer||(r.__layer=R(r,Ae,"f")._createDrawingLayer(99)),b=r.__styleId1||(r.__styleId1=de.createDrawingStyle({strokeStyle:"blue"})),me=new _s({points:xe.points},b);Ie.addDrawingItems([me])}if(R(r,ye,"f").autoZoomOutFrameCount=0,R(r,ye,"f").noIntermediateResultsCount=0,R(r,$e,"f").autoZoom){const Ie=R(r,ye,"f").autoZoomIdealArea[1];let b=(1-R(r,ye,"f").autoZoomTargetBorder)/2;const me=xe.points[0].x/ie,Re=(ie-xe.points[2].x)/ie,je=xe.points[0].y/J,u=(J-xe.points[2].y)/J;if(me>Ie&&Re>Ie&&je>Ie&&u>Ie&&xe.result.moduleSize<R(r,ye,"f").autoZoomInIdealModuleSize){if(R(r,ye,"f").autoZoomInFrameArray.push(!0),R(r,ye,"f").autoZoomInFrameArray.splice(0,R(r,ye,"f").autoZoomInFrameArray.length-R(r,ye,"f").autoZoomInFrameLimit[0]),R(r,ye,"f").frameArrayInIdealZoom.length=0,R(r,$e,"f").enhancedFocus&&(R(r,ye,"f").nextActionInIdealZoom="focus",H({mode:"continuous"}).catch(()=>{})),R(r,ye,"f").autoZoomInFrameArray.filter(a=>!0===a).length>=R(r,ye,"f").autoZoomInFrameLimit[1]){R(r,ye,"f").autoZoomInFrameArray.length=0;const a=[(.5-b)/(.5-me),(.5-b)/(.5-Re),(.5-b)/(.5-je),(.5-b)/(.5-u)].filter(d=>d>0),l=Math.min(...a,R(r,ye,"f").autoZoomInIdealModuleSize/xe.result.moduleSize),m=r.getZoomSettings().factor;let i=Math.max(Math.pow(m*l,1/R(r,ye,"f").autoZoomInMaxTimes),R(r,ye,"f").autoZoomInMinStep);i=Math.min(i,l);let o=m*i;o=Math.max(R(r,ye,"f").minValue,o),o=Math.min(R(r,ye,"f").maxValue,o);try{yield W({factor:o})}catch(d){console.warn(d.message||d)}r.clearBuffer()}}else if(R(r,ye,"f").autoZoomInFrameArray.length=0,R(r,ye,"f").frameArrayInIdealZoom.push(!0),R(r,ye,"f").frameArrayInIdealZoom.splice(0,R(r,ye,"f").frameArrayInIdealZoom.length-R(r,ye,"f").frameLimitInIdealZoom[0]),R(r,ye,"f").frameArrayInIdealZoom.filter(a=>!0===a).length>=R(r,ye,"f").frameLimitInIdealZoom[1])if(R(r,ye,"f").frameArrayInIdealZoom.length=0,"focus"===R(r,ye,"f").nextActionInIdealZoom&&R(r,$e,"f").enhancedFocus){const a=xe.points;try{yield H({mode:"manual",area:{centerPoint:{x:(a[0].x+a[2].x)/2+"px",y:(a[0].y+a[2].y)/2+"px"},width:a[2].x-a[0].x+"px",height:a[2].y-a[0].y+"px"}})}catch(l){console.warn(l.message||l)}r.clearBuffer()}else{if("zoomOut"!==R(r,ye,"f").nextActionInIdealZoom&&R(r,$e,"f").enhancedFocus)throw new Error("Invalid action.");if(R(r,ye,"f").enableZoomOutInIdealZoom){b=R(r,ye,"f").autoZoomIdealArea[1]+R(r,ye,"f").autoZoomOutStepRate_2;const a=[(.5-b)/(.5-me),(.5-b)/(.5-Re),(.5-b)/(.5-je),(.5-b)/(.5-u)].filter(m=>m>0);let l=Math.min(...a)*r.getZoomSettings().factor;l=Math.max(R(r,ye,"f").minValue,l),l=Math.min(R(r,ye,"f").maxValue,l);try{yield W({factor:l})}catch(m){console.warn(m.message||m)}r.clearBuffer(),R(r,$e,"f").enhancedFocus&&(R(r,ye,"f").nextActionInIdealZoom="focus",H({mode:"continuous"}).catch(()=>{}))}}}if(!R(r,$e,"f").autoZoom&&R(r,$e,"f").enhancedFocus&&(R(r,ye,"f").autoFocusFrameArray.push(!0),R(r,ye,"f").autoFocusFrameArray.splice(0,R(r,ye,"f").autoFocusFrameArray.length-R(r,ye,"f").autoFocusFrameLimit[0]),R(r,ye,"f").autoFocusFrameArray.filter(Ie=>!0===Ie).length>=R(r,ye,"f").autoFocusFrameLimit[1])){R(r,ye,"f").autoFocusFrameArray.length=0;try{const Ie=xe.points;yield H({mode:"manual",area:{centerPoint:{x:(Ie[0].x+Ie[2].x)/2+"px",y:(Ie[0].y+Ie[2].y)/2+"px"},width:Ie[2].x-Ie[0].x+"px",height:Ie[2].y-Ie[0].y+"px"}})}catch(Ie){console.warn(Ie.message||Ie)}r.clearBuffer()}}else{if(R(r,ye,"f").noIntermediateResultsCount++,R(r,$e,"f").autoZoom){if(R(r,ye,"f").autoZoomInFrameArray.push(!1),R(r,ye,"f").autoZoomInFrameArray.splice(0,R(r,ye,"f").autoZoomInFrameArray.length-R(r,ye,"f").autoZoomInFrameLimit[0]),R(r,ye,"f").autoZoomOutFrameCount++,R(r,ye,"f").frameArrayInIdealZoom.push(!1),R(r,ye,"f").frameArrayInIdealZoom.splice(0,R(r,ye,"f").frameArrayInIdealZoom.length-R(r,ye,"f").frameLimitInIdealZoom[0]),R(r,ye,"f").autoZoomOutFrameCount>=R(r,ye,"f").autoZoomOutFrameLimit){R(r,ye,"f").autoZoomOutFrameCount=0;const Z=r.getZoomSettings().factor;let X=Z-Math.max((Z-1)*R(r,ye,"f").autoZoomOutStepRate,R(r,ye,"f").autoZoomOutMinStep);X=Math.max(R(r,ye,"f").minValue,X),X=Math.min(R(r,ye,"f").maxValue,X);try{yield W({factor:X})}catch(q){console.warn(q.message||q)}r.clearBuffer()}R(r,$e,"f").enhancedFocus&&(R(r,ye,"f").nextActionInIdealZoom="focus",H({mode:"continuous"}).catch(()=>{}))}!R(r,$e,"f").autoZoom&&R(r,$e,"f").enhancedFocus&&(R(r,ye,"f").autoFocusFrameArray.length=0,H({mode:"continuous"}).catch(()=>{}))}}});return function(C,T){return f.apply(this,arguments)}}(),Te(this,Xt,new ai(1e4),"f")}setCameraView(t){if(!(t instanceof lt))throw new TypeError("Invalid view.");if(t.disposed)throw new Error("The camera view has been disposed.");if(this.isOpen())throw new Error("It is not allowed to change camera view when the camera is open.");this.releaseCameraView(),t._singleFrameMode=this.singleFrameMode,t._onSingleFrameAcquired=this._onSingleFrameAcquired,this.videoSrc&&(R(this,Ae,"f")._hideDefaultSelection=!0),R(this,He,"m",et).call(this)||R(this,be,"f").setVideoEl(t.getVideoElement()),Te(this,Ae,t,"f"),this.addListenerToView()}getCameraView(){return R(this,Ae,"f")}releaseCameraView(){R(this,Ae,"f")&&(this.removeListenerFromView(),R(this,Ae,"f").disposed||(R(this,Ae,"f")._singleFrameMode="disabled",R(this,Ae,"f")._onSingleFrameAcquired=null,R(this,Ae,"f")._hideDefaultSelection=!1),R(this,be,"f").releaseVideoEl(),Te(this,Ae,null,"f"))}addListenerToView(){if(!R(this,Ae,"f"))return;if(R(this,Ae,"f").disposed)throw new Error("'cameraView' has been disposed.");const t=R(this,Ae,"f");R(this,He,"m",et).call(this)||this.videoSrc||(t._innerComponent&&(R(this,be,"f").tapFocusEventBoundEl=t._innerComponent),t._selCam&&t._selCam.addEventListener("change",this._onCameraSelChange),t._selRsl&&t._selRsl.addEventListener("change",this._onResolutionSelChange)),t._btnClose&&t._btnClose.addEventListener("click",this._onCloseBtnClick)}removeListenerFromView(){if(!R(this,Ae,"f")||R(this,Ae,"f").disposed)return;const t=R(this,Ae,"f");R(this,be,"f").tapFocusEventBoundEl=null,t._selCam&&t._selCam.removeEventListener("change",this._onCameraSelChange),t._selRsl&&t._selRsl.removeEventListener("change",this._onResolutionSelChange),t._btnClose&&t._btnClose.removeEventListener("click",this._onCloseBtnClick)}getCameraState(){return R(this,He,"m",et).call(this)?R(this,Bn,"f"):new Map([["closed","closed"],["opening","opening"],["opened","open"]]).get(R(this,be,"f").state)}isOpen(){return"open"===this.getCameraState()}getVideoEl(){return this.video}open(){var t=this;return te(function*(){const r=R(t,Ae,"f");if(r?.disposed)throw new Error("'cameraView' has been disposed.");r&&(r._singleFrameMode=t.singleFrameMode,R(t,He,"m",et).call(t)?r._clickIptSingleFrameMode():(R(t,be,"f").setVideoEl(r.getVideoElement()),r._startLoading()));let f={width:0,height:0,deviceId:""};if(!R(t,He,"m",et).call(t)){try{yield R(t,be,"f").open()}catch(T){throw r&&r._stopLoading(),T}R(t,Fi,"f")&&t.turnOnTorch().catch(()=>{});const C=t.getResolution();f.width=C.width,f.height=C.height,f.deviceId=t.getSelectedCamera().deviceId}return Te(t,Bn,"open","f"),r&&(r._innerComponent.style.display="",R(t,He,"m",et).call(t)||(r._stopLoading(),r._renderCamerasInfo(t.getSelectedCamera(),R(t,be,"f")._arrCameras),r._renderResolutionInfo({width:f.width,height:f.height}),r.eventHandler.fire("content:updated",null,{async:!0}),r.eventHandler.fire("videoEl:resized",null,{async:!0}))),R(t,si,"f").fire("opened",null,{target:t,async:!0}),f})()}close(){const t=R(this,Ae,"f");if(t?.disposed)throw new Error("'cameraView' has been disposed.");this.stopFetching(),this.clearBuffer(),R(this,He,"m",et).call(this)||R(this,be,"f").close(),Te(this,Bn,"closed","f"),R(this,Xt,"f").stopCharging(),t&&(t._innerComponent.style.display="none",R(this,He,"m",et).call(this)&&t._innerComponent.removeElement("content"),t._stopLoading()),R(this,si,"f").fire("closed",null,{target:this,async:!0})}pause(){if(R(this,He,"m",et).call(this))throw new Error("'pause()' is invalid in 'singleFrameMode'.");R(this,be,"f").pause()}isPaused(){var t;return!R(this,He,"m",et).call(this)&&!0===(null===(t=this.video)||void 0===t?void 0:t.paused)}resume(){var t=this;return te(function*(){if(R(t,He,"m",et).call(t))throw new Error("'resume()' is invalid in 'singleFrameMode'.");yield R(t,be,"f").resume()})()}selectCamera(t){var r=this;return te(function*(){if(!t)throw new Error("Invalid value.");let f;f="string"==typeof t?t:t.deviceId,yield R(r,be,"f").setCamera(f),Te(r,Fi,!1,"f");const C=r.getResolution(),T=R(r,Ae,"f");return T&&!T.disposed&&(T._stopLoading(),T._renderCamerasInfo(r.getSelectedCamera(),R(r,be,"f")._arrCameras),T._renderResolutionInfo({width:C.width,height:C.height})),{width:C.width,height:C.height,deviceId:r.getSelectedCamera().deviceId}})()}getSelectedCamera(){return R(this,be,"f").getCamera()}getAllCameras(){var t=this;return te(function*(){return R(t,be,"f").getCameras()})()}setResolution(t){var r=this;return te(function*(){yield R(r,be,"f").setResolution(t.width,t.height),R(r,Fi,"f")&&r.turnOnTorch().catch(()=>{});const f=r.getResolution(),C=R(r,Ae,"f");return C&&!C.disposed&&(C._stopLoading(),C._renderResolutionInfo({width:f.width,height:f.height})),{width:f.width,height:f.height,deviceId:r.getSelectedCamera().deviceId}})()}getResolution(){return R(this,be,"f").getResolution()}getAvailableResolutions(){var t;return null===(t=R(this,be,"f"))||void 0===t?void 0:t.getResolutions()}_on(t,r){["opened","closed","singleframeacquired","frameaddedtobuffer"].includes(t.toLowerCase())?R(this,si,"f").on(t,r):R(this,be,"f").on(t,r)}_off(t,r){["opened","closed","singleframeacquired","frameaddedtobuffer"].includes(t.toLowerCase())?R(this,si,"f").off(t,r):R(this,be,"f").off(t,r)}on(t,r){const f=t.toLowerCase(),C=new Map([["cameraopen","opened"],["cameraclose","closed"],["camerachange","camera:changed"],["resolutionchange","resolution:changed"],["played","played"],["singleframeacquired","singleFrameAcquired"],["frameaddedtobuffer","frameAddedToBuffer"]]).get(f);if(!C)throw new Error("Invalid event.");this._on(C,r)}off(t,r){const f=t.toLowerCase(),C=new Map([["cameraopen","opened"],["cameraclose","closed"],["camerachange","camera:changed"],["resolutionchange","resolution:changed"],["played","played"],["singleframeacquired","singleFrameAcquired"],["frameaddedtobuffer","frameAddedToBuffer"]]).get(f);if(!C)throw new Error("Invalid event.");this._off(C,r)}getVideoSettings(){var t;return null===(t=R(this,be,"f"))||void 0===t?void 0:t.getMediaStreamConstraints()}updateVideoSettings(t){var r=this;return te(function*(){var f;yield null===(f=R(r,be,"f"))||void 0===f?void 0:f.setMediaStreamConstraints(t,!0)})()}getCapabilities(){var t;return null===(t=R(this,be,"f"))||void 0===t?void 0:t.getCameraCapabilities()}getCameraSettings(){return R(this,be,"f").getCameraSettings()}turnOnTorch(){var t=this;return te(function*(){var r;if(R(t,He,"m",et).call(t))throw new Error("'turnOnTorch()' is invalid in 'singleFrameMode'.");yield null===(r=R(t,be,"f"))||void 0===r?void 0:r.turnOnTorch(),Te(t,Fi,!0,"f")})()}turnOffTorch(){var t=this;return te(function*(){var r;if(R(t,He,"m",et).call(t))throw new Error("'turnOffTorch()' is invalid in 'singleFrameMode'.");yield null===(r=R(t,be,"f"))||void 0===r?void 0:r.turnOffTorch(),Te(t,Fi,!1,"f")})()}setColorTemperature(t){var r=this;return te(function*(){if(R(r,He,"m",et).call(r))throw new Error("'setColorTemperature()' is invalid in 'singleFrameMode'.");yield R(r,be,"f").setColorTemperature(t,!0)})()}getColorTemperature(){return R(this,be,"f").getColorTemperature()}setExposureCompensation(t){var r=this;return te(function*(){var f;if(R(r,He,"m",et).call(r))throw new Error("'setExposureCompensation()' is invalid in 'singleFrameMode'.");yield null===(f=R(r,be,"f"))||void 0===f?void 0:f.setExposureCompensation(t,!0)})()}getExposureCompensation(){var t;return null===(t=R(this,be,"f"))||void 0===t?void 0:t.getExposureCompensation()}_setZoom(t){var r=this;return te(function*(){var f;if(R(r,He,"m",et).call(r))throw new Error("'setZoom()' is invalid in 'singleFrameMode'.");yield null===(f=R(r,be,"f"))||void 0===f?void 0:f.setZoom(t)})()}setZoom(t){var r=this;return te(function*(){yield r._setZoom(t)})()}getZoomSettings(){var t;return null===(t=R(this,be,"f"))||void 0===t?void 0:t.getZoom()}resetZoom(){var t=this;return te(function*(){var r;if(R(t,He,"m",et).call(t))throw new Error("'resetZoom()' is invalid in 'singleFrameMode'.");yield null===(r=R(t,be,"f"))||void 0===r?void 0:r.resetZoom()})()}setFrameRate(t){var r=this;return te(function*(){var f;if(R(r,He,"m",et).call(r))throw new Error("'setFrameRate()' is invalid in 'singleFrameMode'.");yield null===(f=R(r,be,"f"))||void 0===f?void 0:f.setFrameRate(t,!0)})()}getFrameRate(){var t;return null===(t=R(this,be,"f"))||void 0===t?void 0:t.getFrameRate()}setFocus(t){var r=this;return te(function*(){var f;if(R(r,He,"m",et).call(r))throw new Error("'setFocus()' is invalid in 'singleFrameMode'.");yield null===(f=R(r,be,"f"))||void 0===f?void 0:f.setFocus(t,!0)})()}getFocusSettings(){var t;return null===(t=R(this,be,"f"))||void 0===t?void 0:t.getFocus()}setAutoZoomRange(t){R(this,ye,"f").minValue=t.min,R(this,ye,"f").maxValue=t.max}getAutoZoomRange(){return{min:R(this,ye,"f").minValue,max:R(this,ye,"f").maxValue}}enableEnhancedFeatures(t){var r=this;return te(function*(){var f,C;if(null===(C=null===(f=pt.license)||void 0===f?void 0:f.LicenseManager)||void 0===C||!C.bPassValidation)throw new Error("License is not verified, or license is invalid.");if(0!==at.bSupportDce4Module)throw new Error("Please set a license containing the DCE module.");t&fi.EF_ENHANCED_FOCUS&&(R(r,$e,"f").enhancedFocus=!0),t&fi.EF_AUTO_ZOOM&&(R(r,$e,"f").autoZoom=!0),t&fi.EF_TAP_TO_FOCUS&&(R(r,$e,"f").tapToFocus=!0,R(r,be,"f").enableTapToFocus())})()}disableEnhancedFeatures(t){t&fi.EF_ENHANCED_FOCUS&&(R(this,$e,"f").enhancedFocus=!1,this.setFocus({mode:"continuous"}).catch(()=>{})),t&fi.EF_AUTO_ZOOM&&(R(this,$e,"f").autoZoom=!1,this.resetZoom().catch(()=>{})),t&fi.EF_TAP_TO_FOCUS&&(R(this,$e,"f").tapToFocus=!1,R(this,be,"f").disableTapToFocus()),R(this,He,"m",$o).call(this)&&R(this,He,"m",Qo).call(this)||R(this,Xt,"f").stopCharging()}_setScanRegion(t){if(null!=t&&!us(t)&&!Kt(t))throw TypeError("Invalid 'region'.");Te(this,Pi,t?JSON.parse(JSON.stringify(t)):null,"f"),R(this,Ae,"f")&&!R(this,Ae,"f").disposed&&R(this,Ae,"f").setScanRegion(t)}setScanRegion(t){this._setScanRegion(t),R(this,Ae,"f")&&!R(this,Ae,"f").disposed&&(null===t?R(this,Ae,"f").setScanRegionMaskVisible(!1):R(this,Ae,"f").setScanRegionMaskVisible(!0))}getScanRegion(){return JSON.parse(JSON.stringify(R(this,Pi,"f")))}setErrorListener(t){if(!t)throw new TypeError("Invalid 'listener'");Te(this,Un,t,"f")}hasNextImageToFetch(){return!("open"!==this.getCameraState()||!R(this,be,"f").isVideoLoaded()||R(this,He,"m",et).call(this))}startFetching(){if(R(this,He,"m",et).call(this))throw Error("'startFetching()' is unavailable in 'singleFrameMode'.");R(this,oi,"f")||(Te(this,oi,!0,"f"),R(this,He,"m",Fs).call(this))}stopFetching(){R(this,oi,"f")&&(Ne._onLog&&Ne._onLog("DCE: stop fetching loop: "+Date.now()),R(this,At,"f")&&clearTimeout(R(this,At,"f")),Te(this,oi,!1,"f"))}fetchImage(){if(R(this,He,"m",et).call(this))throw new Error("'fetchImage()' is unavailable in 'singleFrameMode'.");if(!this.video)throw new Error("The video element does not exist.");if(4!==this.video.readyState)throw new Error("The video is not loaded.");const t=this.getResolution();if(!t?.width||!t?.height)throw new Error("The video is not loaded.");let r;if(r=cr.convert(R(this,Pi,"f"),t.width,t.height),r||(r={x:0,y:0,width:t.width,height:t.height}),r.x>t.width||r.y>t.height)throw new Error("Invalid scan region.");r.x+r.width>t.width&&(r.width=t.width-r.x),r.y+r.height>t.height&&(r.height=t.height-r.y);const f={sx:r.x,sy:r.y,sWidth:r.width,sHeight:r.height,dWidth:r.width,dHeight:r.height},C=Math.max(f.dWidth,f.dHeight);if(this.canvasSizeLimit&&C>this.canvasSizeLimit){const x=this.canvasSizeLimit/C;f.dWidth>f.dHeight?(f.dWidth=this.canvasSizeLimit,f.dHeight=Math.round(f.dHeight*x)):(f.dWidth=Math.round(f.dWidth*x),f.dHeight=this.canvasSizeLimit)}const T=R(this,be,"f").getFrameData({position:f,pixelFormat:ea.get(this.getPixelFormat())});if(!T)return null;let S;S=T.pixelFormat===We.GREY?T.width:4*T.width;let O=!0;return 0===f.sx&&0===f.sy&&f.sWidth===t.width&&f.sHeight===t.height&&(O=!1),{bytes:T.data,width:T.width,height:T.height,stride:S,format:ta.get(T.pixelFormat),tag:{imageId:this._imageId==Number.MAX_VALUE?this._imageId=0:++this._imageId,type:ir.ITT_VIDEO_FRAME,isCropped:O,cropRegion:{left:r.x,top:r.y,right:r.x+r.width,bottom:r.y+r.height,isMeasuredInPercentage:!1},originalWidth:t.width,originalHeight:t.height,currentWidth:T.width,currentHeight:T.height,timeSpent:T.timeSpent,timeStamp:T.timeStamp},toCanvas:R(this,Fr,"f"),isDCEFrame:!0}}setImageFetchInterval(t){this.fetchInterval=t,R(this,oi,"f")&&(R(this,At,"f")&&clearTimeout(R(this,At,"f")),Te(this,At,setTimeout(()=>{this.disposed||R(this,He,"m",Fs).call(this)},t),"f"))}getImageFetchInterval(){return this.fetchInterval}setPixelFormat(t){Te(this,Pr,t,"f")}getPixelFormat(){return R(this,Pr,"f")}takePhoto(t){var r=this;if(!this.isOpen())throw new Error("Not open.");if(R(this,He,"m",et).call(this))throw new Error("'takePhoto()' is unavailable in 'singleFrameMode'.");const f=document.createElement("input");f.setAttribute("type","file"),f.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp"),f.setAttribute("capture",""),f.style.position="absolute",f.style.top="-9999px",f.style.backgroundColor="transparent",f.style.color="transparent",f.addEventListener("click",()=>{const C=this.isOpen();this.close(),window.addEventListener("focus",()=>{C&&this.open(),f.remove()},{once:!0})}),f.addEventListener("change",te(function*(){const C=f.files[0],T=yield(P=te(function*(N){let k=null,W=null;if(typeof createImageBitmap<"u")try{if(k=yield createImageBitmap(N),k)return k}catch{}var H;return k||(W=yield(H=N,new Promise((Z,X)=>{let q=URL.createObjectURL(H),ie=new Image;ie.src=q,ie.onload=()=>{URL.revokeObjectURL(ie.src),Z(ie)},ie.onerror=J=>{X(new Error("Can't convert blob to image : "+(J instanceof Event?J.type:J)))}}))),W}),function(N){return P.apply(this,arguments)})(C),S=T instanceof HTMLImageElement?T.naturalWidth:T.width,O=T instanceof HTMLImageElement?T.naturalHeight:T.height;var P;let x=cr.convert(R(r,Pi,"f"),S,O);x||(x={x:0,y:0,width:S,height:O});const L=R(r,Mr,"f").call(r,T,S,O,x);t&&t(L)})),document.body.appendChild(f),f.click()}convertToPageCoordinates(t){const r=R(this,He,"m",Ps).call(this,t);return{x:r.pageX,y:r.pageY}}convertToClientCoordinates(t){const r=R(this,He,"m",Ps).call(this,t);return{x:r.clientX,y:r.clientY}}dispose(){this.close(),R(this,be,"f").dispose(),this.releaseCameraView(),this.__proto__=null;for(let t in this)delete this[t];Object.defineProperty(this,"isCameraEnhancer",{value:!0}),Object.defineProperty(this,"disposed",{value:!0})}}function vt(p,t,r,f){if("a"===r&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?p!==t||!f:!t.has(p))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?f:"a"===r?f.call(p):f?f.value:t.get(p)}function Gt(p,t,r,f,C){if("m"===f)throw new TypeError("Private method is not writable");if("a"===f&&!C)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?p!==t||!C:!t.has(p))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===f?C.call(p,r):C?C.value=r:t.set(p,r),r}Ds=Ne,be=new WeakMap,Ae=new WeakMap,Bn=new WeakMap,si=new WeakMap,Fi=new WeakMap,Lr=new WeakMap,Mr=new WeakMap,Fr=new WeakMap,Un=new WeakMap,Pi=new WeakMap,Pr=new WeakMap,oi=new WeakMap,At=new WeakMap,$e=new WeakMap,ye=new WeakMap,Xt=new WeakMap,Ms=new WeakMap,He=new WeakSet,et=function(){return"disabled"!==this.singleFrameMode},Qo=function(){return!this.videoSrc&&"opened"===R(this,be,"f").state},$o=function(){for(let p in R(this,$e,"f"))if(1==R(this,$e,"f")[p])return!0;return!1},Fs=function p(){if(this.disposed)return;if("open"!==this.getCameraState()||!R(this,oi,"f"))return R(this,At,"f")&&clearTimeout(R(this,At,"f")),void Te(this,At,setTimeout(()=>{this.disposed||R(this,He,"m",p).call(this)},this.fetchInterval),"f");const t=()=>{var r;let f;Ne._onLog&&Ne._onLog("DCE: start fetching a frame into buffer: "+Date.now());try{f=this.fetchImage()}catch(C){const T=C.message||C;if("The video is not loaded."===T)return;if(null!==(r=R(this,Un,"f"))&&void 0!==r&&r.onErrorReceived)return void setTimeout(()=>{var S;null===(S=R(this,Un,"f"))||void 0===S||S.onErrorReceived(qr.EC_IMAGE_READ_FAILED,T)},0);console.warn(C)}f?(this.addImageToBuffer(f),Ne._onLog&&Ne._onLog("DCE: finish fetching a frame into buffer: "+Date.now()),R(this,si,"f").fire("frameAddedToBuffer",null,{async:!0})):Ne._onLog&&Ne._onLog("DCE: get a invalid frame, abandon it: "+Date.now())};if(this.getImageCount()>=this.getMaxImageCount())switch(this.getBufferOverflowProtectionMode()){case Ti.BOPM_BLOCK:break;case Ti.BOPM_UPDATE:t()}else t();R(this,At,"f")&&clearTimeout(R(this,At,"f")),Te(this,At,setTimeout(()=>{this.disposed||R(this,He,"m",p).call(this)},this.fetchInterval),"f")},Ps=function(p){if(!R(this,Ae,"f"))throw new Error("Camera view is not set.");if(R(this,Ae,"f").disposed)throw new Error("'cameraView' has been disposed.");if(!this.isOpen())throw new Error("Not open.");if(!R(this,He,"m",et).call(this)&&!R(this,be,"f").isVideoLoaded())throw new Error("Video is not loaded.");if(R(this,He,"m",et).call(this)&&!R(this,Ae,"f")._cvsSingleFrameMode)throw new Error("No image is selected.");const t=R(this,Ae,"f")._innerComponent.getBoundingClientRect(),r=t.left,f=t.top,C=r+window.scrollX,T=f+window.scrollY,{width:S,height:O}=R(this,Ae,"f")._innerComponent.getBoundingClientRect();if(S<=0||O<=0)throw new Error("Unable to get content dimensions. Camera view may not be rendered on the page.");let x,L,P;if(R(this,He,"m",et).call(this)){const ie=R(this,Ae,"f")._innerComponent.getElement("content");x=ie.width,L=ie.height,P="contain"}else{const ie=this.getVideoEl();x=ie.videoWidth,L=ie.videoHeight,P=R(this,Ae,"f").getVideoFit()}const N=S/O,k=x/L;let W,H,Z,X,q=1;if("contain"===P)N<k?(q=S/x,W=r+p.x*q,H=f+p.y*q+(O-L*q)/2,Z=C+p.x*q,X=T+p.y*q+(O-L*q)/2):(q=O/L,W=r+p.x*q+(S-x*q)/2,H=f+p.y*q,Z=C+p.x*q+(S-x*q)/2,X=T+p.y*q);else if("cover"===P)if(N<k){q=O/L;let ie=p.x*q-(x*q-S)/2;ie=Math.max(ie,0),ie=Math.min(ie,S),W=r+ie,H=f+p.y*q,Z=C+ie,X=T+p.y*q}else{q=S/x;let ie=p.y*q-(L*q-O)/2;ie=Math.max(ie,0),ie=Math.min(ie,O),W=r+p.x*q,H=f+ie,Z=C+p.x*q,X=T+ie}return{clientX:W,clientY:H,pageX:Z,pageY:X}},Ne._debug=!1,Ls={value:void 0},Ne.browserInfo=gt,"function"==typeof SuppressedError&&SuppressedError;class Ot{static multiply(t,r){const f=[];for(let C=0;C<3;C++){const T=r.slice(3*C,3*C+3);for(let S=0;S<3;S++){const O=[t[S],t[S+3],t[S+6]].reduce((x,L,P)=>x+L*T[P],0);f.push(O)}}return f}static identity(){return[1,0,0,0,1,0,0,0,1]}static translate(t,r,f){return Ot.multiply(t,[1,0,0,0,1,0,r,f,1])}static rotate(t,r){var f=Math.cos(r),C=Math.sin(r);return Ot.multiply(t,[f,-C,0,C,f,0,0,0,1])}static scale(t,r,f){return Ot.multiply(t,[r,0,0,0,f,0,0,0,1])}}var rt,li,hi,kr,on,jn,Gn,an,Nr,Ft,ia,Us,Yn,Hn;!function(p){p.GREY="grey",p.GREY32="grey32",p.RGBA="rgba",p.RBGA="rbga",p.GRBA="grba",p.GBRA="gbra",p.BRGA="brga",p.BGRA="bgra"}(rt||(rt={}));class Pe{static get version(){return"1.1.0"}static checkWebGLSupport(){return null===document.createElement("canvas").getContext("webgl")?(Gt(Pe,li,!1,"f",hi),!1):(Gt(Pe,li,!0,"f",hi),!0)}get disposed(){return vt(this,Nr,"f")}constructor(){kr.set(this,rt.RGBA),on.set(this,null),jn.set(this,null),Gn.set(this,null),this.useWebGLByDefault=!0,this._reusedCvs=null,this._reusedWebGLCvs=null,an.set(this,null),Nr.set(this,!1)}drawImage(t,r,f,C,T,S){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!f||!C)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==vt(Pe,li,"f",hi)&&Pe.checkWebGLSupport(),S?.bUseWebGL&&!vt(Pe,li,"f",hi))throw new Error("Your browser or machine may not support WebGL.");if(r instanceof HTMLVideoElement&&4!==r.readyState||r instanceof HTMLImageElement&&!r.complete)throw new Error("The source is not loaded.");let O;Pe._onLog&&(O=Date.now(),Pe._onLog("drawImage(), START: "+O));let x=0,L=0,P=f,N=C,k=0,W=0,H=f,Z=C;T&&(T.sx&&(x=Math.round(T.sx)),T.sy&&(L=Math.round(T.sy)),T.sWidth&&(P=Math.round(T.sWidth)),T.sHeight&&(N=Math.round(T.sHeight)),T.dx&&(k=Math.round(T.dx)),T.dy&&(W=Math.round(T.dy)),T.dWidth&&(H=Math.round(T.dWidth)),T.dHeight&&(Z=Math.round(T.dHeight)));let X,q=rt.RGBA;if(S?.pixelFormat&&(q=S.pixelFormat),S?.bufferContainer&&(X=S.bufferContainer,X.length<4*H*Z))throw new Error("Unexpected size of the 'bufferContainer'.");const ie=t;if(!vt(Pe,li,"f",hi)||!(this.useWebGLByDefault&&null==S?.bUseWebGL||S?.bUseWebGL)){Pe._onLog&&Pe._onLog("drawImage() in context2d."),ie.ctx2d||(ie.ctx2d=ie.getContext("2d",{willReadFrequently:!0}));const J=ie.ctx2d;if(!J)throw new Error("Unable to get 'CanvasRenderingContext2D' from canvas.");return(ie.width<k+H||ie.height<W+Z)&&(ie.width=k+H,ie.height=W+Z),J.drawImage(r,x,L,P,N,k,W,H,Z),Pe._onLog&&Pe._onLog("drawImage() in context2d end. Costs: "+(Date.now()-O)),{context:J,pixelFormat:rt.RGBA,bUseWebGL:!1}}Pe._onLog&&Pe._onLog("drawImage() in WebGL.");try{(ie.width<k+H||ie.height<W+Z)&&(ie.width=k+H,ie.height=W+Z,ie.ctxWebGL&&ie.ctxWebGL.viewport(0,0,k+H,W+Z));const J=ie.ctxWebGL||ie.getContext("webgl",{antialias:!1})||ie.getContext("experimental-webgl",{antialias:!1});if(!J){Pe._onLog&&Pe._onLog("Browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");const b=new Error("Unable to get 'WebGLRenderingContext'. Your browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");throw b.name="WebGLError",b}if(!ie.ctxWebGL||q!==vt(this,kr,"f")){ie.ctxWebGL=J;const b=i=>{const o=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,o),i.bufferData(i.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),i.STATIC_DRAW);const d=i.createBuffer();return i.bindBuffer(i.ARRAY_BUFFER,d),i.bufferData(i.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),i.STATIC_DRAW),{positions:o,texCoords:d}},me=i=>{const o=i.createTexture();return i.bindTexture(i.TEXTURE_2D,o),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),o},Re=(i,o)=>{const d=i.createProgram();if(o.forEach(y=>i.attachShader(d,y)),i.linkProgram(d),!i.getProgramParameter(d,i.LINK_STATUS)){const y=new Error(`An error occured linking the program: ${i.getProgramInfoLog(d)}.`);throw y.name="WebGLError",y}return i.useProgram(d),d},je=(i,o,d)=>{const y=i.createShader(o);if(i.shaderSource(y,d),i.compileShader(y),!i.getShaderParameter(y,i.COMPILE_STATUS)){const _=new Error(`An error occured compiling the shader: ${i.getShaderInfoLog(y)}.`);throw _.name="WebGLError",_}return y},u="\n                  attribute vec2 a_position;\n                  attribute vec2 a_texCoord;\n  \n                  uniform mat3 u_matrix;\n                  uniform mat3 u_textureMatrix;\n  \n                  varying vec2 v_texCoord;\n                  void main(void) {\n                  gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1.0);\n                  v_texCoord = vec4((u_textureMatrix * vec3(a_texCoord, 1)).xy, 0, 1.0).xy;\n                  }\n              ";let a="rgb";["rgba","rbga","grba","gbra","brga","bgra"].includes(q)&&(a=q.slice(0,3));const l=`\n                  precision mediump float;\n                  varying vec2 v_texCoord;\n                  uniform sampler2D u_image;\n                  uniform float uColorFactor;\n  \n                  void main() {\n                      vec4 sample = texture2D(u_image, v_texCoord);\n                      float grey = 0.21 * sample.r + 0.71 * sample.g + 0.07 * sample.b;\n                      gl_FragColor = vec4(sample.${a} * (1.0 - uColorFactor) + (grey * uColorFactor), sample.a);\n                  }\n              `,m=Re(J,[je(J,J.VERTEX_SHADER,u),je(J,J.FRAGMENT_SHADER,l)]);Gt(this,jn,{program:m,attribLocations:{vertexPosition:J.getAttribLocation(m,"a_position"),texPosition:J.getAttribLocation(m,"a_texCoord")},uniformLocations:{uSampler:J.getUniformLocation(m,"u_image"),uColorFactor:J.getUniformLocation(m,"uColorFactor"),uMatrix:J.getUniformLocation(m,"u_matrix"),uTextureMatrix:J.getUniformLocation(m,"u_textureMatrix")}},"f"),Gt(this,Gn,b(J),"f"),Gt(this,on,me(J),"f"),Gt(this,kr,q,"f")}const Ee=(b,me,Re)=>{b.bindBuffer(b.ARRAY_BUFFER,me),b.enableVertexAttribArray(Re),b.vertexAttribPointer(Re,2,b.FLOAT,!1,0,0)},xe=(b,me,Re,je)=>{b.clearColor(0,0,0,1),b.clearDepth(1),b.enable(b.DEPTH_TEST),b.depthFunc(b.LEQUAL),b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT),Ee(b,Re.positions,me.attribLocations.vertexPosition),Ee(b,Re.texCoords,me.attribLocations.texPosition),b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,je),b.uniform1i(me.uniformLocations.uSampler,0),b.uniform1f(me.uniformLocations.uColorFactor,[rt.GREY,rt.GREY32].includes(q)?1:0);let u,a,l=Ot.translate(Ot.identity(),-1,-1);l=Ot.scale(l,2,2),l=Ot.scale(l,1/b.canvas.width,1/b.canvas.height),u=Ot.translate(l,k,W),u=Ot.scale(u,H,Z),b.uniformMatrix3fv(me.uniformLocations.uMatrix,!1,u),a=Ot.translate(Ot.identity(),x/f,L/C),a=Ot.scale(a,P/f,N/C),b.uniformMatrix3fv(me.uniformLocations.uTextureMatrix,!1,a),b.drawArrays(b.TRIANGLES,0,6)};((b,me,Re)=>{const je=b.RGBA,u=b.RGBA,a=b.UNSIGNED_BYTE;b.bindTexture(b.TEXTURE_2D,me),b.texImage2D(b.TEXTURE_2D,0,je,u,a,Re)})(J,vt(this,on,"f"),r),xe(J,vt(this,jn,"f"),vt(this,Gn,"f"),vt(this,on,"f"));const Ie=X||new Uint8Array(4*H*Z);if(J.readPixels(k,W,H,Z,J.RGBA,J.UNSIGNED_BYTE,Ie),255!==Ie[3]){Pe._onLog&&Pe._onLog("Incorrect WebGL drawing .");const b=new Error("WebGL error: incorrect drawing.");throw b.name="WebGLError",b}return Pe._onLog&&Pe._onLog("drawImage() in WebGL end. Costs: "+(Date.now()-O)),{context:J,pixelFormat:q===rt.GREY?rt.GREY32:q,bUseWebGL:!0}}catch(J){if(this.forceLoseContext(),null==S?.bUseWebGL)return Pe._onLog&&Pe._onLog("'drawImage()' in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.drawImage(t,r,f,C,T,Object.assign({},S,{bUseWebGL:!1}));throw J.name="WebGLError",J}}readCvsData(t,r,f){if(!(t instanceof CanvasRenderingContext2D||t instanceof WebGLRenderingContext))throw new Error("Invalid 'context'.");let C,T=0,S=0,O=t.canvas.width,x=t.canvas.height;if(r&&(r.x&&(T=r.x),r.y&&(S=r.y),r.width&&(O=r.width),r.height&&(x=r.height)),f?.length<4*O*x)throw new Error("Unexpected size of the 'bufferContainer'.");if(t instanceof WebGLRenderingContext){const L=t;f?(L.readPixels(T,S,O,x,L.RGBA,L.UNSIGNED_BYTE,f),C=new Uint8Array(f.buffer,0,4*O*x)):(C=new Uint8Array(4*O*x),L.readPixels(T,S,O,x,L.RGBA,L.UNSIGNED_BYTE,C))}else if(t instanceof CanvasRenderingContext2D){let L;L=t.getImageData(T,S,O,x),C=new Uint8Array(L.data.buffer),f?.set(C)}return C}transformPixelFormat(t,r,f,C){let T,S;if(Pe._onLog&&(T=Date.now(),Pe._onLog("transformPixelFormat(), START: "+T)),r===f)return Pe._onLog&&Pe._onLog("transformPixelFormat() end. Costs: "+(Date.now()-T)),C?new Uint8Array(t):t;const O=[rt.RGBA,rt.RBGA,rt.GRBA,rt.GBRA,rt.BRGA,rt.BGRA];if(O.includes(r))if(f===rt.GREY){S=new Uint8Array(t.length/4);for(let x=0;x<t.length;x+=4)S[x/4]=.21*t[x]+.71*t[x+1]+.07*t[x+2]}else if(f===rt.GREY32){S=C?new Uint8Array(t):t;for(let x=0;x<t.length;x+=4){const L=.21*t[x]+.71*t[x+1]+.07*t[x+2];S[x]=L,S[x+1]=L,S[x+2]=L}}else{if(!O.includes(f))throw new Error("Unable to transform.");if(C){S=new Uint8Array(t);const x=r.indexOf("r"),L=r.indexOf("g"),P=r.indexOf("b"),N=f.indexOf("r"),k=f.indexOf("g"),W=f.indexOf("b");for(let H=0;H<t.length;H+=4)S[H+N]=t[H+x],S[H+k]=t[H+L],S[H+W]=t[H+P]}else{S=t;const x=r.indexOf("r"),L=r.indexOf("g"),P=r.indexOf("b"),N=f.indexOf("r"),k=f.indexOf("g"),W=f.indexOf("b");for(let H=0;H<t.length;H+=4){let Z=[t[H],t[H+1],t[H+2]];S[H+N]=Z[x],S[H+k]=Z[L],S[H+W]=Z[P]}}}else if(r===rt.GREY){if(f!==rt.GREY32)throw new Error("Unable to transform.");S=new Uint8Array(4*t.length);for(let x=0;x<t.length;x++)S[4*x]=t[x],S[4*x+1]=t[x],S[4*x+2]=t[x],S[4*x+3]=255}else{if(r!==rt.GREY32)throw new Error("Unable to transform.");if(f!==rt.GREY)throw new Error("Unable to transform.");S=new Uint8Array(t.length/4);for(let x=0;x<t.length;x+=4)S[x/4]=t[x]}return Pe._onLog&&Pe._onLog("transformPixelFormat() end. Costs: "+(Date.now()-T)),S}getImageData(t,r,f,C,T){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!r||!f)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==vt(Pe,li,"f",hi)&&Pe.checkWebGLSupport(),T?.bUseWebGL&&!vt(Pe,li,"f",hi))throw new Error("Your browser or machine may not support WebGL.");if(C.sx>r||C.sy>f||C.sx+C.sWidth>r||C.sy+C.sHeight>f)throw new Error("Invalid position.");if(t instanceof HTMLVideoElement&&4!==t.readyState||t instanceof HTMLImageElement&&!t.complete)throw new Error("The source is not loaded.");let S;Pe._onLog&&(S=Date.now(),Pe._onLog("getImageData(), START: "+S));const O=Math.round(C.sx),x=Math.round(C.sy),L=Math.round(C.sWidth),P=Math.round(C.sHeight),N=Math.round(C.dWidth),k=Math.round(C.dHeight);let W=rt.RGBA;T?.pixelFormat&&(W=T.pixelFormat);let H,Z,X,q=null;if(T?.bufferContainer&&(q=T.bufferContainer),vt(Pe,li,"f",hi)&&(this.useWebGLByDefault&&null==T?.bUseWebGL||T?.bUseWebGL)){Pe._onLog&&Pe._onLog("getImageData() in WebGL."),this._reusedWebGLCvs||(this._reusedWebGLCvs=document.createElement("canvas")),H=this._reusedWebGLCvs;try{if(q)if(W===rt.GREY){if(X=new Uint8Array(4*N*k),Z=this.drawImage(H,t,r,f,{sx:O,sy:x,sWidth:L,sHeight:P,dWidth:N,dHeight:k},{pixelFormat:W,bUseWebGL:!0,bufferContainer:X}),X=this.transformPixelFormat(X,Z.pixelFormat,W),q){if(q.length<X.length)throw new Error("Unexpected size of the 'bufferContainer'.");q.set(X)}}else Z=this.drawImage(H,t,r,f,{sx:O,sy:x,sWidth:L,sHeight:P,dWidth:N,dHeight:k},{pixelFormat:W,bUseWebGL:!0,bufferContainer:q}),X=new Uint8Array(q.buffer,0,4*N*k),X=this.transformPixelFormat(X,Z.pixelFormat,W);else W===rt.GREY?((!vt(this,an,"f")||vt(this,an,"f").length<4*N*k)&&Gt(this,an,new Uint8Array(4*N*k),"f"),X=new Uint8Array(vt(this,an,"f").buffer,0,4*N*k)):X=new Uint8Array(4*N*k),Z=this.drawImage(H,t,r,f,{sx:O,sy:x,sWidth:L,sHeight:P,dWidth:N,dHeight:k},{pixelFormat:W,bUseWebGL:!0,bufferContainer:X}),X=this.transformPixelFormat(X,Z.pixelFormat,W)}catch(ie){if("WebGLError"===ie.name&&(this.forceLoseContext(),null==T?.bUseWebGL))return Pe._onLog&&Pe._onLog("getImageData() in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.getImageData(t,r,f,{sx:O,sy:x,sWidth:L,sHeight:P,dWidth:N,dHeight:k},Object.assign({},T,{bUseWebGL:!1}));throw ie}}else if(Pe._onLog&&Pe._onLog("getImageData() in context2d."),this._reusedCvs||(this._reusedCvs=document.createElement("canvas")),H=this._reusedCvs,Z=this.drawImage(H,t,r,f,{sx:O,sy:x,sWidth:L,sHeight:P,dWidth:N,dHeight:k},{pixelFormat:rt.RGBA,bUseWebGL:!1}),X=this.readCvsData(Z.context,{width:N,height:k},null),X=this.transformPixelFormat(X,Z.pixelFormat,W),q){if(q.length<X.length)throw new Error("Unexpected size of the 'bufferContainer'.");q.set(X)}return Pe._onLog&&Pe._onLog("getImageData() end. Costs: "+(Date.now()-S)),{data:X,pixelFormat:W,width:N,height:k,bUseWebGL:Z.bUseWebGL}}convertDataToCvs(t,r,f,C){if(!(t instanceof Uint8Array||t instanceof Uint8ClampedArray))throw new TypeError("Invalid 'data'.");if("number"!=typeof r||r<=0)throw new Error("Invalid 'width'.");if("number"!=typeof f||f<=0)throw new Error("Invalid 'height'.");const T=document.createElement("canvas");let S;if(T.width=r,T.height=f,C===rt.GREY){S=new Uint8ClampedArray(4*r*f);for(let x=0;x<S.length;x+=4)S[x]=t[x/4],S[x+1]=t[x/4],S[x+2]=t[x/4],S[x+3]=255}else S=new Uint8ClampedArray(t.buffer);const O=new ImageData(S,r,f);return T.getContext("2d").putImageData(O,0,0),T}forceLoseContext(){if(!this._reusedWebGLCvs)return;const t=this._reusedWebGLCvs.ctxWebGL;t&&!t.isContextLost()&&t.getExtension("WEBGL_lose_context")&&t.getExtension("WEBGL_lose_context").loseContext(),Gt(this,on,null,"f"),Gt(this,jn,null,"f"),Gt(this,Gn,null,"f"),this._reusedWebGLCvs=null}dispose(){this.forceLoseContext(),Gt(this,Nr,!0,"f")}}li=Pe,kr=new WeakMap,on=new WeakMap,jn=new WeakMap,Gn=new WeakMap,an=new WeakMap,Nr=new WeakMap,hi={value:void 0};class hn{static beep(){if(!this.beepSoundSource)return;let t;if(R(this,Ft,"f",Yn).size&&(t=R(this,Ft,"f",Yn).values().next().value,this.beepSoundSource==t.src?(R(this,Ft,"f",Yn).delete(t),t.play()):t=null),!t)if(R(this,Ft,"f",Hn).size<64){t=new Audio(this.beepSoundSource);let r=null,f=()=>{t.removeEventListener("loadedmetadata",f),t.play(),r=setTimeout(()=>{R(this,Ft,"f",Hn).delete(t)},2e3*t.duration)};t.addEventListener("loadedmetadata",f),t.addEventListener("ended",()=>{null!=r&&(clearTimeout(r),r=null),t.pause(),t.currentTime=0,R(this,Ft,"f",Hn).delete(t),R(this,Ft,"f",Yn).add(t)})}else R(this,Ft,"f",Us)||(Te(this,Ft,!0,"f",Us),console.warn("The requested audio tracks exceed 64 and will not be played."));t&&R(this,Ft,"f",Hn).add(t)}static vibrate(){if(!navigator||!navigator.vibrate)throw new Error("Not supported.");navigator.vibrate(hn.vibrateDuration)}}Ft=hn,ia={value:"data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"},Us={value:!1},Yn={value:new Set},Hn={value:new Set},hn.beepSoundSource=R(hn,Ft,"f",ia),hn.vibrateDuration=300;const Gr={barcode:2,text_line:4,detected_quad:8,normalized_image:16},cn=p=>Object.values(Gr).includes(p)||Gr.hasOwnProperty(p),js=(p,t)=>"string"==typeof p?t[Gr[p]]:t[p],Gs=(p,t,r)=>{"string"==typeof p?t[Gr[p]]=r:t[p]=r};class Va{constructor(){this.verificationEnabled={[Le.CRIT_BARCODE]:!1,[Le.CRIT_TEXT_LINE]:!0,[Le.CRIT_DETECTED_QUAD]:!0,[Le.CRIT_NORMALIZED_IMAGE]:!1},this.duplicateFilterEnabled={[Le.CRIT_BARCODE]:!1,[Le.CRIT_TEXT_LINE]:!1,[Le.CRIT_DETECTED_QUAD]:!1,[Le.CRIT_NORMALIZED_IMAGE]:!1},this.duplicateForgetTime={[Le.CRIT_BARCODE]:3e3,[Le.CRIT_TEXT_LINE]:3e3,[Le.CRIT_DETECTED_QUAD]:3e3,[Le.CRIT_NORMALIZED_IMAGE]:3e3}}enableResultCrossVerification(t,r){cn(t)&&Gs(t,this.verificationEnabled,r)}isResultCrossVerificationEnabled(t){return!!cn(t)&&js(t,this.verificationEnabled)}enableResultDeduplication(t,r){cn(t)&&Gs(t,this.duplicateFilterEnabled,r)}isResultDeduplicationEnabled(t){return!!cn(t)&&js(t,this.duplicateFilterEnabled)}setDuplicateForgetTime(t,r){cn(t)&&(r>18e4&&(r=18e4),r<0&&(r=0),Gs(t,this.duplicateForgetTime,r))}getDuplicateForgetTime(t){return cn(t)?js(t,this.duplicateForgetTime):-1}getFilteredResultItemTypes(){let t=0;const r=[Le.CRIT_BARCODE,Le.CRIT_TEXT_LINE,Le.CRIT_DETECTED_QUAD];for(let f=0;f<r.length;f++)(this.verificationEnabled[r[f]]||this.duplicateFilterEnabled[r[f]])&&(t|=r[f]);return t}onOriginalImageResultReceived(t){}onDecodedBarcodesReceived(t){if(this.isResultCrossVerificationEnabled(Le.CRIT_BARCODE))for(let r=0;r<t.length;r++)t[r]&&t[r].type===Le.CRIT_BARCODE&&!t[r].verified&&(t[r].isFilter=!0);if(this.isResultDeduplicationEnabled(Le.CRIT_BARCODE))for(let r=0;r<t.length;r++)t[r]&&t[r].type===Le.CRIT_BARCODE&&t[r].duplicate&&(t[r].isFilter=!0)}onRecognizedTextLinesReceived(t){if(this.isResultCrossVerificationEnabled(Le.CRIT_TEXT_LINE))for(let r=0;r<t.length;r++)t[r]&&t[r].type===Le.CRIT_TEXT_LINE&&!t[r].verified&&(t[r].isFilter=!0);if(this.isResultDeduplicationEnabled(Le.CRIT_TEXT_LINE))for(let r=0;r<t.length;r++)t[r]&&t[r].type===Le.CRIT_TEXT_LINE&&t[r].duplicate&&(t[r].isFilter=!0)}onDetectedQuadsReceived(t){if(this.isResultCrossVerificationEnabled(Le.CRIT_DETECTED_QUAD))for(let r=0;r<t.length;r++)t[r]&&t[r].type===Le.CRIT_DETECTED_QUAD&&!t[r].verified&&(t[r].isFilter=!0);if(this.isResultDeduplicationEnabled(Le.CRIT_DETECTED_QUAD))for(let r=0;r<t.length;r++)t[r]&&t[r].type===Le.CRIT_DETECTED_QUAD&&t[r].duplicate&&(t[r].isFilter=!0)}onNormalizedImagesReceived(t){if(this.isResultCrossVerificationEnabled(Le.CRIT_NORMALIZED_IMAGE))for(let r=0;r<t.length;r++)t[r]&&t[r].type===Le.CRIT_NORMALIZED_IMAGE&&!t[r].verified&&(t[r].isFilter=!0);if(this.isResultDeduplicationEnabled(Le.CRIT_NORMALIZED_IMAGE))for(let r=0;r<t.length;r++)t[r]&&t[r].type===Le.CRIT_NORMALIZED_IMAGE&&t[r].duplicate&&(t[r].isFilter=!0)}}const Wa=["uiContainer"],Ya=["resultsContainer"];function Ha(p,t){if(1&p&&(ce.TgZ(0,"section",6)(1,"div",7)(2,"div",8)(3,"small"),ce._uU(4),ce.qZA()()(),ce.TgZ(5,"div",9)(6,"strong"),ce._uU(7),ce.qZA()()()),2&p){const r=ce.oxw();ce.xp6(4),ce.hij("Response: ",r.responseData.format,""),ce.xp6(3),ce.Oqu(r.responseData.text)}}let Xa=(()=>{class p{constructor(){this.pInit=null,this.uiContainer=null,this.resultsContainer=null,this.responseData={format:"",text:""}}init(){var r=this;return te(function*(){try{const f=yield lt.createInstance(),C=yield Ne.createInstance(f);r.uiContainer.nativeElement.append(f.getUIElement());const T=yield ze.createInstance();T.setInput(C);const S=new va;S.onDecodedBarcodesReceived=x=>{if(x.barcodeResultItems.length){r.resultsContainer.nativeElement.textContent="",console.log(x);for(let L of x.barcodeResultItems)r.responseData={format:L.formatString,text:L.text}}},T.addResultReceiver(S);const O=new Va;return O.enableResultCrossVerification("barcode",!0),O.enableResultDeduplication("barcode",!0),O.setDuplicateForgetTime("barcode",3e3),yield T.addResultFilter(O),yield C.open(),yield T.startCapturing("ReadSingleBarcode"),{cameraView:f,cameraEnhancer:C,router:T}}catch(f){let C=f.message||f;throw console.error(C),alert(C),f}})()}ngOnInit(){var r=this;return te(function*(){r.pInit=r.init()})()}ngOnDestroy(){var r=this;return te(function*(){if(r.pInit){const{cameraView:f,cameraEnhancer:C,router:T}=yield r.pInit;T.dispose(),C.dispose(),f.dispose()}r.uiContainer.nativeElement.innerText="",console.log("VideoCapture Component Unmount")})()}static#e=this.\u0275fac=function(f){return new(f||p)};static#t=this.\u0275cmp=ce.Xpm({type:p,selectors:[["video-capture"]],viewQuery:function(f,C){if(1&f&&(ce.Gf(Wa,5),ce.Gf(Ya,5)),2&f){let T;ce.iGM(T=ce.CRH())&&(C.uiContainer=T.first),ce.iGM(T=ce.CRH())&&(C.resultsContainer=T.first)}},decls:7,vars:1,consts:[[1,"div-ui-container"],["uiContainer",""],[1,"div-results-container"],["resultsContainer",""],[1,"content-results"],["class","results",4,"ngIf"],[1,"results"],[1,"content-header"],[1,"response"],[1,"content-response"]],template:function(f,C){1&f&&(ce._UZ(0,"div",0,1)(2,"br"),ce.TgZ(3,"div",2,3)(5,"div",4),ce.YNc(6,Ha,8,2,"section",5),ce.qZA()()),2&f&&(ce.xp6(6),ce.Q6J("ngIf",C.responseData.text))},dependencies:[qn.O5],styles:[".div-ui-container[_ngcontent-%COMP%]{width:100%;height:70vh}.div-results-container[_ngcontent-%COMP%]{width:100%;height:10vh;overflow:auto} {width:100%;min-width:15ch;max-width:30ch;border-radius:.25em;padding:.25em .5em;font-size:1.25rem}section.results[_ngcontent-%COMP%]{border-radius:12px;margin:16px 0;border:1px solid #c4c6d0}.content-response[_ngcontent-%COMP%]{padding:16px 24px;word-wrap:break-word}.content-header[_ngcontent-%COMP%]{align-content:center;align-items:center;display:flex;justify-content:center;padding:16px 16px 0 24px}.content-header[_ngcontent-%COMP%]   .response[_ngcontent-%COMP%]{flex:1 1 auto;color:#44474e}.content-header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{cursor:pointer;border:none;background:transparent;margin:auto 10px}"]})}return p})(),za=(()=>{class p{constructor(){this.showVideoCapture=!0,this.showOption=new ce.vpe}ngOnInit(){this.showOptionCapture(this.showVideoCapture)}onShowVideoCapture(){this.showOptionCapture(!0)}onShowImageCapture(){this.showOptionCapture(!1)}showOptionCapture(r){this.showVideoCapture=r,this.showOption.emit(this.showVideoCapture)}static#e=this.\u0275fac=function(f){return new(f||p)};static#t=this.\u0275cmp=ce.Xpm({type:p,selectors:[["header-navbar"]],outputs:{showOption:"showOption"},decls:8,vars:4,consts:[[1,"div-content"],[3,"click"]],template:function(f,C){1&f&&(ce.TgZ(0,"div",0)(1,"h1"),ce._uU(2,"WEB SCANNER READER PDF417"),ce.qZA(),ce.TgZ(3,"div")(4,"button",1),ce.NdJ("click",function(){return C.onShowVideoCapture()}),ce._uU(5,"Decode Video"),ce.qZA(),ce.TgZ(6,"button",1),ce.NdJ("click",function(){return C.onShowImageCapture()}),ce._uU(7,"Decode Image"),ce.qZA()()()),2&f&&(ce.xp6(4),ce.ekj("selected-option",C.showVideoCapture),ce.xp6(2),ce.ekj("selected-option",!C.showVideoCapture))},styles:["[_nghost-%COMP%]{--primary: #43555e;--secondary: #fff}.div-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;width:100%;height:100%;color:#43555e;text-align:center;background-color:#d3d3d3a8}.div-content[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:nth-of-type(1){margin-bottom:20px}button[_ngcontent-%COMP%]{font-size:1.5rem;margin:1.5vh 0;border:1px solid var(--primary);background-color:var(--secondary);color:var(--primary);border-radius:5px;padding:.5rem}button.selected-option[_ngcontent-%COMP%]{background-color:var(--primary);color:var(--secondary)}button[_ngcontent-%COMP%] ~ button[_ngcontent-%COMP%]{margin-left:20px}.container[_ngcontent-%COMP%]{margin:2vmin auto;height:70vh;width:80vw}h1[_ngcontent-%COMP%]{font-size:1.5em}"]})}return p})();function Za(p,t){1&p&&ce._UZ(0,"video-capture")}function qa(p,t){1&p&&ce._UZ(0,"image-capture")}const Ka=[{path:"",component:(()=>{class p{static#e=this.\u0275fac=function(f){return new(f||p)};static#t=this.\u0275cmp=ce.Xpm({type:p,selectors:[["app-content-managment"]],decls:2,vars:0,consts:[[1,"routes-container"]],template:function(f,C){1&f&&(ce.TgZ(0,"div",0),ce._UZ(1,"router-outlet"),ce.qZA())},dependencies:[Wr.lC]})}return p})(),children:[{path:"home",component:(()=>{class p{constructor(){this.showVideoCapture=!0}showOptionCapture(r){this.showVideoCapture=r}static#e=this.\u0275fac=function(f){return new(f||p)};static#t=this.\u0275cmp=ce.Xpm({type:p,selectors:[["home"]],decls:4,vars:2,consts:[[3,"showOption"],[1,"container"],[4,"ngIf"]],template:function(f,C){1&f&&(ce.TgZ(0,"header-navbar",0),ce.NdJ("showOption",function(S){return C.showOptionCapture(S)}),ce.qZA(),ce.TgZ(1,"div",1),ce.YNc(2,Za,1,0,"video-capture",2),ce.YNc(3,qa,1,0,"image-capture",2),ce.qZA()),2&f&&(ce.xp6(2),ce.Q6J("ngIf",C.showVideoCapture),ce.xp6(1),ce.Q6J("ngIf",!C.showVideoCapture))},dependencies:[qn.O5,Ta,Xa,za],styles:[".div-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;width:100%;height:100%;color:#43555e}.div-content[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:nth-of-type(1){margin-bottom:20px}button[_ngcontent-%COMP%]{font-size:1.5rem;margin:1.5vh 0;border:1px solid #43555e;background-color:#fff;color:#43555e;border-radius:5px}.container[_ngcontent-%COMP%]{margin:2vmin auto;height:70vh;width:80vw}h1[_ngcontent-%COMP%]{font-size:1.5em}"]})}return p})()}]},{path:"**",redirectTo:"",pathMatch:"full"}];let Ja=(()=>{class p{static#e=this.\u0275fac=function(f){return new(f||p)};static#t=this.\u0275mod=ce.oAB({type:p});static#i=this.\u0275inj=ce.cJS({imports:[Wr.Bz.forChild(Ka),Wr.Bz]})}return p})();var Qa=Ni(822);let $a=(()=>{class p{static#e=this.\u0275fac=function(f){return new(f||p)};static#t=this.\u0275mod=ce.oAB({type:p});static#i=this.\u0275inj=ce.cJS({imports:[qn.ez,Ja,Qa.K]})}return p})()}}]);